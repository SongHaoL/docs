<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.b8edc01d.css" as="style"><link rel="preload" href="/docs/assets/js/app.943739cd.js" as="script"><link rel="preload" href="/docs/assets/js/2.3d9c2800.js" as="script"><link rel="preload" href="/docs/assets/js/139.e9f6bd04.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.1b6443d6.js"><link rel="prefetch" href="/docs/assets/js/100.2771f4e0.js"><link rel="prefetch" href="/docs/assets/js/101.eca2f0fc.js"><link rel="prefetch" href="/docs/assets/js/102.c84eee7d.js"><link rel="prefetch" href="/docs/assets/js/103.3b9a983c.js"><link rel="prefetch" href="/docs/assets/js/104.7ecfd746.js"><link rel="prefetch" href="/docs/assets/js/105.7ddb716d.js"><link rel="prefetch" href="/docs/assets/js/106.2c7775dd.js"><link rel="prefetch" href="/docs/assets/js/107.c737b12d.js"><link rel="prefetch" href="/docs/assets/js/108.51225344.js"><link rel="prefetch" href="/docs/assets/js/109.061b49f1.js"><link rel="prefetch" href="/docs/assets/js/11.5cc2d18d.js"><link rel="prefetch" href="/docs/assets/js/110.e1160262.js"><link rel="prefetch" href="/docs/assets/js/111.cdcdc9fa.js"><link rel="prefetch" href="/docs/assets/js/112.90f2016f.js"><link rel="prefetch" href="/docs/assets/js/113.4b277914.js"><link rel="prefetch" href="/docs/assets/js/114.f4feb8f1.js"><link rel="prefetch" href="/docs/assets/js/115.9b0d4ff2.js"><link rel="prefetch" href="/docs/assets/js/116.87005108.js"><link rel="prefetch" href="/docs/assets/js/117.7d4aa07f.js"><link rel="prefetch" href="/docs/assets/js/118.4a1abd3e.js"><link rel="prefetch" href="/docs/assets/js/119.a49892b7.js"><link rel="prefetch" href="/docs/assets/js/12.33937275.js"><link rel="prefetch" href="/docs/assets/js/120.7b193373.js"><link rel="prefetch" href="/docs/assets/js/121.31e6c2e0.js"><link rel="prefetch" href="/docs/assets/js/122.fec515f3.js"><link rel="prefetch" href="/docs/assets/js/123.b8135806.js"><link rel="prefetch" href="/docs/assets/js/124.ca212621.js"><link rel="prefetch" href="/docs/assets/js/125.870194da.js"><link rel="prefetch" href="/docs/assets/js/126.b5ee96bc.js"><link rel="prefetch" href="/docs/assets/js/127.3f0081ae.js"><link rel="prefetch" href="/docs/assets/js/128.c3894d82.js"><link rel="prefetch" href="/docs/assets/js/129.5a9e8538.js"><link rel="prefetch" href="/docs/assets/js/13.ff457e04.js"><link rel="prefetch" href="/docs/assets/js/130.2099fa38.js"><link rel="prefetch" href="/docs/assets/js/131.1551d0a3.js"><link rel="prefetch" href="/docs/assets/js/132.bd022eba.js"><link rel="prefetch" href="/docs/assets/js/133.37068e78.js"><link rel="prefetch" href="/docs/assets/js/134.d197c9a6.js"><link rel="prefetch" href="/docs/assets/js/135.5acfd4b1.js"><link rel="prefetch" href="/docs/assets/js/136.69222be5.js"><link rel="prefetch" href="/docs/assets/js/137.f75900a0.js"><link rel="prefetch" href="/docs/assets/js/138.85ce5fa5.js"><link rel="prefetch" href="/docs/assets/js/14.eb589be3.js"><link rel="prefetch" href="/docs/assets/js/140.8b24bab2.js"><link rel="prefetch" href="/docs/assets/js/141.78cd2566.js"><link rel="prefetch" href="/docs/assets/js/142.f14638cf.js"><link rel="prefetch" href="/docs/assets/js/143.62c3e99a.js"><link rel="prefetch" href="/docs/assets/js/144.f1abadfd.js"><link rel="prefetch" href="/docs/assets/js/145.71e72026.js"><link rel="prefetch" href="/docs/assets/js/146.83d99514.js"><link rel="prefetch" href="/docs/assets/js/147.d3a99408.js"><link rel="prefetch" href="/docs/assets/js/148.540c24a8.js"><link rel="prefetch" href="/docs/assets/js/149.cd56d2f4.js"><link rel="prefetch" href="/docs/assets/js/15.d5b846f2.js"><link rel="prefetch" href="/docs/assets/js/150.6c8fad08.js"><link rel="prefetch" href="/docs/assets/js/151.82993155.js"><link rel="prefetch" href="/docs/assets/js/152.64ac1c40.js"><link rel="prefetch" href="/docs/assets/js/153.151f782d.js"><link rel="prefetch" href="/docs/assets/js/154.5e81ddda.js"><link rel="prefetch" href="/docs/assets/js/155.7b79d462.js"><link rel="prefetch" href="/docs/assets/js/156.6ca47cf7.js"><link rel="prefetch" href="/docs/assets/js/157.7b02a332.js"><link rel="prefetch" href="/docs/assets/js/158.ec96375a.js"><link rel="prefetch" href="/docs/assets/js/159.4c30a06f.js"><link rel="prefetch" href="/docs/assets/js/16.09e44cf2.js"><link rel="prefetch" href="/docs/assets/js/160.db1de307.js"><link rel="prefetch" href="/docs/assets/js/161.bc3ee83c.js"><link rel="prefetch" href="/docs/assets/js/162.dfaf0863.js"><link rel="prefetch" href="/docs/assets/js/163.f9472698.js"><link rel="prefetch" href="/docs/assets/js/164.d65d901b.js"><link rel="prefetch" href="/docs/assets/js/165.680c630b.js"><link rel="prefetch" href="/docs/assets/js/166.24938709.js"><link rel="prefetch" href="/docs/assets/js/167.e82726ea.js"><link rel="prefetch" href="/docs/assets/js/168.c660063a.js"><link rel="prefetch" href="/docs/assets/js/169.4cae7088.js"><link rel="prefetch" href="/docs/assets/js/17.90305846.js"><link rel="prefetch" href="/docs/assets/js/170.143c0d4c.js"><link rel="prefetch" href="/docs/assets/js/171.f097d8aa.js"><link rel="prefetch" href="/docs/assets/js/172.6f7b39bd.js"><link rel="prefetch" href="/docs/assets/js/173.00d72719.js"><link rel="prefetch" href="/docs/assets/js/174.67373a98.js"><link rel="prefetch" href="/docs/assets/js/175.23dbfd6b.js"><link rel="prefetch" href="/docs/assets/js/176.600ccdb9.js"><link rel="prefetch" href="/docs/assets/js/177.5f862766.js"><link rel="prefetch" href="/docs/assets/js/178.2e899bed.js"><link rel="prefetch" href="/docs/assets/js/179.1a35729c.js"><link rel="prefetch" href="/docs/assets/js/18.9b17b3ad.js"><link rel="prefetch" href="/docs/assets/js/180.c6c579f4.js"><link rel="prefetch" href="/docs/assets/js/181.06bb4eb3.js"><link rel="prefetch" href="/docs/assets/js/182.9a1f58d5.js"><link rel="prefetch" href="/docs/assets/js/183.94080e1d.js"><link rel="prefetch" href="/docs/assets/js/184.dfe42dd4.js"><link rel="prefetch" href="/docs/assets/js/185.be1e07c7.js"><link rel="prefetch" href="/docs/assets/js/186.f9320cc8.js"><link rel="prefetch" href="/docs/assets/js/187.fc197676.js"><link rel="prefetch" href="/docs/assets/js/188.a580066a.js"><link rel="prefetch" href="/docs/assets/js/189.203cb299.js"><link rel="prefetch" href="/docs/assets/js/19.cb7975b1.js"><link rel="prefetch" href="/docs/assets/js/190.b9db26d7.js"><link rel="prefetch" href="/docs/assets/js/191.91414e64.js"><link rel="prefetch" href="/docs/assets/js/192.0d46f9ca.js"><link rel="prefetch" href="/docs/assets/js/193.d90f5086.js"><link rel="prefetch" href="/docs/assets/js/194.9827c2ce.js"><link rel="prefetch" href="/docs/assets/js/195.abb048d8.js"><link rel="prefetch" href="/docs/assets/js/196.33987892.js"><link rel="prefetch" href="/docs/assets/js/197.14fa139c.js"><link rel="prefetch" href="/docs/assets/js/198.2771ce57.js"><link rel="prefetch" href="/docs/assets/js/199.01898f8e.js"><link rel="prefetch" href="/docs/assets/js/20.c0ca55ca.js"><link rel="prefetch" href="/docs/assets/js/21.e4e20cfd.js"><link rel="prefetch" href="/docs/assets/js/22.b4e42163.js"><link rel="prefetch" href="/docs/assets/js/23.f0e81db5.js"><link rel="prefetch" href="/docs/assets/js/24.584ba8e0.js"><link rel="prefetch" href="/docs/assets/js/25.96d28530.js"><link rel="prefetch" href="/docs/assets/js/26.922ceced.js"><link rel="prefetch" href="/docs/assets/js/27.e3c60b98.js"><link rel="prefetch" href="/docs/assets/js/28.24d30099.js"><link rel="prefetch" href="/docs/assets/js/29.f5c9fac3.js"><link rel="prefetch" href="/docs/assets/js/3.8582ba9c.js"><link rel="prefetch" href="/docs/assets/js/30.3a966c9e.js"><link rel="prefetch" href="/docs/assets/js/31.ff2a59af.js"><link rel="prefetch" href="/docs/assets/js/32.a37b1c09.js"><link rel="prefetch" href="/docs/assets/js/33.b0d42084.js"><link rel="prefetch" href="/docs/assets/js/34.0d6008cb.js"><link rel="prefetch" href="/docs/assets/js/35.fe56a588.js"><link rel="prefetch" href="/docs/assets/js/36.7613ef08.js"><link rel="prefetch" href="/docs/assets/js/37.4d23301c.js"><link rel="prefetch" href="/docs/assets/js/38.f6566171.js"><link rel="prefetch" href="/docs/assets/js/39.6fffa468.js"><link rel="prefetch" href="/docs/assets/js/4.51debccd.js"><link rel="prefetch" href="/docs/assets/js/40.01b01345.js"><link rel="prefetch" href="/docs/assets/js/41.5e6fd62e.js"><link rel="prefetch" href="/docs/assets/js/42.bc17cc4e.js"><link rel="prefetch" href="/docs/assets/js/43.b12bd60a.js"><link rel="prefetch" href="/docs/assets/js/44.d482c833.js"><link rel="prefetch" href="/docs/assets/js/45.81647c67.js"><link rel="prefetch" href="/docs/assets/js/46.ebeb4c40.js"><link rel="prefetch" href="/docs/assets/js/47.43cdfef7.js"><link rel="prefetch" href="/docs/assets/js/48.9fb386ba.js"><link rel="prefetch" href="/docs/assets/js/49.ddd6fec5.js"><link rel="prefetch" href="/docs/assets/js/5.b80e916b.js"><link rel="prefetch" href="/docs/assets/js/50.2ea8844c.js"><link rel="prefetch" href="/docs/assets/js/51.78550f87.js"><link rel="prefetch" href="/docs/assets/js/52.da138b9d.js"><link rel="prefetch" href="/docs/assets/js/53.10921130.js"><link rel="prefetch" href="/docs/assets/js/54.7c84ac8b.js"><link rel="prefetch" href="/docs/assets/js/55.cbea270f.js"><link rel="prefetch" href="/docs/assets/js/56.58e9dc64.js"><link rel="prefetch" href="/docs/assets/js/57.a264d039.js"><link rel="prefetch" href="/docs/assets/js/58.c6897ea4.js"><link rel="prefetch" href="/docs/assets/js/59.e369d2e6.js"><link rel="prefetch" href="/docs/assets/js/6.169b3707.js"><link rel="prefetch" href="/docs/assets/js/60.6c788ac5.js"><link rel="prefetch" href="/docs/assets/js/61.ce513008.js"><link rel="prefetch" href="/docs/assets/js/62.3873888e.js"><link rel="prefetch" href="/docs/assets/js/63.d566534d.js"><link rel="prefetch" href="/docs/assets/js/64.f74a9f7e.js"><link rel="prefetch" href="/docs/assets/js/65.79f84fb8.js"><link rel="prefetch" href="/docs/assets/js/66.e707c7ca.js"><link rel="prefetch" href="/docs/assets/js/67.986688f6.js"><link rel="prefetch" href="/docs/assets/js/68.a2f488e0.js"><link rel="prefetch" href="/docs/assets/js/69.059d49dd.js"><link rel="prefetch" href="/docs/assets/js/7.c00ca9e6.js"><link rel="prefetch" href="/docs/assets/js/70.22d516f3.js"><link rel="prefetch" href="/docs/assets/js/71.e845c40d.js"><link rel="prefetch" href="/docs/assets/js/72.cf6e4dd6.js"><link rel="prefetch" href="/docs/assets/js/73.2163549b.js"><link rel="prefetch" href="/docs/assets/js/74.b79d48ec.js"><link rel="prefetch" href="/docs/assets/js/75.735eceaa.js"><link rel="prefetch" href="/docs/assets/js/76.781e3bdc.js"><link rel="prefetch" href="/docs/assets/js/77.fbe1aac6.js"><link rel="prefetch" href="/docs/assets/js/78.d956e353.js"><link rel="prefetch" href="/docs/assets/js/79.57012fbf.js"><link rel="prefetch" href="/docs/assets/js/8.cc178099.js"><link rel="prefetch" href="/docs/assets/js/80.bffa8d1d.js"><link rel="prefetch" href="/docs/assets/js/81.b66a6bfe.js"><link rel="prefetch" href="/docs/assets/js/82.094ae501.js"><link rel="prefetch" href="/docs/assets/js/83.c25a4922.js"><link rel="prefetch" href="/docs/assets/js/84.7f0aacb3.js"><link rel="prefetch" href="/docs/assets/js/85.5c689a00.js"><link rel="prefetch" href="/docs/assets/js/86.dffffe26.js"><link rel="prefetch" href="/docs/assets/js/87.980a1339.js"><link rel="prefetch" href="/docs/assets/js/88.b534fafc.js"><link rel="prefetch" href="/docs/assets/js/89.d8cdb9a1.js"><link rel="prefetch" href="/docs/assets/js/9.de8a3333.js"><link rel="prefetch" href="/docs/assets/js/90.8a5fd5bb.js"><link rel="prefetch" href="/docs/assets/js/91.f2fe97c1.js"><link rel="prefetch" href="/docs/assets/js/92.27196680.js"><link rel="prefetch" href="/docs/assets/js/93.46f4dd64.js"><link rel="prefetch" href="/docs/assets/js/94.a5dfc706.js"><link rel="prefetch" href="/docs/assets/js/95.6cb4877f.js"><link rel="prefetch" href="/docs/assets/js/96.a0f86234.js"><link rel="prefetch" href="/docs/assets/js/97.7def1600.js"><link rel="prefetch" href="/docs/assets/js/98.d6416b19.js"><link rel="prefetch" href="/docs/assets/js/99.6733795c.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.b8edc01d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/project/mock.html" class="sidebar-link">前端数据mock</a></li><li><a href="/docs/project/module.html" class="sidebar-link">一文搞懂AMD,CMD,CommonJs,UMD,ES Modules</a></li><li><a href="/docs/project/babel.html" class="sidebar-link">Babel</a></li><li><a href="/docs/project/webpack.html" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#四个核心概念" class="sidebar-link">四个核心概念</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#模块热替换" class="sidebar-link">模块热替换</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#文件监听" class="sidebar-link">文件监听</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#文件指纹" class="sidebar-link">文件指纹</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#自动清理构建目录" class="sidebar-link">自动清理构建目录</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#css增强" class="sidebar-link">CSS增强</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#静态资源内联" class="sidebar-link">静态资源内联</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用-source-map" class="sidebar-link">使用 source map</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#提取页面的公共资源" class="sidebar-link">提取页面的公共资源</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#splitchunks" class="sidebar-link">splitChunks</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#scope-hoisting" class="sidebar-link">Scope Hoisting</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#代码分割和动态import" class="sidebar-link">代码分割和动态import</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack与ci-cd集成" class="sidebar-link">webpack与CI/CD集成</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack打包组件和基础库" class="sidebar-link">webpack打包组件和基础库</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack实现ssr打包" class="sidebar-link">webpack实现SSR打包</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#优化构建时命令行的显示" class="sidebar-link">优化构建时命令行的显示</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#commonschunkplugin" class="sidebar-link">CommonsChunkPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#cleanwebpackplugin" class="sidebar-link">CleanWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#extracttextwebpackplugin" class="sidebar-link">ExtractTextWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#copywebpackplugin" class="sidebar-link">CopyWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#uglifyjswebpackplugin" class="sidebar-link">UglifyjsWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#zipwebpackplugin" class="sidebar-link">ZipWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#minicssextractplugin" class="sidebar-link">MiniCssExtractPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#htmlwebpackplugin" class="sidebar-link">HtmlWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#path与publicpath" class="sidebar-link">path与publicPath</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#构建配置抽离成npm包" class="sidebar-link">构建配置抽离成npm包</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#构建包功能模块设计" class="sidebar-link">构建包功能模块设计</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#目录结构设计" class="sidebar-link">目录结构设计</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#冒烟测试" class="sidebar-link">冒烟测试</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#单元测试和测试覆盖率" class="sidebar-link">单元测试和测试覆盖率</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#构建包的持续集成和-travis-ci" class="sidebar-link">构建包的持续集成和 Travis CI</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#发布构建包到npm" class="sidebar-link">发布构建包到npm</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用webpack内部的stats进行构建包的初步分析" class="sidebar-link">使用webpack内部的stats进行构建包的初步分析</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用-speed-measure-webpack-plugin进行速度分析" class="sidebar-link">使用 speed-measure-webpack-plugin进行速度分析</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用-webpack-bundle-analyzer进行体积分析" class="sidebar-link">使用 webpack-bundle-analyzer进行体积分析</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#多进程-多实例并行压缩" class="sidebar-link">多进程/多实例并行压缩</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#通过设置externals进行分包" class="sidebar-link">通过设置Externals进行分包</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#缩小构建目标" class="sidebar-link">缩小构建目标</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#tree-shaking-在css中的优化" class="sidebar-link">Tree Shaking 在CSS中的优化</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用webpack进行图片压缩" class="sidebar-link">使用webpack进行图片压缩</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用动态的ployfill优化构建体积" class="sidebar-link">使用动态的Ployfill优化构建体积</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack启动过程分析" class="sidebar-link">webpack启动过程分析</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack-cli-源码阅读" class="sidebar-link">webpack-cli 源码阅读</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#tapable插件架构与hooks设计" class="sidebar-link">Tapable插件架构与Hooks设计</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#tapable是如何和webpack关联起来的" class="sidebar-link">Tapable是如何和webpack关联起来的</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack流程细剖-准备篇" class="sidebar-link">webpack流程细剖————准备篇</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#模块构建和chunk生成阶段" class="sidebar-link">模块构建和chunk生成阶段</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack流程篇-文件生成" class="sidebar-link">webpack流程篇————文件生成</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#实战篇-动手编写一个简易的webpack" class="sidebar-link">实战篇————动手编写一个简易的webpack</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#loader的链式调用和执行顺序" class="sidebar-link">Loader的链式调用和执行顺序</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用loader-runner高效进行loader的调式" class="sidebar-link">使用loader-runner高效进行loader的调式</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#更复杂的loader开发场景" class="sidebar-link">更复杂的loader开发场景</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#开发一个自动合成雪碧图的loader" class="sidebar-link">开发一个自动合成雪碧图的loader</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#插件基本结构介绍" class="sidebar-link">插件基本结构介绍</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#动手实现一个-loader-之简易的jsx-px2rem" class="sidebar-link">动手实现一个 loader 之简易的jsx-px2rem</a></li></ul></li><li><a href="/docs/project/autobuild.html" class="sidebar-link">前端轻量自动化构建方案</a></li><li><a href="/docs/project/err.html" class="sidebar-link">前端错误监控体系搭建</a></li><li><a href="/docs/project/standards.html" class="sidebar-link">前端代码规范</a></li><li><a href="/docs/project/docker.html" class="sidebar-link">从0开始学习docker</a></li><li><a href="/docs/project/autoTryCatch.html" class="sidebar-link">基于 Babel 和 AST自动添加 try catch 方法</a></li><li><a href="/docs/project/gitlabCI.html" class="sidebar-link">GitLab CI Pipeline框架</a></li></ul></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器插件扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信开发相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件推荐</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack">webpack</h1> <p><strong>本文所阐述的相关知识都是基于webpack4.x版本</strong></p> <h2 id="定义">定义</h2> <blockquote><p><code>webpack</code>是一个现代<code>JavasScript</code>应用程序的模块打包器(<code>module bunder</code>)</p></blockquote> <h2 id="四个核心概念">四个核心概念</h2> <ul><li><code>入口(entry)</code></li> <li><code>输出(output)</code></li> <li><code>loader</code></li> <li><code>插件(plugins)</code></li></ul> <h3 id="入口">入口</h3> <blockquote><p>指示 <code>webpack</code> 应该使用哪个模块，来作为构建其内部依赖图的开始。Webpack执行构建的第一步将从 入口开始，搜寻及递归解析出所有入口依赖的模块。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 最简单的单入口文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// entry 属性的单个入口语法，是下面的简写：</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config
</code></pre></div><h3 id="出口">出口</h3> <blockquote><p><code>output</code> 属性告诉 <code>webpack</code> 在哪里输出它所创建的 <code>bundles</code>，以及如何命名这些文件，默认值为 <code>./dist</code>。基本上，整个应用程序结构，都会被编译到你指定的输出路径的文件夹中。你可以通过在配置中指定一个 <code>output</code> 字段，来配置这些处理过程：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 简单的单入口 单出口配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'my-first-webpack.bundle.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="loader">loader</h3> <blockquote><p><code>loader</code> 让 <code>webpack</code> 能够去处理那些非 <code>JavaScript</code> 文件（<code>webpack</code> 自身只理解 <code>JavaScript</code>）。<code>loader</code> 可以将所有类型的文件转换为 <code>webpack</code> 能够处理的有效模块，然后你就可以利用 <code>webpack</code> 的打包能力，对它们进行处理。</p></blockquote> <p>本质上，<code>webpack loader</code> 将所有类型的文件，转换为应用程序的依赖图（和最终的 <code>bundle</code>）可以直接引用的模块。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 <code>webpack</code> 的配置中 <code>loader</code> 有两个目标：</p> <ul><li><code>test</code> 属性，用于标识出应该被对应的 <code>loader</code> 进行转换的某个或某些文件。</li> <li><code>use</code> 属性，表示进行转换时，应该使用哪个 <code>loader</code>。</li></ul> <p><code>thread-loader</code>:可以配置webpack进行多进程的打包js和css。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 简单的loader配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'my-first-webpack.bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> <span class="token comment">//匹配所有的js文件</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//除了node_modules以外</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 配置css loaders 假如在index.js中引入css 会被转化成commonjs对象</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// styles-loader 将css转化成style 插入到head中</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// url-loader可以处理一些图片大小转base64的功能   limit的单位是B(字节)</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.png|jpg|jpeg|gif$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span> loader<span class="token operator">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>options<span class="token operator">:</span><span class="token punctuation">{</span>limit<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div><h3 id="loader-特性">loader 特性</h3> <ol><li><p>loader 支持链式传递。能够对资源使用流水线(pipeline)。一组链式的 loader 将按照相反的顺序执行。loader 链中的第一个 loader 返回值给下一个 loader。在最后一个 loader，返回 webpack 所预期的 JavaScript。</p></li> <li><p>loader 可以是同步的，也可以是异步的。</p></li> <li><p>loader 运行在 Node.js 中，并且能够执行任何可能的操作。</p></li> <li><p>loader 接收查询参数。用于对 loader 传递配置。</p></li> <li><p>loader 也能够使用 options 对象进行配置。</p></li> <li><p>除了使用 package.json 常见的 main 属性，还可以将普通的 npm 模块导出为 loader，做法是在 package.json 里定义一个 loader 字段。</p></li> <li><p>插件(plugin)可以为 loader 带来更多特性。</p></li> <li><p>loader 能够产生额外的任意文件。</p></li></ol> <h3 id="插件-plugins">插件(plugins)</h3> <blockquote><p><code>loader</code> 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p></blockquote> <p>想要使用一个插件，你只需要 <code>require()</code> 它，然后把它添加到 <code>plugins</code> 数组中。多数插件可以通过选项(<code>option</code>)自定义。你也可以在一个配置文件中因为不同目的而多次使用同一个插件，这时需要通过使用 <code>new</code> 操作符来创建它的一个实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 npm 安装</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用于访问内置插件</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>webpack</code> 提供许多开箱可用的插件！查阅<a href="https://www.webpackjs.com/plugins/" target="_blank" rel="noopener noreferrer">插件列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>获取更多信息。</p></div> <h3 id="模式-mode">模式(mode)</h3> <blockquote><p><code>webpack</code>内置了两个不同的模式(<code>development</code>、<code>production</code> ),通过选择 <code>development</code> 或 <code>production</code> 之中的一个，来设置 <code>mode</code> 参数，你可以启用相应模式下的 <code>webpack</code> 内置的优化。</p></blockquote> <p><strong>- <code>development</code>模式下，将侧重于功能调试和优化开发体验，包含如下内容：</strong></p> <ol><li>浏览器调试工具</li> <li>开发阶段的详细错误日志和提示</li> <li>快速和优化的增量构建机制</li></ol> <p><strong>- <code>production模式下</code>，将侧重于模块体积优化和线上部署，包含如下内容：</strong></p> <ol><li>开启所有的优化代码</li> <li>更小的<code>bundle</code>大小</li> <li>去除掉只在开发阶段运行的代码</li> <li><code>Scope hoisting</code>和<code>Tree-shaking</code></li> <li>自动启用<code>uglifyjs</code>对代码进行压缩</li></ol> <h3 id="manifest">manifest</h3> <p><strong>在使用 webpack 构建的典型应用程序或站点中，有三种主要的代码类型：</strong></p> <ol><li>你或你的团队编写的源码。</li> <li>你的源码会依赖的任何第三方的 library 或 &quot;vendor&quot; 代码。</li> <li>webpack 的 <code>runtime</code> 和 <code>manifest</code>，管理所有模块的交互。</li></ol> <p><strong>Runtime</strong></p> <p>如上所述，我们这里只简略地介绍一下。runtime，以及伴随的 manifest 数据，主要是指：在浏览器运行时，webpack 用来连接模块化的应用程序的所有代码。runtime 包含：在模块交互时，连接模块所需的加载和解析逻辑。包括浏览器中的已加载模块的连接，以及懒加载模块的执行逻辑。</p> <p><strong>Manifest</strong>
那么，一旦你的应用程序中，形如 index.html 文件、一些 bundle 和各种资源加载到浏览器中，会发生什么？你精心安排的 /src 目录的文件结构现在已经不存在，所以 webpack 如何管理所有模块之间的交互呢？这就是 manifest 数据用途的由来……</p> <p>当编译器(compiler)开始执行、解析和映射应用程序时，它会保留所有模块的详细要点。这个数据集合称为 &quot;Manifest&quot;，当完成打包并发送到浏览器时，会在运行时通过 Manifest 来解析和加载模块。无论你选择哪种模块语法，那些 import 或 require 语句现在都已经转换为 <strong>webpack_require</strong> 方法，此方法指向模块标识符(module identifier)。通过使用 manifest 中的数据，runtime 将能够查询模块标识符，检索出背后对应的模块。</p> <h2 id="模块热替换">模块热替换</h2> <p>模块热替换(HMR - Hot Module Replacement)功能会在应用程序运行过程中替换、添加或删除模块，而无需重新加载整个页面。主要是通过以下几种方式，来显著加快开发速度：</p> <ul><li><p>保留在完全重新加载页面时丢失的应用程序状态。</p></li> <li><p>只更新变更内容，以节省宝贵的开发时间。</p></li> <li><p>调整样式更加快速 - 几乎相当于在浏览器调试器中更改样式。</p></li></ul> <p>你可以设置 HMR，以使此进程自动触发更新，或者你可以选择要求在用户交互时进行更新。通常我们可以使用<code>webpack-dev-server</code>来进行处理。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><p><code>webpack-dev-server</code> 不会刷新浏览器</p></li> <li><p><code>webpack-dev-server</code> 不输出文件,二是放在内存中</p></li> <li><p>使用 <code>HotModuleReplacementPlugin</code> 插件(webpack自带)</p></li> <li><p>使用 <code>webpack-dev-middleware</code>也可以实现相同的功能，不过这种方式会将<code>webpack</code>输出的文件传输给服务器,适用于灵活的定制场景。</p></li></ul></div> <h3 id="热更新原理">热更新原理</h3> <p><img src="https://img-blog.csdnimg.cn/20200515205923186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="极客时间热更原理"></p> <h2 id="文件监听">文件监听</h2> <blockquote><p>文件监听是在发现源码发生变化的时候,自动的构建出新的输出文件。</p></blockquote> <p>webpack中开启监听模式有两种方式实现:</p> <ul><li><p>启动 <code>webpack</code> 的时候带上 <code>--watch</code> 参数</p></li> <li><p>在配置 <code>webpack.config.js</code> 的时候设置 <code>watch:true</code></p></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>这种方式虽然webpack构建是成功了 但是需要开发者手动刷新浏览器才会显示效果</p></div> <h3 id="文件监听的原理">文件监听的原理</h3> <blockquote><p>轮询的判断文件的最后编辑时间是否发生了变化。当某个文件发生了变化，并不会立即告诉监听者，而是先缓存起来,等待 <code>aggregateTimeout</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>modules<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token comment">// 默认是false 不开启</span>
   watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token comment">// 只有watch开启之后才会有效</span>
   watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token comment">// 默认为空 不监听的文件或文件夹 支持正则匹配</span>
     ignored<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
     <span class="token comment">// 监听到变化后等待多少ms之后执行 默认是300ms</span>
     aggregateTimeout<span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span>
     <span class="token comment">// 判断文件是否发生变化通过不停询问系统指定文件有没有变化实现的， 默认为每秒询问1000次</span>
     poll<span class="token operator">:</span> <span class="token number">1000</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="文件指纹">文件指纹</h2> <blockquote><p>文件指纹其实指的就是每次文件打包之后后面跟着的<code>HashCode</code>,用来做版本管理等功能</p></blockquote> <h3 id="分类">分类</h3> <ul><li><p><code>Hash</code>: 和整个项目的构建有关,只要项目文件有修改,整个项目构建的hash值就会更改。</p></li> <li><p><code>Chunkhash</code>: 和<code>webpack</code>打包的<code>chunk</code>有关，不同的<code>entry</code>会生成不同的<code>chunkhash</code>。</p></li> <li><p><code>Contenthash</code>: 根据文件的内容来定义<code>hash</code>,文件内容不变,则<code>contenthash</code>不变。</p></li></ul> <h2 id="自动清理构建目录">自动清理构建目录</h2> <ul><li>2020.05.18</li></ul> <p>默认情况下每次webpack的构建的需要手动去清除之前构建产生的目录文件，这样在实际工程中就变得很麻烦。下面将会讲解几种自动化清理构建目录的方法。</p> <ol><li>通过script命令</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>rm <span class="token operator">-</span>rf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
<span class="token comment">// rimraf 是个插件库</span>
rimraf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
</code></pre></div><ol start="2"><li>使用 <code>clean-webpack-plugin</code> 插件</li></ol> <blockquote><p>这个插件默认会删除 <code>output</code> 指定的输出目录</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="css增强">CSS增强</h2> <h3 id="_1-自动补全属性兼容">1. 自动补全属性兼容</h3> <p>CSS3某些属性其实在不同浏览器的支持情况不一样，以前的css代码中经常会出现以下这种qingx</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token property">-moz-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">-webkit-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">-o-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">-ms-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
</code></pre></div><p>如何只编写W3C规范的属性，其余的让大宝工具自动帮助我们完成?</p> <p>其实我们可以通过使用<code>post-css</code>和<code>autoprefixer</code>插件来辅助我们完成这个功能。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rule<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'style-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'css-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'postcss-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            overrideBrowserslist<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 4 versions'</span><span class="token punctuation">,</span> <span class="token string">'ie 9'</span><span class="token punctuation">,</span> <span class="token string">'android 4.4.4'</span><span class="token punctuation">,</span> <span class="token string">'ios 8'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'sass-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    modifyVars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>机制是在CanIUse上查找兼容性。</p> <h3 id="_2-自动px转rem适配移动端">2. 自动px转rem适配移动端</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  addPostcssPlugins<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;customize-cra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">addPostcssPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-px2rem'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> remUnit<span class="token operator">:</span> <span class="token number">75</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// px转换成rem</span>

<span class="token comment">// 早期版本</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'px2rem-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        remUnit<span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span><span class="token comment">// 1rem = 75px  750设计稿</span>
        remPrecision<span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">,</span><span class="token comment">// px转rem小数点位数</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>推荐使用手机淘宝的<a href="https://github.com/amfe/lib-flexible" target="_blank" rel="noopener noreferrer"><code>lib-flexible</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>库配套使用 或者使用本博客对应的js技巧篇中的方法。</p></div> <h2 id="静态资源内联">静态资源内联</h2> <h3 id="意义">意义</h3> <ul><li><p>页面框架的初始化脚本</p></li> <li><p>上报相关打点</p></li> <li><p>CSS内联避免页面闪动</p></li> <li><p>小图片或者字体内联 减少<code>HTTP</code>请求数</p></li></ul> <h3 id="实现">实现</h3> <p>主要是用 <code>raw-loader</code>来实现静态资源内联。</p> <h3 id="功能">功能</h3> <ul><li><code>raw-loader</code> 内联html</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raw-loader!babel-loader!./meta.html'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><code>raw-loader</code> 内联js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raw-loader!babel-loader!../node_modules/lib_flexible'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="实现css内联">实现css内联</h3> <ol><li>借助<code>style-loader</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span><span class="token punctuation">{</span>
        insertAt<span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span><span class="token comment">// 样式插入head</span>
        singleton<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 将所有的style标签合并成一个</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>使用<code>html-inline-css-webpack-plugin</code></li></ol> <h2 id="使用-source-map">使用 source map</h2> <blockquote><p>soure map可以将打包后的文件与原文件建立映射 方便查找打包之前的文件、定位错误</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意: 一般仅在开发环境开启</p></div> <h3 id="关键字">关键字</h3> <ul><li><p><code>eval</code>: 使用<code>eval</code>包裹模块代码</p></li> <li><p><code>source map</code>: 产生<code>.map</code>文件</p></li> <li><p><code>cheap</code>: 不包含列信息</p></li> <li><p><code>inline</code>: 将<code>.map</code>作为<code>DataURI</code>嵌入,不单独生成<code>.map</code>文件</p></li> <li><p><code>module</code>: 包含<code>loader</code>的<code>sourcemap</code></p></li></ul> <h2 id="提取页面的公共资源">提取页面的公共资源</h2> <h3 id="基础库的分离">基础库的分离</h3> <blockquote><p>将react、react-dom等基础包通过cdn引入,不打入bundle中。</p></blockquote> <p>实际操作起来就是将这些库使用<code>externals</code>进行引入或者使用<code>splitChunks</code>进行分割.</p> <p><strong>使用 <code>html-webpack-externals-plugin</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 安装</span>
npm i html<span class="token operator">-</span>webpack<span class="token operator">-</span>externals<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>


<span class="token comment">// 使用 </span>
<span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-externals-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        externals<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            module<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
            entry<span class="token operator">:</span> <span class="token string">'cdn文件地址'</span><span class="token punctuation">,</span>
            global<span class="token operator">:</span> <span class="token string">'React'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            module<span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
            entry<span class="token operator">:</span> <span class="token string">'cdn文件地址'</span><span class="token punctuation">,</span>
            global<span class="token operator">:</span> <span class="token string">'ReactDOM'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;依赖地址&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="splitchunks">splitChunks</h2> <ul><li>2020.05.18</li></ul> <p><code>splitChunks</code>算是<code>webpack</code>中比较高级的一个用法，主要是跟<code>模块拆分</code>与<code>代码拆分</code>功能相关。</p> <p>在研究<code>splitChunks</code>之前，我们先再回顾下<code>webpack</code>中的<code>module</code>、<code>chunk</code>和<code>bundle</code>。</p> <ul><li><p><code>module</code>：就是js的模块化<code>webpack</code>支持<code>commonJS</code>、<code>ES6</code>等模块化规范，简单来说就是你通过<code>import</code>语句引入的代码。</p></li> <li><p><code>chunk</code>: <code>chunk</code>是<code>webpack</code>根据功能拆分出来的，包含三种情况：</p> <ol><li>你的项目入口<code>（entry）</code></li> <li>通过<code>import()</code>动态引入的代码</li> <li>通过<code>splitChunks</code>拆分出来的代码</li></ol></li></ul> <p><code>chunk</code>包含着<code>module</code>，可能是一对多也可能是一对一。</p> <ul><li><code>bundle</code>：<code>bundle</code>是<code>webpack</code>打包之后的各个文件，一般就是和<code>chunk</code>是一对一的关系，<code>bundle</code>就是对<code>chunk</code>进行编译压缩打包等处理之后的产出。</li></ul> <p>在<code>webpack4</code>之后有一个默认的<code>splitChunks</code>配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="chunks">chunks</h3> <p><code>chunks</code>的含义是拆分模块的范围，它有三个值<code>async</code>、<code>initial</code>和<code>all</code>。</p> <ul><li><code>async</code>表示只从异步加载得模块（<code>动态加载import()</code>）里面进行拆分</li> <li><code>initial</code>表示只从入口模块进行拆分</li> <li><code>all</code>表示以上两者都包括</li></ul> <p><code>chunks</code>的默认配置是<code>async</code>，也就是只从<code>动态加载得模块</code>里面进行拆分</p> <h3 id="cachegroups">cacheGroups</h3> <p><code>cacheGroups</code>其实是<code>splitChunks</code>里面最核心的配置,<code>splitChunks</code>就是根据<code>cacheGroups</code>去拆分模块的.</p> <p><code>splitChunks</code>默认有两个缓存组：<code>vender</code>和<code>default</code>。</p> <p>如果有一个模块满足了多个缓存组的条件就会去按照权重划分，谁的权重高就优先按照谁的规则处理。</p> <h3 id="maxinitialrequests">maxInitialRequests</h3> <blockquote><p>表示允许入口并行加载的最大请求数。</p></blockquote> <p>之所以有这个配置也是为了对拆分数量进行限制，不至于拆分出太多模块导致请求数量过多而得不偿失。</p> <p><strong>这里需要注意几点：</strong></p> <ol><li>入口文件本身算一个请求</li> <li>如果入口里面有动态加载得模块这个不算在内</li> <li>通过<code>runtimeChunk</code>拆分出的<code>runtime</code>不算在内</li> <li>只算<code>js</code>文件的请求，<code>css</code>不算在内</li> <li>如果同时又两个模块满足<code>cacheGroup</code>的规则要进行拆分，但是<code>maxInitialRequests</code>的值只能允许再拆分一个模块，那尺寸更大的模块会被拆分出来</li></ol> <h3 id="maxasyncrequests">maxAsyncRequests</h3> <p><code>maxAsyncRequests</code>和<code>maxInitialRequests</code>有相似之处，它俩都是用来限制拆分数量的，<code>maxInitialRequests</code>是用来限制入口的拆分数量而<code>maxAsyncRequests</code>是用来限制异步模块内部的并行最大请求数的，说白了你可以理解为是<code>每个import()</code>它里面的最大并行请求数量。</p> <p><strong>这其中要注意以下几点：</strong></p> <ol><li><p><code>import()</code>文件本身算一个请求</p></li> <li><p>并不算js以外的公共资源请求比如css</p></li> <li><p>如果同时有两个模块满足<code>cacheGroup</code>的规则要进行拆分，但是<code>maxInitialRequests</code>的值只能允许再拆分一个模块，那<code>尺寸更大</code>的模块会被拆分出来</p></li></ol> <h3 id="其余要点">其余要点</h3> <ol><li><p><code>splitChunks.cacheGroup</code>必须同时满足各个条件才能生效，比如<code>minSize</code>或是<code>minChunks</code>等条件必须同时满足才行</p></li> <li><p><code>splitChunks</code>的配置项都是作用于<code>cacheGroup</code>上的，如果将<code>cacheGroup</code>的默认两个分组<code>vendor</code>和<code>default</code>设置为<code>false</code>，则<code>splitChunks</code>就不会起作用</p></li> <li><p><code>minChunks</code>、<code>maxAsyncRequests</code>、<code>maxInitialRequests</code>的值必须设置为大于等于1的数</p></li> <li><p>当<code>chunk</code>没有名字时，通过<code>splitChunks</code>分出的模块的名字用<code>id</code>替代，当然你也可以通过<code>name</code>属性自定义</p></li> <li><p>当<code>父chunk</code>和<code>子chunk</code>同时引入相同的<code>module</code>时，并不会将其分割出来而是删除掉<code>子chunk</code>里面共同的<code>module</code>，保留<code>父chunk</code>的<code>module</code>，这个是因为 <code>optimization.removeAvaliableModules</code> 默认是<code>true</code></p></li> <li><p>当两个<code>cacheGroup.priority</code>相同时，先定义的会先命中</p></li> <li><p>除了<code>js</code>，<code>splitChunks</code>也适用于<code>css</code></p></li></ol> <h2 id="tree-shaking">Tree Shaking</h2> <ul><li>2020.05.19</li></ul> <blockquote><p>一个模块里可能有很多个方法,只要其中的某个方法使用到了,则整个文件都会被打包到 <code>bundle</code>中去，<code>tree shaking</code>就是只把用到的方法打入到 <code>bundle</code> , 没用到的方法会在 <code>ugify阶段</code>被擦除掉,从而减小了包的体积。</p></blockquote> <h3 id="使用">使用</h3> <p><code>webpack</code>默认支持, 在 <code>.barbelrc</code> 里面设置 <code>modules: false</code> 即可。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>webpack4之后在<code>mode:production</code> 的情况下默认开启。</p> <p>必须是ES6的语法, CJS的方式不支持,且其中编写的方法不能有副作用，否则就会失效。</p></div> <p><strong>副作用解释</strong></p> <blockquote><p>对于相同的输入就有相同的输出，不依赖外部环境，也不改变外部环境。</p></blockquote> <p>符合上述的描述就可以称为纯函数，反之就是带有副作用。</p> <h3 id="原理">原理</h3> <p>利用ES6模块的特点:</p> <ul><li>只能作为模块顶层的语句出现,只在文件的顶层,不能在代码中动态导入</li> <li><code>import</code>的模块名只能是字符串常量</li> <li><code>import binding</code> 是 <code>immutable</code> 的</li></ul> <p>代码擦除:</p> <ul><li><code>uglify</code>阶段删除无用代码。</li></ul> <h3 id="扩展">扩展</h3> <ul><li>2020.05.19</li></ul> <p>上述描述到如果模块是不纯,那么<code>tree shaking</code>检测就会失效，如何优化这部分的功能呢?</p> <p>这里可以配合使用另外一个插件<code>webpack-deep-scope-plugin</code>。</p> <blockquote><p><code>webpack-deep-scope-plugin</code>是一位中国同胞(学生)在<code>Google夏令营</code>，在导师Tobias带领下写的一个<code>webpack</code>插件。主要用于填充<code>webpack</code>自身<code>Tree-shaking</code>的不足，通过<code>作用域分析</code>来消除无用的代码。</p></blockquote> <h2 id="scope-hoisting">Scope Hoisting</h2> <ul><li>2020.05.19</li></ul> <blockquote><p><code>scope hoisting</code> 是 <code>webpack3</code> 的新功能，直译过来就是<code>「作用域提升」</code>。熟悉 <code>JavaScript</code> 都应该知道<code>「函数提升」</code>和<code>「变量提升」</code>，<code>JavaScript</code> 会把函数和变量声明提升到当前作用域的顶部。<code>「作用域提升」</code>也类似于此，<code>webpack</code> 会把引入的 <code>js</code> 文件“提升到”它的引入者顶部。</p></blockquote> <h3 id="现象">现象</h3> <p>在未使用<code>Scope Hoisting</code>的情况下,编译后的代码中存在着大量的闭包代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 编译前</span>
<span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'xxxx'</span><span class="token punctuation">;</span>

<span class="token comment">// b.js</span>
<span class="token keyword">import</span> index <span class="token keyword">from</span> <span class="token string">'./a'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 编译后</span>

<span class="token comment">/****/</span> <span class="token string">&quot;./app/index/app.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******************!*\
  !*** ./app/index/app.js ***!
  \**************************/</span>
<span class="token comment">/*! no exports provided */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> __js_index__WEBPACK_IMPORTED_MODULES_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./js/index */</span> <span class="token string">&quot;./app/index/app.js&quot;</span><span class="token punctuation">)</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__js_index__WEBPACK_IMPORTED_MODULES_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">/****/</span> <span class="token string">&quot;./app/index/js/index.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******************!*\
  !*** ./app/index/js/index.js ***!
  \**************************/</span>
<span class="token comment">/*! export provided:default */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* harmony default export */</span> __webpack_exoirts__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'xxxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>这样会导致:</strong></p> <ol><li><p>大量闭包函数包裹代码，导致体积增大(模块越多的情况下越明显)</p></li> <li><p>运行代码时创建的函数作用域变多,内存开销变大</p></li></ol> <h3 id="原理之模块转化分析">原理之模块转化分析</h3> <p>我们来探究下为什么经过<code>webpack</code>打包之后会产生这么多的闭包函数，先来了解下<code>webpack</code>的<code>模块转化</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 打包之前的代码</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> helloword <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./helloworld'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'../../common'</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">helloworld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 打包之后的模块初始化函数</span>
<span class="token comment">/* 0 */</span>
<span class="token comment">/***/</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import (指es6的import语法)*/</span> <span class="token keyword">var</span> _common_WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> _helloworld_WEBPACK_IMPORTED_MODULE_1__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">Object</span><span class="token punctuation">(</span>_helloworld_WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">[</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="结论">结论</h4> <ul><li><p>被 <code>webpack</code> 转化后的模块会带上一层包裹</p></li> <li><p><code>import</code> 会被转化成 <code>__webpack_require</code></p></li></ul> <h3 id="进一步分析-webpack-的模块机制">进一步分析 <code>webpack</code> 的模块机制</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">/* 0 module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/* 1 module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/* n module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="结论-2">结论</h4> <ul><li><p><code>webpack</code>打包出来的是一个 <code>IIFE(匿名闭包)</code></p></li> <li><p><code>modules</code> 是一个数组,每一项是一个模块初始化函数</p></li> <li><p><code>__webpack_require</code> 用来加载模块, 返回的是 <code>module.exports</code></p></li> <li><p>通过<code>WEBPACK_REQUIRE_METHOD(0)</code>来启动程序</p></li></ul> <h3 id="scope-hoisting-原理">Scope Hoisting 原理</h3> <blockquote><p>将所有模块的代码按照引用顺序放在一个函数作用域里, 然后适当的重命名一些变量以防止变量名冲突。</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200519145232537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="Scope Hoisting 原理"></p> <h3 id="scope-hoisting-使用">Scope Hoisting 使用</h3> <p><strong>在<code>webpack4</code>下 <code>mode</code> 为 <code>production</code> 时默认开启了此功能。</strong></p> <h2 id="代码分割和动态import">代码分割和动态import</h2> <ul><li>2020.05.19</li></ul> <h3 id="如何动态的import">如何动态的import</h3> <ol><li>安装 babel 插件</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm install @babel/plugin-syntax-dynamic-import --save-dev
</code></pre></div><ol start="2"><li>配置<code>.babelrc</code>文件的<code>plugins</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'@babel/plugin-syntax-dynamic-import'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何使用">如何使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="内部原理">内部原理</h3> <p>通过 <code>webpackJsonp</code> 请求异步加载。动态创建<code>script标签</code>,然后引入。</p> <h2 id="webpack与ci-cd集成">webpack与CI/CD集成</h2> <ul><li>2020.05.19</li></ul> <h3 id="本地开发增加precommit钩子">本地开发增加<code>precommit</code>钩子</h3> <ol><li>安装 <code>husky</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm install husky --save-dev
</code></pre></div><ol start="2"><li>增加 <code>npm script</code>，通过 <code>lint-staged</code> 增量检查修改的文件</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span><span class="token punctuation">,</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;precommit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git rev-parse --abbrev-ref HEAD | if ! [[ $(xargs) =~ 'gray|master|t\\d*' ]]; then lint-staged; fi&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;linters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;*.{js,scss}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;git add&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="webpack打包组件和基础库">webpack打包组件和基础库</h2> <ul><li>2020.05.19</li></ul> <blockquote><p><code>webpack</code>除了打包应用，也可以用来打包js库和一些自定义组件库。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>单纯只是打包js库和组件库的话 使用<a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer"><code>rollup</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>打包也是一个不错的选择</p></div> <p><strong>我们来实现一个简单的打包例子，这个例子需要满足以下几点功能:</strong></p> <ol><li><p>需要支持打包<code>压缩版(x.min.js)</code>和<code>非压缩版本(x.js)</code>。</p></li> <li><p>支持 <code>AMD/CJS/ESM</code> 模块引入。</p></li> <li><p>支持通过<code>script</code>脚本直接引入链接。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ESM</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Tool <span class="token keyword">from</span> <span class="token string">'tools'</span><span class="token punctuation">;</span>

<span class="token comment">//cjs</span>
<span class="token keyword">const</span> Tool <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tools'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// AMD</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'tools'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// script 脚本</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://xxx.com/tools&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>如何将库暴露出去？</strong></p> <ul><li><p><code>library</code>：指定库的全局变量</p></li> <li><p><code>libraryTarget</code>：支持库引入的方式</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
   entry<span class="token operator">:</span> <span class="token punctuation">{</span>
     tools<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
     tools<span class="token punctuation">.</span>min<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   output<span class="token operator">:</span><span class="token punctuation">{</span>
     filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
     library<span class="token operator">:</span> <span class="token string">&quot;tools&quot;</span><span class="token punctuation">,</span>
     libraryExport<span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
     libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span><span class="token comment">// var this window ...</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>接下来让我们开始表演:</strong></p> <h3 id="_1-新建项目-webpack-build-tools-安装webpack和webpack-cli">1.新建项目 <code>webpack-build-tools</code> 安装<code>webpack</code>和<code>webpack-cli</code></h3> <div class="language- extra-class"><pre class="language-text"><code>mkdir webpack-build-tools

cd webpack-build-tools

npm init -y

npm i webpack webpack-cli
</code></pre></div><h3 id="_2-新建目录-src-index-js-编写我们的工具代码">2. 新建目录 <code>src/index.js</code>,编写我们的工具代码</h3> <p>此处的代码来自我的博客下 <code>js-tips</code> 仅作为示例使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 将参数中的null undefined转化为空
 * @param {String} el 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">,</span> <span class="token string">'undefined'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> el
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 正则表示法
 * 思路:通过正则表达式获取url上的参数 然后通过数组reduce追加到对象中
 * 
 * @param {string} url 需要获取的url地址默认为当前地址
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">getUrlParameters</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * match返回字符串中匹配结果的数组,匹配不到返回null
     * [^?=&amp;]+ 匹配除了?=&amp;之外的字符 仅匹配一次
     * Array.reduce(callBack(prev,cur,index,array), initialValue)
     * Array.slice(start,[end]) 返回start-end的元素
     */</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)=([^&amp;]*)/g</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-安装-terser-webpack-plugin-压缩插件">3. 安装 <code>terser-webpack-plugin</code> 压缩插件</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i terser-webpack-plugin -D
</code></pre></div><h3 id="_4-新建-webpack-config-js">4. 新建 <code>webpack.config.js</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">// 引入压缩插件</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token comment">// 因为默认是production 默认会进行压缩</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;tools&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;tools.min&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token string">&quot;tools&quot;</span><span class="token punctuation">,</span>
        libraryExport<span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 不添加的话引用的时候需要 tools.default</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">// var this window ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 使用压缩插件</span>
                include<span class="token operator">:</span> <span class="token regex">/\.min\.js$/</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-修改-package-json-添加打包命令">5. 修改 <code>package.json</code> 添加打包命令</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-build-tools&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js常用工具函数&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;webpack-build-tools&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xjl271314&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.43.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.11&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;terser-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-打包并查看打包效果">6. 打包并查看打包效果</h3> <div class="language- extra-class"><pre class="language-text"><code>npm run build
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20200519174826824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="打包结果"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// tools.js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpackUniversalModuleDefinition</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span>
		module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span>
		<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span>
		exports<span class="token punctuation">[</span><span class="token string">&quot;tools&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		root<span class="token punctuation">[</span><span class="token string">&quot;tools&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
<span class="token comment">/******/</span> 	<span class="token comment">// The module cache</span>
<span class="token comment">/******/</span> 	<span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// The require function</span>
<span class="token comment">/******/</span> 	<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Check if module is in cache</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			<span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Create a new module (and put it into the cache)</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
<span class="token comment">/******/</span> 			l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token comment">/******/</span> 			exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Execute the module function</span>
<span class="token comment">/******/</span> 		modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Flag the module as loaded</span>
<span class="token comment">/******/</span> 		module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Return the exports of the module</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// expose the modules object (__webpack_modules__)</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// expose the module cache</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// define getter function for harmony exports</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> getter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token operator">:</span> getter <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// define __esModule on exports</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'Module'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// create a fake namespace object</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 1: value is a module id, require it</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 2: merge all properties of value into the ns</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 4: return value when already ns object</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 8|1: behave like require</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> value <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> ns <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> ns<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// getDefaultExport function for compatibility with non-harmony modules</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> getter <span class="token operator">=</span> module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule <span class="token operator">?</span>
<span class="token comment">/******/</span> 			<span class="token keyword">function</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">:</span>
<span class="token comment">/******/</span> 			<span class="token keyword">function</span> <span class="token function">getModuleExports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		__webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> getter<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// Object.prototype.hasOwnProperty.call</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// __webpack_public_path__</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// Load entry module and return exports</span>
<span class="token comment">/******/</span> 	<span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/************************************************************************/</span>
<span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token comment">/* 0 */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;transferDefectParams&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> transferDefectParams<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> getUrlParameters<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 将参数中的null undefined转化为空
 * @param {String} el 
 */</span>
<span class="token keyword">function</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">,</span> <span class="token string">'undefined'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> el
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 正则表示法
 * 思路:通过正则表达式获取url上的参数 然后通过数组reduce追加到对象中
 * 
 * @param {string} url 需要获取的url地址默认为当前地址
 */</span>
<span class="token keyword">function</span> <span class="token function">getUrlParameters</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * match返回字符串中匹配结果的数组,匹配不到返回null
     * [^?=&amp;]+ 匹配除了?=&amp;之外的字符 仅匹配一次
     * Array.reduce(callBack(prev,cur,index,array), initialValue)
     * Array.slice(start,[end]) 返回start-end的元素
     */</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)=([^&amp;]*)/g</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/******/</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// tools.min.js</span>
<span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> exports<span class="token operator">&amp;&amp;</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> module<span class="token operator">?</span>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">&quot;function&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> define<span class="token operator">&amp;&amp;</span>define<span class="token punctuation">.</span>amd<span class="token operator">?</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> exports<span class="token operator">?</span>exports<span class="token punctuation">.</span>tools<span class="token operator">=</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>e<span class="token punctuation">.</span>tools<span class="token operator">=</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> t<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">return</span> t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span><span class="token keyword">var</span> o<span class="token operator">=</span>t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token operator">:</span>r<span class="token punctuation">,</span>l<span class="token operator">:</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>exports<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> e<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>o<span class="token punctuation">,</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>l<span class="token operator">=</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">}</span><span class="token keyword">return</span> n<span class="token punctuation">.</span>m<span class="token operator">=</span>e<span class="token punctuation">,</span>n<span class="token punctuation">.</span>c<span class="token operator">=</span>t<span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">d</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t<span class="token punctuation">,</span>r</span><span class="token punctuation">)</span><span class="token punctuation">{</span>n<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token operator">||</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">,</span><span class="token punctuation">{</span>enumerable<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">get</span><span class="token operator">:</span>r<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">r</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;undefined&quot;</span><span class="token operator">!=</span><span class="token keyword">typeof</span> Symbol<span class="token operator">&amp;&amp;</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token operator">&amp;&amp;</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token string">&quot;Module&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">t</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token function">n</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token keyword">return</span> e<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> e<span class="token operator">&amp;&amp;</span>e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span><span class="token keyword">return</span> e<span class="token punctuation">;</span><span class="token keyword">var</span> r<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>enumerable<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>value<span class="token operator">:</span>e<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token string">&quot;string&quot;</span><span class="token operator">!=</span><span class="token keyword">typeof</span> e<span class="token punctuation">)</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token keyword">in</span> e<span class="token punctuation">)</span>n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>o<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> r<span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">n</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> t<span class="token operator">=</span>e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token operator">?</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">.</span>default<span class="token punctuation">}</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">o</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span>p<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token function">n</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>s<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">[</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;undefined&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">&quot;&quot;</span><span class="token operator">:</span>e<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">o</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">=</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">const</span> t<span class="token operator">=</span>e<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)=([^&amp;]*)/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> t<span class="token operator">?</span>t<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;transferDefectParams&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> r<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> o<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-设置入口文件-不同环境下使用不同的入口文件">7.设置入口文件 不同环境下使用不同的入口文件</h3> <p><code>package.json</code>中的<code>main</code>字段为<code>index.js</code>，所以在项目根目录下新建 <code>index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 通过环境变量来决定入口文件</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/tools.min.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/tools.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-进行npm包发布-需要注册npm账号-且进行登录">8.进行npm包发布(需要注册npm账号,且进行登录)</h3> <div class="language- extra-class"><pre class="language-text"><code>npm publish
</code></pre></div><h3 id="_9-同步代码到git-并编写对应的说明文档等">9. 同步代码到git,并编写对应的说明文档等</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 其他项目引用</span>
npm i tools <span class="token operator">-</span>s

<span class="token keyword">import</span> getUrlParameters <span class="token keyword">from</span> <span class="token string">'tools'</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>完整代码参见<a href="https://github.com/xjl271314/webpack-build-tools" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="webpack实现ssr打包">webpack实现SSR打包</h2> <ul><li>2020.05.19</li></ul> <ol><li><p>客户端渲染: HTML + CSS + JS + Data ————&gt; 渲染后的HTML</p></li> <li><p>服务端渲染:</p></li></ol> <ul><li><p>所有的模板等资源都存储在服务器</p></li> <li><p>内网机器拉取更快</p></li> <li><p>一个 HTML 返回所有的数据</p></li></ul> <p><img src="https://img-blog.csdnimg.cn/20200519202722384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="渲染差别"></p> <h3 id="ssr代码实现思路">SSR代码实现思路</h3> <ul><li>服务端：</li></ul> <ol><li><p>使用 <code>react-dom/server</code> 的 <code>renderToString</code> 方法将 <code>React组件</code> 渲染成字符串。</p></li> <li><p>服务端路由返回对应的模板。</p></li></ol> <ul><li>客户端</li></ul> <p>打包出针对服务端的组件。</p> <h3 id="简单示例">简单示例</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;build:ssr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.ssr.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>目录下新建 <code>server/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* server/index.js */</span>

<span class="token comment">// 兼容window报错</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/xx-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token parameter">port</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port:'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">server</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
        &lt;title&gt;Document&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>组件目录下创建<code>index-server.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index-server.js server端不能识别import 需要使用commonjs规范</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> React <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Example</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token operator">&lt;</span>Example <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>创建 <code>webpack.ssr.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.ssr.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name-server].js'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="打包过程中遇到的问题">打包过程中遇到的问题</h3> <h4 id="浏览器的全局变量-node-js-中没有document-window">浏览器的全局变量(<code>Node.js</code> 中没有<code>document</code>, <code>window</code>)</h4> <ul><li><p>组件适配: 将不兼容的组件根据打包环境进行适配</p></li> <li><p>请求适配: 将<code>fetch</code> 或者 <code>ajax</code> 发送请求的写法改成 <code>isomorphic-fetch</code> 或者 <code>axios</code></p></li></ul> <h4 id="样式问题-node-js-无法解析css">样式问题(<code>Node.js</code> 无法解析<code>CSS</code>)</h4> <ul><li><p>服务端打包通过 <code>ignore-loader</code> 忽略掉 <code>CSS的解析</code></p></li> <li><p>将<code>style-loader</code> 替换成 <code>isomorphic-style-loader</code></p></li> <li><p>或者使用内联样式<code>style</code></p></li></ul> <h3 id="解决打包样式问题">解决打包样式问题</h3> <p>使用打包出来的浏览器端 html 文件作为模板, 设置占位符, 动态插入组件。</p> <p>修改 <code>/server/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>修改对应的 <code>template.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- HTML_PLCAEHOLDER ---&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="优化构建时命令行的显示">优化构建时命令行的显示</h2> <ul><li>2020.05.26</li></ul> <p>实际开发过程中当我们进行打包<code>npm run build</code>或者在开发过程中<code>npm run dev</code>的时候会在控制台输出大量的信息。</p> <h3 id="使用-friendly-errors-webpack-plugin-优化日志显示">使用 <code>friendly-errors-webpack-plugin</code> 优化日志显示</h3> <ul><li><p><code>success</code>: 构建成功的日志提示</p></li> <li><p><code>warning</code>: 构建警告的日志提示</p></li> <li><p><code>error</code>: 构建报错的日志提示</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>stats<span class="token operator">:</span> <span class="token string">'errors-only'</span>
<span class="token operator">...</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="commonschunkplugin">CommonsChunkPlugin</h2> <ul><li>2020.05.18</li></ul> <blockquote><p>主要是用来提取第三方库和公共模块，避免<code>首屏加载的bundle文件</code>或者<code>按需加载的bundle文件</code>体积过大，从而导致加载时间过长，是一把优化项目的利器。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>webpack4</code>之后推荐使用<code>splitChunks</code>替代该方法。</p></div> <h3 id="chunk有哪几种，主要有以下三种：">chunk有哪几种，主要有以下三种：</h3> <ol><li><p><code>webpack</code>当中配置的<code>入口文件（entry）</code>是<code>chunk</code>，可以理解为<code>entry chunk</code></p></li> <li><p>入口文件以及它的依赖文件通过<code>code split（代码分割</code>）出来的也是<code>chunk</code>，可以理解为<code>children chunk</code></p></li> <li><p>通过<code>commonsChunkPlugin</code>创建出来的文件也是<code>chunk</code>，可以理解为<code>commons chunk</code></p></li></ol> <h3 id="可配置的属性：">可配置的属性：</h3> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">属性说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>name</code></td> <td style="text-align:left;">可以是已经存在的<code>chunk（一般指入口文件</code>）对应的<code>name</code>，那么就会把公共模块代码合并到这个<code>chunk</code>上；否则，就会创建名字为<code>name</code>的<code>commons chunk</code>进行合并</td></tr> <tr><td style="text-align:left;"><code>filename</code></td> <td style="text-align:left;">指定<code>commons chunk</code>的文件名</td></tr> <tr><td style="text-align:left;"><code>chunks</code></td> <td style="text-align:left;">指定该<code>source chunk</code>，即指定从哪些<code>chunk</code>当中去找公共模块，省略该选项的时候，默认就是<code>entry chunks</code></td></tr> <tr><td style="text-align:left;"><code>minChunks</code></td> <td style="text-align:left;">既可以数字，也可以是函数，还可以是<code>Infinity</code></td></tr></tbody></table> <h4 id="插件的作用">插件的作用:</h4> <p>单独分离出第三方库、自定义公共模块、webpack运行文件</p> <ul><li>抽离webpack运行文件，修改webpack配置文件：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'runtime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">Infinity</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>上面这段抽离<code>webpack</code>运行文件代码的意思是创建一个名为<code>runtime</code>的<code>commons chunk</code>进行<code>webpack</code>运行文件的抽离，其中<code>source chunks</code>是<code>vendor.js</code>。</p> <h2 id="cleanwebpackplugin">CleanWebpackPlugin</h2> <blockquote><p>清理构建目录</p></blockquote> <h2 id="extracttextwebpackplugin">ExtractTextWebpackPlugin</h2> <blockquote><p>将CSS从bundle中提取成一个独立的css文件</p></blockquote> <h2 id="copywebpackplugin">CopyWebpackPlugin</h2> <blockquote><p>将文件或者文件夹拷贝到构建的输出目录</p></blockquote> <h2 id="uglifyjswebpackplugin">UglifyjsWebpackPlugin</h2> <blockquote><p>压缩JS</p></blockquote> <h2 id="zipwebpackplugin">ZipWebpackPlugin</h2> <blockquote><p>将打包出的资源生成一个zip包</p></blockquote> <h2 id="minicssextractplugin">MiniCssExtractPlugin</h2> <ul><li>2020.05.29</li></ul> <blockquote><p>将css打包成单独的css文件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// npm i  mini-css-extract-plugin</span>

<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包为开发模式</span>
    entry<span class="token operator">:</span> <span class="token string">&quot;./src/main&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件,从项目根目录指定</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//输出路径和文件名，使用path模块resolve方法将输出路径解析为绝对路径</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist/js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将js文件打包到dist/js的目录</span>
        filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
	    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
	      <span class="token punctuation">{</span>
	        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
	        use<span class="token operator">:</span> <span class="token punctuation">[</span>
	        	MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
	        	<span class="token punctuation">{</span>
		            loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
		            options<span class="token operator">:</span> <span class="token punctuation">{</span>
		              minimize<span class="token operator">:</span> <span class="token boolean">true</span>
		            <span class="token punctuation">}</span>
		        <span class="token punctuation">}</span><span class="token punctuation">,</span>
	        <span class="token punctuation">]</span>
	      <span class="token punctuation">}</span>
	    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	filename<span class="token operator">:</span> <span class="token string">&quot;../css/styles.css&quot;</span> <span class="token comment">//如果需要将css文件单独放入css文件夹中需要../</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="htmlwebpackplugin">HtmlWebpackPlugin</h2> <ol><li><p><a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>HtmlWebpackPlugin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> star: 8.5K</p> <p>主要有两个作用:</p> <ol><li><p>为<code>html</code>文件中引入的外部资源如<code>script</code>、<code>link</code>动态添加每次<code>compile</code>后的<code>hash</code>，防止引用缓存的外部文件问题</p></li> <li><p>可以生成创建<code>html</code>入口文件，比如单页面可以生成一个<code>html</code>文件入口，配置N个<code>html-webpack-plugin</code>可以生成N个页面入口</p></li></ol> <p>常用的字段：</p> <ul><li><p><code>title</code>:设置生成<code>html</code>文件的标题 默认值为:<code>Webpack App</code></p></li> <li><p><code>filename</code>: 输出的<code>html</code>的文件名称 默认值为:<code>index.html</code></p></li> <li><p><code>template</code>: html模板所在的文件路径</p></li></ul> <p>根据自己的指定的模板文件来生成特定的 <code>html</code> 文件。这里的模板类型可以是任意你喜欢的模板，可以是 <code>html</code>, <code>jade</code>, <code>ejs</code>, <code>hbs</code>, 等等，但是要注意的是，使用自定义的模板文件时，需要提前安装对应的 <code>loader</code>， 否则<code>webpack</code>不能正确解析。</p> <ul><li><p><code>inject</code>:注入选项。</p> <ol><li><code>true</code>：默认值，script标签位于html文件的 body 底部</li> <li><code>body</code>：script标签位于html文件的 body 底部（同 true）</li> <li><code>head</code>：script 标签位于 head 标签内</li> <li><code>false</code>：不插入生成的 js 文件，只是单纯的生成一个 html 文件</li></ol></li> <li><p><code>favicon</code>:给生成的 <code>html</code> 文件生成一个 <code>favicon</code>。属性值为 <code>favicon</code> 文件所在的路径名</p></li> <li><p><code>minify</code>:对 <code>html</code> 文件进行压缩，<code>minify</code> 的属性值是一个压缩选项或者 <code>false</code> 。默认值为<code>false</code>, 不对生成的 <code>html</code> 文件进行压缩。</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 部分省略，具体看minify的配置</span>
        minify<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">//是否对大小写敏感，默认false</span>
            caseSensitive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否简写boolean格式的属性如：disabled=&quot;disabled&quot; 简写为disabled  默认false</span>
            collapseBooleanAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否去除空格，默认false</span>
            collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否压缩html里的css（使用clean-css进行的压缩） 默认值false；</span>
            minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否压缩html里的js（使用uglify-js进行的压缩）</span>
            minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//Prevents the escaping of the values of attributes</span>
            preventAttributesEscaping<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否移除属性的引号 默认false</span>
            removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否移除注释 默认false</span>
            removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//从脚本和样式删除的注释 默认false</span>
            removeCommentsFromCDATA<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否删除空属性，默认false</span>
            removeEmptyAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//若开启此项，生成的html中没有 body 和 head，html也未闭合</span>
            removeOptionalTags<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
            
            <span class="token comment">//删除多余的属性</span>
            removeRedundantAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            
            <span class="token comment">//删除script的类型属性，在h5下面script的type默认值：text/javascript 默认值false</span>
            removeScriptTypeAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//删除style的类型属性， type=&quot;text/css&quot; 同上</span>
            removeStyleLinkTypeAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//使用短的文档类型，默认false</span>
            useShortDoctype<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p><code>hash</code>:给生成的 <code>js</code> 文件一个独特的 <code>hash</code> 值，该 <code>hash</code> 值是该次 <code>webpack</code> 编译的 <code>hash</code> 值。默认值为 <code>false</code> 。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        hash<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// 编译后</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span>bundle<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token number">22</span>b9692e22e7be37b57e<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><p><code>cache</code>:默认是<code>true</code>的，表示内容变化的时候生成一个新的文件。</p></li> <li><p><code>showErrors</code>:如果 webpack 编译出现错误，webpack会将错误信息包裹在一个 pre 标签内，属性的默认值为 true ，也就是显示错误信息。开启这个，方便定位错误.</p></li> <li><p><code>chunks</code>:chunks主要用于多入口文件，当你有多个入口文件，那就会编译后生成多个打包后的文件，那么<code>chunks</code> 就能选择你要使用那些js文件。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    devor<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/devor.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    main<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">httpWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// 打包后</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span><span class="token string">&quot;main.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 而如果没有指定 chunks 选项，默认会全部引用。</span>
</code></pre></div><ul><li><code>excludeChunks</code>:排除掉一些js不进行打包</li></ul></li></ol> <h2 id="path与publicpath">path与publicPath</h2> <p>在复杂的项目里可能会有一些构建出的资源需要异步加载，加载这些异步资源需要对应的URL地址。</p> <p><code>output.publicPath</code>配置发布到线上资源的URL前缀，为<code>string</code>类型，默认值是字符串’’，即使用相对路径。</p> <p>例如：需要将构建出的资源文件上传到CDN服务上，以利于加快页面的打开速度，配置代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
publicPath<span class="token operator">:</span> <span class="token string">'https://cdn.example.com/assets/'</span>
</code></pre></div><ul><li><p><code>path</code>是<code>webpack</code>构建后输出构建结果的目录，必须是<code>绝对路径</code>.</p></li> <li><p><code>publicPath</code>并不会对生成文件的路径造成影响，主要是对你的页面里面引入的资源的路径做对应的补全，常见的就是css文件里面引入的图片url值.</p></li></ul> <h2 id="构建配置抽离成npm包">构建配置抽离成npm包</h2> <ul><li>2020.05.26</li></ul> <h3 id="意义-2">意义</h3> <ul><li><p>通用性</p> <ul><li>业务的开发者无需关注构建配置</li> <li>统一团队构建脚本</li></ul></li> <li><p>可维护性</p> <ul><li>构建配置合理的拆分</li> <li>README文档、ChangeLog文档等</li></ul></li> <li><p>质量</p> <ul><li>冒烟测试</li> <li>持续集成</li></ul></li></ul> <h3 id="可选方案">可选方案</h3> <p><strong>1. 通过配置多个文件区分不同环境的构建 <code>webpack --config</code> 进行参数的控制</strong></p> <ul><li>基础环境: webpack.base.js</li> <li>开发环境: webpack.dev.js</li> <li>生成环境: webpack.prod.js</li> <li>SSR环境: webpack.ssr.js</li> <li>PWA环境: webpack.pwa.js</li></ul> <p><strong>2. 将构建配置设计成一个库， 比如 <code>hjs-webpack</code></strong></p> <ul><li>规范: Git Commit日志、README文档、ESlint规范、Semver规范等</li> <li>质量: 冒烟测试、单元测试、测试覆盖率和CI等</li></ul> <p><strong>3. 抽离成一个工具进行管理， 比如 <code>create-react-app</code></strong></p> <p><strong>4. 将所有配置放在一个文件，通过一个 <code>--env</code> 参数控制分支选择</strong></p> <h3 id="组合">组合</h3> <blockquote><p>推荐使用<code>webpack-merge</code>组合我们的配置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="构建包功能模块设计">构建包功能模块设计</h2> <ul><li>2020.05.27</li></ul> <p><img src="https://img-blog.csdnimg.cn/2020052712400568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="构建功能模块设计"></p> <h2 id="目录结构设计">目录结构设计</h2> <p><img src="https://img-blog.csdnimg.cn/20200527203103923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="目录结构设计"></p> <h2 id="冒烟测试">冒烟测试</h2> <ul><li>2020.6.01</li></ul> <ol><li><p>判断构建是否成功</p></li> <li><p>判断基本功能是否正常</p></li></ol> <p>借助第三方工具jest等。</p> <h2 id="单元测试和测试覆盖率">单元测试和测试覆盖率</h2> <ul><li>2020.06.01</li></ul> <h3 id="单纯的测试框架-需要断言库">单纯的测试框架,需要断言库</h3> <ul><li>chai</li> <li>mocha</li> <li>ava</li> <li>should.js</li> <li>expect</li> <li>better-assert</li></ul> <h3 id="集成框架，开箱即用">集成框架，开箱即用</h3> <ul><li>jest</li> <li>jasmine</li></ul> <h3 id="编写单元测试用例">编写单元测试用例</h3> <p><img src="https://img-blog.csdnimg.cn/20200601203435647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="编写单元测试用例"></p> <h3 id="单元测试的接入">单元测试的接入</h3> <ol><li>安装相关的插件</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm i mocha chai -D
</code></pre></div><ol start="2"><li><p>新建<code>test</code>目录, 并增加 <code>xxx.test.js</code> 测试文件</p></li> <li><p>在 <code>package.json</code> 中的 <code>scripts</code> 字段增加 <code>test</code> 命令</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/mocha/bin/_mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>执行测试命令</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><h3 id="验证测试覆盖率">验证测试覆盖率</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i -g istanbul
</code></pre></div><p>修改script</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;istanbul cover node_modules/mocha/bin/_mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="构建包的持续集成和-travis-ci">构建包的持续集成和 Travis CI</h2> <ul><li>2020.07.27</li></ul> <h3 id="接入travis-ci">接入Travis CI</h3> <ol><li><p>https://travis-ci.org 使用Github账号登录</p></li> <li><p>在https://travis-ci.org/account/repositories为项目开启</p></li> <li><p>项目根目录下新增 .travis.yml</p></li></ol> <p>具体流程可以参考<a href="https://docs.travis-ci.com/user/deployment/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="发布构建包到npm">发布构建包到npm</h2> <ul><li>2020.07.27</li></ul> <h3 id="添加用户">添加用户</h3> <blockquote><p>npm adduser</p></blockquote> <h3 id="升级版本">升级版本</h3> <ul><li><p>升级补丁版本号: npm version patch</p></li> <li><p>升级小版本号: npm version minor</p></li> <li><p>升级大版本号: npm version major</p></li></ul> <h3 id="发布版本">发布版本</h3> <blockquote><p>npm publish</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>发布的时候需要去搜索下 当前包名是否已经被使用。包里不要带上一些不相干的文件。</p></div> <h2 id="使用webpack内部的stats进行构建包的初步分析">使用webpack内部的stats进行构建包的初步分析</h2> <ul><li>2020.07.28</li></ul> <blockquote><p>webpack内部给我们提供了一个stats的功能,我们可以在script中配置。</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token property">&quot;build:stats&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env production --json &gt; stats.json&quot;</span>
<span class="token punctuation">}</span>
...
</code></pre></div><p>在Node.js中使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.config.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span>

<span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这种方式可以达到简单的分析效果 但是颗粒度太细,看不太出问题的所在。</p> <h2 id="使用-speed-measure-webpack-plugin进行速度分析">使用 speed-measure-webpack-plugin进行速度分析</h2> <ul><li>2020.07.28</li></ul> <blockquote><p>使用该插件可以直观的看到每个loader和插件执行耗时以及打包的总耗时。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webpackVonfig <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token comment">// 需要分析的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">MyOtherPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>构建比较耗时的会显示为红色，构建较耗时的会显示为黄色,构建速度正常的会显示为绿色。</p></div> <h2 id="使用-webpack-bundle-analyzer进行体积分析">使用 webpack-bundle-analyzer进行体积分析</h2> <ul><li>2020.07.29</li></ul> <blockquote><p>使用该插件可以分析项目内依赖的第三方模块文件的大小以及业务内组件代码的大小。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>构建完成后会在8888端口进行构建包大小的展示。</p> <h2 id="多进程-多实例并行压缩">多进程/多实例并行压缩</h2> <ul><li>2020.08.07</li></ul> <h3 id="使用parallel-uglify-plugin">使用parallel-uglify-plugin</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> parallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'parallel-uglify-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">parallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      uglifyJS<span class="token operator">:</span><span class="token punctuation">{</span>
        output<span class="token operator">:</span><span class="token punctuation">{</span>
          beautify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span><span class="token punctuation">{</span>
          warning<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用-uglifyjs-webpack-plugin-并开启parallel参数">使用 uglifyjs-webpack-plugin 并开启parallel参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugin<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      uglifyOptions<span class="token operator">:</span><span class="token punctuation">{</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        parse<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        mangle<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        toplevel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        nameCache<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        ie8<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        keep_names<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      parallel<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用terser-webpack-plugin开启parallel参数">使用terser-webpack-plugin开启parallel参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span><span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          parallel<span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="通过设置externals进行分包">通过设置Externals进行分包</h2> <ul><li>2020.08.07</li></ul> <h3 id="使用html-webpack-externals-plugin">使用html-webpack-externals-plugin</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-externals-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugin<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      externals<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            module<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
            entry<span class="token operator">:</span> <span class="token string">'react_cdn_url'</span><span class="token punctuation">,</span>
            global<span class="token operator">:</span> <span class="token string">'React'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            module<span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
            entry<span class="token operator">:</span> <span class="token string">'react_dom_url'</span><span class="token punctuation">,</span>
            global<span class="token operator">:</span> <span class="token string">'ReactDom'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="进一步分包-采用预编译资源模块">进一步分包:采用预编译资源模块</h3> <blockquote><p>思路: 将react、react-dom、redux、react-redux基础包和业务基础包打包成一个文件。</p></blockquote> <p>方法: 使用 <code>DLLPlugin</code>进行分包,<code>DllReferencePlugin</code> 对 <code>manifest.json</code> 引用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.less'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">,</span> <span class="token string">'.scss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        modules<span class="token operator">:</span> <span class="token punctuation">[</span>__driname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        library<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'react'</span><span class="token punctuation">,</span>
            <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
            <span class="token string">'redux'</span><span class="token punctuation">,</span>
            <span class="token string">'react-redux'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./build/library'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token string">'[name]'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DLLPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span> <span class="token string">'./build/library/[name].json'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>包构建完成后,在<code>webpack.config.js</code>中引入</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/library/manifest.json'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>引用效果,会在html文件中加入一个脚本。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/build/library/library.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>完整的配置示例:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dll.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        library<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'react'</span><span class="token punctuation">,</span>
            <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
            <span class="token string">'redux'</span><span class="token punctuation">,</span>
            <span class="token string">'react-redux'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash].dll.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./build/library'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token string">'[name]'</span> <span class="token comment">// 暴露库的名字</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DLLPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'[name]_[hash]'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build/library/[name].json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/library/manifest.json'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="充分医用缓存提升二次构建速度">充分医用缓存提升二次构建速度</h3> <p>缓存思路:</p> <ul><li><code>babel-loder</code> 开启缓存</li> <li><code>terser-webpack-plugin</code> 开启缓存</li> <li>使用 <code>cache-loader</code> 或者 <code>hard-source-webpack-plugin</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// babel-loder 开启缓存</span>

loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory=true'</span><span class="token punctuation">]</span>

<span class="token comment">// terser-webpack-plugin 开启缓存</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minizer<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            cache<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// hard-source-webpack-plugin(https://github.com/mzgoddard/hard-source-webpack-plugin)</span>
<span class="token keyword">var</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  context<span class="token operator">:</span> <span class="token comment">// ...</span>
  entry<span class="token operator">:</span> <span class="token comment">// ...</span>
  output<span class="token operator">:</span> <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="缩小构建目标">缩小构建目标</h2> <ul><li>2020.08.13</li></ul> <blockquote><p>尽可能的少构建模块。</p></blockquote> <h3 id="比如-babel-loader-不解析-node-modules">比如 <code>babel-loader</code> 不解析 <code>node_modules</code></h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token string">'/\.js$'</span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">'happypack/loader'</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token string">'node_modules'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="减少文件搜索范围">减少文件搜索范围</h3> <ul><li>优化 <code>resolve.modules</code> 配置(减少模块搜索层级)</li> <li>优化 <code>resolve.mainFields</code> 配置</li> <li>优化 <code>resolve.extensions</code> 配置</li> <li>合理使用 <code>alias</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      react<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react/dist/react.min.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 先找项目内 找不到直接去node_modules找 以减少模块搜索的层级</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// import一个文件没有后缀 优先查找.js文件 如果数组内配置较多 查找也比较耗时</span>
    mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tree-shaking-在css中的优化">Tree Shaking 在CSS中的优化</h2> <ul><li>2020.08.13</li></ul> <p>之前的章节中已经介绍过<code>Tree Shaking</code> 的相关原理和在js中的使用,那么如何在<code>CSS</code>中也进行相应的优化呢?</p> <ul><li><p><code>PurifyCSS</code>: 遍历代码,识别已经用到的CSS Class。</p></li> <li><p><code>uncss</code>: <code>HTML</code>需要通过<code>jsdom</code>加载,所有的样式通过<code>PostCss</code>解析,通过<code>document.querySelector</code>来识别在<code>html</code>文件里面不存在的选择器。</p></li></ul> <p>这里将使用 <a href="https://github.com/FullHuman/purgecss-webpack-plugin" target="_blank" rel="noopener noreferrer">purgecss-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 配合 <a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener noreferrer">mini-css-extract-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// Options similar to the same options in webpackOptions.output</span>
      <span class="token comment">// both options are optional</span>
      filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
      chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              publicPath<span class="token operator">:</span> <span class="token string">'/public/path/to/'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// PurgecssPlugin</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="使用webpack进行图片压缩">使用webpack进行图片压缩</h2> <ul><li>2020.08.13</li></ul> <p>要求: 基于 <code>Node</code>库的 <code>imagemin</code> 或者 <code>timypng API</code></p> <p>使用: 配置 <code>image-webpack-plugin</code></p> <h3 id="使用imagemin的有点分析">使用Imagemin的有点分析</h3> <ul><li><p>有很多定制选项</p></li> <li><p>可以引入更多第三方优化插件，例如 pngquant</p></li> <li><p>可以处理多种图片格式</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token string">'/\.(png|svg|jpg|gif|blob)'</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">img/[name]</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.[ext]</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
        progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        quality<span class="token operator">:</span> <span class="token number">65</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
        quality<span class="token operator">:</span> <span class="token string">'65-90'</span><span class="token punctuation">,</span>
        speed<span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
        interlaced<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      webp<span class="token operator">:</span> <span class="token punctuation">{</span>
        quality<span class="token operator">:</span> <span class="token number">75</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="imagemin的压缩原理">Imagemin的压缩原理</h3> <ul><li><p><code>pngquant</code>: 一款PNG压缩器,通过将图像转化为具有<code>alpha通道</code>(通常比24/32位PNG文件小60-80%)的更高效的8位PNG格式,可显著减小文件大小。</p></li> <li><p><code>pngcrush</code>: 其主要目的是通过尝试不同的压缩级别和PNG过滤方法来降低PNG IDAT数据流的大小。</p></li> <li><p><code>optipng</code>: 其设计灵感来自于<code>pngcrush</code>。<code>optipng</code>可将图像文件重新压缩为更小尺寸,而不会失去任何信息。</p></li> <li><p><code>tinypng</code>: 将24位png文件转化为更小有索引的8位图片,同时所有非必要的<code>metadata</code>也会被剥离掉。</p></li></ul> <h2 id="使用动态的ployfill优化构建体积">使用动态的Ployfill优化构建体积</h2> <ul><li>2020.08.14</li></ul> <table><thead><tr><th style="text-align:left;">方案</th> <th style="text-align:left;">优点</th> <th style="text-align:left;">缺点</th> <th style="text-align:left;">建议</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>babel-polyfill</code></td> <td style="text-align:left;">React16官方推荐方案</td> <td style="text-align:left;">1. 包体积约200K+,难以单独抽离Map、Set。 2. 项目里react是单独引用的cdn,如果用使用的话,需要单独构建一份放在react前加载。</td> <td style="text-align:left;">不建议采用</td></tr> <tr><td style="text-align:left;"><code>babel-plugin-transform-runtime</code></td> <td style="text-align:left;">能只polyfill用到的类或方法,相对体积较小</td> <td style="text-align:left;">不能polyfill原型上的方法,不适用于业务项目的复杂开发环境</td> <td style="text-align:left;">不建议采用</td></tr> <tr><td style="text-align:left;"><code>自己写Map、Set的polyfill</code></td> <td style="text-align:left;">定制化高,体积小</td> <td style="text-align:left;">1. 重复造轮子,容易在日后年久失修或者成为坑 2. 即使体积小,依然所以用户都要加载。</td> <td style="text-align:left;">不建议采用</td></tr> <tr><td style="text-align:left;"><code>polyfill-service</code></td> <td style="text-align:left;">只给用户返回需要的polyfill,社区维护</td> <td style="text-align:left;">部分国内奇葩浏览器UA可能无法识别(但是可以降级返回所需全部polyfill)</td> <td style="text-align:left;">推荐使用</td></tr></tbody></table> <h3 id="polyfill-service原理">Polyfill Service原理</h3> <blockquote><p>识别访问的<code>User Agent</code>,下发不同的 <code>Polyfill</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdn.polyfill.io/v2/polyfill.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="webpack启动过程分析">webpack启动过程分析</h2> <ul><li>2020.08.14</li></ul> <p><strong>思考:</strong></p> <ul><li><p>通过 <code>npm scripts</code> 运行 <code>webpack</code>
-开发环境: <code>npm run dev</code>
-生产环境: <code>npm run build</code></p></li> <li><p>通过 webpack 直接运行</p> <ul><li><code>webpack entry.js bundle.js</code></li></ul></li></ul> <p><strong>这个过程到底发生了什么???</strong></p> <h3 id="_1-查找-webpack-入口文件">1. 查找 webpack 入口文件</h3> <blockquote><p>在命令行运行以上命令后,<code>npm</code>会让命令行工具进入<code>node_modules/.bin</code> 目录查找是否存在 <code>webpack.sh(mac)</code> 或者 <code>webpack.cmd(windows)</code>文件,如果存在就执行,不存在就抛出错误。</p></blockquote> <p>实际的入口文件是: <code>node_modules/webpack/bin/webpack.js</code> 找到之后执行其中的代码。</p> <h3 id="_2-分析-webpack的入口文件-webpack-js到底做了什么事情">2. 分析 webpack的入口文件 webpack.js到底做了什么事情</h3> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token comment">// @ts-ignore 正常执行的返回值</span>
process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 运行某个命令之后返回一个promise
 * @param {string} command process to run
 * @param {string[]} args commandline arguments
 * @returns {Promise&lt;void&gt;} promise
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> executedCommand <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			stdio<span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span><span class="token punctuation">,</span>
			shell<span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token parameter">code</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 判断某个包是否安装
 * @param {string} packageName name of the package
 * @returns {boolean} is the package installed?
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isInstalled</span> <span class="token operator">=</span> <span class="token parameter">packageName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * webpack可用的CLI:webpack-cli 和 webpack-command
 * @typedef {Object} CliOption
 * @property {string} name display name
 * @property {string} package npm package name
 * @property {string} binName name of the executable file
 * @property {string} alias shortcut for choice
 * @property {boolean} installed currently installed?
 * @property {boolean} recommended is recommended
 * @property {string} url homepage
 * @property {string} description description
 */</span>

<span class="token comment">/** @type {CliOption[]} */</span>
<span class="token keyword">const</span> CLIs <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		name<span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
		<span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
		binName<span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
		alias<span class="token operator">:</span> <span class="token string">&quot;cli&quot;</span><span class="token punctuation">,</span>
		installed<span class="token operator">:</span> <span class="token function">isInstalled</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		recommended<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		url<span class="token operator">:</span> <span class="token string">&quot;https://github.com/webpack/webpack-cli&quot;</span><span class="token punctuation">,</span>
		description<span class="token operator">:</span> <span class="token string">&quot;The original webpack full-featured CLI.&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>
		name<span class="token operator">:</span> <span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">,</span>
		<span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">,</span>
		binName<span class="token operator">:</span> <span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">,</span>
		alias<span class="token operator">:</span> <span class="token string">&quot;command&quot;</span><span class="token punctuation">,</span>
		installed<span class="token operator">:</span> <span class="token function">isInstalled</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		recommended<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		url<span class="token operator">:</span> <span class="token string">&quot;https://github.com/webpack-contrib/webpack-command&quot;</span><span class="token punctuation">,</span>
		description<span class="token operator">:</span> <span class="token string">&quot;A lightweight, opinionated webpack CLI.&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 判断两个CLI是否安装了</span>
<span class="token keyword">const</span> installedClis <span class="token operator">=</span> CLIs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">cli</span> <span class="token operator">=&gt;</span> cli<span class="token punctuation">.</span>installed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据安装的CLI数量进行处理</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> readLine <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;readline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">let</span> notify <span class="token operator">=</span>
		<span class="token string">&quot;One CLI for webpack must be installed. These are recommended choices, delivered as separate packages:&quot;</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> CLIs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>recommended<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			notify <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)\n   </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>notify<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> isYarn <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;yarn.lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> packageManager <span class="token operator">=</span> isYarn <span class="token operator">?</span> <span class="token string">&quot;yarn&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> installOptions <span class="token operator">=</span> <span class="token punctuation">[</span>isYarn <span class="token operator">?</span> <span class="token string">&quot;add&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-D&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
		<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">We will use &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; to install the CLI via &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
			<span class="token string">&quot; &quot;</span>
		<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> question <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Do you want to install 'webpack-cli' (yes/no): </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> questionInterface <span class="token operator">=</span> readLine<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		input<span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
		output<span class="token operator">:</span> process<span class="token punctuation">.</span>stderr
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	questionInterface<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span>question<span class="token punctuation">,</span> <span class="token parameter">answer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		questionInterface<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> normalizedAnswer <span class="token operator">=</span> answer<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>normalizedAnswer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
				<span class="token string">&quot;You need to install 'webpack-cli' to use webpack via CLI.\n&quot;</span> <span class="token operator">+</span>
					<span class="token string">&quot;You can also install the CLI manually.&quot;</span>
			<span class="token punctuation">)</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> packageName <span class="token operator">=</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">;</span>

		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
			<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Installing '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' (running '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
				<span class="token string">&quot; &quot;</span>
			<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')...</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">runCommand</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">,</span> installOptions<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token function">require</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//eslint-disable-line</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> pkgPath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installedClis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>package<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// eslint-disable-next-line node/no-missing-require</span>
	<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// eslint-disable-next-line node/no-missing-require</span>
	<span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
		path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">,</span>
		pkg<span class="token punctuation">.</span>bin<span class="token punctuation">[</span>installedClis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>binName<span class="token punctuation">]</span>
	<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
		<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You have installed </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installedClis
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
				<span class="token string">&quot; and &quot;</span>
			<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> together. To work with the &quot;webpack&quot; command you need only one CLI package, please remove one of them or use them directly via their binary.</span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// @ts-ignore</span>
	process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>webpack启动后的结果:</strong></p> <p><code>webpack</code>最终找到 <code>webpack-cli(webpack-command)</code>这个<code>npm</code>包,并且执行<code>CLI</code>命令。</p></div> <h2 id="webpack-cli-源码阅读">webpack-cli 源码阅读</h2> <ul><li>2020.08.14</li></ul> <h3 id="webpack-cli做的事情">webpack-cli做的事情</h3> <ol><li><p>引入了<code>yargs</code>,对命令进行定制</p></li> <li><p>分析命令行参数,对各个参数进行转换,组成编译配置项</p></li> <li><p>引用<code>webpack</code>,根据配置项进行编译和构建</p></li></ol> <h3 id="_1-从non-compilation-cdm分析出不需要编译的命令">1.从NON_COMPILATION_CDM分析出不需要编译的命令</h3> <blockquote><p><code>webpack-cli</code>处理不需要经过编译的命令</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token comment">/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">NON_COMPILATION_ARGS</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/constants&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// wrap in IIFE to be able to use return</span>

	<span class="token keyword">const</span> importLocal <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;import-local&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Prefer the local installation of webpack-cli</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">importLocal</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;v8-compile-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> ErrorHelpers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/errorHelpers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_CMD</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">===</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv <span class="token operator">=</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> a <span class="token operator">!==</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>argv <span class="token operator">=</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> a <span class="token operator">===</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/prompt-command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">,</span> <span class="token operator">...</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack-cli </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

Usage: webpack-cli [options]
       webpack-cli [options] --entry &lt;entry&gt; --output &lt;output&gt;
       webpack-cli [options] &lt;entries...&gt; --output &lt;output&gt;
       webpack-cli &lt;command&gt; [options]

For more information, see https://webpack.js.org/api/cli/.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config/config-yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>yargs<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// yargs will terminate the process early when the user uses help or version.</span>
	<span class="token comment">// This causes large help outputs to be cut short (https://github.com/nodejs/node/wiki/API-changes-between-v0.10-and-v4#process).</span>
	<span class="token comment">// To prevent this we use the yargs.parse API and exit the process normally</span>
	yargs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		Error<span class="token punctuation">.</span>stackTraceLimit <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

		<span class="token comment">// arguments validation failed</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// help or version info</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>verbose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			argv<span class="token punctuation">[</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">let</span> options<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			options <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/convert-argv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">&quot;MODULE_NOT_FOUND&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">const</span> moduleName <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> instructions <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> errorMessage <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>moduleName <span class="token operator">===</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					errorMessage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not installed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
					instructions <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Install webpack to start bundling: \u001b[32m\n  $ npm install --save-dev </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

					<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_execpath <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_execpath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;yarn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						instructions <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Install webpack to start bundling: \u001b[32m\n $ yarn add </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --dev\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					Error<span class="token punctuation">.</span>stackTraceLimit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>errorMessage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>instructions<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">&quot;ValidationError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> err<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">const</span> stack <span class="token operator">=</span> ErrorHelpers<span class="token punctuation">.</span><span class="token function">cleanUpWebpackOptions</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> message <span class="token operator">=</span> err<span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\u001b[1m\u001b[31m</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u001b[39m\u001b[22m</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">/**
		 * When --silent flag is present, an object with a no-op write method is
		 * used in place of process.stout
		 */</span>
		<span class="token keyword">const</span> stdout <span class="token operator">=</span> argv<span class="token punctuation">.</span>silent <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token function-variable function">write</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>

		<span class="token keyword">function</span> <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>init<span class="token punctuation">)</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>init<span class="token punctuation">)</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">fn</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">function</span> <span class="token function">processOptions</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// process Promise</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				options<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>processOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack <span class="token operator">||</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// eslint-disable-next-line no-process-exit</span>
					process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">const</span> firstOptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> statsPresetToOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Stats<span class="token punctuation">.</span>presetToOptions<span class="token punctuation">;</span>

			<span class="token keyword">let</span> outputOptions <span class="token operator">=</span> options<span class="token punctuation">.</span>stats<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions <span class="token operator">===</span> <span class="token string">&quot;boolean&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> outputOptions <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions <span class="token operator">=</span> <span class="token function">statsPresetToOptions</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">preset</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions <span class="token operator">=</span> <span class="token function">statsPresetToOptions</span><span class="token punctuation">(</span>preset<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			outputOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>outputOptions<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>children <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">o</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>context <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>context <span class="token operator">=</span> firstOptions<span class="token punctuation">.</span>context<span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					outputOptions<span class="token punctuation">.</span>_env <span class="token operator">=</span> value<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					outputOptions<span class="token punctuation">.</span>json <span class="token operator">=</span> bool<span class="token punctuation">;</span>
					outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> bool<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>colors <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;supports-color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;sort-modules-by&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>modulesSort <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;sort-chunks-by&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>chunksSort <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;sort-assets-by&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>assetsSort <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-exclude&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>exclude <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputOptions<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>cached <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>cached <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>cachedAssets <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>cachedAssets <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-chunks&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
						outputOptions<span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						outputOptions<span class="token punctuation">.</span>chunkModules <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-entrypoints&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					outputOptions<span class="token punctuation">.</span>entrypoints <span class="token operator">=</span> bool<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-reasons&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>reasons <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-depth&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>depth <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-used-exports&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>usedExports <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-provided-exports&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>providedExports <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-optimization-bailout&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>optimizationBailout <span class="token operator">=</span> bool<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-error-details&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>errorDetails <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-origins&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>chunkOrigins <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-max-modules&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					outputOptions<span class="token punctuation">.</span>maxModules <span class="token operator">=</span> <span class="token operator">+</span>value<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-cached&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>cached <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-cached-assets&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>cachedAssets <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputOptions<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>exclude <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bower_components&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;components&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token string">&quot;display-modules&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					outputOptions<span class="token punctuation">.</span>maxModules <span class="token operator">=</span> <span class="token number">Infinity</span><span class="token punctuation">;</span>
					outputOptions<span class="token punctuation">.</span>exclude <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
					outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;hide-modules&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
					outputOptions<span class="token punctuation">.</span>chunkModules <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;info-verbosity&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>infoVerbosity <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;build-delimiter&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				outputOptions<span class="token punctuation">.</span>buildDelimiter <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">let</span> lastHash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> compiler<span class="token punctuation">;</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;WebpackOptionsValidationError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>color<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\u001b[1m\u001b[31m</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u001b[39m\u001b[22m</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// eslint-disable-next-line no-process-exit</span>
					process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">throw</span> err<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>progress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">const</span> ProgressPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ProgressPlugin<span class="token punctuation">;</span>
				<span class="token keyword">new</span> <span class="token class-name">ProgressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					profile<span class="token operator">:</span> argv<span class="token punctuation">.</span>profile
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>infoVerbosity <span class="token operator">===</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>watchRun<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WebpackInfo&quot;</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
						<span class="token keyword">const</span> compilationName <span class="token operator">=</span> compilation<span class="token punctuation">.</span>name <span class="token operator">?</span> compilation<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
						console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nCompilation &quot;</span> <span class="token operator">+</span> compilationName <span class="token operator">+</span> <span class="token string">&quot; starting…\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeRun<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WebpackInfo&quot;</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
						<span class="token keyword">const</span> compilationName <span class="token operator">=</span> compilation<span class="token punctuation">.</span>name <span class="token operator">?</span> compilation<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
						console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nCompilation &quot;</span> <span class="token operator">+</span> compilationName <span class="token operator">+</span> <span class="token string">&quot; starting…\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WebpackInfo&quot;</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token keyword">const</span> compilationName <span class="token operator">=</span> compilation<span class="token punctuation">.</span>name <span class="token operator">?</span> compilation<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nCompilation &quot;</span> <span class="token operator">+</span> compilationName <span class="token operator">+</span> <span class="token string">&quot; finished\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">function</span> <span class="token function">compilerCallback</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>watch <span class="token operator">||</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Do not keep cache anymore</span>
					compiler<span class="token punctuation">.</span><span class="token function">purgeInputFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					lastHash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack <span class="token operator">||</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span><span class="token punctuation">;</span>
					process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span>hash <span class="token operator">!==</span> lastHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					lastHash <span class="token operator">=</span> stats<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span>compilation <span class="token operator">&amp;&amp;</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">const</span> errors <span class="token operator">=</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors<span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;EntryModuleNotFoundError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\n\u001b[1m\u001b[31mInsufficient number of arguments or no entry found.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
								<span class="token string">&quot;\u001b[1m\u001b[31mAlternatively, run 'webpack(-cli) --help' for usage info.\u001b[39m\u001b[22m\n&quot;</span>
							<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">const</span> statsString <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">const</span> delimiter <span class="token operator">=</span> outputOptions<span class="token punctuation">.</span>buildDelimiter <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outputOptions<span class="token punctuation">.</span>buildDelimiter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>statsString<span class="token punctuation">)</span> stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>statsString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delimiter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>firstOptions<span class="token punctuation">.</span>watch <span class="token operator">||</span> options<span class="token punctuation">.</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">const</span> watchOptions <span class="token operator">=</span>
					firstOptions<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> options<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> firstOptions<span class="token punctuation">.</span>watch <span class="token operator">||</span> options<span class="token punctuation">.</span>watch <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>watchOptions<span class="token punctuation">.</span>stdin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> compilerCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>infoVerbosity <span class="token operator">!==</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nwebpack is watching the files…\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>close<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token parameter">err2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							<span class="token function">compilerCallback</span><span class="token punctuation">(</span>err <span class="token operator">||</span> err2<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token function">compilerCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token function">processOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>NON_COMPILATION_ARGS</strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * init 创建一份webpack配置文件
 * migrate 进行webpack版本迁移
 * add 往webpack配置文件中增加属性
 * remove 往webpack配置文件中删除属性
 * serve 运行webpack-server
 * generate-loader 生成webpack loader代码
 * generate-plugin 生成webpack plugin代码
 * info 返回与本地环境相关的一些信息
*/</span>
<span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_ARGS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;migrate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;remove&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;generate-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;generate-plugin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">CONFIG_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Config options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">BASIC_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Basic options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MODULE_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Module options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">OUTPUT_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Output options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ADVANCED_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Advanced options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RESOLVE_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Resolving options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">OPTIMIZE_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Optimizing options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">DISPLAY_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Stats options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">GROUPS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">DISPLAY_GROUP</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">WEBPACK_OPTIONS_FLAG</span> <span class="token operator">=</span> <span class="token string">&quot;WEBPACK_OPTIONS&quot;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">,</span>
	<span class="token constant">GROUPS</span><span class="token punctuation">,</span>
	<span class="token constant">WEBPACK_OPTIONS_FLAG</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>prompt-command.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// based on https://github.com/webpack/webpack/blob/master/bin/webpack.js</span>

<span class="token comment">/**
 * @param {string} command process to run
 * @param {string[]} args commandline arguments
 * @returns {Promise&lt;void&gt;} promise
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> executedCommand <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			stdio<span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span><span class="token punctuation">,</span>
			shell<span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token parameter">code</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">npmGlobalRoot</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> command <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-g&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		command<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		command<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		command<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">runWhenInstalled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">packages<span class="token punctuation">,</span> pathForCmd<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> currentPackage <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> func <span class="token operator">=</span> currentPackage<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> func <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@webpack-cli/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> failed to export a default function</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">promptForInstallation</span><span class="token punctuation">(</span><span class="token parameter">packages<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> nameOfPackage <span class="token operator">=</span> <span class="token string">&quot;@webpack-cli/&quot;</span> <span class="token operator">+</span> packages<span class="token punctuation">;</span>
	<span class="token keyword">let</span> packageIsInstalled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> pathForCmd<span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pathForCmd <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@webpack-cli&quot;</span><span class="token punctuation">,</span> packages<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> globalModules <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;global-modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pathForCmd <span class="token operator">=</span> globalModules <span class="token operator">+</span> <span class="token string">&quot;/@webpack-cli/&quot;</span> <span class="token operator">+</span> packages<span class="token punctuation">;</span>
			require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		packageIsInstalled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		packageIsInstalled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>packageIsInstalled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> readLine <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;readline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> isYarn <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;yarn.lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> packageManager <span class="token operator">=</span> isYarn <span class="token operator">?</span> <span class="token string">&quot;yarn&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-D&quot;</span><span class="token punctuation">,</span> nameOfPackage<span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>isYarn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>packages <span class="token operator">===</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isYarn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				options<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// remove '-D'</span>
				options<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;global&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				options<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;-g&quot;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> commandToBeRun <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> question <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Would you like to install </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">? (That will run </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commandToBeRun<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) (yes/NO) : </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The command moved into a separate package: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfPackage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> questionInterface <span class="token operator">=</span> readLine<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			input<span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
			output<span class="token operator">:</span> process<span class="token punctuation">.</span>stdout
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		questionInterface<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span>question<span class="token punctuation">,</span> <span class="token parameter">answer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			questionInterface<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>answer<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token string">&quot;yes&quot;</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token string">&quot;1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token function">runCommand</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>packages <span class="token operator">===</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token function">npmGlobalRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
									<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">root</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										<span class="token keyword">const</span> pathtoInit <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;@webpack-cli&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
										<span class="token keyword">return</span> pathtoInit<span class="token punctuation">;</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span>
									<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">pathForInit</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										<span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span>pathForInit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span>
									<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
										process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">return</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>

							pathForCmd <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@webpack-cli&quot;</span><span class="token punctuation">,</span> packages<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">return</span> <span class="token function">runWhenInstalled</span><span class="token punctuation">(</span>packages<span class="token punctuation">,</span> pathForCmd<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
							process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfPackage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> needs to be installed in order to run the command.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">runWhenInstalled</span><span class="token punctuation">(</span>packages<span class="token punctuation">,</span> pathForCmd<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-命令行工具-yargs-介绍">2.命令行工具 yargs 介绍</h3> <blockquote><p>提供命令和分组参数,动态生成help帮助信息</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200814163033594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70#pic_center" alt="help帮助信息"></p> <p><strong>config-yargs</strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> optionsSchema <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../config/optionsSchema.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">GROUPS</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../utils/constants&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
	<span class="token constant">DISPLAY_GROUP</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">GROUPS</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nestedProperties <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;anyOf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;oneOf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;allOf&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolveSchema</span> <span class="token operator">=</span> <span class="token parameter">schema</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> current <span class="token operator">=</span> schema<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> schema <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;$ref&quot;</span> <span class="token keyword">in</span> schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> path <span class="token operator">=</span> schema<span class="token punctuation">.</span>$ref<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> element <span class="token keyword">of</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">===</span> <span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				current <span class="token operator">=</span> optionsSchema<span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				current <span class="token operator">=</span> current<span class="token punctuation">[</span>element<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> current<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">findPropertyInSchema</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">schema<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>subProperty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> subProperty <span class="token keyword">in</span> schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">resolveSchema</span><span class="token punctuation">(</span>schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">[</span>subProperty<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token keyword">in</span> schema<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolveSchema</span><span class="token punctuation">(</span>schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">of</span> nestedProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> schema<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">const</span> resolvedItem <span class="token operator">=</span> <span class="token function">resolveSchema</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>resolvedItem<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getSchemaInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> pathSegments <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> current <span class="token operator">=</span> optionsSchema<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> segment <span class="token keyword">of</span> pathSegments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>segment <span class="token operator">===</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			current <span class="token operator">=</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token string">&quot;additionalProperties&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token string">&quot;items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			current <span class="token operator">=</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token string">&quot;properties&quot;</span><span class="token punctuation">,</span> segment<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>current<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	yargs
		<span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;version&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			config<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Path to the config file&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;webpack.config.js or webpackfile.js&quot;</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;config-register&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Preload one or more modules before loading the webpack configuration&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;module id or path&quot;</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;config-name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Name of the config to use&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			env<span class="token operator">:</span> <span class="token punctuation">{</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Environment passed to the config, when it is a function&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			mode<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				choices<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;enum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			context<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;context&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;context&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;The current directory&quot;</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			entry<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;no-cache&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Disables cached builds&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;module-bind&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Bind an extension to a loader&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;module-bind-post&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Bind an extension to a post loader&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;module-bind-pre&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Bind an extension to a pre loader&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			output<span class="token operator">:</span> <span class="token punctuation">{</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;The output path and file for compilation assets&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;The current directory&quot;</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-filename&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.filename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-chunk-filename&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.chunkFilename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;filename with [id] instead of [name] or [id] prefixed&quot;</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-source-map-filename&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.sourceMapFilename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-public-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.publicPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-jsonp-function&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.jsonpFunction&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-pathinfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.pathinfo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-library&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Expose the exports of the entry point as library&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;output-library-target&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.libraryTarget&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				choices<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.libraryTarget&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;enum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;records-input-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;recordsInputPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;records-output-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;recordsOutputPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;records-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;recordsPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			define<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Define any free var in the bundle&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			target<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			cache<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;cache&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				defaultDescription<span class="token operator">:</span> <span class="token string">&quot;It's enabled by default when watching&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			watch<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;watch-stdin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;stdin&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.stdin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;watch-aggregate-timeout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.aggregateTimeout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				type<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.aggregateTimeout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;watch-poll&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.poll&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			hot<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Enables Hot Module Replacement&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			debug<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Switch loaders to debug mode&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			devtool<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;devtool&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;resolve-alias&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;resolve.alias&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;resolve-extensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;resolve.alias&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;resolve-loader-alias&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Setup a loader alias for resolving&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;optimize-max-chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Try to keep the chunk count below a limit&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;optimize-min-chunk-size&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;optimization.splitChunks.minSize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;optimize-minimize&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;optimization.minimize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">OPTIMIZE_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			prefetch<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Prefetch this request (Example: --prefetch ./file.js)&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			provide<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Provide these modules as free vars in all modules (Example: --provide jQuery=jquery)&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;labeled-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Enables labeled modules&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			plugin<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Load this plugin&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				requiresArg<span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			bail<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;bail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;bail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				<span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			profile<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;profile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
				<span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			d<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;shortcut for --debug --devtool eval-cheap-module-source-map --output-pathinfo&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			p<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				<span class="token comment">// eslint-disable-next-line quotes</span>
				describe<span class="token operator">:</span> <span class="token string">'shortcut for --optimize-minimize --define process.env.NODE_ENV=&quot;production&quot;'</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			silent<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Prevent output from being displayed in stdout&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			json<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;j&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Prints the result as JSON.&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			progress<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Print compilation progress in percentage&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			color<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;colors&quot;</span><span class="token punctuation">,</span>
				<span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">supportsColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;supports-color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Force colors on the console&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;no-color&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				alias<span class="token operator">:</span> <span class="token string">&quot;no-colors&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Force no colors on the console&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;sort-modules-by&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Sorts the modules list by property in module&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;sort-chunks-by&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Sorts the chunks list by property in chunk&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;sort-assets-by&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Sorts the assets list by property in asset&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;hide-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Hides info about modules&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Exclude modules in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display even excluded modules in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-max-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Sets the maximum number of visible modules in output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display chunks in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-entrypoints&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display entry points in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-origins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display origins of chunks in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-cached&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display also cached modules in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-cached-assets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display also cached assets in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-reasons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display reasons about module inclusion in the output&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-depth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display distance from entry point for each module&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-used-exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display information about used exports in modules (Tree Shaking)&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-provided-exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display information about exports provided from modules&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-optimization-bailout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display information about why optimization bailed out for modules&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;display-error-details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display details about errors&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			display<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				choices<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;detailed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;minimal&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Select display preset&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			verbose<span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Show more details&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;info-verbosity&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				<span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span>
				choices<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Controls the output of lifecycle messaging e.g. Started watching files...&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string">&quot;build-delimiter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
				group<span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
				describe<span class="token operator">:</span> <span class="token string">&quot;Display custom text after build output&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-webpack-cli-使用-args-分析">3.webpack-cli 使用 args 分析</h3> <blockquote><p>参数分组(config/config-args.js)将命令划分为了9类：</p></blockquote> <ul><li><code>Config options</code>: 配置相关参数(文件名称、运行参数等)</li> <li><code>Basic options</code>: 基础参数(entry设置、debug模式设置、watch监听设置、devtool设置)</li> <li><code>Module options</code>: 模块参数,给loader设置扩展</li> <li><code>Output options</code>: 输出参数(输出路径、输出文件名称)</li> <li><code>Advanced options</code>: 高级用法(记录设置、缓存设置、监听频率、bail等)</li> <li><code>Resolving options</code>: 解析参数(alias 和 解析的文件后缀设置)</li> <li><code>Optimizing options</code>: 优化参数</li> <li><code>Stats options</code>: 统计参数</li> <li><code>options</code>: 通用参数(帮助命令、版本信息等)</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>webpack-cli 执行的结果</strong></p> <p>webpack-cli配置文件和命令行参数进行转换最终胜出配置选项参数 options</p> <p>最终会根据配置参数实例化 webpack 对象,然后执行构建流程</p></div> <h2 id="tapable插件架构与hooks设计">Tapable插件架构与Hooks设计</h2> <ul><li>2020.08.16</li></ul> <h3 id="webpack的本质是什么">webpack的本质是什么?</h3> <blockquote><p>可以理解为webpack是一种基于事件流的编程范例,一系列的插件运行。</p></blockquote> <p>其中核心对象Complier继承Tapable,Complation也是继承Tapable。</p> <h3 id="tapable是什么">Tapable是什么?</h3> <blockquote><p><code>Tapable</code>是一个类似于<code>Node.js</code>的<code>EventEmitter插件库</code>,主要是控制钩子函数的发布与订阅,控制着<code>webpack</code>的插件系统。</p></blockquote> <p>Tapable库暴露了很多的Hook(钩子)类,为插件的挂载提供了钩子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
	Tapable<span class="token punctuation">,</span> 
	SyncHook<span class="token punctuation">,</span> <span class="token comment">// 同步钩子</span>
	SyncBailHook<span class="token punctuation">,</span> <span class="token comment">// 同步熔断钩子 </span>
	SyncWaterfallHook<span class="token punctuation">,</span> <span class="token comment">// 同步流水钩子</span>
	SyncLoopHook<span class="token punctuation">,</span> <span class="token comment">// 同步循环钩子</span>
	AsyncParallelHook<span class="token punctuation">,</span> <span class="token comment">// 异步并发钩子</span>
	AsyncParallelBailHook<span class="token punctuation">,</span> <span class="token comment">// 异步并发熔断钩子</span>
	AsyncSeriesHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行钩子</span>
	AsyncSeriesBailHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行熔断钩子</span>
	AsyncSeriesWaterfallHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行流水钩子</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tapable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>hooks类型:</p> <table><thead><tr><th style="text-align:left;">type</th> <th style="text-align:left;">function</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>Hook</code></td> <td style="text-align:left;">所有钩子的后缀</td></tr> <tr><td style="text-align:left;"><code>Waterfall</code></td> <td style="text-align:left;">同步方法,但是他会传值给下一个函数</td></tr> <tr><td style="text-align:left;"><code>Bail</code></td> <td style="text-align:left;">熔断,当函数有任何返回值,则在当前执行函数停止</td></tr> <tr><td style="text-align:left;"><code>Loop</code></td> <td style="text-align:left;">监听函数返回true表示循环,返回undefined表示结束循环</td></tr> <tr><td style="text-align:left;"><code>Sync</code></td> <td style="text-align:left;">同步方法</td></tr> <tr><td style="text-align:left;"><code>AsyncSeries</code></td> <td style="text-align:left;">异步串行钩子</td></tr> <tr><td style="text-align:left;"><code>AsyncParallel</code></td> <td style="text-align:left;">异步并行执行钩子</td></tr></tbody></table> <h3 id="tapable的使用-new-hook-新建钩子">Tapable的使用————new Hook(新建钩子)</h3> <blockquote><p>Tapable暴露出来的都是类方法,我们需要new 一个类方法获得我们需要的钩子。class接收数组参数options,非必传。类方法会根据传参,接收同样数量的参数。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hook1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="tapable的使用-钩子的绑定与执行">Tapable的使用————钩子的绑定与执行</h3> <blockquote><p>Tapable提供了同步和异步的绑定钩子的方法,并且他们都有绑定事件和执行事件对应的方法。</p></blockquote> <table><thead><tr><th style="text-align:left;">Async*</th> <th style="text-align:left;">Sync*</th></tr></thead> <tbody><tr><td style="text-align:left;">绑定: tapAsync、tapPromise、tap</td> <td style="text-align:left;">绑定: tap</td></tr> <tr><td style="text-align:left;">执行: callAsync、promise</td> <td style="text-align:left;">执行: call</td></tr></tbody></table> <h3 id="tapable的使用-hook基本用法示例">Tapable的使用————hook基本用法示例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hook1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'arg1'</span><span class="token punctuation">,</span> <span class="token string">'arg2'</span><span class="token punctuation">,</span> <span class="token string">'arg3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定事件到webpack事件流</span>
hook1<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'hook1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 执行绑定的事件</span>
<span class="token function">hook1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="tapable的使用-实际例子演示">Tapable的使用————实际例子演示</h3> <p>定义一个Car方法,在内部hook上新建钩子。分别是同步钩子 <code>accelerate</code>、<code>brake</code>(accelerate接收一个参数)和异步钩子<code>calculateRoutes</code>。</p> <p>使用钩子对应的绑定和执行方法。</p> <p><code>calculateRoutes</code>使用<code>tapPromise</code>可以返回一个<code>promise对象</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Car.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
	SyncHook<span class="token punctuation">,</span>
	AsyncSeriesHook
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
			accelerate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'newspeed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			brake<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			calculateRoutes<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">,</span> <span class="token string">'trget'</span><span class="token punctuation">,</span> <span class="token string">'routesList'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定同步钩子</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>brake<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'WarningLampPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WarningLampPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定同步钩子 并传参</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>accelerate<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'LoggerPlugin'</span><span class="token punctuation">,</span> <span class="token parameter">newSpeed</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accelerating to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSpeed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// </span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'calculateRoutes tapPromise'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> trget<span class="token punctuation">,</span> routesList<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tapPromise to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>trget<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routesList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行异步钩子</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'Async'</span><span class="token punctuation">,</span> <span class="token string">'hook'</span><span class="token punctuation">,</span> <span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">timeEmd</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">timeEmd</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="tapable是如何和webpack关联起来的">Tapable是如何和webpack关联起来的</h2> <ul><li>2020.08.17</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.js</span>
<span class="token comment">/**
 * @param {WebpackOptions} options options object
 * @param {function(Error=, Stats=): void=} callback callback
 * @returns {Compiler | MultiCompiler} the compiler object
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> webpackOptionsValidationErrors <span class="token operator">=</span> <span class="token function">validateSchema</span><span class="token punctuation">(</span>
		webpackOptionsSchema<span class="token punctuation">,</span>
		options
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>webpackOptionsValidationErrors<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsValidationError</span><span class="token punctuation">(</span>webpackOptionsValidationErrors<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">let</span> compiler<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiCompiler</span><span class="token punctuation">(</span>
			Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsDefaulter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

		compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
		<span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			infrastructureLogging<span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 这里对应的就是webpack.config.js中对应的plugins数组执行</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid argument: options&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid argument: callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>
			options<span class="token punctuation">.</span>watch <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">||</span>
			<span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">o</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>watch<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> watchOptions <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
				<span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">o</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token operator">:</span> options<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="模拟一个自定义的complier">模拟一个自定义的complier</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Complier</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
			accelerate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'newspeed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			brake<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			calculateRoutes<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">,</span> <span class="token string">'trget'</span><span class="token punctuation">,</span> <span class="token string">'routesList'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>break<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateRoutes</span><span class="token punctuation">(</span><span class="token string">'Async'</span><span class="token punctuation">,</span> <span class="token string">'Hook'</span><span class="token punctuation">,</span> <span class="token string">'Demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">accelerate</span><span class="token punctuation">(</span><span class="token parameter">speed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">break</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">calculateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Complier<span class="token punctuation">;</span>
</code></pre></div><h3 id="根据complier编写一个简易的自定义插件">根据Complier编写一个简易的自定义插件</h3> <blockquote><p>通过上面的分析我们知道自定义插件需要接收一个complier对象参数,内部需要有一个apply方法。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./complier'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyFirstPlugin</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token punctuation">}</span>

	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">complier</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>break<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WarningLampPlugin&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WarningLampPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>accelerate<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;LoggerPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newSpeed</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accelerate to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSpeed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&quot;calculateRoutes tapAsync&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> routesList</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tapPromise to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routesList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="模拟插件的执行">模拟插件的执行</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myPlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyFirstPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
	plugins<span class="token operator">:</span><span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Complier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

complier<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="webpack流程细剖-准备篇">webpack流程细剖————准备篇</h2> <ul><li>2020.08.17</li></ul> <p><img src="https://img-blog.csdnimg.cn/20200817204240119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70#pic_center" alt="流程分析"></p> <h2 id="模块构建和chunk生成阶段">模块构建和chunk生成阶段</h2> <ul><li>2020.08.17</li></ul> <h3 id="modulefactory">ModuleFactory</h3> <ul><li>NormalModuleFactory</li></ul> <blockquote><p>指那些通过普通的<code>module.exports</code>导出的模块。</p></blockquote> <ul><li>ContextModuleFactory</li></ul> <blockquote><p>路径模块之类的。</p></blockquote> <h3 id="module的类型">Module的类型</h3> <ul><li><code>NormalModule</code> 普通模块</li></ul> <p>Build通过:</p> <ol><li><p>使用 <code>loader-runner</code> 运行loaders</p></li> <li><p>通过 <code>Parser</code> 解析(内部是 acron)</p></li> <li><p><code>ParserPlugins</code> 添加依赖</p></li></ol> <ul><li><code>ContextModule</code> 路径模块</li></ul> <blockquote><p>'./src/a'</p></blockquote> <ul><li><code>ExternalModule</code> 外部模块</li></ul> <blockquote><p>module.exports = Jquery</p></blockquote> <ul><li><code>DelegatedModule</code></li></ul> <blockquote><p>manifest</p></blockquote> <ul><li><code>MultiModule</code></li></ul> <blockquote><p>entry: ['a', 'b']</p></blockquote> <h3 id="chunk生成算法">chunk生成算法</h3> <ol><li><code>webpack</code>先将<code>entry</code>中对应的<code>module</code>都生成一个新的<code>chunk</code></li> <li>遍历<code>module</code>的依赖列表，将依赖的<code>module</code>也加入到<code>chunk</code>中</li> <li>如果一个依赖<code>module</code>是动态引入的模块，那么就会根据这个<code>module</code>创建一个新的<code>chunk</code>，继续遍历依赖</li> <li>重复上面的过程，知道得到所有的<code>chunks</code></li></ol> <h2 id="webpack流程篇-文件生成">webpack流程篇————文件生成</h2> <ul><li>2020.08.18</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里有一个点,文件生成的<code>Hash值</code>是在<code>seal阶段</code>生成的。</p> <p>调用的是<code>Complation.js</code>中的<code>this.createHash</code>方法。</p></div> <h2 id="实战篇-动手编写一个简易的webpack">实战篇————动手编写一个简易的webpack</h2> <ul><li>2020.08.18</li></ul> <p><strong>知识点回顾:</strong></p> <ol><li><code>webpack</code>打包出来的是一个<code>IIFE(匿名闭包)</code>。</li> <li><code>modules</code> 是一个数组,每一项是一个模块初始化函数。</li> <li><code>__webpack__require</code> 用来加载模块,返回<code>module.exports</code>。</li> <li><code>通过WEBPACK_REQUIRE_METHOD(0)</code> 来启动程序。</li></ol> <p><strong>功能需求:</strong></p> <ol><li><p>可以将ES6预发转化成ES5的语法。</p> <ul><li>通过<code>babylon</code>生成AST树</li> <li>通过<code>babel-core</code>将AST重新生成源码</li></ul></li> <li><p>可以分析模块之间的依赖关系</p> <ul><li>通过<code>babel-traverse</code> 的<code>ImportDeclaration</code> 方法获取依赖属性</li></ul></li> <li><p>生成的JS文件可以在浏览器中运行。</p></li></ol> <p><strong>完整示例</strong></p> <p><a href="https://github.com/xjl271314/simple-webpack" target="_blank" rel="noopener noreferrer">完整代码参见<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="loader的链式调用和执行顺序">Loader的链式调用和执行顺序</h2> <ul><li>2020.08.19</li></ul> <blockquote><p>loader只是一个导出为函数的Javascript函数,我们知道定义的loader是从右往左依次执行的。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>loader是串行执行的, loader的执行顺序为: <code>postcss-loader</code> -&gt; <code>scss-loader</code> -&gt; <code>css-loader</code> -&gt; <code>style-loader</code></p> <div class="language-js extra-class"><pre class="language-js"><code>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token punctuation">,</span>
	module<span class="token operator">:</span><span class="token punctuation">{</span>
		rule<span class="token operator">:</span> <span class="token punctuation">[</span>
			test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
			use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'scss-loader'</span><span class="token punctuation">,</span><span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>loader的实现方式和我们之前接触的compose函数的思想是一致的。</p> <h3 id="compose函数">compose函数</h3> <blockquote><p>compose函数接收一个参数返回一个组合后的复合函数,下一个函数会以上个函数的返回值作为参数</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initArg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">var</span> result <span class="token operator">=</span> initArg<span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			result <span class="token operator">=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调用ReduceRight()</span>
<span class="token keyword">function</span> <span class="token function">compose1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initArg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">init<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">current</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>initArg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用webpack-cli创建loader</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>webpack<span class="token operator">-</span>cli<span class="token operator">-</span>loader
</code></pre></div><h2 id="使用loader-runner高效进行loader的调式">使用loader-runner高效进行loader的调式</h2> <ul><li>2020.08.20</li></ul> <blockquote><p><code>loader-runner</code>允许你在不安装<code>webpack</code>的情况下运行<code>loaders</code></p></blockquote> <p><strong>作用:</strong></p> <ol><li>作为webpack的依赖,webpack中使用它执行loader</li> <li>进行loader的开发和测试。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;loader-runner&quot;</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	resource<span class="token operator">:</span> <span class="token string">&quot;/abs/path/to/file.txt?query&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// String: Absolute path to the resource (optionally including query string)</span>

	loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/abs/path/to/loader.js?query&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token comment">// String[]: Absolute paths to the loaders (optionally including query string)</span>
	<span class="token comment">// {loader, options}[]: Absolute paths to the loaders with options object</span>

	context<span class="token operator">:</span> <span class="token punctuation">{</span> minimize<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// Additional loader context which is used as base context</span>

	readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
	<span class="token comment">// A function to read the resource</span>
	<span class="token comment">// Must have signature function(path, function(err, buffer))</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// err: Error?</span>

	<span class="token comment">// result.result: Buffer | String</span>
	<span class="token comment">// The result</span>

	<span class="token comment">// result.resourceBuffer: Buffer</span>
	<span class="token comment">// The raw resource as Buffer (useful for SourceMaps)</span>

	<span class="token comment">// result.cacheable: Bool</span>
	<span class="token comment">// Is the result cacheable or do it require reexecution?</span>

	<span class="token comment">// result.fileDependencies: String[]</span>
	<span class="token comment">// An array of paths (files) on which the result depends on</span>

	<span class="token comment">// result.contextDependencies: String[]</span>
	<span class="token comment">// An array of paths (directories) on which the result depends on</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="开发一个raw-loader">开发一个raw-loader</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// raw-loader \u2028: 行分隔符 \u2029: 段落分隔符</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\u2028/g</span><span class="token punctuation">,</span> <span class="token string">'\\u2028'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\u2029/g</span><span class="token punctuation">,</span> <span class="token string">'\\u2029'</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// run-loader.js</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-runner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span>
	<span class="token punctuation">{</span>
		resource<span class="token operator">:</span> <span class="token string">'./demo.txt'</span><span class="token punctuation">,</span>
		loaders<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loaders/raw-loader'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> err <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 运行</span>
node run<span class="token operator">-</span>loader<span class="token punctuation">.</span>js

<span class="token comment">// 结果</span>
<span class="token punctuation">{</span>
	result<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'export defualt footbar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	resourceBuffer<span class="token operator">:</span> <span class="token operator">&lt;</span>Buffer <span class="token number">66</span> <span class="token number">6</span>f <span class="token number">6</span>f <span class="token number">62</span> <span class="token number">61</span> <span class="token number">72</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	cacheable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	fileDependencies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/demo.txt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	contextDependencies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="更复杂的loader开发场景">更复杂的loader开发场景</h2> <blockquote><p>实际的loader开发过程中往往涉及到很多,比如loader的参数获取、loader内部的异常处理</p></blockquote> <h3 id="通过loader-utils的-getoptions方法获取参数">通过loader-utils的 getOptions方法获取参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loader内部的异常处理">loader内部的异常处理</h3> <blockquote><p>loader内直接通过<code>throw</code>抛出,通过<code>this.callback</code>传递错误。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
	err<span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
	content<span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
	sourceMap<span class="token operator">?</span><span class="token operator">:</span> sourceMap<span class="token punctuation">,</span>
	meta<span class="token operator">?</span><span class="token operator">:</span> any
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="loader的异步处理">loader的异步处理</h3> <blockquote><p>通过 <code>this.async</code>来返回一个异步函数(第一个参数是<code>Error</code>,第二个参数是<code>处理的结果</code>)</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// No callback -&gt; return synchronous results</span>
	<span class="token comment">// if callback ....</span>

	<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>  input <span class="token operator">+</span> input<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在-loader中使用缓存">在 loader中使用缓存</h3> <blockquote><p>webpack中默认是开启loader缓存的(可以使用<code>this.cacheable</code>关掉缓存)。</p></blockquote> <p>缓存的条件:</p> <p><code>loader</code>的结果在相同的输入下有明确的输出,有依赖的<code>loader</code>无法使用缓存。</p> <h3 id="在loader中如何进行文件输出">在loader中如何进行文件输出</h3> <blockquote><p>loader中通过 <code>this.emitFile</code> 进行文件写入</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> url <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;[name].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        source<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">__webpack_public_path__+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="开发一个自动合成雪碧图的loader">开发一个自动合成雪碧图的loader</h2> <ul><li>2020.08.20</li></ul> <p><strong>准备知识：如何将两张图片合成一张图片?</strong></p> <blockquote><p>使用 spritesmith(https://www.npmjs.com/package/spritesmith)</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Spritesmith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'spritesmith '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> imgs <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/url\((\s*)\?__sprite/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> matchedImgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> imgs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> img <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/url\((\s*)\?__sprite/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		matchedImgs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	Spritesmith<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		src<span class="token operator">:</span> matchedImgs<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>	<span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dist/sprite.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
			source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/url\((\s*)\?__sprite/g</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(&quot;dist/sprite.jpg&quot;)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>

			fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dist/index.css'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="插件基本结构介绍">插件基本结构介绍</h2> <ul><li>2020.08.20</li></ul> <blockquote><p>用于处理除了loader以外的功能,没有像loader一样的独立运行环境,只能在webpack中运行。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>	<span class="token comment">// 插件的名称</span>
	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>	<span class="token comment">// 必须的apply方法</span>
		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'My Plugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>	<span class="token comment">// 触发的hooks</span>
			<span class="token comment">// do something ...</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span>

<span class="token comment">// 插件的使用</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="动手实现一个-loader-之简易的jsx-px2rem">动手实现一个 loader 之简易的jsx-px2rem</h2> <ul><li>2020.09.08</li></ul> <blockquote><p>此loader用于将jsx中的style中的px转换为rem。</p></blockquote> <p><strong><code>jsx-px2rem-loader.js</code></strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> regRules <span class="token keyword">from</span> <span class="token string">'./reg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>    <span class="token comment">// lodash是一个js工具库，特别方便建议各位去了解一下</span>
 
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// webpack中默认是开启loader缓存的(可以使用this.cacheable关掉缓存)。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> backUp <span class="token operator">=</span> source<span class="token punctuation">;</span>
 
  <span class="token comment">// style={{marginRight: '1px'}} =&gt; style={{marginRight: '0.01rem'}}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>pxReg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>backUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    backUp <span class="token operator">=</span> backUp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>pxReg<span class="token punctuation">,</span> <span class="token parameter">px</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> px<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>numReg<span class="token punctuation">,</span> <span class="token parameter">num</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> num <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      val <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/px$/</span><span class="token punctuation">,</span> <span class="token string">'rem'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 
 
  <span class="token comment">// marginRight: 1 =&gt; marginRight: '0.01rem'</span>
  _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>styleReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> styleName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>backUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      backUp <span class="token operator">=</span> backUp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>numReg<span class="token punctuation">,</span> <span class="token parameter">num</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num <span class="token operator">/</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
  <span class="token comment">// img标签 width: 1 =&gt; style={{width: '0.01rem'}}</span>
  _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>imgReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> styleName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>backUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      backUp <span class="token operator">=</span> backUp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>numReg<span class="token punctuation">,</span> <span class="token parameter">num</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          style <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num <span class="token operator">/</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">style={{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>style<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;}}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> backUp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>reg.js</code></strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 匹配jsx中的px 如 1px</span>
<span class="token keyword">const</span> pxReg <span class="token operator">=</span> <span class="token regex">/\b(\d+(\.\d+)?)px\b/g</span><span class="token punctuation">;</span>    
 
<span class="token comment">// 匹配jsx中 缩写形式的style 如：marginRight: 1</span>
<span class="token keyword">const</span> styleReg <span class="token operator">=</span> <span class="token punctuation">{</span>    
  marginTop<span class="token operator">:</span> <span class="token regex">/\bmarginTop(?:\s+):(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  marginRight<span class="token operator">:</span> <span class="token regex">/\bmarginRight(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  marginBottom<span class="token operator">:</span> <span class="token regex">/\bmarginBottom(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  marginLeft<span class="token operator">:</span> <span class="token regex">/\bmarginLeft(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  fontSize<span class="token operator">:</span> <span class="token regex">/\bfontSize(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  paddingTop<span class="token operator">:</span> <span class="token regex">/\bpaddingTop(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  paddingRight<span class="token operator">:</span> <span class="token regex">/\bpaddingRight(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  paddingBottom<span class="token operator">:</span> <span class="token regex">/\bpaddingBottom(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
  paddingLeft<span class="token operator">:</span> <span class="token regex">/\bpaddingLeft(?:\s+)?:(?:\s+)?(\d+)/g</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 匹配img 中的行内样式 width: '20'</span>
<span class="token keyword">const</span> imgReg <span class="token operator">=</span> <span class="token punctuation">{</span>    
  height<span class="token operator">:</span> <span class="token regex">/\bheight(?:\s+)?=(?:\s+)?(\'||\&quot;)?(\d+)?=(\'||\&quot;)?/g</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token regex">/\bwidth(?:\s+)?=(?:\s+)?(\'||\&quot;)?(\d+)?=(\'||\&quot;)?/g</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 匹配数字</span>
<span class="token keyword">const</span> numReg <span class="token operator">=</span> <span class="token regex">/(\d+)/g</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  pxReg<span class="token punctuation">,</span>
  styleReg<span class="token punctuation">,</span>
  imgReg<span class="token punctuation">,</span>
  numReg<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>config.js</code></strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
 
<span class="token operator">...</span>
 
<span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'jsx-px2rem-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.js$/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>exclude
      <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../src/pages/.umi'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'../loader/jsx-px2rem-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../loader/jsx-px2rem-loader'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-09-09 12:35:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/project/babel.html" class="prev">
        Babel
      </a></span> <span class="next"><a href="/docs/project/autobuild.html">
        前端轻量自动化构建方案
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.943739cd.js" defer></script><script src="/docs/assets/js/2.3d9c2800.js" defer></script><script src="/docs/assets/js/139.e9f6bd04.js" defer></script>
  </body>
</html>
