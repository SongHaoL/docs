<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.a5c765a3.css" as="style"><link rel="preload" href="/docs/assets/js/app.8c7fcf95.js" as="script"><link rel="preload" href="/docs/assets/js/2.346c741e.js" as="script"><link rel="preload" href="/docs/assets/js/128.46207642.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.448efd45.js"><link rel="prefetch" href="/docs/assets/js/100.fae1f295.js"><link rel="prefetch" href="/docs/assets/js/101.3cd81eca.js"><link rel="prefetch" href="/docs/assets/js/102.a3c75686.js"><link rel="prefetch" href="/docs/assets/js/103.ff124445.js"><link rel="prefetch" href="/docs/assets/js/104.7c0250f8.js"><link rel="prefetch" href="/docs/assets/js/105.c951f9f3.js"><link rel="prefetch" href="/docs/assets/js/106.fdf73f24.js"><link rel="prefetch" href="/docs/assets/js/107.407f43d1.js"><link rel="prefetch" href="/docs/assets/js/108.a7505ba2.js"><link rel="prefetch" href="/docs/assets/js/109.8116e3b4.js"><link rel="prefetch" href="/docs/assets/js/11.6b84f53c.js"><link rel="prefetch" href="/docs/assets/js/110.8c7e56d6.js"><link rel="prefetch" href="/docs/assets/js/111.9c8d3d82.js"><link rel="prefetch" href="/docs/assets/js/112.69669fa1.js"><link rel="prefetch" href="/docs/assets/js/113.315c1aab.js"><link rel="prefetch" href="/docs/assets/js/114.808f9724.js"><link rel="prefetch" href="/docs/assets/js/115.3d1fbad9.js"><link rel="prefetch" href="/docs/assets/js/116.77832c80.js"><link rel="prefetch" href="/docs/assets/js/117.900392ca.js"><link rel="prefetch" href="/docs/assets/js/118.6fe81f17.js"><link rel="prefetch" href="/docs/assets/js/119.a7c8bc4a.js"><link rel="prefetch" href="/docs/assets/js/12.8bcafd6e.js"><link rel="prefetch" href="/docs/assets/js/120.c9b8aa9b.js"><link rel="prefetch" href="/docs/assets/js/121.fbc3daa4.js"><link rel="prefetch" href="/docs/assets/js/122.ba51161d.js"><link rel="prefetch" href="/docs/assets/js/123.735b30b7.js"><link rel="prefetch" href="/docs/assets/js/124.ba35c0ae.js"><link rel="prefetch" href="/docs/assets/js/125.ec715272.js"><link rel="prefetch" href="/docs/assets/js/126.dc431365.js"><link rel="prefetch" href="/docs/assets/js/127.b6f28734.js"><link rel="prefetch" href="/docs/assets/js/129.7c3bbe7c.js"><link rel="prefetch" href="/docs/assets/js/13.4455f4e8.js"><link rel="prefetch" href="/docs/assets/js/130.5d044c8a.js"><link rel="prefetch" href="/docs/assets/js/131.0200a303.js"><link rel="prefetch" href="/docs/assets/js/132.7cb59737.js"><link rel="prefetch" href="/docs/assets/js/133.c15bf84c.js"><link rel="prefetch" href="/docs/assets/js/134.3dea2520.js"><link rel="prefetch" href="/docs/assets/js/135.8fd41d0c.js"><link rel="prefetch" href="/docs/assets/js/136.f966ed00.js"><link rel="prefetch" href="/docs/assets/js/137.db334cf3.js"><link rel="prefetch" href="/docs/assets/js/138.9d057e9a.js"><link rel="prefetch" href="/docs/assets/js/139.1b75c557.js"><link rel="prefetch" href="/docs/assets/js/14.3b0be226.js"><link rel="prefetch" href="/docs/assets/js/140.35cf529e.js"><link rel="prefetch" href="/docs/assets/js/141.b3de3e13.js"><link rel="prefetch" href="/docs/assets/js/142.294520e4.js"><link rel="prefetch" href="/docs/assets/js/143.5ae18b07.js"><link rel="prefetch" href="/docs/assets/js/144.b173db47.js"><link rel="prefetch" href="/docs/assets/js/145.f2d44f37.js"><link rel="prefetch" href="/docs/assets/js/146.44948606.js"><link rel="prefetch" href="/docs/assets/js/147.fcc04391.js"><link rel="prefetch" href="/docs/assets/js/148.1f4ccdc6.js"><link rel="prefetch" href="/docs/assets/js/149.a8553248.js"><link rel="prefetch" href="/docs/assets/js/15.4b5d7343.js"><link rel="prefetch" href="/docs/assets/js/150.e762acbd.js"><link rel="prefetch" href="/docs/assets/js/151.84101683.js"><link rel="prefetch" href="/docs/assets/js/152.481ffa05.js"><link rel="prefetch" href="/docs/assets/js/153.3384c5e3.js"><link rel="prefetch" href="/docs/assets/js/154.a16635df.js"><link rel="prefetch" href="/docs/assets/js/155.d65170ad.js"><link rel="prefetch" href="/docs/assets/js/156.d3912eb6.js"><link rel="prefetch" href="/docs/assets/js/157.4cac489f.js"><link rel="prefetch" href="/docs/assets/js/158.e260917e.js"><link rel="prefetch" href="/docs/assets/js/159.dd6ae020.js"><link rel="prefetch" href="/docs/assets/js/16.9d0963b3.js"><link rel="prefetch" href="/docs/assets/js/160.824aac5f.js"><link rel="prefetch" href="/docs/assets/js/161.71c2cda7.js"><link rel="prefetch" href="/docs/assets/js/162.d3151b7e.js"><link rel="prefetch" href="/docs/assets/js/163.84297f8a.js"><link rel="prefetch" href="/docs/assets/js/164.41add528.js"><link rel="prefetch" href="/docs/assets/js/165.6af85c21.js"><link rel="prefetch" href="/docs/assets/js/166.fb6cb500.js"><link rel="prefetch" href="/docs/assets/js/167.7da713e1.js"><link rel="prefetch" href="/docs/assets/js/168.a6add8c4.js"><link rel="prefetch" href="/docs/assets/js/169.a01126be.js"><link rel="prefetch" href="/docs/assets/js/17.95b7e490.js"><link rel="prefetch" href="/docs/assets/js/170.a97cef1a.js"><link rel="prefetch" href="/docs/assets/js/171.438f8be5.js"><link rel="prefetch" href="/docs/assets/js/172.f6c40b86.js"><link rel="prefetch" href="/docs/assets/js/173.a1d8efe4.js"><link rel="prefetch" href="/docs/assets/js/174.f97fba7e.js"><link rel="prefetch" href="/docs/assets/js/175.3a3b0a5c.js"><link rel="prefetch" href="/docs/assets/js/176.abb36d15.js"><link rel="prefetch" href="/docs/assets/js/177.b525c7c6.js"><link rel="prefetch" href="/docs/assets/js/178.6cbda090.js"><link rel="prefetch" href="/docs/assets/js/179.fba2a07c.js"><link rel="prefetch" href="/docs/assets/js/18.ca0afb77.js"><link rel="prefetch" href="/docs/assets/js/180.c90f194d.js"><link rel="prefetch" href="/docs/assets/js/181.4e43287b.js"><link rel="prefetch" href="/docs/assets/js/19.981481df.js"><link rel="prefetch" href="/docs/assets/js/20.6e80cd2d.js"><link rel="prefetch" href="/docs/assets/js/21.c0ec8375.js"><link rel="prefetch" href="/docs/assets/js/22.648850d3.js"><link rel="prefetch" href="/docs/assets/js/23.73ed5316.js"><link rel="prefetch" href="/docs/assets/js/24.768a95fb.js"><link rel="prefetch" href="/docs/assets/js/25.b460e9a9.js"><link rel="prefetch" href="/docs/assets/js/26.61c56597.js"><link rel="prefetch" href="/docs/assets/js/27.2bbfe116.js"><link rel="prefetch" href="/docs/assets/js/28.efc0814f.js"><link rel="prefetch" href="/docs/assets/js/29.8bebb742.js"><link rel="prefetch" href="/docs/assets/js/3.f0b9dcd8.js"><link rel="prefetch" href="/docs/assets/js/30.e6180f81.js"><link rel="prefetch" href="/docs/assets/js/31.791f6adb.js"><link rel="prefetch" href="/docs/assets/js/32.59f79bfb.js"><link rel="prefetch" href="/docs/assets/js/33.24072082.js"><link rel="prefetch" href="/docs/assets/js/34.9cc3face.js"><link rel="prefetch" href="/docs/assets/js/35.f5942d3c.js"><link rel="prefetch" href="/docs/assets/js/36.dd226553.js"><link rel="prefetch" href="/docs/assets/js/37.12a8e708.js"><link rel="prefetch" href="/docs/assets/js/38.0c48b0a9.js"><link rel="prefetch" href="/docs/assets/js/39.9d41280d.js"><link rel="prefetch" href="/docs/assets/js/4.0f806da2.js"><link rel="prefetch" href="/docs/assets/js/40.494e0bb7.js"><link rel="prefetch" href="/docs/assets/js/41.e2242735.js"><link rel="prefetch" href="/docs/assets/js/42.f6d801aa.js"><link rel="prefetch" href="/docs/assets/js/43.51c3e56f.js"><link rel="prefetch" href="/docs/assets/js/44.a096b57c.js"><link rel="prefetch" href="/docs/assets/js/45.2d938602.js"><link rel="prefetch" href="/docs/assets/js/46.5462b19e.js"><link rel="prefetch" href="/docs/assets/js/47.3693a81a.js"><link rel="prefetch" href="/docs/assets/js/48.1d984385.js"><link rel="prefetch" href="/docs/assets/js/49.75eb0693.js"><link rel="prefetch" href="/docs/assets/js/5.7088cd54.js"><link rel="prefetch" href="/docs/assets/js/50.06ea30e6.js"><link rel="prefetch" href="/docs/assets/js/51.95767db4.js"><link rel="prefetch" href="/docs/assets/js/52.036a427b.js"><link rel="prefetch" href="/docs/assets/js/53.03e8160e.js"><link rel="prefetch" href="/docs/assets/js/54.3f89c021.js"><link rel="prefetch" href="/docs/assets/js/55.ee276a6b.js"><link rel="prefetch" href="/docs/assets/js/56.c18fddc1.js"><link rel="prefetch" href="/docs/assets/js/57.80455c3d.js"><link rel="prefetch" href="/docs/assets/js/58.8ffe2d5a.js"><link rel="prefetch" href="/docs/assets/js/59.5adb1a11.js"><link rel="prefetch" href="/docs/assets/js/6.aa27b4b3.js"><link rel="prefetch" href="/docs/assets/js/60.35ada18a.js"><link rel="prefetch" href="/docs/assets/js/61.127f120e.js"><link rel="prefetch" href="/docs/assets/js/62.0d882604.js"><link rel="prefetch" href="/docs/assets/js/63.57f410fd.js"><link rel="prefetch" href="/docs/assets/js/64.f121b763.js"><link rel="prefetch" href="/docs/assets/js/65.76ef0090.js"><link rel="prefetch" href="/docs/assets/js/66.a39ac5ac.js"><link rel="prefetch" href="/docs/assets/js/67.499d3620.js"><link rel="prefetch" href="/docs/assets/js/68.7c04c7a8.js"><link rel="prefetch" href="/docs/assets/js/69.e58396ea.js"><link rel="prefetch" href="/docs/assets/js/7.6653ed24.js"><link rel="prefetch" href="/docs/assets/js/70.2ce6d316.js"><link rel="prefetch" href="/docs/assets/js/71.80443b6f.js"><link rel="prefetch" href="/docs/assets/js/72.f224489d.js"><link rel="prefetch" href="/docs/assets/js/73.0f73eb62.js"><link rel="prefetch" href="/docs/assets/js/74.a6215b26.js"><link rel="prefetch" href="/docs/assets/js/75.1dd84ab6.js"><link rel="prefetch" href="/docs/assets/js/76.f706d67e.js"><link rel="prefetch" href="/docs/assets/js/77.583d7e47.js"><link rel="prefetch" href="/docs/assets/js/78.add671e4.js"><link rel="prefetch" href="/docs/assets/js/79.6fc1e8ae.js"><link rel="prefetch" href="/docs/assets/js/8.a8d55efb.js"><link rel="prefetch" href="/docs/assets/js/80.ac37b44e.js"><link rel="prefetch" href="/docs/assets/js/81.22269b9e.js"><link rel="prefetch" href="/docs/assets/js/82.5e87105a.js"><link rel="prefetch" href="/docs/assets/js/83.c163ad45.js"><link rel="prefetch" href="/docs/assets/js/84.ea4c4f56.js"><link rel="prefetch" href="/docs/assets/js/85.c85d59a7.js"><link rel="prefetch" href="/docs/assets/js/86.c72e064f.js"><link rel="prefetch" href="/docs/assets/js/87.b3b4b378.js"><link rel="prefetch" href="/docs/assets/js/88.427e7539.js"><link rel="prefetch" href="/docs/assets/js/89.3e80f38e.js"><link rel="prefetch" href="/docs/assets/js/9.7d808dd7.js"><link rel="prefetch" href="/docs/assets/js/90.98e5fa17.js"><link rel="prefetch" href="/docs/assets/js/91.eec311e8.js"><link rel="prefetch" href="/docs/assets/js/92.e69c17dd.js"><link rel="prefetch" href="/docs/assets/js/93.819ed333.js"><link rel="prefetch" href="/docs/assets/js/94.fdb7e62a.js"><link rel="prefetch" href="/docs/assets/js/95.e7fa30b5.js"><link rel="prefetch" href="/docs/assets/js/96.3de3ec3c.js"><link rel="prefetch" href="/docs/assets/js/97.2126926f.js"><link rel="prefetch" href="/docs/assets/js/98.60f1bc26.js"><link rel="prefetch" href="/docs/assets/js/99.b65571cc.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.a5c765a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/project/mock.html" class="sidebar-link">前端数据mock</a></li><li><a href="/docs/project/module.html" class="sidebar-link">一文搞懂AMD,CMD,CommonJs,UMD,ES Modules</a></li><li><a href="/docs/project/babel.html" class="sidebar-link">Babel</a></li><li><a href="/docs/project/webpack.html" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#四个核心概念" class="sidebar-link">四个核心概念</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#模块热替换" class="sidebar-link">模块热替换</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#文件监听" class="sidebar-link">文件监听</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#文件指纹" class="sidebar-link">文件指纹</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#自动清理构建目录" class="sidebar-link">自动清理构建目录</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#css增强" class="sidebar-link">CSS增强</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#静态资源内联" class="sidebar-link">静态资源内联</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#使用-source-map" class="sidebar-link">使用 source map</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#提取页面的公共资源" class="sidebar-link">提取页面的公共资源</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#splitchunks" class="sidebar-link">splitChunks</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#scope-hoisting" class="sidebar-link">Scope Hoisting</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#代码分割和动态import" class="sidebar-link">代码分割和动态import</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack与ci-cd集成" class="sidebar-link">webpack与CI/CD集成</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack打包组件和基础库" class="sidebar-link">webpack打包组件和基础库</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#webpack实现ssr打包" class="sidebar-link">webpack实现SSR打包</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#优化构建时命令行的显示" class="sidebar-link">优化构建时命令行的显示</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#commonschunkplugin" class="sidebar-link">CommonsChunkPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#cleanwebpackplugin" class="sidebar-link">CleanWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#extracttextwebpackplugin" class="sidebar-link">ExtractTextWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#copywebpackplugin" class="sidebar-link">CopyWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#uglifyjswebpackplugin" class="sidebar-link">UglifyjsWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#zipwebpackplugin" class="sidebar-link">ZipWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#minicssextractplugin" class="sidebar-link">MiniCssExtractPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#htmlwebpackplugin" class="sidebar-link">HtmlWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#path与publicpath" class="sidebar-link">path与publicPath</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#构建配置抽离成npm包" class="sidebar-link">构建配置抽离成npm包</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#构建包功能模块设计" class="sidebar-link">构建包功能模块设计</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#目录结构设计" class="sidebar-link">目录结构设计</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#冒烟测试" class="sidebar-link">冒烟测试</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#单元测试和测试覆盖率" class="sidebar-link">单元测试和测试覆盖率</a></li><li class="sidebar-sub-header"><a href="/docs/project/webpack.html#构建包的持续集成和-travis-ci" class="sidebar-link">构建包的持续集成和 Travis CI</a></li></ul></li><li><a href="/docs/project/autobuild.html" class="sidebar-link">前端轻量自动化构建方案</a></li><li><a href="/docs/project/err.html" class="sidebar-link">前端错误监控体系搭建</a></li><li><a href="/docs/project/standards.html" class="sidebar-link">前端代码规范</a></li><li><a href="/docs/project/docker.html" class="sidebar-link">从0开始学习docker</a></li><li><a href="/docs/project/autoTryCatch.html" class="sidebar-link">基于 Babel 和 AST自动添加 try catch 方法</a></li><li><a href="/docs/project/gitlabCI.html" class="sidebar-link">GitLab CI Pipeline框架</a></li></ul></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><a href="/docs/git/" class="sidebar-link">git相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器插件扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack">webpack</h1> <p><strong>本文所阐述的相关知识都是基于webpack4.x版本</strong></p> <h2 id="定义">定义</h2> <blockquote><p><code>webpack</code>是一个现代<code>JavasScript</code>应用程序的模块打包器(<code>module bunder</code>)</p></blockquote> <h2 id="四个核心概念">四个核心概念</h2> <ul><li><code>入口(entry)</code></li> <li><code>输出(output)</code></li> <li><code>loader</code></li> <li><code>插件(plugins)</code></li></ul> <h3 id="入口">入口</h3> <blockquote><p>指示 <code>webpack</code> 应该使用哪个模块，来作为构建其内部依赖图的开始。Webpack执行构建的第一步将从 入口开始，搜寻及递归解析出所有入口依赖的模块。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 最简单的单入口文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// entry 属性的单个入口语法，是下面的简写：</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config
</code></pre></div><h3 id="出口">出口</h3> <blockquote><p><code>output</code> 属性告诉 <code>webpack</code> 在哪里输出它所创建的 <code>bundles</code>，以及如何命名这些文件，默认值为 <code>./dist</code>。基本上，整个应用程序结构，都会被编译到你指定的输出路径的文件夹中。你可以通过在配置中指定一个 <code>output</code> 字段，来配置这些处理过程：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 简单的单入口 单出口配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'my-first-webpack.bundle.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="loader">loader</h3> <blockquote><p><code>loader</code> 让 <code>webpack</code> 能够去处理那些非 <code>JavaScript</code> 文件（<code>webpack</code> 自身只理解 <code>JavaScript</code>）。<code>loader</code> 可以将所有类型的文件转换为 <code>webpack</code> 能够处理的有效模块，然后你就可以利用 <code>webpack</code> 的打包能力，对它们进行处理。</p></blockquote> <p>本质上，<code>webpack loader</code> 将所有类型的文件，转换为应用程序的依赖图（和最终的 <code>bundle</code>）可以直接引用的模块。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 <code>webpack</code> 的配置中 <code>loader</code> 有两个目标：</p> <ul><li><code>test</code> 属性，用于标识出应该被对应的 <code>loader</code> 进行转换的某个或某些文件。</li> <li><code>use</code> 属性，表示进行转换时，应该使用哪个 <code>loader</code>。</li></ul> <p><code>thread-loader</code>:可以配置webpack进行多进程的打包js和css。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 简单的loader配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'my-first-webpack.bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> <span class="token comment">//匹配所有的js文件</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//除了node_modules以外</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 配置css loaders 假如在index.js中引入css 会被转化成commonjs对象</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// styles-loader 将css转化成style 插入到head中</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// url-loader可以处理一些图片大小转base64的功能   limit的单位是B(字节)</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.png|jpg|jpeg|gif$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span> loader<span class="token operator">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>options<span class="token operator">:</span><span class="token punctuation">{</span>limit<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div><h3 id="loader-特性">loader 特性</h3> <ol><li><p>loader 支持链式传递。能够对资源使用流水线(pipeline)。一组链式的 loader 将按照相反的顺序执行。loader 链中的第一个 loader 返回值给下一个 loader。在最后一个 loader，返回 webpack 所预期的 JavaScript。</p></li> <li><p>loader 可以是同步的，也可以是异步的。</p></li> <li><p>loader 运行在 Node.js 中，并且能够执行任何可能的操作。</p></li> <li><p>loader 接收查询参数。用于对 loader 传递配置。</p></li> <li><p>loader 也能够使用 options 对象进行配置。</p></li> <li><p>除了使用 package.json 常见的 main 属性，还可以将普通的 npm 模块导出为 loader，做法是在 package.json 里定义一个 loader 字段。</p></li> <li><p>插件(plugin)可以为 loader 带来更多特性。</p></li> <li><p>loader 能够产生额外的任意文件。</p></li></ol> <h3 id="插件-plugins">插件(plugins)</h3> <blockquote><p><code>loader</code> 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p></blockquote> <p>想要使用一个插件，你只需要 <code>require()</code> 它，然后把它添加到 <code>plugins</code> 数组中。多数插件可以通过选项(<code>option</code>)自定义。你也可以在一个配置文件中因为不同目的而多次使用同一个插件，这时需要通过使用 <code>new</code> 操作符来创建它的一个实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 npm 安装</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用于访问内置插件</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>webpack</code> 提供许多开箱可用的插件！查阅<a href="https://www.webpackjs.com/plugins/" target="_blank" rel="noopener noreferrer">插件列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>获取更多信息。</p></div> <h3 id="模式-mode">模式(mode)</h3> <blockquote><p><code>webpack</code>内置了两个不同的模式(<code>development</code>、<code>production</code> ),通过选择 <code>development</code> 或 <code>production</code> 之中的一个，来设置 <code>mode</code> 参数，你可以启用相应模式下的 <code>webpack</code> 内置的优化。</p></blockquote> <p><strong>- <code>development</code>模式下，将侧重于功能调试和优化开发体验，包含如下内容：</strong></p> <ol><li>浏览器调试工具</li> <li>开发阶段的详细错误日志和提示</li> <li>快速和优化的增量构建机制</li></ol> <p><strong>- <code>production模式下</code>，将侧重于模块体积优化和线上部署，包含如下内容：</strong></p> <ol><li>开启所有的优化代码</li> <li>更小的<code>bundle</code>大小</li> <li>去除掉只在开发阶段运行的代码</li> <li><code>Scope hoisting</code>和<code>Tree-shaking</code></li> <li>自动启用<code>uglifyjs</code>对代码进行压缩</li></ol> <h3 id="manifest">manifest</h3> <p><strong>在使用 webpack 构建的典型应用程序或站点中，有三种主要的代码类型：</strong></p> <ol><li>你或你的团队编写的源码。</li> <li>你的源码会依赖的任何第三方的 library 或 &quot;vendor&quot; 代码。</li> <li>webpack 的 <code>runtime</code> 和 <code>manifest</code>，管理所有模块的交互。</li></ol> <p><strong>Runtime</strong></p> <p>如上所述，我们这里只简略地介绍一下。runtime，以及伴随的 manifest 数据，主要是指：在浏览器运行时，webpack 用来连接模块化的应用程序的所有代码。runtime 包含：在模块交互时，连接模块所需的加载和解析逻辑。包括浏览器中的已加载模块的连接，以及懒加载模块的执行逻辑。</p> <p><strong>Manifest</strong>
那么，一旦你的应用程序中，形如 index.html 文件、一些 bundle 和各种资源加载到浏览器中，会发生什么？你精心安排的 /src 目录的文件结构现在已经不存在，所以 webpack 如何管理所有模块之间的交互呢？这就是 manifest 数据用途的由来……</p> <p>当编译器(compiler)开始执行、解析和映射应用程序时，它会保留所有模块的详细要点。这个数据集合称为 &quot;Manifest&quot;，当完成打包并发送到浏览器时，会在运行时通过 Manifest 来解析和加载模块。无论你选择哪种模块语法，那些 import 或 require 语句现在都已经转换为 <strong>webpack_require</strong> 方法，此方法指向模块标识符(module identifier)。通过使用 manifest 中的数据，runtime 将能够查询模块标识符，检索出背后对应的模块。</p> <h2 id="模块热替换">模块热替换</h2> <p>模块热替换(HMR - Hot Module Replacement)功能会在应用程序运行过程中替换、添加或删除模块，而无需重新加载整个页面。主要是通过以下几种方式，来显著加快开发速度：</p> <ul><li><p>保留在完全重新加载页面时丢失的应用程序状态。</p></li> <li><p>只更新变更内容，以节省宝贵的开发时间。</p></li> <li><p>调整样式更加快速 - 几乎相当于在浏览器调试器中更改样式。</p></li></ul> <p>你可以设置 HMR，以使此进程自动触发更新，或者你可以选择要求在用户交互时进行更新。通常我们可以使用<code>webpack-dev-server</code>来进行处理。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><p><code>webpack-dev-server</code> 不会刷新浏览器</p></li> <li><p><code>webpack-dev-server</code> 不输出文件,二是放在内存中</p></li> <li><p>使用 <code>HotModuleReplacementPlugin</code> 插件(webpack自带)</p></li> <li><p>使用 <code>webpack-dev-middleware</code>也可以实现相同的功能，不过这种方式会将<code>webpack</code>输出的文件传输给服务器,适用于灵活的定制场景。</p></li></ul></div> <h3 id="热更新原理">热更新原理</h3> <p><img src="https://img-blog.csdnimg.cn/20200515205923186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="极客时间热更原理"></p> <h2 id="文件监听">文件监听</h2> <blockquote><p>文件监听是在发现源码发生变化的时候,自动的构建出新的输出文件。</p></blockquote> <p>webpack中开启监听模式有两种方式实现:</p> <ul><li><p>启动 <code>webpack</code> 的时候带上 <code>--watch</code> 参数</p></li> <li><p>在配置 <code>webpack.config.js</code> 的时候设置 <code>watch:true</code></p></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>这种方式虽然webpack构建是成功了 但是需要开发者手动刷新浏览器才会显示效果</p></div> <h3 id="文件监听的原理">文件监听的原理</h3> <blockquote><p>轮询的判断文件的最后编辑时间是否发生了变化。当某个文件发生了变化，并不会立即告诉监听者，而是先缓存起来,等待 <code>aggregateTimeout</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>modules<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token comment">// 默认是false 不开启</span>
   watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token comment">// 只有watch开启之后才会有效</span>
   watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token comment">// 默认为空 不监听的文件或文件夹 支持正则匹配</span>
     ignored<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
     <span class="token comment">// 监听到变化后等待多少ms之后执行 默认是300ms</span>
     aggregateTimeout<span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span>
     <span class="token comment">// 判断文件是否发生变化通过不停询问系统指定文件有没有变化实现的， 默认为每秒询问1000次</span>
     poll<span class="token operator">:</span> <span class="token number">1000</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="文件指纹">文件指纹</h2> <blockquote><p>文件指纹其实指的就是每次文件打包之后后面跟着的<code>HashCode</code>,用来做版本管理等功能</p></blockquote> <h3 id="分类">分类</h3> <ul><li><p><code>Hash</code>: 和整个项目的构建有关,只要项目文件有修改,整个项目构建的hash值就会更改。</p></li> <li><p><code>Chunkhash</code>: 和<code>webpack</code>打包的<code>chunk</code>有关，不同的<code>entry</code>会生成不同的<code>chunkhash</code>。</p></li> <li><p><code>Contenthash</code>: 根据文件的内容来定义<code>hash</code>,文件内容不变,则<code>contenthash</code>不变。</p></li></ul> <h2 id="自动清理构建目录">自动清理构建目录</h2> <ul><li>2020.05.18</li></ul> <p>默认情况下每次webpack的构建的需要手动去清除之前构建产生的目录文件，这样在实际工程中就变得很麻烦。下面将会讲解几种自动化清理构建目录的方法。</p> <ol><li>通过script命令</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>rm <span class="token operator">-</span>rf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
<span class="token comment">// rimraf 是个插件库</span>
rimraf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
</code></pre></div><ol start="2"><li>使用 <code>clean-webpack-plugin</code> 插件</li></ol> <blockquote><p>这个插件默认会删除 <code>output</code> 指定的输出目录</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="css增强">CSS增强</h2> <h3 id="_1-自动补全属性兼容">1. 自动补全属性兼容</h3> <p>CSS3某些属性其实在不同浏览器的支持情况不一样，以前的css代码中经常会出现以下这种qingx</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token property">-moz-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">-webkit-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">-o-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">-ms-border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
<span class="token property">border-redius</span><span class="token punctuation">:</span>50px<span class="token punctuation">;</span>
</code></pre></div><p>如何只编写W3C规范的属性，其余的让大宝工具自动帮助我们完成?</p> <p>其实我们可以通过使用<code>post-css</code>和<code>autoprefixer</code>插件来辅助我们完成这个功能。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rule<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'style-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'css-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'postcss-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            overrideBrowserslist<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 4 versions'</span><span class="token punctuation">,</span> <span class="token string">'ie 9'</span><span class="token punctuation">,</span> <span class="token string">'android 4.4.4'</span><span class="token punctuation">,</span> <span class="token string">'ios 8'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'sass-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    modifyVars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>机制是在CanIUse上查找兼容性。</p> <h3 id="_2-自动px转rem适配移动端">2. 自动px转rem适配移动端</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  addPostcssPlugins<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;customize-cra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">addPostcssPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-px2rem'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> remUnit<span class="token operator">:</span> <span class="token number">75</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// px转换成rem</span>

<span class="token comment">// 早期版本</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'px2rem-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        remUnit<span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span><span class="token comment">// 1rem = 75px  750设计稿</span>
        remPrecision<span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">,</span><span class="token comment">// px转rem小数点位数</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>推荐使用手机淘宝的<a href="https://github.com/amfe/lib-flexible" target="_blank" rel="noopener noreferrer"><code>lib-flexible</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>库配套使用 或者使用本博客对应的js技巧篇中的方法。</p></div> <h2 id="静态资源内联">静态资源内联</h2> <h3 id="意义">意义</h3> <ul><li><p>页面框架的初始化脚本</p></li> <li><p>上报相关打点</p></li> <li><p>CSS内联避免页面闪动</p></li> <li><p>小图片或者字体内联 减少<code>HTTP</code>请求数</p></li></ul> <h3 id="实现">实现</h3> <p>主要是用 <code>raw-loader</code>来实现静态资源内联。</p> <h3 id="功能">功能</h3> <ul><li><code>raw-loader</code> 内联html</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raw-loader!babel-loader!./meta.html'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><code>raw-loader</code> 内联js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raw-loader!babel-loader!../node_modules/lib_flexible'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="实现css内联">实现css内联</h3> <ol><li>借助<code>style-loader</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span><span class="token punctuation">{</span>
        insertAt<span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span><span class="token comment">// 样式插入head</span>
        singleton<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 将所有的style标签合并成一个</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>使用<code>html-inline-css-webpack-plugin</code></li></ol> <h2 id="使用-source-map">使用 source map</h2> <blockquote><p>soure map可以将打包后的文件与原文件建立映射 方便查找打包之前的文件、定位错误</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意: 一般仅在开发环境开启</p></div> <h3 id="关键字">关键字</h3> <ul><li><p><code>eval</code>: 使用<code>eval</code>包裹模块代码</p></li> <li><p><code>source map</code>: 产生<code>.map</code>文件</p></li> <li><p><code>cheap</code>: 不包含列信息</p></li> <li><p><code>inline</code>: 将<code>.map</code>作为<code>DataURI</code>嵌入,不单独生成<code>.map</code>文件</p></li> <li><p><code>module</code>: 包含<code>loader</code>的<code>sourcemap</code></p></li></ul> <h2 id="提取页面的公共资源">提取页面的公共资源</h2> <h3 id="基础库的分离">基础库的分离</h3> <blockquote><p>将react、react-dom等基础包通过cdn引入,不打入bundle中。</p></blockquote> <p>实际操作起来就是将这些库使用<code>externals</code>进行引入或者使用<code>splitChunks</code>进行分割.</p> <p><strong>使用 <code>html-webpack-externals-plugin</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 安装</span>
npm i html<span class="token operator">-</span>webpack<span class="token operator">-</span>externals<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>


<span class="token comment">// 使用 </span>
<span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-externals-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        externals<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            module<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
            entry<span class="token operator">:</span> <span class="token string">'cdn文件地址'</span><span class="token punctuation">,</span>
            global<span class="token operator">:</span> <span class="token string">'React'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            module<span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
            entry<span class="token operator">:</span> <span class="token string">'cdn文件地址'</span><span class="token punctuation">,</span>
            global<span class="token operator">:</span> <span class="token string">'ReactDOM'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;依赖地址&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="splitchunks">splitChunks</h2> <ul><li>2020.05.18</li></ul> <p><code>splitChunks</code>算是<code>webpack</code>中比较高级的一个用法，主要是跟<code>模块拆分</code>与<code>代码拆分</code>功能相关。</p> <p>在研究<code>splitChunks</code>之前，我们先再回顾下<code>webpack</code>中的<code>module</code>、<code>chunk</code>和<code>bundle</code>。</p> <ul><li><p><code>module</code>：就是js的模块化<code>webpack</code>支持<code>commonJS</code>、<code>ES6</code>等模块化规范，简单来说就是你通过<code>import</code>语句引入的代码。</p></li> <li><p><code>chunk</code>: <code>chunk</code>是<code>webpack</code>根据功能拆分出来的，包含三种情况：</p> <ol><li>你的项目入口<code>（entry）</code></li> <li>通过<code>import()</code>动态引入的代码</li> <li>通过<code>splitChunks</code>拆分出来的代码</li></ol></li></ul> <p><code>chunk</code>包含着<code>module</code>，可能是一对多也可能是一对一。</p> <ul><li><code>bundle</code>：<code>bundle</code>是<code>webpack</code>打包之后的各个文件，一般就是和<code>chunk</code>是一对一的关系，<code>bundle</code>就是对<code>chunk</code>进行编译压缩打包等处理之后的产出。</li></ul> <p>在<code>webpack4</code>之后有一个默认的<code>splitChunks</code>配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="chunks">chunks</h3> <p><code>chunks</code>的含义是拆分模块的范围，它有三个值<code>async</code>、<code>initial</code>和<code>all</code>。</p> <ul><li><code>async</code>表示只从异步加载得模块（<code>动态加载import()</code>）里面进行拆分</li> <li><code>initial</code>表示只从入口模块进行拆分</li> <li><code>all</code>表示以上两者都包括</li></ul> <p><code>chunks</code>的默认配置是<code>async</code>，也就是只从<code>动态加载得模块</code>里面进行拆分</p> <h3 id="cachegroups">cacheGroups</h3> <p><code>cacheGroups</code>其实是<code>splitChunks</code>里面最核心的配置,<code>splitChunks</code>就是根据<code>cacheGroups</code>去拆分模块的.</p> <p><code>splitChunks</code>默认有两个缓存组：<code>vender</code>和<code>default</code>。</p> <p>如果有一个模块满足了多个缓存组的条件就会去按照权重划分，谁的权重高就优先按照谁的规则处理。</p> <h3 id="maxinitialrequests">maxInitialRequests</h3> <blockquote><p>表示允许入口并行加载的最大请求数。</p></blockquote> <p>之所以有这个配置也是为了对拆分数量进行限制，不至于拆分出太多模块导致请求数量过多而得不偿失。</p> <p><strong>这里需要注意几点：</strong></p> <ol><li>入口文件本身算一个请求</li> <li>如果入口里面有动态加载得模块这个不算在内</li> <li>通过<code>runtimeChunk</code>拆分出的<code>runtime</code>不算在内</li> <li>只算<code>js</code>文件的请求，<code>css</code>不算在内</li> <li>如果同时又两个模块满足<code>cacheGroup</code>的规则要进行拆分，但是<code>maxInitialRequests</code>的值只能允许再拆分一个模块，那尺寸更大的模块会被拆分出来</li></ol> <h3 id="maxasyncrequests">maxAsyncRequests</h3> <p><code>maxAsyncRequests</code>和<code>maxInitialRequests</code>有相似之处，它俩都是用来限制拆分数量的，<code>maxInitialRequests</code>是用来限制入口的拆分数量而<code>maxAsyncRequests</code>是用来限制异步模块内部的并行最大请求数的，说白了你可以理解为是<code>每个import()</code>它里面的最大并行请求数量。</p> <p><strong>这其中要注意以下几点：</strong></p> <ol><li><p><code>import()</code>文件本身算一个请求</p></li> <li><p>并不算js以外的公共资源请求比如css</p></li> <li><p>如果同时有两个模块满足<code>cacheGroup</code>的规则要进行拆分，但是<code>maxInitialRequests</code>的值只能允许再拆分一个模块，那<code>尺寸更大</code>的模块会被拆分出来</p></li></ol> <h3 id="其余要点">其余要点</h3> <ol><li><p><code>splitChunks.cacheGroup</code>必须同时满足各个条件才能生效，比如<code>minSize</code>或是<code>minChunks</code>等条件必须同时满足才行</p></li> <li><p><code>splitChunks</code>的配置项都是作用于<code>cacheGroup</code>上的，如果将<code>cacheGroup</code>的默认两个分组<code>vendor</code>和<code>default</code>设置为<code>false</code>，则<code>splitChunks</code>就不会起作用</p></li> <li><p><code>minChunks</code>、<code>maxAsyncRequests</code>、<code>maxInitialRequests</code>的值必须设置为大于等于1的数</p></li> <li><p>当<code>chunk</code>没有名字时，通过<code>splitChunks</code>分出的模块的名字用<code>id</code>替代，当然你也可以通过<code>name</code>属性自定义</p></li> <li><p>当<code>父chunk</code>和<code>子chunk</code>同时引入相同的<code>module</code>时，并不会将其分割出来而是删除掉<code>子chunk</code>里面共同的<code>module</code>，保留<code>父chunk</code>的<code>module</code>，这个是因为 <code>optimization.removeAvaliableModules</code> 默认是<code>true</code></p></li> <li><p>当两个<code>cacheGroup.priority</code>相同时，先定义的会先命中</p></li> <li><p>除了<code>js</code>，<code>splitChunks</code>也适用于<code>css</code></p></li></ol> <h2 id="tree-shaking">Tree Shaking</h2> <ul><li>2020.05.19</li></ul> <blockquote><p>一个模块里可能有很多个方法,只要其中的某个方法使用到了,则整个文件都会被打包到 <code>bundle</code>中去，<code>tree shaking</code>就是只把用到的方法打入到 <code>bundle</code> , 没用到的方法会在 <code>ugify阶段</code>被擦除掉,从而减小了包的体积。</p></blockquote> <h3 id="使用">使用</h3> <p><code>webpack</code>默认支持, 在 <code>.barbelrc</code> 里面设置 <code>modules: false</code> 即可。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>webpack4之后在<code>mode:production</code> 的情况下默认开启。</p> <p>必须是ES6的语法, CJS的方式不支持,且其中编写的方法不能有副作用，否则就会失效。</p></div> <p><strong>副作用解释</strong></p> <blockquote><p>对于相同的输入就有相同的输出，不依赖外部环境，也不改变外部环境。</p></blockquote> <p>符合上述的描述就可以称为纯函数，反之就是带有副作用。</p> <h3 id="原理">原理</h3> <p>利用ES6模块的特点:</p> <ul><li>只能作为模块顶层的语句出现,只在文件的顶层,不能在代码中动态导入</li> <li><code>import</code>的模块名只能是字符串常量</li> <li><code>import binding</code> 是 <code>immutable</code> 的</li></ul> <p>代码擦除:</p> <ul><li><code>uglify</code>阶段删除无用代码。</li></ul> <h3 id="扩展">扩展</h3> <ul><li>2020.05.19</li></ul> <p>上述描述到如果模块是不纯,那么<code>tree shaking</code>检测就会失效，如何优化这部分的功能呢?</p> <p>这里可以配合使用另外一个插件<code>webpack-deep-scope-plugin</code>。</p> <blockquote><p><code>webpack-deep-scope-plugin</code>是一位中国同胞(学生)在<code>Google夏令营</code>，在导师Tobias带领下写的一个<code>webpack</code>插件。主要用于填充<code>webpack</code>自身<code>Tree-shaking</code>的不足，通过<code>作用域分析</code>来消除无用的代码。</p></blockquote> <h2 id="scope-hoisting">Scope Hoisting</h2> <ul><li>2020.05.19</li></ul> <blockquote><p><code>scope hoisting</code> 是 <code>webpack3</code> 的新功能，直译过来就是<code>「作用域提升」</code>。熟悉 <code>JavaScript</code> 都应该知道<code>「函数提升」</code>和<code>「变量提升」</code>，<code>JavaScript</code> 会把函数和变量声明提升到当前作用域的顶部。<code>「作用域提升」</code>也类似于此，<code>webpack</code> 会把引入的 <code>js</code> 文件“提升到”它的引入者顶部。</p></blockquote> <h3 id="现象">现象</h3> <p>在未使用<code>Scope Hoisting</code>的情况下,编译后的代码中存在着大量的闭包代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 编译前</span>
<span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'xxxx'</span><span class="token punctuation">;</span>

<span class="token comment">// b.js</span>
<span class="token keyword">import</span> index <span class="token keyword">from</span> <span class="token string">'./a'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 编译后</span>

<span class="token comment">/****/</span> <span class="token string">&quot;./app/index/app.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******************!*\
  !*** ./app/index/app.js ***!
  \**************************/</span>
<span class="token comment">/*! no exports provided */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> __js_index__WEBPACK_IMPORTED_MODULES_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./js/index */</span> <span class="token string">&quot;./app/index/app.js&quot;</span><span class="token punctuation">)</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__js_index__WEBPACK_IMPORTED_MODULES_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">/****/</span> <span class="token string">&quot;./app/index/js/index.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******************!*\
  !*** ./app/index/js/index.js ***!
  \**************************/</span>
<span class="token comment">/*! export provided:default */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* harmony default export */</span> __webpack_exoirts__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'xxxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>这样会导致:</strong></p> <ol><li><p>大量闭包函数包裹代码，导致体积增大(模块越多的情况下越明显)</p></li> <li><p>运行代码时创建的函数作用域变多,内存开销变大</p></li></ol> <h3 id="原理之模块转化分析">原理之模块转化分析</h3> <p>我们来探究下为什么经过<code>webpack</code>打包之后会产生这么多的闭包函数，先来了解下<code>webpack</code>的<code>模块转化</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 打包之前的代码</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> helloword <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./helloworld'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'../../common'</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">helloworld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 打包之后的模块初始化函数</span>
<span class="token comment">/* 0 */</span>
<span class="token comment">/***/</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import (指es6的import语法)*/</span> <span class="token keyword">var</span> _common_WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> _helloworld_WEBPACK_IMPORTED_MODULE_1__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">Object</span><span class="token punctuation">(</span>_helloworld_WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">[</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="结论">结论</h4> <ul><li><p>被 <code>webpack</code> 转化后的模块会带上一层包裹</p></li> <li><p><code>import</code> 会被转化成 <code>__webpack_require</code></p></li></ul> <h3 id="进一步分析-webpack-的模块机制">进一步分析 <code>webpack</code> 的模块机制</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">/* 0 module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/* 1 module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/* n module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="结论-2">结论</h4> <ul><li><p><code>webpack</code>打包出来的是一个 <code>IIFE(匿名闭包)</code></p></li> <li><p><code>modules</code> 是一个数组,每一项是一个模块初始化函数</p></li> <li><p><code>__webpack_require</code> 用来加载模块, 返回的是 <code>module.exports</code></p></li> <li><p>通过<code>WEBPACK_REQUIRE_METHOD(0)</code>来启动程序</p></li></ul> <h3 id="scope-hoisting-原理">Scope Hoisting 原理</h3> <blockquote><p>将所有模块的代码按照引用顺序放在一个函数作用域里, 然后适当的重命名一些变量以防止变量名冲突。</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200519145232537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="Scope Hoisting 原理"></p> <h3 id="scope-hoisting-使用">Scope Hoisting 使用</h3> <p><strong>在<code>webpack4</code>下 <code>mode</code> 为 <code>production</code> 时默认开启了此功能。</strong></p> <h2 id="代码分割和动态import">代码分割和动态import</h2> <ul><li>2020.05.19</li></ul> <h3 id="如何动态的import">如何动态的import</h3> <ol><li>安装 babel 插件</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm install @babel/plugin-syntax-dynamic-import --save-dev
</code></pre></div><ol start="2"><li>配置<code>.babelrc</code>文件的<code>plugins</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'@babel/plugin-syntax-dynamic-import'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何使用">如何使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="内部原理">内部原理</h3> <p>通过 <code>webpackJsonp</code> 请求异步加载。动态创建<code>script标签</code>,然后引入。</p> <h2 id="webpack与ci-cd集成">webpack与CI/CD集成</h2> <ul><li>2020.05.19</li></ul> <h3 id="本地开发增加precommit钩子">本地开发增加<code>precommit</code>钩子</h3> <ol><li>安装 <code>husky</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm install husky --save-dev
</code></pre></div><ol start="2"><li>增加 <code>npm script</code>，通过 <code>lint-staged</code> 增量检查修改的文件</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span><span class="token punctuation">,</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;precommit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git rev-parse --abbrev-ref HEAD | if ! [[ $(xargs) =~ 'gray|master|t\\d*' ]]; then lint-staged; fi&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;linters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;*.{js,scss}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;git add&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="webpack打包组件和基础库">webpack打包组件和基础库</h2> <ul><li>2020.05.19</li></ul> <blockquote><p><code>webpack</code>除了打包应用，也可以用来打包js库和一些自定义组件库。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>单纯只是打包js库和组件库的话 使用<a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer"><code>rollup</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>打包也是一个不错的选择</p></div> <p><strong>我们来实现一个简单的打包例子，这个例子需要满足以下几点功能:</strong></p> <ol><li><p>需要支持打包<code>压缩版(x.min.js)</code>和<code>非压缩版本(x.js)</code>。</p></li> <li><p>支持 <code>AMD/CJS/ESM</code> 模块引入。</p></li> <li><p>支持通过<code>script</code>脚本直接引入链接。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ESM</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Tool <span class="token keyword">from</span> <span class="token string">'tools'</span><span class="token punctuation">;</span>

<span class="token comment">//cjs</span>
<span class="token keyword">const</span> Tool <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tools'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// AMD</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'tools'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// script 脚本</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://xxx.com/tools&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>如何将库暴露出去？</strong></p> <ul><li><p><code>library</code>：指定库的全局变量</p></li> <li><p><code>libraryTarget</code>：支持库引入的方式</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
   entry<span class="token operator">:</span> <span class="token punctuation">{</span>
     tools<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
     tools<span class="token punctuation">.</span>min<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   output<span class="token operator">:</span><span class="token punctuation">{</span>
     filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
     library<span class="token operator">:</span> <span class="token string">&quot;tools&quot;</span><span class="token punctuation">,</span>
     libraryExport<span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
     libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span><span class="token comment">// var this window ...</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>接下来让我们开始表演:</strong></p> <h3 id="_1-新建项目-webpack-build-tools-安装webpack和webpack-cli">1.新建项目 <code>webpack-build-tools</code> 安装<code>webpack</code>和<code>webpack-cli</code></h3> <div class="language- extra-class"><pre class="language-text"><code>mkdir webpack-build-tools

cd webpack-build-tools

npm init -y

npm i webpack webpack-cli
</code></pre></div><h3 id="_2-新建目录-src-index-js-编写我们的工具代码">2. 新建目录 <code>src/index.js</code>,编写我们的工具代码</h3> <p>此处的代码来自我的博客下 <code>js-tips</code> 仅作为示例使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 将参数中的null undefined转化为空
 * @param {String} el 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">,</span> <span class="token string">'undefined'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> el
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 正则表示法
 * 思路:通过正则表达式获取url上的参数 然后通过数组reduce追加到对象中
 * 
 * @param {string} url 需要获取的url地址默认为当前地址
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">getUrlParameters</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * match返回字符串中匹配结果的数组,匹配不到返回null
     * [^?=&amp;]+ 匹配除了?=&amp;之外的字符 仅匹配一次
     * Array.reduce(callBack(prev,cur,index,array), initialValue)
     * Array.slice(start,[end]) 返回start-end的元素
     */</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)=([^&amp;]*)/g</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-安装-terser-webpack-plugin-压缩插件">3. 安装 <code>terser-webpack-plugin</code> 压缩插件</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i terser-webpack-plugin -D
</code></pre></div><h3 id="_4-新建-webpack-config-js">4. 新建 <code>webpack.config.js</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">// 引入压缩插件</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token comment">// 因为默认是production 默认会进行压缩</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;tools&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;tools.min&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token string">&quot;tools&quot;</span><span class="token punctuation">,</span>
        libraryExport<span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 不添加的话引用的时候需要 tools.default</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">// var this window ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 使用压缩插件</span>
                include<span class="token operator">:</span> <span class="token regex">/\.min\.js$/</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-修改-package-json-添加打包命令">5. 修改 <code>package.json</code> 添加打包命令</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-build-tools&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js常用工具函数&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;webpack-build-tools&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xjl271314&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.43.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.11&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;terser-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-打包并查看打包效果">6. 打包并查看打包效果</h3> <div class="language- extra-class"><pre class="language-text"><code>npm run build
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20200519174826824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="打包结果"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// tools.js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpackUniversalModuleDefinition</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span>
		module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span>
		<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span>
		exports<span class="token punctuation">[</span><span class="token string">&quot;tools&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		root<span class="token punctuation">[</span><span class="token string">&quot;tools&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
<span class="token comment">/******/</span> 	<span class="token comment">// The module cache</span>
<span class="token comment">/******/</span> 	<span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// The require function</span>
<span class="token comment">/******/</span> 	<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Check if module is in cache</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			<span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Create a new module (and put it into the cache)</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
<span class="token comment">/******/</span> 			l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token comment">/******/</span> 			exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Execute the module function</span>
<span class="token comment">/******/</span> 		modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Flag the module as loaded</span>
<span class="token comment">/******/</span> 		module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Return the exports of the module</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// expose the modules object (__webpack_modules__)</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// expose the module cache</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// define getter function for harmony exports</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> getter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token operator">:</span> getter <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// define __esModule on exports</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'Module'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// create a fake namespace object</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 1: value is a module id, require it</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 2: merge all properties of value into the ns</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 4: return value when already ns object</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 8|1: behave like require</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> value <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> ns <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> ns<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// getDefaultExport function for compatibility with non-harmony modules</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> getter <span class="token operator">=</span> module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule <span class="token operator">?</span>
<span class="token comment">/******/</span> 			<span class="token keyword">function</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">:</span>
<span class="token comment">/******/</span> 			<span class="token keyword">function</span> <span class="token function">getModuleExports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		__webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> getter<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// Object.prototype.hasOwnProperty.call</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// __webpack_public_path__</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// Load entry module and return exports</span>
<span class="token comment">/******/</span> 	<span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/************************************************************************/</span>
<span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token comment">/* 0 */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;transferDefectParams&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> transferDefectParams<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> getUrlParameters<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 将参数中的null undefined转化为空
 * @param {String} el 
 */</span>
<span class="token keyword">function</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">,</span> <span class="token string">'undefined'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> el
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 正则表示法
 * 思路:通过正则表达式获取url上的参数 然后通过数组reduce追加到对象中
 * 
 * @param {string} url 需要获取的url地址默认为当前地址
 */</span>
<span class="token keyword">function</span> <span class="token function">getUrlParameters</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * match返回字符串中匹配结果的数组,匹配不到返回null
     * [^?=&amp;]+ 匹配除了?=&amp;之外的字符 仅匹配一次
     * Array.reduce(callBack(prev,cur,index,array), initialValue)
     * Array.slice(start,[end]) 返回start-end的元素
     */</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)=([^&amp;]*)/g</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/******/</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// tools.min.js</span>
<span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> exports<span class="token operator">&amp;&amp;</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> module<span class="token operator">?</span>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">&quot;function&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> define<span class="token operator">&amp;&amp;</span>define<span class="token punctuation">.</span>amd<span class="token operator">?</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> exports<span class="token operator">?</span>exports<span class="token punctuation">.</span>tools<span class="token operator">=</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>e<span class="token punctuation">.</span>tools<span class="token operator">=</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> t<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">return</span> t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span><span class="token keyword">var</span> o<span class="token operator">=</span>t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token operator">:</span>r<span class="token punctuation">,</span>l<span class="token operator">:</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>exports<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> e<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>o<span class="token punctuation">,</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>l<span class="token operator">=</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">}</span><span class="token keyword">return</span> n<span class="token punctuation">.</span>m<span class="token operator">=</span>e<span class="token punctuation">,</span>n<span class="token punctuation">.</span>c<span class="token operator">=</span>t<span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">d</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t<span class="token punctuation">,</span>r</span><span class="token punctuation">)</span><span class="token punctuation">{</span>n<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token operator">||</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">,</span><span class="token punctuation">{</span>enumerable<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">get</span><span class="token operator">:</span>r<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">r</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;undefined&quot;</span><span class="token operator">!=</span><span class="token keyword">typeof</span> Symbol<span class="token operator">&amp;&amp;</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token operator">&amp;&amp;</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token string">&quot;Module&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">t</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token function">n</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token keyword">return</span> e<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> e<span class="token operator">&amp;&amp;</span>e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span><span class="token keyword">return</span> e<span class="token punctuation">;</span><span class="token keyword">var</span> r<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>enumerable<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>value<span class="token operator">:</span>e<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token string">&quot;string&quot;</span><span class="token operator">!=</span><span class="token keyword">typeof</span> e<span class="token punctuation">)</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token keyword">in</span> e<span class="token punctuation">)</span>n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>o<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> r<span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">n</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> t<span class="token operator">=</span>e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token operator">?</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">.</span>default<span class="token punctuation">}</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function-variable function">o</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span>p<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token function">n</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>s<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">[</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;undefined&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">&quot;&quot;</span><span class="token operator">:</span>e<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">o</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">=</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">const</span> t<span class="token operator">=</span>e<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)=([^&amp;]*)/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> t<span class="token operator">?</span>t<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;transferDefectParams&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> r<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> o<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-设置入口文件-不同环境下使用不同的入口文件">7.设置入口文件 不同环境下使用不同的入口文件</h3> <p><code>package.json</code>中的<code>main</code>字段为<code>index.js</code>，所以在项目根目录下新建 <code>index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 通过环境变量来决定入口文件</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/tools.min.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/tools.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-进行npm包发布-需要注册npm账号-且进行登录">8.进行npm包发布(需要注册npm账号,且进行登录)</h3> <div class="language- extra-class"><pre class="language-text"><code>npm publish
</code></pre></div><h3 id="_9-同步代码到git-并编写对应的说明文档等">9. 同步代码到git,并编写对应的说明文档等</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 其他项目引用</span>
npm i tools <span class="token operator">-</span>s

<span class="token keyword">import</span> getUrlParameters <span class="token keyword">from</span> <span class="token string">'tools'</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>完整代码参见<a href="https://github.com/xjl271314/webpack-build-tools" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="webpack实现ssr打包">webpack实现SSR打包</h2> <ul><li>2020.05.19</li></ul> <ol><li><p>客户端渲染: HTML + CSS + JS + Data ————&gt; 渲染后的HTML</p></li> <li><p>服务端渲染:</p></li></ol> <ul><li><p>所有的模板等资源都存储在服务器</p></li> <li><p>内网机器拉取更快</p></li> <li><p>一个 HTML 返回所有的数据</p></li></ul> <p><img src="https://img-blog.csdnimg.cn/20200519202722384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="渲染差别"></p> <h3 id="ssr代码实现思路">SSR代码实现思路</h3> <ul><li>服务端：</li></ul> <ol><li><p>使用 <code>react-dom/server</code> 的 <code>renderToString</code> 方法将 <code>React组件</code> 渲染成字符串。</p></li> <li><p>服务端路由返回对应的模板。</p></li></ol> <ul><li>客户端</li></ul> <p>打包出针对服务端的组件。</p> <h3 id="简单示例">简单示例</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;build:ssr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.ssr.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>目录下新建 <code>server/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* server/index.js */</span>

<span class="token comment">// 兼容window报错</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/xx-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token parameter">port</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port:'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">server</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
        &lt;title&gt;Document&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>组件目录下创建<code>index-server.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index-server.js server端不能识别import 需要使用commonjs规范</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> React <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Example</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token operator">&lt;</span>Example <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>创建 <code>webpack.ssr.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.ssr.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name-server].js'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="打包过程中遇到的问题">打包过程中遇到的问题</h3> <h4 id="浏览器的全局变量-node-js-中没有document-window">浏览器的全局变量(<code>Node.js</code> 中没有<code>document</code>, <code>window</code>)</h4> <ul><li><p>组件适配: 将不兼容的组件根据打包环境进行适配</p></li> <li><p>请求适配: 将<code>fetch</code> 或者 <code>ajax</code> 发送请求的写法改成 <code>isomorphic-fetch</code> 或者 <code>axios</code></p></li></ul> <h4 id="样式问题-node-js-无法解析css">样式问题(<code>Node.js</code> 无法解析<code>CSS</code>)</h4> <ul><li><p>服务端打包通过 <code>ignore-loader</code> 忽略掉 <code>CSS的解析</code></p></li> <li><p>将<code>style-loader</code> 替换成 <code>isomorphic-style-loader</code></p></li> <li><p>或者使用内联样式<code>style</code></p></li></ul> <h3 id="解决打包样式问题">解决打包样式问题</h3> <p>使用打包出来的浏览器端 html 文件作为模板, 设置占位符, 动态插入组件。</p> <p>修改 <code>/server/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>修改对应的 <code>template.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- HTML_PLCAEHOLDER ---&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="优化构建时命令行的显示">优化构建时命令行的显示</h2> <ul><li>2020.05.26</li></ul> <p>实际开发过程中当我们进行打包<code>npm run build</code>或者在开发过程中<code>npm run dev</code>的时候会在控制台输出大量的信息。</p> <h3 id="使用-friendly-errors-webpack-plugin-优化日志显示">使用 <code>friendly-errors-webpack-plugin</code> 优化日志显示</h3> <ul><li><p><code>success</code>: 构建成功的日志提示</p></li> <li><p><code>warning</code>: 构建警告的日志提示</p></li> <li><p><code>error</code>: 构建报错的日志提示</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>stats<span class="token operator">:</span> <span class="token string">'errors-only'</span>
<span class="token operator">...</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="commonschunkplugin">CommonsChunkPlugin</h2> <ul><li>2020.05.18</li></ul> <blockquote><p>主要是用来提取第三方库和公共模块，避免<code>首屏加载的bundle文件</code>或者<code>按需加载的bundle文件</code>体积过大，从而导致加载时间过长，是一把优化项目的利器。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>webpack4</code>之后推荐使用<code>splitChunks</code>替代该方法。</p></div> <h3 id="chunk有哪几种，主要有以下三种：">chunk有哪几种，主要有以下三种：</h3> <ol><li><p><code>webpack</code>当中配置的<code>入口文件（entry）</code>是<code>chunk</code>，可以理解为<code>entry chunk</code></p></li> <li><p>入口文件以及它的依赖文件通过<code>code split（代码分割</code>）出来的也是<code>chunk</code>，可以理解为<code>children chunk</code></p></li> <li><p>通过<code>commonsChunkPlugin</code>创建出来的文件也是<code>chunk</code>，可以理解为<code>commons chunk</code></p></li></ol> <h3 id="可配置的属性：">可配置的属性：</h3> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">属性说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>name</code></td> <td style="text-align:left;">可以是已经存在的<code>chunk（一般指入口文件</code>）对应的<code>name</code>，那么就会把公共模块代码合并到这个<code>chunk</code>上；否则，就会创建名字为<code>name</code>的<code>commons chunk</code>进行合并</td></tr> <tr><td style="text-align:left;"><code>filename</code></td> <td style="text-align:left;">指定<code>commons chunk</code>的文件名</td></tr> <tr><td style="text-align:left;"><code>chunks</code></td> <td style="text-align:left;">指定该<code>source chunk</code>，即指定从哪些<code>chunk</code>当中去找公共模块，省略该选项的时候，默认就是<code>entry chunks</code></td></tr> <tr><td style="text-align:left;"><code>minChunks</code></td> <td style="text-align:left;">既可以数字，也可以是函数，还可以是<code>Infinity</code></td></tr></tbody></table> <h4 id="插件的作用">插件的作用:</h4> <p>单独分离出第三方库、自定义公共模块、webpack运行文件</p> <ul><li>抽离webpack运行文件，修改webpack配置文件：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'runtime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">Infinity</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>上面这段抽离<code>webpack</code>运行文件代码的意思是创建一个名为<code>runtime</code>的<code>commons chunk</code>进行<code>webpack</code>运行文件的抽离，其中<code>source chunks</code>是<code>vendor.js</code>。</p> <h2 id="cleanwebpackplugin">CleanWebpackPlugin</h2> <blockquote><p>清理构建目录</p></blockquote> <h2 id="extracttextwebpackplugin">ExtractTextWebpackPlugin</h2> <blockquote><p>将CSS从bundle中提取成一个独立的css文件</p></blockquote> <h2 id="copywebpackplugin">CopyWebpackPlugin</h2> <blockquote><p>将文件或者文件夹拷贝到构建的输出目录</p></blockquote> <h2 id="uglifyjswebpackplugin">UglifyjsWebpackPlugin</h2> <blockquote><p>压缩JS</p></blockquote> <h2 id="zipwebpackplugin">ZipWebpackPlugin</h2> <blockquote><p>将打包出的资源生成一个zip包</p></blockquote> <h2 id="minicssextractplugin">MiniCssExtractPlugin</h2> <ul><li>2020.05.29</li></ul> <blockquote><p>将css打包成单独的css文件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// npm i  mini-css-extract-plugin</span>

<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包为开发模式</span>
    entry<span class="token operator">:</span> <span class="token string">&quot;./src/main&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件,从项目根目录指定</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//输出路径和文件名，使用path模块resolve方法将输出路径解析为绝对路径</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist/js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将js文件打包到dist/js的目录</span>
        filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
	    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
	      <span class="token punctuation">{</span>
	        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
	        use<span class="token operator">:</span> <span class="token punctuation">[</span>
	        	MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
	        	<span class="token punctuation">{</span>
		            loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
		            options<span class="token operator">:</span> <span class="token punctuation">{</span>
		              minimize<span class="token operator">:</span> <span class="token boolean">true</span>
		            <span class="token punctuation">}</span>
		        <span class="token punctuation">}</span><span class="token punctuation">,</span>
	        <span class="token punctuation">]</span>
	      <span class="token punctuation">}</span>
	    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	filename<span class="token operator">:</span> <span class="token string">&quot;../css/styles.css&quot;</span> <span class="token comment">//如果需要将css文件单独放入css文件夹中需要../</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="htmlwebpackplugin">HtmlWebpackPlugin</h2> <ol><li><p><a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>HtmlWebpackPlugin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> star: 8.5K</p> <p>主要有两个作用:</p> <ol><li><p>为<code>html</code>文件中引入的外部资源如<code>script</code>、<code>link</code>动态添加每次<code>compile</code>后的<code>hash</code>，防止引用缓存的外部文件问题</p></li> <li><p>可以生成创建<code>html</code>入口文件，比如单页面可以生成一个<code>html</code>文件入口，配置N个<code>html-webpack-plugin</code>可以生成N个页面入口</p></li></ol> <p>常用的字段：</p> <ul><li><p><code>title</code>:设置生成<code>html</code>文件的标题 默认值为:<code>Webpack App</code></p></li> <li><p><code>filename</code>: 输出的<code>html</code>的文件名称 默认值为:<code>index.html</code></p></li> <li><p><code>template</code>: html模板所在的文件路径</p></li></ul> <p>根据自己的指定的模板文件来生成特定的 <code>html</code> 文件。这里的模板类型可以是任意你喜欢的模板，可以是 <code>html</code>, <code>jade</code>, <code>ejs</code>, <code>hbs</code>, 等等，但是要注意的是，使用自定义的模板文件时，需要提前安装对应的 <code>loader</code>， 否则<code>webpack</code>不能正确解析。</p> <ul><li><p><code>inject</code>:注入选项。</p> <ol><li><code>true</code>：默认值，script标签位于html文件的 body 底部</li> <li><code>body</code>：script标签位于html文件的 body 底部（同 true）</li> <li><code>head</code>：script 标签位于 head 标签内</li> <li><code>false</code>：不插入生成的 js 文件，只是单纯的生成一个 html 文件</li></ol></li> <li><p><code>favicon</code>:给生成的 <code>html</code> 文件生成一个 <code>favicon</code>。属性值为 <code>favicon</code> 文件所在的路径名</p></li> <li><p><code>minify</code>:对 <code>html</code> 文件进行压缩，<code>minify</code> 的属性值是一个压缩选项或者 <code>false</code> 。默认值为<code>false</code>, 不对生成的 <code>html</code> 文件进行压缩。</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 部分省略，具体看minify的配置</span>
        minify<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">//是否对大小写敏感，默认false</span>
            caseSensitive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否简写boolean格式的属性如：disabled=&quot;disabled&quot; 简写为disabled  默认false</span>
            collapseBooleanAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否去除空格，默认false</span>
            collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否压缩html里的css（使用clean-css进行的压缩） 默认值false；</span>
            minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否压缩html里的js（使用uglify-js进行的压缩）</span>
            minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//Prevents the escaping of the values of attributes</span>
            preventAttributesEscaping<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否移除属性的引号 默认false</span>
            removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否移除注释 默认false</span>
            removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//从脚本和样式删除的注释 默认false</span>
            removeCommentsFromCDATA<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//是否删除空属性，默认false</span>
            removeEmptyAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//若开启此项，生成的html中没有 body 和 head，html也未闭合</span>
            removeOptionalTags<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
            
            <span class="token comment">//删除多余的属性</span>
            removeRedundantAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            
            <span class="token comment">//删除script的类型属性，在h5下面script的type默认值：text/javascript 默认值false</span>
            removeScriptTypeAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//删除style的类型属性， type=&quot;text/css&quot; 同上</span>
            removeStyleLinkTypeAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            
            <span class="token comment">//使用短的文档类型，默认false</span>
            useShortDoctype<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p><code>hash</code>:给生成的 <code>js</code> 文件一个独特的 <code>hash</code> 值，该 <code>hash</code> 值是该次 <code>webpack</code> 编译的 <code>hash</code> 值。默认值为 <code>false</code> 。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        hash<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// 编译后</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span>bundle<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token number">22</span>b9692e22e7be37b57e<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><p><code>cache</code>:默认是<code>true</code>的，表示内容变化的时候生成一个新的文件。</p></li> <li><p><code>showErrors</code>:如果 webpack 编译出现错误，webpack会将错误信息包裹在一个 pre 标签内，属性的默认值为 true ，也就是显示错误信息。开启这个，方便定位错误.</p></li> <li><p><code>chunks</code>:chunks主要用于多入口文件，当你有多个入口文件，那就会编译后生成多个打包后的文件，那么<code>chunks</code> 就能选择你要使用那些js文件。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    devor<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/devor.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    main<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">httpWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// 打包后</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span><span class="token string">&quot;main.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 而如果没有指定 chunks 选项，默认会全部引用。</span>
</code></pre></div><ul><li><code>excludeChunks</code>:排除掉一些js不进行打包</li></ul></li></ol> <h2 id="path与publicpath">path与publicPath</h2> <p>在复杂的项目里可能会有一些构建出的资源需要异步加载，加载这些异步资源需要对应的URL地址。</p> <p><code>output.publicPath</code>配置发布到线上资源的URL前缀，为<code>string</code>类型，默认值是字符串’’，即使用相对路径。</p> <p>例如：需要将构建出的资源文件上传到CDN服务上，以利于加快页面的打开速度，配置代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
publicPath<span class="token operator">:</span> <span class="token string">'https://cdn.example.com/assets/'</span>
</code></pre></div><ul><li><p><code>path</code>是<code>webpack</code>构建后输出构建结果的目录，必须是<code>绝对路径</code>.</p></li> <li><p><code>publicPath</code>并不会对生成文件的路径造成影响，主要是对你的页面里面引入的资源的路径做对应的补全，常见的就是css文件里面引入的图片url值.</p></li></ul> <h2 id="构建配置抽离成npm包">构建配置抽离成npm包</h2> <ul><li>2020.05.26</li></ul> <h3 id="意义-2">意义</h3> <ul><li><p>通用性</p> <ul><li>业务的开发者无需关注构建配置</li> <li>统一团队构建脚本</li></ul></li> <li><p>可维护性</p> <ul><li>构建配置合理的拆分</li> <li>README文档、ChangeLog文档等</li></ul></li> <li><p>质量</p> <ul><li>冒烟测试</li> <li>持续集成</li></ul></li></ul> <h3 id="可选方案">可选方案</h3> <p><strong>1. 通过配置多个文件区分不同环境的构建 <code>webpack --config</code> 进行参数的控制</strong></p> <ul><li>基础环境: webpack.base.js</li> <li>开发环境: webpack.dev.js</li> <li>生成环境: webpack.prod.js</li> <li>SSR环境: webpack.ssr.js</li> <li>PWA环境: webpack.pwa.js</li></ul> <p><strong>2. 将构建配置设计成一个库， 比如 <code>hjs-webpack</code></strong></p> <ul><li>规范: Git Commit日志、README文档、ESlint规范、Semver规范等</li> <li>质量: 冒烟测试、单元测试、测试覆盖率和CI等</li></ul> <p><strong>3. 抽离成一个工具进行管理， 比如 <code>create-react-app</code></strong></p> <p><strong>4. 将所有配置放在一个文件，通过一个 <code>--env</code> 参数控制分支选择</strong></p> <h3 id="组合">组合</h3> <blockquote><p>推荐使用<code>webpack-merge</code>组合我们的配置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="构建包功能模块设计">构建包功能模块设计</h2> <ul><li>2020.05.27</li></ul> <p><img src="https://img-blog.csdnimg.cn/2020052712400568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="构建功能模块设计"></p> <h2 id="目录结构设计">目录结构设计</h2> <p><img src="https://img-blog.csdnimg.cn/20200527203103923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="目录结构设计"></p> <h2 id="冒烟测试">冒烟测试</h2> <ul><li>2020.6.01</li></ul> <ol><li><p>判断构建是否成功</p></li> <li><p>判断基本功能是否正常</p></li></ol> <p>借助第三方工具jest等。</p> <h2 id="单元测试和测试覆盖率">单元测试和测试覆盖率</h2> <ul><li>2020.06.01</li></ul> <h3 id="单纯的测试框架-需要断言库">单纯的测试框架,需要断言库</h3> <ul><li>chai</li> <li>mocha</li> <li>ava</li> <li>should.js</li> <li>expect</li> <li>better-assert</li></ul> <h3 id="集成框架，开箱即用">集成框架，开箱即用</h3> <ul><li>jest</li> <li>jasmine</li></ul> <h3 id="编写单元测试用例">编写单元测试用例</h3> <p><img src="https://img-blog.csdnimg.cn/20200601203435647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="编写单元测试用例"></p> <h3 id="单元测试的接入">单元测试的接入</h3> <ol><li>安装相关的插件</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm i mocha chai -D
</code></pre></div><ol start="2"><li><p>新建<code>test</code>目录, 并增加 <code>xxx.test.js</code> 测试文件</p></li> <li><p>在 <code>package.json</code> 中的 <code>scripts</code> 字段增加 <code>test</code> 命令</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/mocha/bin/_mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>执行测试命令</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><h3 id="验证测试覆盖率">验证测试覆盖率</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i -g istanbul
</code></pre></div><p>修改script</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;istanbul cover node_modules/mocha/bin/_mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="构建包的持续集成和-travis-ci">构建包的持续集成和 Travis CI</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-06-05 07:00:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/project/babel.html" class="prev">
        Babel
      </a></span> <span class="next"><a href="/docs/project/autobuild.html">
        前端轻量自动化构建方案
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.8c7fcf95.js" defer></script><script src="/docs/assets/js/2.346c741e.js" defer></script><script src="/docs/assets/js/128.46207642.js" defer></script>
  </body>
</html>
