<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitLab CI Pipeline框架 | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.c9eac72b.css" as="style"><link rel="preload" href="/docs/assets/js/app.a9659497.js" as="script"><link rel="preload" href="/docs/assets/js/2.346c741e.js" as="script"><link rel="preload" href="/docs/assets/js/125.91210b17.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.448efd45.js"><link rel="prefetch" href="/docs/assets/js/100.5d874431.js"><link rel="prefetch" href="/docs/assets/js/101.e8f6686c.js"><link rel="prefetch" href="/docs/assets/js/102.ac7c2714.js"><link rel="prefetch" href="/docs/assets/js/103.a3e434f6.js"><link rel="prefetch" href="/docs/assets/js/104.bcd074ff.js"><link rel="prefetch" href="/docs/assets/js/105.aa1ce6d8.js"><link rel="prefetch" href="/docs/assets/js/106.2ed5a0cc.js"><link rel="prefetch" href="/docs/assets/js/107.1006fb70.js"><link rel="prefetch" href="/docs/assets/js/108.e0479076.js"><link rel="prefetch" href="/docs/assets/js/109.6e6b76b1.js"><link rel="prefetch" href="/docs/assets/js/11.6b84f53c.js"><link rel="prefetch" href="/docs/assets/js/110.72843676.js"><link rel="prefetch" href="/docs/assets/js/111.665d3836.js"><link rel="prefetch" href="/docs/assets/js/112.0812096e.js"><link rel="prefetch" href="/docs/assets/js/113.99a17862.js"><link rel="prefetch" href="/docs/assets/js/114.4bfefbd2.js"><link rel="prefetch" href="/docs/assets/js/115.25d0786f.js"><link rel="prefetch" href="/docs/assets/js/116.286de7c9.js"><link rel="prefetch" href="/docs/assets/js/117.ff3a8ea0.js"><link rel="prefetch" href="/docs/assets/js/118.9870db77.js"><link rel="prefetch" href="/docs/assets/js/119.1da41f99.js"><link rel="prefetch" href="/docs/assets/js/12.8bcafd6e.js"><link rel="prefetch" href="/docs/assets/js/120.05183de4.js"><link rel="prefetch" href="/docs/assets/js/121.9210abc8.js"><link rel="prefetch" href="/docs/assets/js/122.742ced66.js"><link rel="prefetch" href="/docs/assets/js/123.37d485ac.js"><link rel="prefetch" href="/docs/assets/js/124.b51860b3.js"><link rel="prefetch" href="/docs/assets/js/126.190b1f76.js"><link rel="prefetch" href="/docs/assets/js/127.debd93cd.js"><link rel="prefetch" href="/docs/assets/js/128.174cd224.js"><link rel="prefetch" href="/docs/assets/js/129.557d117e.js"><link rel="prefetch" href="/docs/assets/js/13.4455f4e8.js"><link rel="prefetch" href="/docs/assets/js/130.0441ccc8.js"><link rel="prefetch" href="/docs/assets/js/131.a988d409.js"><link rel="prefetch" href="/docs/assets/js/132.5f89abc2.js"><link rel="prefetch" href="/docs/assets/js/133.335655f5.js"><link rel="prefetch" href="/docs/assets/js/134.bc112f59.js"><link rel="prefetch" href="/docs/assets/js/135.24e4f170.js"><link rel="prefetch" href="/docs/assets/js/136.404aec32.js"><link rel="prefetch" href="/docs/assets/js/137.88350949.js"><link rel="prefetch" href="/docs/assets/js/138.9aa6c017.js"><link rel="prefetch" href="/docs/assets/js/139.457cdff2.js"><link rel="prefetch" href="/docs/assets/js/14.3b0be226.js"><link rel="prefetch" href="/docs/assets/js/140.8048d4fe.js"><link rel="prefetch" href="/docs/assets/js/141.d438db48.js"><link rel="prefetch" href="/docs/assets/js/142.d04afe64.js"><link rel="prefetch" href="/docs/assets/js/143.3e4aef7f.js"><link rel="prefetch" href="/docs/assets/js/144.1aa9cfab.js"><link rel="prefetch" href="/docs/assets/js/145.18cfb8cf.js"><link rel="prefetch" href="/docs/assets/js/146.496bdcfa.js"><link rel="prefetch" href="/docs/assets/js/147.04557f75.js"><link rel="prefetch" href="/docs/assets/js/148.d568eaf9.js"><link rel="prefetch" href="/docs/assets/js/149.6489978c.js"><link rel="prefetch" href="/docs/assets/js/15.4b5d7343.js"><link rel="prefetch" href="/docs/assets/js/150.e89ebbbb.js"><link rel="prefetch" href="/docs/assets/js/151.c54984c8.js"><link rel="prefetch" href="/docs/assets/js/152.b5cd8e76.js"><link rel="prefetch" href="/docs/assets/js/153.99ad6a4d.js"><link rel="prefetch" href="/docs/assets/js/154.411008f0.js"><link rel="prefetch" href="/docs/assets/js/155.19de9787.js"><link rel="prefetch" href="/docs/assets/js/156.26871448.js"><link rel="prefetch" href="/docs/assets/js/157.e9173643.js"><link rel="prefetch" href="/docs/assets/js/158.0f19324e.js"><link rel="prefetch" href="/docs/assets/js/159.ac43de81.js"><link rel="prefetch" href="/docs/assets/js/16.9d0963b3.js"><link rel="prefetch" href="/docs/assets/js/160.43817e58.js"><link rel="prefetch" href="/docs/assets/js/161.9ace0c45.js"><link rel="prefetch" href="/docs/assets/js/162.ced98cd7.js"><link rel="prefetch" href="/docs/assets/js/163.c1f7afd4.js"><link rel="prefetch" href="/docs/assets/js/164.29f248cd.js"><link rel="prefetch" href="/docs/assets/js/165.f2a9906b.js"><link rel="prefetch" href="/docs/assets/js/166.ac1a2811.js"><link rel="prefetch" href="/docs/assets/js/167.1a489c8e.js"><link rel="prefetch" href="/docs/assets/js/168.41e3a733.js"><link rel="prefetch" href="/docs/assets/js/169.1626e37e.js"><link rel="prefetch" href="/docs/assets/js/17.95b7e490.js"><link rel="prefetch" href="/docs/assets/js/170.e4bb47a3.js"><link rel="prefetch" href="/docs/assets/js/171.069c538f.js"><link rel="prefetch" href="/docs/assets/js/172.04f9f150.js"><link rel="prefetch" href="/docs/assets/js/173.0d08c0f6.js"><link rel="prefetch" href="/docs/assets/js/174.41a6e119.js"><link rel="prefetch" href="/docs/assets/js/175.d0348a39.js"><link rel="prefetch" href="/docs/assets/js/176.ed15b50b.js"><link rel="prefetch" href="/docs/assets/js/177.976f966e.js"><link rel="prefetch" href="/docs/assets/js/178.42939f88.js"><link rel="prefetch" href="/docs/assets/js/179.1821c5a0.js"><link rel="prefetch" href="/docs/assets/js/18.ca0afb77.js"><link rel="prefetch" href="/docs/assets/js/180.8f6c57ba.js"><link rel="prefetch" href="/docs/assets/js/181.37505ee8.js"><link rel="prefetch" href="/docs/assets/js/182.f6e15fd6.js"><link rel="prefetch" href="/docs/assets/js/183.f5c105a9.js"><link rel="prefetch" href="/docs/assets/js/19.981481df.js"><link rel="prefetch" href="/docs/assets/js/20.6e80cd2d.js"><link rel="prefetch" href="/docs/assets/js/21.c0ec8375.js"><link rel="prefetch" href="/docs/assets/js/22.648850d3.js"><link rel="prefetch" href="/docs/assets/js/23.73ed5316.js"><link rel="prefetch" href="/docs/assets/js/24.768a95fb.js"><link rel="prefetch" href="/docs/assets/js/25.b460e9a9.js"><link rel="prefetch" href="/docs/assets/js/26.61c56597.js"><link rel="prefetch" href="/docs/assets/js/27.2bbfe116.js"><link rel="prefetch" href="/docs/assets/js/28.efc0814f.js"><link rel="prefetch" href="/docs/assets/js/29.8bebb742.js"><link rel="prefetch" href="/docs/assets/js/3.f0b9dcd8.js"><link rel="prefetch" href="/docs/assets/js/30.e6180f81.js"><link rel="prefetch" href="/docs/assets/js/31.791f6adb.js"><link rel="prefetch" href="/docs/assets/js/32.59f79bfb.js"><link rel="prefetch" href="/docs/assets/js/33.24072082.js"><link rel="prefetch" href="/docs/assets/js/34.9cc3face.js"><link rel="prefetch" href="/docs/assets/js/35.f5942d3c.js"><link rel="prefetch" href="/docs/assets/js/36.59fe9f6c.js"><link rel="prefetch" href="/docs/assets/js/37.12a8e708.js"><link rel="prefetch" href="/docs/assets/js/38.0c48b0a9.js"><link rel="prefetch" href="/docs/assets/js/39.9d41280d.js"><link rel="prefetch" href="/docs/assets/js/4.0f806da2.js"><link rel="prefetch" href="/docs/assets/js/40.2ee80385.js"><link rel="prefetch" href="/docs/assets/js/41.fefef9e9.js"><link rel="prefetch" href="/docs/assets/js/42.f6d801aa.js"><link rel="prefetch" href="/docs/assets/js/43.51c3e56f.js"><link rel="prefetch" href="/docs/assets/js/44.a096b57c.js"><link rel="prefetch" href="/docs/assets/js/45.2d938602.js"><link rel="prefetch" href="/docs/assets/js/46.5462b19e.js"><link rel="prefetch" href="/docs/assets/js/47.3693a81a.js"><link rel="prefetch" href="/docs/assets/js/48.bb4e694c.js"><link rel="prefetch" href="/docs/assets/js/49.c49213e9.js"><link rel="prefetch" href="/docs/assets/js/5.7088cd54.js"><link rel="prefetch" href="/docs/assets/js/50.e005e49f.js"><link rel="prefetch" href="/docs/assets/js/51.86b3541a.js"><link rel="prefetch" href="/docs/assets/js/52.7fd33353.js"><link rel="prefetch" href="/docs/assets/js/53.03e8160e.js"><link rel="prefetch" href="/docs/assets/js/54.3f89c021.js"><link rel="prefetch" href="/docs/assets/js/55.ee276a6b.js"><link rel="prefetch" href="/docs/assets/js/56.c18fddc1.js"><link rel="prefetch" href="/docs/assets/js/57.80455c3d.js"><link rel="prefetch" href="/docs/assets/js/58.8ffe2d5a.js"><link rel="prefetch" href="/docs/assets/js/59.5adb1a11.js"><link rel="prefetch" href="/docs/assets/js/6.aa27b4b3.js"><link rel="prefetch" href="/docs/assets/js/60.1152a6b2.js"><link rel="prefetch" href="/docs/assets/js/61.abef8004.js"><link rel="prefetch" href="/docs/assets/js/62.0d882604.js"><link rel="prefetch" href="/docs/assets/js/63.57f410fd.js"><link rel="prefetch" href="/docs/assets/js/64.f121b763.js"><link rel="prefetch" href="/docs/assets/js/65.76ef0090.js"><link rel="prefetch" href="/docs/assets/js/66.a39ac5ac.js"><link rel="prefetch" href="/docs/assets/js/67.499d3620.js"><link rel="prefetch" href="/docs/assets/js/68.7c04c7a8.js"><link rel="prefetch" href="/docs/assets/js/69.e58396ea.js"><link rel="prefetch" href="/docs/assets/js/7.6653ed24.js"><link rel="prefetch" href="/docs/assets/js/70.2ce6d316.js"><link rel="prefetch" href="/docs/assets/js/71.80443b6f.js"><link rel="prefetch" href="/docs/assets/js/72.f224489d.js"><link rel="prefetch" href="/docs/assets/js/73.0f73eb62.js"><link rel="prefetch" href="/docs/assets/js/74.a6215b26.js"><link rel="prefetch" href="/docs/assets/js/75.1dd84ab6.js"><link rel="prefetch" href="/docs/assets/js/76.f706d67e.js"><link rel="prefetch" href="/docs/assets/js/77.583d7e47.js"><link rel="prefetch" href="/docs/assets/js/78.add671e4.js"><link rel="prefetch" href="/docs/assets/js/79.6fc1e8ae.js"><link rel="prefetch" href="/docs/assets/js/8.a8d55efb.js"><link rel="prefetch" href="/docs/assets/js/80.ac37b44e.js"><link rel="prefetch" href="/docs/assets/js/81.22269b9e.js"><link rel="prefetch" href="/docs/assets/js/82.5e87105a.js"><link rel="prefetch" href="/docs/assets/js/83.f55d61be.js"><link rel="prefetch" href="/docs/assets/js/84.3b7083e8.js"><link rel="prefetch" href="/docs/assets/js/85.ec6a50bc.js"><link rel="prefetch" href="/docs/assets/js/86.fc7122ad.js"><link rel="prefetch" href="/docs/assets/js/87.69e065a3.js"><link rel="prefetch" href="/docs/assets/js/88.36babaab.js"><link rel="prefetch" href="/docs/assets/js/89.3e80f38e.js"><link rel="prefetch" href="/docs/assets/js/9.7d808dd7.js"><link rel="prefetch" href="/docs/assets/js/90.1d0cf103.js"><link rel="prefetch" href="/docs/assets/js/91.13a8981c.js"><link rel="prefetch" href="/docs/assets/js/92.e2a40968.js"><link rel="prefetch" href="/docs/assets/js/93.f882c881.js"><link rel="prefetch" href="/docs/assets/js/94.c81c3b2f.js"><link rel="prefetch" href="/docs/assets/js/95.8f19edd2.js"><link rel="prefetch" href="/docs/assets/js/96.7fe83a34.js"><link rel="prefetch" href="/docs/assets/js/97.d6cc8f8f.js"><link rel="prefetch" href="/docs/assets/js/98.ca6b340a.js"><link rel="prefetch" href="/docs/assets/js/99.e00a8340.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.c9eac72b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/project/mock.html" class="sidebar-link">前端数据mock</a></li><li><a href="/docs/project/module.html" class="sidebar-link">一文搞懂AMD,CMD,CommonJs,UMD,ES Modules</a></li><li><a href="/docs/project/babel.html" class="sidebar-link">Babel</a></li><li><a href="/docs/project/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/docs/project/autobuild.html" class="sidebar-link">前端轻量自动化构建方案</a></li><li><a href="/docs/project/err.html" class="sidebar-link">前端错误监控体系搭建</a></li><li><a href="/docs/project/standards.html" class="sidebar-link">前端代码规范</a></li><li><a href="/docs/project/docker.html" class="sidebar-link">从0开始学习docker</a></li><li><a href="/docs/project/autoTryCatch.html" class="sidebar-link">基于 Babel 和 AST自动添加 try catch 方法</a></li><li><a href="/docs/project/gitlabCI.html" class="active sidebar-link">GitLab CI Pipeline框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#ci-cd-工作流程" class="sidebar-link">CI/CD 工作流程</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#gitlab-ci" class="sidebar-link">Gitlab CI</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#gitlab-runner" class="sidebar-link">Gitlab Runner</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#gitlab-ci-yml-配置文件" class="sidebar-link">gitlab-ci.yml(配置文件)</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#pipeline-管道" class="sidebar-link">Pipeline(管道)</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#stages" class="sidebar-link">Stages</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#jobs" class="sidebar-link">Jobs</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#script" class="sidebar-link">Script</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#image-and-services" class="sidebar-link">image and services</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#before-script和after-script" class="sidebar-link">beforescript和afterscript</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#配置示例" class="sidebar-link">配置示例</a></li></ul></li></ul></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><a href="/docs/git/" class="sidebar-link">git相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器插件扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="gitlab-ci-pipeline框架">GitLab CI Pipeline框架</h1> <ul><li>2020.05.20</li></ul> <p>本文将会介绍一些跟<code>GitLab CI</code>流程相关的知识,方便大家对CI/CD流程的熟悉,设计适合自己项目的流程。</p> <h2 id="ci-cd-工作流程">CI/CD 工作流程</h2> <p><img src="https://img-blog.csdnimg.cn/20200520181143980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="CI/CD 工作流程"></p> <h2 id="gitlab-ci">Gitlab CI</h2> <blockquote><p><code>GitLab CI</code> 是 <code>GitLab</code>内置的进行持续集成的工具，在你安装好 <code>GitLab</code> 之后，即同时安装了 <code>GitLab CI</code>。只需要在仓库根目录下创建 <code>.gitlab-ci.yml</code> 文件，并配置<code>GitLab Runner</code>；每次提交的时候，<code>gitlab</code>将自动识别到<code>.gitlab-ci.yml</code>文件，并且使用<code>Gitlab Runner</code>执行该脚本。</p></blockquote> <h2 id="gitlab-runner">Gitlab Runner</h2> <blockquote><p><code>GitLab Runner</code> 是用来执行<code>.gitlab-ci.yml</code> 脚本的工具，从 <code>GitLab CI</code> 中获取到任务，并按其要求完成任务的执行。可以理解成，<code>Runner</code>就像认真工作的工人，<code>GitLab-CI</code>就是管理工人的中心，所有工人都要在 <code>GitLab-CI</code> 里面注册，并且表明自己是为哪个项目服务。当相应的项目发生变化时，<code>GitLab-CI</code> 就会通知相应的工人执行对应的脚本。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>Runner</code>负责执行<code>.gitlab-ci.yml</code>文件中定义的<code>job</code>，可以是<code>虚拟机</code>、<code>vps</code>、<code>裸机</code>、<code>docker容器</code>或<code>容器集群</code>。</p> <p><code>GitLab Runner</code> 是由Go语言编写的,可以运行在 <code>GNU/Linux</code>, <code>macOS</code> 和 <code>Windows</code>上。</p> <p>如果我们项目中需要使用到<code>Docker</code>的话,最低版本的 <code>Docker</code> 需要 <code>v1.13.0</code>。</p> <p>我们可以在项目的<code>Settings--&gt;CI/CD--&gt;Runners</code>页面可以查看到是否有可用的<code>Runner</code>。</p></div> <h3 id="runner类型">Runner类型</h3> <p><code>GitLab-Runner</code> 可以分类两种类型：<code>Shared Runner（共享型）</code>和 <code>Specific Runner（指定型）</code>。</p> <ol><li><p><code>Shared Runner</code>：所有工程都能够用的，且只有<code>系统管理员</code>能够创建。</p></li> <li><p><code>Specific Runner</code>：只有特定的项目可以使用。</p></li></ol> <h3 id="runner安装">Runner安装</h3> <p>以<code>macOs</code>为例子,完整的安装地址参考:<a href="https://docs.gitlab.com/runner/install/" target="_blank" rel="noopener noreferrer">官方下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>方式1</li></ul> <div class="language- extra-class"><pre class="language-text"><code>sudo curl --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-darwin-amd64

sudo chmod +x /usr/local/bin/gitlab-runner

cd ~
gitlab-runner install
gitlab-runner start
</code></pre></div><ul><li>方式2</li></ul> <div class="language- extra-class"><pre class="language-text"><code>brew install gitlab-runner

brew services start gitlab-runner
</code></pre></div><h3 id="获取runner注册token">获取Runner注册Token</h3> <p>安装好<code>Runner</code>之后，需要向<code>Gitlab</code>进行注册，注册<code>Runner</code>需要 <code>GitLab-CI</code> 的 <code>url</code> 和 <code>token</code>。可根据需求注册选择所需类型<code>Runner</code>。</p> <ul><li>获取<code>Shared Runner注册Token</code>：</li></ul> <p>使用管理员用户登录，进入<code>Admin Area-&gt;OverView-&gt;Runners</code>界面。</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZWVkMTM5OGRjZjg" alt="图片地址"></p> <ul><li>获取<code>Specific Runner注册Token</code>：</li></ul> <p>进行项目仓库-&gt;settings-&gt;CI/CD界面</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZWVmZmFkYTc4NWI" alt="图片地址"></p> <h3 id="注册runner">注册Runner</h3> <p>完整的注册文档请参见<a href="https://docs.gitlab.com/runner/register/" target="_blank" rel="noopener noreferrer">官方注册文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>执行 <code>gitlab-ci-multi-runner register</code>命令进行 <code>Runner注册</code>，期间会用到前期获取的url及token；注册完成之后，<code>GitLab-CI</code>就会多出一条<code>Runner记录</code>。</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZWYzZDVmZmI5MTA" alt="图片地址"></p> <h2 id="gitlab-ci-yml-配置文件">gitlab-ci.yml(配置文件)</h2> <blockquote><p>从<code>7.12</code>版本开始，<code>GitLab CI</code>使用<code>YAML</code>文件(<code>.gitlab-ci.yml</code>)来管理项目配置。该文件存放于项目<code>仓库的根目录</code>，并且包含了你的项目如何被编译的描述语句。<code>YAML</code>文件使用一系列约束叙述定义了Job启动时所要做的事情。</p></blockquote> <p>通过配置<code>gitlab-ci.yml</code>文件我们可以定义<code>Pipeline</code>的结构和执行顺序。</p> <h3 id="关键字及含义">关键字及含义</h3> <table><thead><tr><th style="text-align:left;">关键字</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>before_script</code></td> <td style="text-align:left;">定义任何 Jobs 运行前都会执行的命令。</td></tr> <tr><td style="text-align:left;"><code>after_script</code></td> <td style="text-align:left;">定义任何 Jobs 运行完后都会执行的命令。（要求 GitLab 8.7+ 和 GitLab Runner 1.2+）</td></tr> <tr><td style="text-align:left;"><code>variables &amp;&amp; Job.variables</code></td> <td style="text-align:left;">定义环境变量。如果定义了 Job 级别的环境变量的话，该 Job 会优先使用 Job 级别的环境变量。（要求 GitLab Runner 0.5.0+）</td></tr> <tr><td style="text-align:left;"><code>cache &amp;&amp; Job.cache</code></td> <td style="text-align:left;">定义需要缓存的文件。每个 Job 开始的时候，Runner 都会删掉 .gitignore 里面的文件。如果有些文件 (如 node_modules/) 需要多个 Jobs 共用的话，我们只能让每个 Job 都先执行一遍 npm install。（要求 GitLab Runner 0.7.0+）</td></tr> <tr><td style="text-align:left;"><code>Job.scrip</code></td> <td style="text-align:left;">定义 Job 要运行的命令，必填项</td></tr> <tr><td style="text-align:left;"><code>Job.stage</code></td> <td style="text-align:left;">定义 Job 的 stage，默认为 test</td></tr> <tr><td style="text-align:left;"><code>Job.artifacts</code></td> <td style="text-align:left;">定义 Job 中生成的附件。当该 Job 运行成功后，生成的文件可以作为附件 (如生成的二进制文件) 保留下来，打包发送到 GitLab，之后我们可以在 GitLab 的项目页面下下载该附件。</td></tr></tbody></table> <h3 id="工作流程">工作流程</h3> <p><img src="https://www.chenshaowen.com/blog/images/2017/11/cicd_pipeline_infograph.png" alt="工作流程"></p> <h2 id="pipeline-管道">Pipeline(管道)</h2> <p>完整的 <code>pipeline</code> 配置可以参考<a href="https://docs.gitlab.com/ee/user/project/pipelines/schedules.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p><code>PipeLine</code> 即流水线是持续集成、发布、部署的最顶层的组件。由 <code>Stage</code> 和 <code>Job</code> 组成，由<code>.gitlab-ci.yml</code>来定义。按触发模式可分为：<code>自动触发</code>和<code>人工触发</code>。</p></blockquote> <p>一次 <code>Pipeline</code> 其实相当于一次构建任务，里面可以包含多个流程，比如<code>自动构建</code>、<code>自动进行单元测试</code>、<code>自动进行代码检查</code>等流程 ;</p> <p>任何提交或者 <code>Merge Request</code> 的合并都可以触发 <code>Pipeline</code> ;</p> <h3 id="自动触发">自动触发</h3> <ul><li>定时触发</li></ul> <p>比如我们可以通过配置<a href="https://docs.gitlab.com/ee/api/pipeline_schedules.html" target="_blank" rel="noopener noreferrer">Pipeline schedules API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在每天的0:00进行一次操作。</p> <p>创建一个新的项目管道计划。</p> <div class="language- extra-class"><pre class="language-text"><code>POST /projects/:id/pipeline_schedules
</code></pre></div><table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">需要</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>id</code></td> <td style="text-align:left;">int / string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">经过身份验证的用户拥有的项目的ID或URL编码路径</td></tr> <tr><td style="text-align:left;"><code>description</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">管道进度表的描述</td></tr> <tr><td style="text-align:left;"><code>ref</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">分支/标签名称将被触发</td></tr> <tr><td style="text-align:left;"><code>cron</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">cron（例如0 1 * * *）（Cron语法）</td></tr> <tr><td style="text-align:left;"><code>cron_timezone</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">否</td> <td style="text-align:left;">所支持的时区ActiveSupport::TimeZone（如Pacific Time (US &amp; Canada)）（默认值：'UTC'）</td></tr> <tr><td style="text-align:left;"><code>active</code></td> <td style="text-align:left;">boolean</td> <td style="text-align:left;">否</td> <td style="text-align:left;">管道计划的激活。如果假设置，管道计划将首先停用（默认值：true）</td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code>curl --request POST --header &quot;PRIVATE-TOKEN: k5ESFgWY2Qf5xEvDcFxZ&quot; --form description=&quot;Build packages&quot; --form ref=&quot;master&quot; --form cron=&quot;0 0 * * *&quot; --form cron_timezone=&quot;UTC&quot; --form active=&quot;true&quot; &quot;https://gitlab.example.com/api/v4/projects/29/pipeline_schedules&quot;
</code></pre></div><p>执行结果:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Build packages&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;master&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cron&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0 0 * * *&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cron_timezone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UTC&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next_run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-05-21T00:00:00.000Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;active&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;created_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-05-20T13:43:08.169Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;updated_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-05-20T13:43:08.169Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;last_pipeline&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;owner&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Administrator&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;active&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;avatar_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&amp;d=identicon&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;web_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://gitlab.example.com/root&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Merge请求</code>触发</li></ul> <blockquote><p>此功能在<code>GitLab 11.6</code>版本中引入。</p></blockquote> <p>在基础配置中,每次提交一个更改到分支的时候,GitLab都会运行一个管道。要在merge的时候触发需要配置CI/CD配置文件。</p> <p>例如使用<code>only</code>或<code>except</code>运行管道以进行合并请求:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> ./build
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> master

<span class="token key atrule">test</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">script</span><span class="token punctuation">:</span> ./test
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> merge_requests

<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token key atrule">script</span><span class="token punctuation">:</span> ./deploy
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> master
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>使用此方法时，必须<code>only: - merge_requests</code>为每个作业指定。</p> <p>在此示例中，管道包含<code>test</code>配置为在合并请求上运行的作业,在<code>build</code>与<code>deploy</code>工作没有<code>only: - merge_requests</code>参数，所以他们不会合并请求运行。</p></div> <h3 id="人工触发">人工触发</h3> <p>手动去触发打包</p> <h2 id="stages">Stages</h2> <blockquote><p><code>stages</code> 表示构建阶段,一个 <code>Pipeline</code> 中可以定义多个 <code>stage</code>,包括了 <code>build</code>、<code>test</code> 和 <code>deploy</code>等阶段。</p></blockquote> <p><strong>stages有如下特点 :</strong></p> <ul><li><p>所有 <code>stages</code> 会按照顺序运行，即当一个 <code>stage</code> 完成后，下一个 <code>stage</code> 才会开始</p></li> <li><p>只有当所有 <code>stages</code> 成功完成后，该构建任务 (<code>Pipeline</code>) 才算成功</p></li> <li><p>如果任何一个 <code>stage</code> 失败，那么后面的 <code>stages</code> 不会执行，该构建任务 (<code>Pipeline</code>) 失败</p></li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build
  <span class="token punctuation">-</span> test
  <span class="token punctuation">-</span> deploy

job 1<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make build dependencies

job 2<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make build artifacts

job 3<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make test

job 4<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make deploy
</code></pre></div><h3 id="stages执行顺序">Stages执行顺序</h3> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZjAzOTY1MzVkM2M" alt="Stages执行顺序"></p> <p>以图中所示为例，整个 CI 环节包含三个 Stage：<code>build、test 和deploy</code>。</p> <ul><li><p><code>build</code> 被首先执行。如果发生错误，本次 CI 立刻失败；</p></li> <li><p><code>test</code> 在 build 成功执行完毕后执行。如果发生错误，本次 CI 立刻失败；</p></li> <li><p><code>deploy</code> 在 test 成功执行完毕后执行。如果发生错误，本次 CI 失败。</p></li></ul> <h2 id="jobs">Jobs</h2> <blockquote><p><code>Job</code>是 <code>.gitlab-ci.yml</code> 文件中最基本的元素，表示某个<code>stage</code>里面执行的工作。一个<code>stage</code>中用户可以创建任意个任务；每个任务必须有一个独一无二的名字，但有一些保留 <code>keywords</code> 不能用于<code>Job</code>名称。</p></blockquote> <p><strong>保留关键字</strong>:</p> <ul><li><code>image</code>，</li> <li><code>services</code>，</li> <li><code>stages</code>，</li> <li><code>types</code>，</li> <li><code>before_script</code>，</li> <li><code>after_script</code>，</li> <li><code>variables</code>，</li> <li><code>cache</code>，</li> <li><code>include</code>。</li></ul> <p><code>Job</code>被定义为<code>顶级元素</code>，并且至少包括一条<code>script</code>语句，如果一个 <code>Job</code> 没有显式地关联某个 <code>Stage</code>，则会被默认关联到 <code>test Stage</code>。</p> <p><strong>jobs有如下特点 :</strong></p> <ul><li><p>相同 <code>stage</code> 中的<code>jobs</code> 会并行执行</p></li> <li><p>相同 <code>stage</code> 中的 <code>jobs</code> 都执行成功时，该 <code>stage</code> 才会成功</p></li> <li><p>如果任何一个<code>job</code> 失败，那么该 <code>stage</code> 失败，即该构建任务 (<code>Pipeline</code>) 失败</p></li></ul> <h3 id="job执行流程">Job执行流程</h3> <p><img src="https://img-blog.csdnimg.cn/20200520181121774.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20200520181035314.png" alt="Job执行流程"></p> <h2 id="script">Script</h2> <blockquote><p><code>script</code>是一段由<code>Runner</code>执行的<code>shell</code>脚本。</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">job</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> uname <span class="token punctuation">-</span>a
    <span class="token punctuation">-</span> bundle exec rspec
</code></pre></div><h2 id="image-and-services">image and services</h2> <blockquote><p>这两个选项允许开发者指定任务运行时所需的自定义的docker镜像和服务。</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">#为每个作业定义不同的映像和服务</span>
<span class="token key atrule">test:2.1</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> ruby<span class="token punctuation">:</span><span class="token number">2.1</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> postgres<span class="token punctuation">:</span><span class="token number">9.3</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> bundle exec rake spec

<span class="token key atrule">test:2.2</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> ruby<span class="token punctuation">:</span><span class="token number">2.2</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> postgres<span class="token punctuation">:</span><span class="token number">9.4</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> bundle exec rake spec
</code></pre></div><h2 id="before-script和after-script">before_script和after_script</h2> <blockquote><p><code>before_script</code>是用于定义一些在所有任务执行前所需执行的命令, 包括部署工作，可以接受一个数组或者多行字符串。<code>after_script</code>用于定义所有job执行过后需要执行的命令，可以接受一个数组或者多行字符串。</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">#定义全局 before_script:</span>
<span class="token key atrule">default</span><span class="token punctuation">:</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> global before script
<span class="token comment">#覆盖全局before_script</span>
<span class="token key atrule">job</span><span class="token punctuation">:</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> execute this instead of global before script
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> my command
  <span class="token key atrule">after_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> execute this after my script

</code></pre></div><h2 id="配置示例">配置示例</h2> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">before_script</span><span class="token punctuation">:</span>
  <span class="token comment"># 激活 nodeenv 虚拟环境</span>
  <span class="token punctuation">-</span> source /data/gitlab<span class="token punctuation">-</span>runner/paas<span class="token punctuation">-</span>webfe/bin/activate
  <span class="token comment"># 查看 node 版本</span>
  <span class="token punctuation">-</span> which node <span class="token important">&amp;&amp;</span> node <span class="token punctuation">-</span><span class="token punctuation">-</span>version
  <span class="token comment"># 为了能方便使用 npm ，给它取一个别名</span>
  <span class="token punctuation">-</span> alias npm=&quot;/data/gitlab<span class="token punctuation">-</span>runner/node/bin/npm&quot;
  <span class="token punctuation">-</span> which npm <span class="token important">&amp;&amp;</span> npm <span class="token punctuation">-</span><span class="token punctuation">-</span>version

<span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build

<span class="token key atrule">build-test-webpack</span><span class="token punctuation">:</span>
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
    <span class="token comment"># 需要修改为项目的 GitLab 地址格式 </span>
    <span class="token key atrule">CI_REPOSITORY_URL</span><span class="token punctuation">:</span>
      http<span class="token punctuation">:</span>//$GIT_USERNAME<span class="token punctuation">:</span>$GIT_PASSWORD@gitlab.xxx.com/$CI_PROJECT_PATH.git
    <span class="token comment"># 打包生成的文件存放目录</span>
    <span class="token key atrule">OUT_PUT_DIR</span><span class="token punctuation">:</span>
      test
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token comment"># 允许在 GitLab 页面上，直接下载 $OUT_PUT_DIR 内容</span>
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $OUT_PUT_DIR
  <span class="token comment"># 没有 Git 版本的文件，设置缓存，可以避免每次 npm install 重复安装</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">untracked</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token comment"># 开始执行打包编译命令，并提交到当前的 Git 仓库，具体的命令，需要根据项目编写，也可以放在一个 shell 文件，执行</span>
    <span class="token punctuation">-</span> echo &quot;start build test&quot;
    <span class="token punctuation">-</span> rm <span class="token punctuation">-</span>rf  $CI_PROJECT_NAME $OUT_PUT_DIR
    <span class="token punctuation">-</span> cd ./webpack <span class="token important">&amp;&amp;</span> tnpm install <span class="token important">&amp;&amp;</span> tnpm run build<span class="token punctuation">-</span>test <span class="token important">&amp;&amp;</span> cd ..
    <span class="token punctuation">-</span> git clone $CI_REPOSITORY_URL
    <span class="token punctuation">-</span> rm <span class="token punctuation">-</span>rf $CI_PROJECT_NAME/$OUT_PUT_DIR <span class="token important">&amp;&amp;</span> cp <span class="token punctuation">-</span>r $OUT_PUT_DIR $CI_PROJECT_NAME/
    <span class="token punctuation">-</span> cd $CI_PROJECT_NAME
    <span class="token punctuation">-</span> git add $OUT_PUT_DIR
    <span class="token punctuation">-</span> git status <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> build.log
    <span class="token punctuation">-</span> date <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> build.log
    <span class="token punctuation">-</span> git add build.log
    <span class="token punctuation">-</span> git commit <span class="token punctuation">-</span>m &quot;auto build<span class="token punctuation">-</span>test<span class="token punctuation">[</span>ci skip<span class="token punctuation">]</span>&quot;
    <span class="token punctuation">-</span> git push $CI_REPOSITORY_URL master
    <span class="token punctuation">-</span> echo &quot;end build test&quot;
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-06-30 09:49:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/project/autoTryCatch.html" class="prev">
        基于 Babel 和 AST自动添加 try catch 方法
      </a></span> <span class="next"><a href="/docs/safe/">
        Web安全问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.a9659497.js" defer></script><script src="/docs/assets/js/2.346c741e.js" defer></script><script src="/docs/assets/js/125.91210b17.js" defer></script>
  </body>
</html>
