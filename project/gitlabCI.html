<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitLab CI Pipeline框架 | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.b36278c7.css" as="style"><link rel="preload" href="/docs/assets/js/app.82d7bf1e.js" as="script"><link rel="preload" href="/docs/assets/js/2.3d9c2800.js" as="script"><link rel="preload" href="/docs/assets/js/134.57aeca7d.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.1b6443d6.js"><link rel="prefetch" href="/docs/assets/js/100.9a3d380f.js"><link rel="prefetch" href="/docs/assets/js/101.55721936.js"><link rel="prefetch" href="/docs/assets/js/102.71adf8eb.js"><link rel="prefetch" href="/docs/assets/js/103.38ccae79.js"><link rel="prefetch" href="/docs/assets/js/104.2fd1ceb1.js"><link rel="prefetch" href="/docs/assets/js/105.ffac2203.js"><link rel="prefetch" href="/docs/assets/js/106.8fbdede4.js"><link rel="prefetch" href="/docs/assets/js/107.a7e2c623.js"><link rel="prefetch" href="/docs/assets/js/108.ad96b83c.js"><link rel="prefetch" href="/docs/assets/js/109.9bafc2e1.js"><link rel="prefetch" href="/docs/assets/js/11.5cc2d18d.js"><link rel="prefetch" href="/docs/assets/js/110.26652f51.js"><link rel="prefetch" href="/docs/assets/js/111.a5f0c4dc.js"><link rel="prefetch" href="/docs/assets/js/112.e176a2ce.js"><link rel="prefetch" href="/docs/assets/js/113.0a0d4eff.js"><link rel="prefetch" href="/docs/assets/js/114.fe91f476.js"><link rel="prefetch" href="/docs/assets/js/115.31f48ffd.js"><link rel="prefetch" href="/docs/assets/js/116.ea4a9c71.js"><link rel="prefetch" href="/docs/assets/js/117.8aefd1ff.js"><link rel="prefetch" href="/docs/assets/js/118.531e937a.js"><link rel="prefetch" href="/docs/assets/js/119.955c0607.js"><link rel="prefetch" href="/docs/assets/js/12.33937275.js"><link rel="prefetch" href="/docs/assets/js/120.4c4034ff.js"><link rel="prefetch" href="/docs/assets/js/121.259fd5c5.js"><link rel="prefetch" href="/docs/assets/js/122.e03352f1.js"><link rel="prefetch" href="/docs/assets/js/123.04b3a836.js"><link rel="prefetch" href="/docs/assets/js/124.8fd424f0.js"><link rel="prefetch" href="/docs/assets/js/125.cdf3fbcd.js"><link rel="prefetch" href="/docs/assets/js/126.3bf7069d.js"><link rel="prefetch" href="/docs/assets/js/127.8e69bc32.js"><link rel="prefetch" href="/docs/assets/js/128.eb58f967.js"><link rel="prefetch" href="/docs/assets/js/129.98c353ef.js"><link rel="prefetch" href="/docs/assets/js/13.ff457e04.js"><link rel="prefetch" href="/docs/assets/js/130.6fa36252.js"><link rel="prefetch" href="/docs/assets/js/131.137677b0.js"><link rel="prefetch" href="/docs/assets/js/132.5f72fbfe.js"><link rel="prefetch" href="/docs/assets/js/133.80e8c8b9.js"><link rel="prefetch" href="/docs/assets/js/135.23bb21c9.js"><link rel="prefetch" href="/docs/assets/js/136.fa7d3da4.js"><link rel="prefetch" href="/docs/assets/js/137.5ac69eb0.js"><link rel="prefetch" href="/docs/assets/js/138.22b4ad51.js"><link rel="prefetch" href="/docs/assets/js/139.c0318cd8.js"><link rel="prefetch" href="/docs/assets/js/14.eb589be3.js"><link rel="prefetch" href="/docs/assets/js/140.c62ceb8d.js"><link rel="prefetch" href="/docs/assets/js/141.31de57b7.js"><link rel="prefetch" href="/docs/assets/js/142.a72b4df0.js"><link rel="prefetch" href="/docs/assets/js/143.c3a926ef.js"><link rel="prefetch" href="/docs/assets/js/144.4999c75e.js"><link rel="prefetch" href="/docs/assets/js/145.b228369e.js"><link rel="prefetch" href="/docs/assets/js/146.96672717.js"><link rel="prefetch" href="/docs/assets/js/147.eb02df33.js"><link rel="prefetch" href="/docs/assets/js/148.f66212d7.js"><link rel="prefetch" href="/docs/assets/js/149.43b3f398.js"><link rel="prefetch" href="/docs/assets/js/15.d5b846f2.js"><link rel="prefetch" href="/docs/assets/js/150.d5446155.js"><link rel="prefetch" href="/docs/assets/js/151.9bb16945.js"><link rel="prefetch" href="/docs/assets/js/152.801e6881.js"><link rel="prefetch" href="/docs/assets/js/153.2e9225d0.js"><link rel="prefetch" href="/docs/assets/js/154.bdfad3bb.js"><link rel="prefetch" href="/docs/assets/js/155.ca33a5d6.js"><link rel="prefetch" href="/docs/assets/js/156.597faf29.js"><link rel="prefetch" href="/docs/assets/js/157.167ca53e.js"><link rel="prefetch" href="/docs/assets/js/158.d1845c02.js"><link rel="prefetch" href="/docs/assets/js/159.39ddf39b.js"><link rel="prefetch" href="/docs/assets/js/16.09e44cf2.js"><link rel="prefetch" href="/docs/assets/js/160.3f5e0e71.js"><link rel="prefetch" href="/docs/assets/js/161.b51ab5d4.js"><link rel="prefetch" href="/docs/assets/js/162.66e1eba7.js"><link rel="prefetch" href="/docs/assets/js/163.ca2e7dc4.js"><link rel="prefetch" href="/docs/assets/js/164.e7ee057b.js"><link rel="prefetch" href="/docs/assets/js/165.c57a3a73.js"><link rel="prefetch" href="/docs/assets/js/166.5ba6a415.js"><link rel="prefetch" href="/docs/assets/js/167.044b71f2.js"><link rel="prefetch" href="/docs/assets/js/168.8591eb7a.js"><link rel="prefetch" href="/docs/assets/js/169.9c289646.js"><link rel="prefetch" href="/docs/assets/js/17.90305846.js"><link rel="prefetch" href="/docs/assets/js/170.17795113.js"><link rel="prefetch" href="/docs/assets/js/171.2e0e2ebd.js"><link rel="prefetch" href="/docs/assets/js/172.02fd79f5.js"><link rel="prefetch" href="/docs/assets/js/173.a2fd1f33.js"><link rel="prefetch" href="/docs/assets/js/174.e73ea271.js"><link rel="prefetch" href="/docs/assets/js/175.f7d1d621.js"><link rel="prefetch" href="/docs/assets/js/176.060d6e9b.js"><link rel="prefetch" href="/docs/assets/js/177.6ffc75ae.js"><link rel="prefetch" href="/docs/assets/js/178.5343dc8a.js"><link rel="prefetch" href="/docs/assets/js/179.cf997ac1.js"><link rel="prefetch" href="/docs/assets/js/18.9b17b3ad.js"><link rel="prefetch" href="/docs/assets/js/180.d47fda54.js"><link rel="prefetch" href="/docs/assets/js/181.c60bc2fa.js"><link rel="prefetch" href="/docs/assets/js/182.0d4d8f0b.js"><link rel="prefetch" href="/docs/assets/js/183.1553505f.js"><link rel="prefetch" href="/docs/assets/js/184.14e1fe42.js"><link rel="prefetch" href="/docs/assets/js/185.be2898ea.js"><link rel="prefetch" href="/docs/assets/js/186.3d975468.js"><link rel="prefetch" href="/docs/assets/js/187.17b9aaa8.js"><link rel="prefetch" href="/docs/assets/js/188.aee032e9.js"><link rel="prefetch" href="/docs/assets/js/189.1abfef54.js"><link rel="prefetch" href="/docs/assets/js/19.cb7975b1.js"><link rel="prefetch" href="/docs/assets/js/190.83982575.js"><link rel="prefetch" href="/docs/assets/js/191.ab30e901.js"><link rel="prefetch" href="/docs/assets/js/192.41482526.js"><link rel="prefetch" href="/docs/assets/js/193.0088e9c3.js"><link rel="prefetch" href="/docs/assets/js/194.78c8b54c.js"><link rel="prefetch" href="/docs/assets/js/195.9614394c.js"><link rel="prefetch" href="/docs/assets/js/196.a2a86b20.js"><link rel="prefetch" href="/docs/assets/js/20.c0ca55ca.js"><link rel="prefetch" href="/docs/assets/js/21.e4e20cfd.js"><link rel="prefetch" href="/docs/assets/js/22.b4e42163.js"><link rel="prefetch" href="/docs/assets/js/23.f0e81db5.js"><link rel="prefetch" href="/docs/assets/js/24.584ba8e0.js"><link rel="prefetch" href="/docs/assets/js/25.96d28530.js"><link rel="prefetch" href="/docs/assets/js/26.922ceced.js"><link rel="prefetch" href="/docs/assets/js/27.e3c60b98.js"><link rel="prefetch" href="/docs/assets/js/28.24d30099.js"><link rel="prefetch" href="/docs/assets/js/29.f5c9fac3.js"><link rel="prefetch" href="/docs/assets/js/3.8582ba9c.js"><link rel="prefetch" href="/docs/assets/js/30.3a966c9e.js"><link rel="prefetch" href="/docs/assets/js/31.ff2a59af.js"><link rel="prefetch" href="/docs/assets/js/32.a37b1c09.js"><link rel="prefetch" href="/docs/assets/js/33.b0d42084.js"><link rel="prefetch" href="/docs/assets/js/34.0d6008cb.js"><link rel="prefetch" href="/docs/assets/js/35.fe56a588.js"><link rel="prefetch" href="/docs/assets/js/36.7613ef08.js"><link rel="prefetch" href="/docs/assets/js/37.62a39318.js"><link rel="prefetch" href="/docs/assets/js/38.f6566171.js"><link rel="prefetch" href="/docs/assets/js/39.cbc74142.js"><link rel="prefetch" href="/docs/assets/js/4.51debccd.js"><link rel="prefetch" href="/docs/assets/js/40.c11c4e2e.js"><link rel="prefetch" href="/docs/assets/js/41.5e6fd62e.js"><link rel="prefetch" href="/docs/assets/js/42.bc17cc4e.js"><link rel="prefetch" href="/docs/assets/js/43.b12bd60a.js"><link rel="prefetch" href="/docs/assets/js/44.d482c833.js"><link rel="prefetch" href="/docs/assets/js/45.81647c67.js"><link rel="prefetch" href="/docs/assets/js/46.ebeb4c40.js"><link rel="prefetch" href="/docs/assets/js/47.43cdfef7.js"><link rel="prefetch" href="/docs/assets/js/48.9fb386ba.js"><link rel="prefetch" href="/docs/assets/js/49.ddd6fec5.js"><link rel="prefetch" href="/docs/assets/js/5.b80e916b.js"><link rel="prefetch" href="/docs/assets/js/50.2ea8844c.js"><link rel="prefetch" href="/docs/assets/js/51.78550f87.js"><link rel="prefetch" href="/docs/assets/js/52.da138b9d.js"><link rel="prefetch" href="/docs/assets/js/53.1b7f0083.js"><link rel="prefetch" href="/docs/assets/js/54.9f7d54e8.js"><link rel="prefetch" href="/docs/assets/js/55.a9a38f68.js"><link rel="prefetch" href="/docs/assets/js/56.58e9dc64.js"><link rel="prefetch" href="/docs/assets/js/57.a264d039.js"><link rel="prefetch" href="/docs/assets/js/58.c6897ea4.js"><link rel="prefetch" href="/docs/assets/js/59.e369d2e6.js"><link rel="prefetch" href="/docs/assets/js/6.169b3707.js"><link rel="prefetch" href="/docs/assets/js/60.6c788ac5.js"><link rel="prefetch" href="/docs/assets/js/61.e17e8971.js"><link rel="prefetch" href="/docs/assets/js/62.4edc2249.js"><link rel="prefetch" href="/docs/assets/js/63.d566534d.js"><link rel="prefetch" href="/docs/assets/js/64.f74a9f7e.js"><link rel="prefetch" href="/docs/assets/js/65.79f84fb8.js"><link rel="prefetch" href="/docs/assets/js/66.e707c7ca.js"><link rel="prefetch" href="/docs/assets/js/67.986688f6.js"><link rel="prefetch" href="/docs/assets/js/68.a2f488e0.js"><link rel="prefetch" href="/docs/assets/js/69.059d49dd.js"><link rel="prefetch" href="/docs/assets/js/7.c00ca9e6.js"><link rel="prefetch" href="/docs/assets/js/70.22d516f3.js"><link rel="prefetch" href="/docs/assets/js/71.8600770a.js"><link rel="prefetch" href="/docs/assets/js/72.98ff3226.js"><link rel="prefetch" href="/docs/assets/js/73.2163549b.js"><link rel="prefetch" href="/docs/assets/js/74.b79d48ec.js"><link rel="prefetch" href="/docs/assets/js/75.735eceaa.js"><link rel="prefetch" href="/docs/assets/js/76.a8043398.js"><link rel="prefetch" href="/docs/assets/js/77.fbe1aac6.js"><link rel="prefetch" href="/docs/assets/js/78.a90e0b54.js"><link rel="prefetch" href="/docs/assets/js/79.7062f14d.js"><link rel="prefetch" href="/docs/assets/js/8.cc178099.js"><link rel="prefetch" href="/docs/assets/js/80.bffa8d1d.js"><link rel="prefetch" href="/docs/assets/js/81.b66a6bfe.js"><link rel="prefetch" href="/docs/assets/js/82.094ae501.js"><link rel="prefetch" href="/docs/assets/js/83.c25a4922.js"><link rel="prefetch" href="/docs/assets/js/84.9f0a65c1.js"><link rel="prefetch" href="/docs/assets/js/85.ef1c065b.js"><link rel="prefetch" href="/docs/assets/js/86.d14111d2.js"><link rel="prefetch" href="/docs/assets/js/87.392ad70c.js"><link rel="prefetch" href="/docs/assets/js/88.a81e5424.js"><link rel="prefetch" href="/docs/assets/js/89.4e98be92.js"><link rel="prefetch" href="/docs/assets/js/9.de8a3333.js"><link rel="prefetch" href="/docs/assets/js/90.a1faca2f.js"><link rel="prefetch" href="/docs/assets/js/91.39315478.js"><link rel="prefetch" href="/docs/assets/js/92.60e8c1e5.js"><link rel="prefetch" href="/docs/assets/js/93.18149e71.js"><link rel="prefetch" href="/docs/assets/js/94.6f5989ff.js"><link rel="prefetch" href="/docs/assets/js/95.c782c63f.js"><link rel="prefetch" href="/docs/assets/js/96.3d4f03f8.js"><link rel="prefetch" href="/docs/assets/js/97.22fb5a19.js"><link rel="prefetch" href="/docs/assets/js/98.a2519c1d.js"><link rel="prefetch" href="/docs/assets/js/99.a9779677.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.b36278c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/project/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/project/mock.html" class="sidebar-link">前端数据mock</a></li><li><a href="/docs/project/module.html" class="sidebar-link">一文搞懂AMD,CMD,CommonJs,UMD,ES Modules</a></li><li><a href="/docs/project/babel.html" class="sidebar-link">Babel</a></li><li><a href="/docs/project/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/docs/project/autobuild.html" class="sidebar-link">前端轻量自动化构建方案</a></li><li><a href="/docs/project/err.html" class="sidebar-link">前端错误监控体系搭建</a></li><li><a href="/docs/project/standards.html" class="sidebar-link">前端代码规范</a></li><li><a href="/docs/project/docker.html" class="sidebar-link">从0开始学习docker</a></li><li><a href="/docs/project/autoTryCatch.html" class="sidebar-link">基于 Babel 和 AST自动添加 try catch 方法</a></li><li><a href="/docs/project/gitlabCI.html" class="active sidebar-link">GitLab CI Pipeline框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#ci-cd-工作流程" class="sidebar-link">CI/CD 工作流程</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#gitlab-ci" class="sidebar-link">Gitlab CI</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#gitlab-runner" class="sidebar-link">Gitlab Runner</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#gitlab-ci-yml-配置文件" class="sidebar-link">gitlab-ci.yml(配置文件)</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#pipeline-管道" class="sidebar-link">Pipeline(管道)</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#stages" class="sidebar-link">Stages</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#jobs" class="sidebar-link">Jobs</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#script" class="sidebar-link">Script</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#image-and-services" class="sidebar-link">image and services</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#before-script和after-script" class="sidebar-link">beforescript和afterscript</a></li><li class="sidebar-sub-header"><a href="/docs/project/gitlabCI.html#配置示例" class="sidebar-link">配置示例</a></li></ul></li></ul></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器插件扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信开发相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件推荐</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="gitlab-ci-pipeline框架">GitLab CI Pipeline框架</h1> <ul><li>2020.05.20</li></ul> <p>本文将会介绍一些跟<code>GitLab CI</code>流程相关的知识,方便大家对CI/CD流程的熟悉,设计适合自己项目的流程。</p> <h2 id="ci-cd-工作流程">CI/CD 工作流程</h2> <p><img src="https://img-blog.csdnimg.cn/20200520181143980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="CI/CD 工作流程"></p> <h2 id="gitlab-ci">Gitlab CI</h2> <blockquote><p><code>GitLab CI</code> 是 <code>GitLab</code>内置的进行持续集成的工具，在你安装好 <code>GitLab</code> 之后，即同时安装了 <code>GitLab CI</code>。只需要在仓库根目录下创建 <code>.gitlab-ci.yml</code> 文件，并配置<code>GitLab Runner</code>；每次提交的时候，<code>gitlab</code>将自动识别到<code>.gitlab-ci.yml</code>文件，并且使用<code>Gitlab Runner</code>执行该脚本。</p></blockquote> <h2 id="gitlab-runner">Gitlab Runner</h2> <blockquote><p><code>GitLab Runner</code> 是用来执行<code>.gitlab-ci.yml</code> 脚本的工具，从 <code>GitLab CI</code> 中获取到任务，并按其要求完成任务的执行。可以理解成，<code>Runner</code>就像认真工作的工人，<code>GitLab-CI</code>就是管理工人的中心，所有工人都要在 <code>GitLab-CI</code> 里面注册，并且表明自己是为哪个项目服务。当相应的项目发生变化时，<code>GitLab-CI</code> 就会通知相应的工人执行对应的脚本。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>Runner</code>负责执行<code>.gitlab-ci.yml</code>文件中定义的<code>job</code>，可以是<code>虚拟机</code>、<code>vps</code>、<code>裸机</code>、<code>docker容器</code>或<code>容器集群</code>。</p> <p><code>GitLab Runner</code> 是由Go语言编写的,可以运行在 <code>GNU/Linux</code>, <code>macOS</code> 和 <code>Windows</code>上。</p> <p>如果我们项目中需要使用到<code>Docker</code>的话,最低版本的 <code>Docker</code> 需要 <code>v1.13.0</code>。</p> <p>我们可以在项目的<code>Settings--&gt;CI/CD--&gt;Runners</code>页面可以查看到是否有可用的<code>Runner</code>。</p></div> <h3 id="runner类型">Runner类型</h3> <p><code>GitLab-Runner</code> 可以分类两种类型：<code>Shared Runner（共享型）</code>和 <code>Specific Runner（指定型）</code>。</p> <ol><li><p><code>Shared Runner</code>：所有工程都能够用的，且只有<code>系统管理员</code>能够创建。</p></li> <li><p><code>Specific Runner</code>：只有特定的项目可以使用。</p></li></ol> <h3 id="runner安装">Runner安装</h3> <p>以<code>macOs</code>为例子,完整的安装地址参考:<a href="https://docs.gitlab.com/runner/install/" target="_blank" rel="noopener noreferrer">官方下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>方式1</li></ul> <div class="language- extra-class"><pre class="language-text"><code>sudo curl --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-darwin-amd64

sudo chmod +x /usr/local/bin/gitlab-runner

cd ~
gitlab-runner install
gitlab-runner start
</code></pre></div><ul><li>方式2</li></ul> <div class="language- extra-class"><pre class="language-text"><code>brew install gitlab-runner

brew services start gitlab-runner
</code></pre></div><h3 id="获取runner注册token">获取Runner注册Token</h3> <p>安装好<code>Runner</code>之后，需要向<code>Gitlab</code>进行注册，注册<code>Runner</code>需要 <code>GitLab-CI</code> 的 <code>url</code> 和 <code>token</code>。可根据需求注册选择所需类型<code>Runner</code>。</p> <ul><li>获取<code>Shared Runner注册Token</code>：</li></ul> <p>使用管理员用户登录，进入<code>Admin Area-&gt;OverView-&gt;Runners</code>界面。</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZWVkMTM5OGRjZjg" alt="图片地址"></p> <ul><li>获取<code>Specific Runner注册Token</code>：</li></ul> <p>进行项目仓库-&gt;settings-&gt;CI/CD界面</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZWVmZmFkYTc4NWI" alt="图片地址"></p> <h3 id="注册runner">注册Runner</h3> <p>完整的注册文档请参见<a href="https://docs.gitlab.com/runner/register/" target="_blank" rel="noopener noreferrer">官方注册文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>执行 <code>gitlab-ci-multi-runner register</code>命令进行 <code>Runner注册</code>，期间会用到前期获取的url及token；注册完成之后，<code>GitLab-CI</code>就会多出一条<code>Runner记录</code>。</p> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZWYzZDVmZmI5MTA" alt="图片地址"></p> <h2 id="gitlab-ci-yml-配置文件">gitlab-ci.yml(配置文件)</h2> <blockquote><p>从<code>7.12</code>版本开始，<code>GitLab CI</code>使用<code>YAML</code>文件(<code>.gitlab-ci.yml</code>)来管理项目配置。该文件存放于项目<code>仓库的根目录</code>，并且包含了你的项目如何被编译的描述语句。<code>YAML</code>文件使用一系列约束叙述定义了Job启动时所要做的事情。</p></blockquote> <p>通过配置<code>gitlab-ci.yml</code>文件我们可以定义<code>Pipeline</code>的结构和执行顺序。</p> <h3 id="关键字及含义">关键字及含义</h3> <table><thead><tr><th style="text-align:left;">关键字</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>before_script</code></td> <td style="text-align:left;">定义任何 Jobs 运行前都会执行的命令。</td></tr> <tr><td style="text-align:left;"><code>after_script</code></td> <td style="text-align:left;">定义任何 Jobs 运行完后都会执行的命令。（要求 GitLab 8.7+ 和 GitLab Runner 1.2+）</td></tr> <tr><td style="text-align:left;"><code>variables &amp;&amp; Job.variables</code></td> <td style="text-align:left;">定义环境变量。如果定义了 Job 级别的环境变量的话，该 Job 会优先使用 Job 级别的环境变量。（要求 GitLab Runner 0.5.0+）</td></tr> <tr><td style="text-align:left;"><code>cache &amp;&amp; Job.cache</code></td> <td style="text-align:left;">定义需要缓存的文件。每个 Job 开始的时候，Runner 都会删掉 .gitignore 里面的文件。如果有些文件 (如 node_modules/) 需要多个 Jobs 共用的话，我们只能让每个 Job 都先执行一遍 npm install。（要求 GitLab Runner 0.7.0+）</td></tr> <tr><td style="text-align:left;"><code>Job.scrip</code></td> <td style="text-align:left;">定义 Job 要运行的命令，必填项</td></tr> <tr><td style="text-align:left;"><code>Job.stage</code></td> <td style="text-align:left;">定义 Job 的 stage，默认为 test</td></tr> <tr><td style="text-align:left;"><code>Job.artifacts</code></td> <td style="text-align:left;">定义 Job 中生成的附件。当该 Job 运行成功后，生成的文件可以作为附件 (如生成的二进制文件) 保留下来，打包发送到 GitLab，之后我们可以在 GitLab 的项目页面下下载该附件。</td></tr></tbody></table> <h3 id="工作流程">工作流程</h3> <p><img src="https://www.chenshaowen.com/blog/images/2017/11/cicd_pipeline_infograph.png" alt="工作流程"></p> <h2 id="pipeline-管道">Pipeline(管道)</h2> <p>完整的 <code>pipeline</code> 配置可以参考<a href="https://docs.gitlab.com/ee/user/project/pipelines/schedules.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p><code>PipeLine</code> 即流水线是持续集成、发布、部署的最顶层的组件。由 <code>Stage</code> 和 <code>Job</code> 组成，由<code>.gitlab-ci.yml</code>来定义。按触发模式可分为：<code>自动触发</code>和<code>人工触发</code>。</p></blockquote> <p>一次 <code>Pipeline</code> 其实相当于一次构建任务，里面可以包含多个流程，比如<code>自动构建</code>、<code>自动进行单元测试</code>、<code>自动进行代码检查</code>等流程 ;</p> <p>任何提交或者 <code>Merge Request</code> 的合并都可以触发 <code>Pipeline</code> ;</p> <h3 id="自动触发">自动触发</h3> <ul><li>定时触发</li></ul> <p>比如我们可以通过配置<a href="https://docs.gitlab.com/ee/api/pipeline_schedules.html" target="_blank" rel="noopener noreferrer">Pipeline schedules API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在每天的0:00进行一次操作。</p> <p>创建一个新的项目管道计划。</p> <div class="language- extra-class"><pre class="language-text"><code>POST /projects/:id/pipeline_schedules
</code></pre></div><table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">需要</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>id</code></td> <td style="text-align:left;">int / string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">经过身份验证的用户拥有的项目的ID或URL编码路径</td></tr> <tr><td style="text-align:left;"><code>description</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">管道进度表的描述</td></tr> <tr><td style="text-align:left;"><code>ref</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">分支/标签名称将被触发</td></tr> <tr><td style="text-align:left;"><code>cron</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">是</td> <td style="text-align:left;">cron（例如0 1 * * *）（Cron语法）</td></tr> <tr><td style="text-align:left;"><code>cron_timezone</code></td> <td style="text-align:left;">string</td> <td style="text-align:left;">否</td> <td style="text-align:left;">所支持的时区ActiveSupport::TimeZone（如Pacific Time (US &amp; Canada)）（默认值：'UTC'）</td></tr> <tr><td style="text-align:left;"><code>active</code></td> <td style="text-align:left;">boolean</td> <td style="text-align:left;">否</td> <td style="text-align:left;">管道计划的激活。如果假设置，管道计划将首先停用（默认值：true）</td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code>curl --request POST --header &quot;PRIVATE-TOKEN: k5ESFgWY2Qf5xEvDcFxZ&quot; --form description=&quot;Build packages&quot; --form ref=&quot;master&quot; --form cron=&quot;0 0 * * *&quot; --form cron_timezone=&quot;UTC&quot; --form active=&quot;true&quot; &quot;https://gitlab.example.com/api/v4/projects/29/pipeline_schedules&quot;
</code></pre></div><p>执行结果:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Build packages&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;master&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cron&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0 0 * * *&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cron_timezone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UTC&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;next_run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-05-21T00:00:00.000Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;active&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;created_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-05-20T13:43:08.169Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;updated_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-05-20T13:43:08.169Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;last_pipeline&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;owner&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Administrator&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;active&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;avatar_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&amp;d=identicon&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;web_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://gitlab.example.com/root&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Merge请求</code>触发</li></ul> <blockquote><p>此功能在<code>GitLab 11.6</code>版本中引入。</p></blockquote> <p>在基础配置中,每次提交一个更改到分支的时候,GitLab都会运行一个管道。要在merge的时候触发需要配置CI/CD配置文件。</p> <p>例如使用<code>only</code>或<code>except</code>运行管道以进行合并请求:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> ./build
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> master

<span class="token key atrule">test</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">script</span><span class="token punctuation">:</span> ./test
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> merge_requests

<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token key atrule">script</span><span class="token punctuation">:</span> ./deploy
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> master
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>使用此方法时，必须<code>only: - merge_requests</code>为每个作业指定。</p> <p>在此示例中，管道包含<code>test</code>配置为在合并请求上运行的作业,在<code>build</code>与<code>deploy</code>工作没有<code>only: - merge_requests</code>参数，所以他们不会合并请求运行。</p></div> <h3 id="人工触发">人工触发</h3> <p>手动去触发打包</p> <h2 id="stages">Stages</h2> <blockquote><p><code>stages</code> 表示构建阶段,一个 <code>Pipeline</code> 中可以定义多个 <code>stage</code>,包括了 <code>build</code>、<code>test</code> 和 <code>deploy</code>等阶段。</p></blockquote> <p><strong>stages有如下特点 :</strong></p> <ul><li><p>所有 <code>stages</code> 会按照顺序运行，即当一个 <code>stage</code> 完成后，下一个 <code>stage</code> 才会开始</p></li> <li><p>只有当所有 <code>stages</code> 成功完成后，该构建任务 (<code>Pipeline</code>) 才算成功</p></li> <li><p>如果任何一个 <code>stage</code> 失败，那么后面的 <code>stages</code> 不会执行，该构建任务 (<code>Pipeline</code>) 失败</p></li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build
  <span class="token punctuation">-</span> test
  <span class="token punctuation">-</span> deploy

job 1<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make build dependencies

job 2<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make build artifacts

job 3<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make test

job 4<span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make deploy
</code></pre></div><h3 id="stages执行顺序">Stages执行顺序</h3> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS83LzI5LzE2YzNjZjAzOTY1MzVkM2M" alt="Stages执行顺序"></p> <p>以图中所示为例，整个 CI 环节包含三个 Stage：<code>build、test 和deploy</code>。</p> <ul><li><p><code>build</code> 被首先执行。如果发生错误，本次 CI 立刻失败；</p></li> <li><p><code>test</code> 在 build 成功执行完毕后执行。如果发生错误，本次 CI 立刻失败；</p></li> <li><p><code>deploy</code> 在 test 成功执行完毕后执行。如果发生错误，本次 CI 失败。</p></li></ul> <h2 id="jobs">Jobs</h2> <blockquote><p><code>Job</code>是 <code>.gitlab-ci.yml</code> 文件中最基本的元素，表示某个<code>stage</code>里面执行的工作。一个<code>stage</code>中用户可以创建任意个任务；每个任务必须有一个独一无二的名字，但有一些保留 <code>keywords</code> 不能用于<code>Job</code>名称。</p></blockquote> <p><strong>保留关键字</strong>:</p> <ul><li><code>image</code>，</li> <li><code>services</code>，</li> <li><code>stages</code>，</li> <li><code>types</code>，</li> <li><code>before_script</code>，</li> <li><code>after_script</code>，</li> <li><code>variables</code>，</li> <li><code>cache</code>，</li> <li><code>include</code>。</li></ul> <p><code>Job</code>被定义为<code>顶级元素</code>，并且至少包括一条<code>script</code>语句，如果一个 <code>Job</code> 没有显式地关联某个 <code>Stage</code>，则会被默认关联到 <code>test Stage</code>。</p> <p><strong>jobs有如下特点 :</strong></p> <ul><li><p>相同 <code>stage</code> 中的<code>jobs</code> 会并行执行</p></li> <li><p>相同 <code>stage</code> 中的 <code>jobs</code> 都执行成功时，该 <code>stage</code> 才会成功</p></li> <li><p>如果任何一个<code>job</code> 失败，那么该 <code>stage</code> 失败，即该构建任务 (<code>Pipeline</code>) 失败</p></li></ul> <h3 id="job执行流程">Job执行流程</h3> <p><img src="https://img-blog.csdnimg.cn/20200520181121774.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20200520181035314.png" alt="Job执行流程"></p> <h2 id="script">Script</h2> <blockquote><p><code>script</code>是一段由<code>Runner</code>执行的<code>shell</code>脚本。</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">job</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> uname <span class="token punctuation">-</span>a
    <span class="token punctuation">-</span> bundle exec rspec
</code></pre></div><h2 id="image-and-services">image and services</h2> <blockquote><p>这两个选项允许开发者指定任务运行时所需的自定义的docker镜像和服务。</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">#为每个作业定义不同的映像和服务</span>
<span class="token key atrule">test:2.1</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> ruby<span class="token punctuation">:</span><span class="token number">2.1</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> postgres<span class="token punctuation">:</span><span class="token number">9.3</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> bundle exec rake spec

<span class="token key atrule">test:2.2</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> ruby<span class="token punctuation">:</span><span class="token number">2.2</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> postgres<span class="token punctuation">:</span><span class="token number">9.4</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> bundle exec rake spec
</code></pre></div><h2 id="before-script和after-script">before_script和after_script</h2> <blockquote><p><code>before_script</code>是用于定义一些在所有任务执行前所需执行的命令, 包括部署工作，可以接受一个数组或者多行字符串。<code>after_script</code>用于定义所有job执行过后需要执行的命令，可以接受一个数组或者多行字符串。</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">#定义全局 before_script:</span>
<span class="token key atrule">default</span><span class="token punctuation">:</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> global before script
<span class="token comment">#覆盖全局before_script</span>
<span class="token key atrule">job</span><span class="token punctuation">:</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> execute this instead of global before script
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> my command
  <span class="token key atrule">after_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> execute this after my script

</code></pre></div><h2 id="配置示例">配置示例</h2> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">before_script</span><span class="token punctuation">:</span>
  <span class="token comment"># 激活 nodeenv 虚拟环境</span>
  <span class="token punctuation">-</span> source /data/gitlab<span class="token punctuation">-</span>runner/paas<span class="token punctuation">-</span>webfe/bin/activate
  <span class="token comment"># 查看 node 版本</span>
  <span class="token punctuation">-</span> which node <span class="token important">&amp;&amp;</span> node <span class="token punctuation">-</span><span class="token punctuation">-</span>version
  <span class="token comment"># 为了能方便使用 npm ，给它取一个别名</span>
  <span class="token punctuation">-</span> alias npm=&quot;/data/gitlab<span class="token punctuation">-</span>runner/node/bin/npm&quot;
  <span class="token punctuation">-</span> which npm <span class="token important">&amp;&amp;</span> npm <span class="token punctuation">-</span><span class="token punctuation">-</span>version

<span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build

<span class="token key atrule">build-test-webpack</span><span class="token punctuation">:</span>
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
    <span class="token comment"># 需要修改为项目的 GitLab 地址格式 </span>
    <span class="token key atrule">CI_REPOSITORY_URL</span><span class="token punctuation">:</span>
      http<span class="token punctuation">:</span>//$GIT_USERNAME<span class="token punctuation">:</span>$GIT_PASSWORD@gitlab.xxx.com/$CI_PROJECT_PATH.git
    <span class="token comment"># 打包生成的文件存放目录</span>
    <span class="token key atrule">OUT_PUT_DIR</span><span class="token punctuation">:</span>
      test
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token comment"># 允许在 GitLab 页面上，直接下载 $OUT_PUT_DIR 内容</span>
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $OUT_PUT_DIR
  <span class="token comment"># 没有 Git 版本的文件，设置缓存，可以避免每次 npm install 重复安装</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">untracked</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token comment"># 开始执行打包编译命令，并提交到当前的 Git 仓库，具体的命令，需要根据项目编写，也可以放在一个 shell 文件，执行</span>
    <span class="token punctuation">-</span> echo &quot;start build test&quot;
    <span class="token punctuation">-</span> rm <span class="token punctuation">-</span>rf  $CI_PROJECT_NAME $OUT_PUT_DIR
    <span class="token punctuation">-</span> cd ./webpack <span class="token important">&amp;&amp;</span> tnpm install <span class="token important">&amp;&amp;</span> tnpm run build<span class="token punctuation">-</span>test <span class="token important">&amp;&amp;</span> cd ..
    <span class="token punctuation">-</span> git clone $CI_REPOSITORY_URL
    <span class="token punctuation">-</span> rm <span class="token punctuation">-</span>rf $CI_PROJECT_NAME/$OUT_PUT_DIR <span class="token important">&amp;&amp;</span> cp <span class="token punctuation">-</span>r $OUT_PUT_DIR $CI_PROJECT_NAME/
    <span class="token punctuation">-</span> cd $CI_PROJECT_NAME
    <span class="token punctuation">-</span> git add $OUT_PUT_DIR
    <span class="token punctuation">-</span> git status <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> build.log
    <span class="token punctuation">-</span> date <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> build.log
    <span class="token punctuation">-</span> git add build.log
    <span class="token punctuation">-</span> git commit <span class="token punctuation">-</span>m &quot;auto build<span class="token punctuation">-</span>test<span class="token punctuation">[</span>ci skip<span class="token punctuation">]</span>&quot;
    <span class="token punctuation">-</span> git push $CI_REPOSITORY_URL master
    <span class="token punctuation">-</span> echo &quot;end build test&quot;
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-06-30 09:49:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/project/autoTryCatch.html" class="prev">
        基于 Babel 和 AST自动添加 try catch 方法
      </a></span> <span class="next"><a href="/docs/safe/">
        Web安全问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.82d7bf1e.js" defer></script><script src="/docs/assets/js/2.3d9c2800.js" defer></script><script src="/docs/assets/js/134.57aeca7d.js" defer></script>
  </body>
</html>
