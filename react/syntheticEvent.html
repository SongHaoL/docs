<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>合成事件(SyntheticEvent) | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.574402e1.css" as="style"><link rel="preload" href="/docs/assets/js/app.8bb7f38c.js" as="script"><link rel="preload" href="/docs/assets/js/2.346c741e.js" as="script"><link rel="preload" href="/docs/assets/js/162.d2a9c87b.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.448efd45.js"><link rel="prefetch" href="/docs/assets/js/100.52b29356.js"><link rel="prefetch" href="/docs/assets/js/101.cd1f4c36.js"><link rel="prefetch" href="/docs/assets/js/102.59e88705.js"><link rel="prefetch" href="/docs/assets/js/103.2b54d112.js"><link rel="prefetch" href="/docs/assets/js/104.fae1d084.js"><link rel="prefetch" href="/docs/assets/js/105.1932bb9c.js"><link rel="prefetch" href="/docs/assets/js/106.4b8b8f95.js"><link rel="prefetch" href="/docs/assets/js/107.b9781ba6.js"><link rel="prefetch" href="/docs/assets/js/108.f69c6b38.js"><link rel="prefetch" href="/docs/assets/js/109.c8643528.js"><link rel="prefetch" href="/docs/assets/js/11.6b84f53c.js"><link rel="prefetch" href="/docs/assets/js/110.07d25ba7.js"><link rel="prefetch" href="/docs/assets/js/111.31f2b11f.js"><link rel="prefetch" href="/docs/assets/js/112.f349742f.js"><link rel="prefetch" href="/docs/assets/js/113.3fec3968.js"><link rel="prefetch" href="/docs/assets/js/114.08a5fea8.js"><link rel="prefetch" href="/docs/assets/js/115.f09e85c3.js"><link rel="prefetch" href="/docs/assets/js/116.f6da850c.js"><link rel="prefetch" href="/docs/assets/js/117.e5ff7776.js"><link rel="prefetch" href="/docs/assets/js/118.d3ba055c.js"><link rel="prefetch" href="/docs/assets/js/119.f98dd6ab.js"><link rel="prefetch" href="/docs/assets/js/12.8bcafd6e.js"><link rel="prefetch" href="/docs/assets/js/120.745a3e22.js"><link rel="prefetch" href="/docs/assets/js/121.eac2116d.js"><link rel="prefetch" href="/docs/assets/js/122.9e915c21.js"><link rel="prefetch" href="/docs/assets/js/123.1e6bec5d.js"><link rel="prefetch" href="/docs/assets/js/124.037e80df.js"><link rel="prefetch" href="/docs/assets/js/125.c21814b1.js"><link rel="prefetch" href="/docs/assets/js/126.6456119c.js"><link rel="prefetch" href="/docs/assets/js/127.0c09c34f.js"><link rel="prefetch" href="/docs/assets/js/128.3346daee.js"><link rel="prefetch" href="/docs/assets/js/129.f351ddb2.js"><link rel="prefetch" href="/docs/assets/js/13.4455f4e8.js"><link rel="prefetch" href="/docs/assets/js/130.0245f34b.js"><link rel="prefetch" href="/docs/assets/js/131.17edd525.js"><link rel="prefetch" href="/docs/assets/js/132.59c9d301.js"><link rel="prefetch" href="/docs/assets/js/133.884b352a.js"><link rel="prefetch" href="/docs/assets/js/134.4f12eb2c.js"><link rel="prefetch" href="/docs/assets/js/135.4ad34e04.js"><link rel="prefetch" href="/docs/assets/js/136.617c9a61.js"><link rel="prefetch" href="/docs/assets/js/137.1f919695.js"><link rel="prefetch" href="/docs/assets/js/138.4f1db5b4.js"><link rel="prefetch" href="/docs/assets/js/139.c8b01cd3.js"><link rel="prefetch" href="/docs/assets/js/14.3b0be226.js"><link rel="prefetch" href="/docs/assets/js/140.334825bd.js"><link rel="prefetch" href="/docs/assets/js/141.6841867e.js"><link rel="prefetch" href="/docs/assets/js/142.e72d2063.js"><link rel="prefetch" href="/docs/assets/js/143.70cd8cce.js"><link rel="prefetch" href="/docs/assets/js/144.75e9018e.js"><link rel="prefetch" href="/docs/assets/js/145.624f7426.js"><link rel="prefetch" href="/docs/assets/js/146.92b228fe.js"><link rel="prefetch" href="/docs/assets/js/147.d0275c5e.js"><link rel="prefetch" href="/docs/assets/js/148.7b0425f7.js"><link rel="prefetch" href="/docs/assets/js/149.92928bf2.js"><link rel="prefetch" href="/docs/assets/js/15.4b5d7343.js"><link rel="prefetch" href="/docs/assets/js/150.75888041.js"><link rel="prefetch" href="/docs/assets/js/151.70152a0e.js"><link rel="prefetch" href="/docs/assets/js/152.81c27cf2.js"><link rel="prefetch" href="/docs/assets/js/153.d5b7922b.js"><link rel="prefetch" href="/docs/assets/js/154.639b55a5.js"><link rel="prefetch" href="/docs/assets/js/155.d602a5bb.js"><link rel="prefetch" href="/docs/assets/js/156.b6966e82.js"><link rel="prefetch" href="/docs/assets/js/157.2e40a616.js"><link rel="prefetch" href="/docs/assets/js/158.f5e0ae1f.js"><link rel="prefetch" href="/docs/assets/js/159.57509c24.js"><link rel="prefetch" href="/docs/assets/js/16.9d0963b3.js"><link rel="prefetch" href="/docs/assets/js/160.2e078fe2.js"><link rel="prefetch" href="/docs/assets/js/161.c0f6c9be.js"><link rel="prefetch" href="/docs/assets/js/163.470653e8.js"><link rel="prefetch" href="/docs/assets/js/164.0ff827a4.js"><link rel="prefetch" href="/docs/assets/js/165.49df0c4a.js"><link rel="prefetch" href="/docs/assets/js/166.c0e049c3.js"><link rel="prefetch" href="/docs/assets/js/167.abc57592.js"><link rel="prefetch" href="/docs/assets/js/168.dfe496d2.js"><link rel="prefetch" href="/docs/assets/js/169.c0c8808d.js"><link rel="prefetch" href="/docs/assets/js/17.95b7e490.js"><link rel="prefetch" href="/docs/assets/js/170.af5fa4f7.js"><link rel="prefetch" href="/docs/assets/js/171.9aeb6fb0.js"><link rel="prefetch" href="/docs/assets/js/172.dbc06008.js"><link rel="prefetch" href="/docs/assets/js/173.d85d8eaf.js"><link rel="prefetch" href="/docs/assets/js/174.87137bbe.js"><link rel="prefetch" href="/docs/assets/js/175.04de97f1.js"><link rel="prefetch" href="/docs/assets/js/176.3c85bda2.js"><link rel="prefetch" href="/docs/assets/js/177.a5de78c2.js"><link rel="prefetch" href="/docs/assets/js/178.4a881e8c.js"><link rel="prefetch" href="/docs/assets/js/179.fe138678.js"><link rel="prefetch" href="/docs/assets/js/18.ca0afb77.js"><link rel="prefetch" href="/docs/assets/js/180.18ff978f.js"><link rel="prefetch" href="/docs/assets/js/19.981481df.js"><link rel="prefetch" href="/docs/assets/js/20.6e80cd2d.js"><link rel="prefetch" href="/docs/assets/js/21.c0ec8375.js"><link rel="prefetch" href="/docs/assets/js/22.648850d3.js"><link rel="prefetch" href="/docs/assets/js/23.73ed5316.js"><link rel="prefetch" href="/docs/assets/js/24.768a95fb.js"><link rel="prefetch" href="/docs/assets/js/25.b460e9a9.js"><link rel="prefetch" href="/docs/assets/js/26.61c56597.js"><link rel="prefetch" href="/docs/assets/js/27.2bbfe116.js"><link rel="prefetch" href="/docs/assets/js/28.efc0814f.js"><link rel="prefetch" href="/docs/assets/js/29.8bebb742.js"><link rel="prefetch" href="/docs/assets/js/3.f0b9dcd8.js"><link rel="prefetch" href="/docs/assets/js/30.e6180f81.js"><link rel="prefetch" href="/docs/assets/js/31.791f6adb.js"><link rel="prefetch" href="/docs/assets/js/32.59f79bfb.js"><link rel="prefetch" href="/docs/assets/js/33.24072082.js"><link rel="prefetch" href="/docs/assets/js/34.9cc3face.js"><link rel="prefetch" href="/docs/assets/js/35.f5942d3c.js"><link rel="prefetch" href="/docs/assets/js/36.9664a07b.js"><link rel="prefetch" href="/docs/assets/js/37.12a8e708.js"><link rel="prefetch" href="/docs/assets/js/38.0c48b0a9.js"><link rel="prefetch" href="/docs/assets/js/39.9d41280d.js"><link rel="prefetch" href="/docs/assets/js/4.0f806da2.js"><link rel="prefetch" href="/docs/assets/js/40.2ee80385.js"><link rel="prefetch" href="/docs/assets/js/41.fefef9e9.js"><link rel="prefetch" href="/docs/assets/js/42.f6d801aa.js"><link rel="prefetch" href="/docs/assets/js/43.51c3e56f.js"><link rel="prefetch" href="/docs/assets/js/44.a096b57c.js"><link rel="prefetch" href="/docs/assets/js/45.2d938602.js"><link rel="prefetch" href="/docs/assets/js/46.5462b19e.js"><link rel="prefetch" href="/docs/assets/js/47.3693a81a.js"><link rel="prefetch" href="/docs/assets/js/48.1d984385.js"><link rel="prefetch" href="/docs/assets/js/49.75eb0693.js"><link rel="prefetch" href="/docs/assets/js/5.7088cd54.js"><link rel="prefetch" href="/docs/assets/js/50.06ea30e6.js"><link rel="prefetch" href="/docs/assets/js/51.95767db4.js"><link rel="prefetch" href="/docs/assets/js/52.036a427b.js"><link rel="prefetch" href="/docs/assets/js/53.03e8160e.js"><link rel="prefetch" href="/docs/assets/js/54.3f89c021.js"><link rel="prefetch" href="/docs/assets/js/55.ee276a6b.js"><link rel="prefetch" href="/docs/assets/js/56.8f841dda.js"><link rel="prefetch" href="/docs/assets/js/57.ddc66f28.js"><link rel="prefetch" href="/docs/assets/js/58.8ffe2d5a.js"><link rel="prefetch" href="/docs/assets/js/59.5adb1a11.js"><link rel="prefetch" href="/docs/assets/js/6.aa27b4b3.js"><link rel="prefetch" href="/docs/assets/js/60.1152a6b2.js"><link rel="prefetch" href="/docs/assets/js/61.abef8004.js"><link rel="prefetch" href="/docs/assets/js/62.51c7286d.js"><link rel="prefetch" href="/docs/assets/js/63.73db51c7.js"><link rel="prefetch" href="/docs/assets/js/64.f121b763.js"><link rel="prefetch" href="/docs/assets/js/65.76ef0090.js"><link rel="prefetch" href="/docs/assets/js/66.a39ac5ac.js"><link rel="prefetch" href="/docs/assets/js/67.499d3620.js"><link rel="prefetch" href="/docs/assets/js/68.7c04c7a8.js"><link rel="prefetch" href="/docs/assets/js/69.e58396ea.js"><link rel="prefetch" href="/docs/assets/js/7.6653ed24.js"><link rel="prefetch" href="/docs/assets/js/70.2ce6d316.js"><link rel="prefetch" href="/docs/assets/js/71.80443b6f.js"><link rel="prefetch" href="/docs/assets/js/72.f224489d.js"><link rel="prefetch" href="/docs/assets/js/73.0f73eb62.js"><link rel="prefetch" href="/docs/assets/js/74.a6215b26.js"><link rel="prefetch" href="/docs/assets/js/75.1dd84ab6.js"><link rel="prefetch" href="/docs/assets/js/76.f706d67e.js"><link rel="prefetch" href="/docs/assets/js/77.583d7e47.js"><link rel="prefetch" href="/docs/assets/js/78.add671e4.js"><link rel="prefetch" href="/docs/assets/js/79.6fc1e8ae.js"><link rel="prefetch" href="/docs/assets/js/8.a8d55efb.js"><link rel="prefetch" href="/docs/assets/js/80.ac37b44e.js"><link rel="prefetch" href="/docs/assets/js/81.22269b9e.js"><link rel="prefetch" href="/docs/assets/js/82.5e87105a.js"><link rel="prefetch" href="/docs/assets/js/83.f55d61be.js"><link rel="prefetch" href="/docs/assets/js/84.3b7083e8.js"><link rel="prefetch" href="/docs/assets/js/85.d8377c9b.js"><link rel="prefetch" href="/docs/assets/js/86.28cdec66.js"><link rel="prefetch" href="/docs/assets/js/87.fd7dd7b0.js"><link rel="prefetch" href="/docs/assets/js/88.58af6bb1.js"><link rel="prefetch" href="/docs/assets/js/89.ed215de5.js"><link rel="prefetch" href="/docs/assets/js/9.7d808dd7.js"><link rel="prefetch" href="/docs/assets/js/90.c3b9fbf3.js"><link rel="prefetch" href="/docs/assets/js/91.c6810a41.js"><link rel="prefetch" href="/docs/assets/js/92.e69c17dd.js"><link rel="prefetch" href="/docs/assets/js/93.d9e89cf9.js"><link rel="prefetch" href="/docs/assets/js/94.ba85fb71.js"><link rel="prefetch" href="/docs/assets/js/95.94198768.js"><link rel="prefetch" href="/docs/assets/js/96.9307b34d.js"><link rel="prefetch" href="/docs/assets/js/97.01aac265.js"><link rel="prefetch" href="/docs/assets/js/98.26a09d18.js"><link rel="prefetch" href="/docs/assets/js/99.241e2c4b.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.574402e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/react/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/react/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/react/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/react/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><a href="/docs/git/" class="sidebar-link">git相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/react/lifestyle.html" class="sidebar-link">生命周期详解</a></li><li><a href="/docs/react/dom.html" class="sidebar-link">虚拟DOM</a></li><li><a href="/docs/react/diff.html" class="sidebar-link">Diff算法</a></li><li><a href="/docs/react/fiber.html" class="sidebar-link">Fiber算法</a></li><li><a href="/docs/react/component.html" class="sidebar-link">类组件与函数式组件</a></li><li><a href="/docs/react/com.html" class="sidebar-link">PureComponent与Component</a></li><li><a href="/docs/react/setState.html" class="sidebar-link">setState</a></li><li><a href="/docs/react/redux.html" class="sidebar-link">Rudex 与 React-Redux</a></li><li><a href="/docs/react/hooksRedux.html" class="sidebar-link">React Hooks Redux</a></li><li><a href="/docs/react/reduxSaga.html" class="sidebar-link">使用Redux Saga来管理副作用</a></li><li><a href="/docs/react/mobx.html" class="sidebar-link">使用Mobx来管理React应用</a></li><li><a href="/docs/react/hooks.html" class="sidebar-link">React Hooks</a></li><li><a href="/docs/react/aria.html" class="sidebar-link">无障碍功能</a></li><li><a href="/docs/react/codesplit.html" class="sidebar-link">代码分割</a></li><li><a href="/docs/react/ref.html" class="sidebar-link">ref</a></li><li><a href="/docs/react/hoc.html" class="sidebar-link">高阶组件(HOC)</a></li><li><a href="/docs/react/jsx.html" class="sidebar-link">深入jsx</a></li><li><a href="/docs/react/portal.html" class="sidebar-link">Portal</a></li><li><a href="/docs/react/syntheticEvent.html" class="active sidebar-link">合成事件(SyntheticEvent)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/react/syntheticEvent.html#事件池" class="sidebar-link">事件池</a></li><li class="sidebar-sub-header"><a href="/docs/react/syntheticEvent.html#支持的事件" class="sidebar-link">支持的事件</a></li><li class="sidebar-sub-header"><a href="/docs/react/syntheticEvent.html#为什么与怎么做？" class="sidebar-link">为什么与怎么做？</a></li></ul></li><li><a href="/docs/react/optimization.html" class="sidebar-link">性能优化</a></li><li><a href="/docs/react/webpack.html" class="sidebar-link">create-react-app中集成webpack</a></li><li><a href="/docs/react/recompose.html" class="sidebar-link">使用recompose优化你的React组件</a></li><li><a href="/docs/react/problems.html" class="sidebar-link">常见问题汇总</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器插件扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="合成事件-syntheticevent">合成事件(SyntheticEvent)</h1> <blockquote><p><code>SyntheticEvent</code> 实例将被传递给你的事件处理函数，它是浏览器的原生事件的跨浏览器包装器。除兼容所有浏览器外，它还拥有和浏览器原生事件相同的接口，包括 <code>stopPropagation()</code> 和 <code>preventDefault()</code>。</p></blockquote> <h2 id="事件池">事件池</h2> <p><code>SyntheticEvent</code> 是合并而来。这意味着 <code>SyntheticEvent</code> 对象可能会被重用，而且在事件回调函数被调用后，所有的属性都会无效。出于性能考虑，你不能通过异步访问事件。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; nullified object.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;click&quot;</span>
  <span class="token keyword">const</span> eventType <span class="token operator">=</span> event<span class="token punctuation">.</span>type<span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;click&quot;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; null</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;click&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 不起作用，this.state.clickEvent 的值将会只包含 null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>clickEvent<span class="token operator">:</span> event<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 你仍然可以导出事件属性</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>eventType<span class="token operator">:</span> event<span class="token punctuation">.</span>type<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果你想异步访问事件属性，你需在事件上调用 <code>event.persist()</code>，此方法会从池中移除合成事件，允许用户代码保留对事件的引用。</p></div> <h2 id="支持的事件">支持的事件</h2> <p><code>React</code> 通过将事件 <code>normalize</code> 以让他们在不同浏览器中拥有一致的属性。</p> <p><code>React</code> 中的 <code>click</code> 事件被命名为 <code>onClick</code>类似的其他事件都以<code>on</code>开头，事件默认都是在<code>冒泡阶段</code>被触发的。</p> <p>如需注册捕获阶段的事件处理函数，则应为事件名添加 <code>Capture</code>。例如，处理捕获阶段的点击事件请使用 <code>onClickCapture</code>，而不是 <code>onClick</code>。</p> <h2 id="为什么与怎么做？">为什么与怎么做？</h2> <p><strong>Q: 为什么React要自己实现一套事件系统？以及React的事件系统是怎么运作起来的？</strong></p> <h3 id="先来看几个简单的例子">先来看几个简单的例子:</h3> <p><strong>1. 运行下面的代码，输出ABCD的顺序是？如果在<code>innerClick</code>中把<code>e.stopPropagation()</code>加上，输出ABCD的顺序是？</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">innerClick</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A: react inner click.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// e.stopPropagation();</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">outerClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;B: react outer click.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;outer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;C: native outer click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;D: native window click&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;outer&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>outerClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;inner&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token constant">BUTTON</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * C: native outer click
 * A: react inner click.
 * B: react outer click.
 * D: native window click
 * 
 * 加上stopPropagation
 * 
 * C: native outer click
 * A: react inner click.
 * /
</span></code></pre></div><p><strong>2. 有一个<code>Modal(弹窗组件)</code>，我们需要在点击除弹窗内容意外的区域关闭弹窗，点击弹窗区域的话保留弹窗，但是实际点击弹窗也会被关闭?</strong></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            visible<span class="token operator">:</span> props<span class="token punctuation">.</span>visible
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClickBody<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClickBody<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function-variable function">handleClickBody</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'visible'</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click body'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            showBox<span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token function-variable function">handleClickButton</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            showBox<span class="token operator">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">clickModal</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click modal'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
        e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> showBox <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state 
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClickButton<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点我显示弹窗</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span>showBox <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                    <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clickModal<span class="token punctuation">}</span></span>
                <span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> 
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 只会输出 click body
 * 
 * /
</span></code></pre></div><p><strong>Q: 为什么<code>React</code>要实现自己的事件合成系统？</strong></p> <p><strong>A: 主要是为了<code>性能</code>和<code>复用</code>两个方面来考虑。</strong></p> <p><img src="https://img-blog.csdnimg.cn/20200218113910575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="React事件合成系统架构"></p> <ol><li><p>首先对于性能来说，<code>React</code>作为一套<code>View</code>层面的UI框架，通过渲染得到<code>vDOM</code>，再由<code>diff</code>算法决定<code>DOM</code>树哪些结点需要新增、替换或修改，假如直接在<code>DOM</code>结点插入原生事件监听，则会导致频繁的调用<code>addEventListener</code>和<code>removeEventListener</code>，造成性能的浪费。所以<code>React</code>采用了事件代理的方法，对于大部分事件而言都在<code>document</code>上做监听，然后根据<code>Event</code>中的<code>target</code>来判断事件触发的结点。</p></li> <li><p>其次<code>React</code>合成的<code>SyntheticEvent</code>采用了<code>池</code>的思想，从而达到节约内存，避免频繁的创建和销毁事件对象的目的。这也是如果我们需要异步使用一个<code>syntheticEvent</code>，需要执行<code>event.persist()</code>才能防止事件对象被释放的原因。</p></li> <li><p>最后在<code>React</code>源码中随处可见<code>batch</code>做批量更新，基本上凡是可以批量处理的事情（最普遍的setState）<code>React</code>都会将中间过程保存起来，留到最后面才<code>flush</code>掉。就如浏览器对<code>DOM</code>树进行<code>Style</code>，<code>Layout</code>，<code>Paint</code>一样，都不会在操作<code>ele.style.color='red'</code>;之后马上执行，只会将这些操作打包起来并最终在需要渲染的时候再做渲染。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span> 
ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">;</span>
ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span>
<span class="token comment">// 只会执行最后一次</span>
</code></pre></div><p>而对于复用来说，<code>React</code>看到在不同的浏览器和平台上，用户界面上的事件其实非常相似，例如普通的<code>click</code>，<code>change</code>等等。<code>React</code>希望通过封装一层事件系统，将不同平台的原生事件都封装成<code>SyntheticEvent</code>。这样做的好处主要有以下亮点:</p> <ol><li><p>使得不同平台只需要通过加入<code>EventEmitter</code>以及对应的<code>Renderer</code>就能使用相同的一个事件系统，<code>WEB</code>平台上加入<code>ReactBrowserEventEmitter</code>，<code>Native</code>上加入<code>ReactNativeEventEmitter</code>。如下图，对于不同平台，<code>React</code>只需要替换掉左边部分，而右边<code>EventPluginHub</code>部分可以保持复用。</p></li> <li><p>而对于不同的浏览器而言，<code>React</code>帮我们统一了事件，做了浏览器的兼容，例如对于<code>transitionEnd</code>,<code>webkitTransitionEnd</code>,<code>MozTransitionEnd</code>和<code>oTransitionEnd</code>, <code>React</code>都会集合成<code>topAnimationEnd</code>，所以我们只用处理这一个标准的事件即可。</p></li></ol> <p><img src="https://img-blog.csdnimg.cn/20200218115403227.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="React合成事件复用架构"></p> <p><strong>Q: <code>React</code>的事件系统是怎么运作起来的？</strong></p> <h3 id="事件绑定">事件绑定</h3> <p>我们来看一下我们在<code>JSX</code>中写的<code>onClickhandler</code>是怎么被记录到<code>DOM</code>结点上，并且在<code>document</code>上做监听的。</p> <p><img src="https://img-blog.csdnimg.cn/20200218115802914.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="React合成事件绑定架构"></p> <p><code>React</code>对于大部分事件的绑定都是使用<code>trapBubbledEvent</code>和<code>trapCapturedEvent</code>这两个函数来注册的。如上图所示，当我们执行了<code>render</code>或者<code>setState</code>之后，<code>React</code>的<code>Fiber调度系统</code>会在最后<code>commit</code>到<code>DOM</code>树之前执行<code>trapBubbledEvent</code>或<code>trapCapturedEvent</code>，通过执行<code>addEventListener</code>在<code>document</code>结点上绑定对应的<code>dispatch</code>作为handler负责监听类型为<code>topLevelType</code>的事件。</p> <p>这里面的<code>dispatchInteractiveEvent</code>和<code>dispatchEvent</code>两个回调函数的区别为，<code>React16</code>开始换掉了原本<code>Stack Reconciliation</code>成<code>Fiber</code>希望实现异步渲染，所以异步渲染的情况下假如入我点了两次按钮，那么第二次按钮响应的时候，可能第一次按钮的<code>handlerA</code>中调用的<code>setState</code>还未最终被<code>commit</code>到<code>DOM</code>树上，这时需要把第一次按钮的结果先给<code>flush</code>掉并<code>commit</code>到<code>DOM</code>树，才能够保持一致性。</p> <p>这个时候就会用到<code>dispatchInteractiveEvent</code>。可以理解成<code>dispatchInteractiveEvent</code>在执行前都会确保之前所有操作都已最终<code>commit</code>到<code>DOM</code>树，再开始自己的流程，并最终触发<code>dispatchEvent</code>。但由于目前<code>React</code>仍是同步渲染的，所以这两个函数在目前的表现是一致的，希望<code>React17</code>会带给我们默认打开的异步渲染功能。</p> <p>到现在我们已经在<code>document</code>结点上监听了事件了，现在需要来看如何将我们在<code>jsx</code>中写的<code>handler</code>存起来对应到相应的结点上。</p> <p>在我们每次新建或者更新结点时，<code>React</code>最终会调用<code>createInstance</code>或者<code>commitUpdate</code>这两个函数，而这两个函数都会最终调用<code>updateFiberProps</code>这个函数，将<code>props</code>也就是我们的<code>onClick</code>，<code>onChange</code>等<code>handler</code>给存到<code>DOM</code>结点上。</p> <p>至此，我们我们已经在<code>document</code>上监听了事件，并且将<code>handler</code>存在对应<code>DOM</code>结点。接下来需要看<code>React</code>怎么监听并处理浏览器的原生事件，最终触发对应的<code>handler</code>了。</p> <h3 id="事件触发">事件触发</h3> <p>我会大概用下图这种方式来解析代码，左边是我点击一个绑定了<code>handleClick</code>的按钮后的<code>js</code>调用栈，右边是每一步的代码，均已删除部分不影响理解的代码。希望通过这种方式能使大家更易理解<code>React</code>的事件触发机制。</p> <p><img src="https://img-blog.csdnimg.cn/2020021812205956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>当我们点击一个按钮时，<code>click</code>事件将会最终冒泡至<code>document</code>，并触发我们监听在<code>document</code>上的<code>handler dispatchEvent</code>，接着触发<code>batchedUpdates</code>。<code>batchedUpdates</code>这个格式的代码在<code>React</code>的源码里面会频繁的出现，基本上<code>React</code>将所有能够批量处理的事情都会先收集起来，再一次性处理。</p> <p>可以看到默认的<code>isBatching</code>是<code>false</code>的，当调用了一次<code>batchedUpdates</code>，<code>isBatching</code>的值将会变成<code>true</code>，此时如果在接下来的调用中有继续调用<code>batchedUpdates</code>的话，就会直接执行<code>handleTopLevel</code>,此时的<code>setState</code>等不会被更新到<code>DOM</code>上。直到调用栈重新回到第一次调用<code>batchedUpdates</code>的时候，才会将所有结果一起<code>flush</code>掉（更新到DOM上）。</p> <p><img src="https://img-blog.csdnimg.cn/20200218122855794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>有的同学可能问调用栈中的<code>BatchedUpdates$1</code>是什么？或者浏览器的<code>renderer</code>和Native的<code>renderer</code>是如何挂在到<code>React</code>的事件系统上的?</p> <p>其实<code>React</code>事件系统里面提供了一个函数<code>setBatchingImplementation</code>，用来动态挂载不同平台的<code>renderer</code>，这个也体现了<code>React事件系统</code>的<code>复用</code>。</p> <p><img src="https://img-blog.csdnimg.cn/20200218125958283.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p><code>handleTopLevel</code>会调用<code>runExtractedEventsInBatch()</code>，这是<code>React</code>事件处理最重要的函数。在<code>EventEmitter</code>里面做的事，其实主要就是这个函数的两步。</p> <ol><li>第一步是根据原生事件合成合成事件，并且在<code>vDOM</code>上模拟捕获冒泡，收集所有需要执行的事件回调构成回调数组。</li> <li>第二步是遍历回调数组，触发回调函数。</li></ol> <p><img src="https://img-blog.csdnimg.cn/20200218130213836.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>首先调用<code>extractEvents</code>，传入原生事件<code>e</code>，<code>React</code>事件系统根据可能的事件插件合成合成事件<code>Synthetic e</code>。 这里我们可以看到调用了<code>EventConstructor.getPooled()</code>，从事件池中去取一个合成事件对象，如果事件池为空，则新创建一个合成事件对象，这体现了<code>React</code>为了性能实现了<code>池</code>的思想。</p> <p><img src="https://img-blog.csdnimg.cn/20200218130347328.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>然后传入<code>Propagator</code>，在<code>vDOM</code>上模拟捕获和冒泡，并收集所有需要执行的事件回调和对应的结点。<code>traverseTwoPhase</code>模拟了捕获和冒泡的两个阶段，这里实现很巧妙，简单而言就是正向和反向遍历了一下数组。接着对每一个结点，调用<code>listenerAtPhase</code>取出事件绑定时挂载在结点上的回调函数，把它加入回调数组中。</p> <p><img src="https://img-blog.csdnimg.cn/20200218130557346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>接着遍历所有合成事件。这里可以看到当一个事件处理完的时候，<code>React</code>会调用<code>event.isPersistent()</code>来查看这个合成事件是否需要被持久化，如果不需要就会释放这个合成事件，这也就是为什么当我们需要异步读取操作一个合成事件的时候，需要执行<code>event.persist()</code>，不然React就是在这里释放掉这个事件。</p> <p><img src="https://img-blog.csdnimg.cn/20200218130734844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>最后这里就是回调函数被真正触发的时候了，取出回调数组<code>event._dispatchListeners</code>，遍历触发回调函数。并通过<code>event.isPropagationStopped()</code>这一步来模拟停止冒泡。这里我们可以看到，<code>React</code>在收集回调数组的时候并不会去管我们是否调用了<code>stopPropagation</code>，而是会在触发的阶段才会去检查是否需要停止冒泡。</p> <p>至此，一个事件回调函数就被触发了，里面如果执行了<code>setState</code>等就会等到调用栈弹回到最低部的<code>interactiveUpdate</code>中的被最终<code>flush</code>掉，构造<code>vDOM</code>，和好，并最终被<code>commit</code>到DOM上。</p> <p>这就是事件触发的整个过程了，可以再看一下<a href="https://www.lzane.com/tech/react-event-system-and-source-code/#%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91" target="_blank" rel="noopener noreferrer">React合成事件动画<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，相信你会更加理解这个过程的。</p> <p><strong>相信看到这里，如果你已经对React事件系统有所理解，现在回过头来让我们看看之前的两个例子。</strong></p> <p>例子一:</p> <ol><li><p>因为<code>React</code>事件监听是挂载在<code>document</code>上的，所以原生系统在<code>#outer</code>上监听的回调C会最先被输出；接着原生事件冒泡至<code>document</code>进入<code>React</code>事件系统，<code>React</code>事件系统模拟捕获冒泡输出A和B；最后<code>React</code>事件系统执行完毕回到浏览器继续冒泡到<code>window</code>，输出D。</p></li> <li><p>原生系统在<code>#outer上</code>监听的回调C会最先被执行；接着原生事件冒泡至<code>document</code>进入<code>React</code>事件系统，输出A，在<code>React</code>事件处理中<code>#inner</code>调用了<code>stopPropagation</code>，事件被停止冒泡。</p></li></ol> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>所以，最好不要混用<code>React事件系统</code>和<code>原生事件系统</code>，如果混用了，请保证你清楚知道会发生什么。</p></div> <p>例子二:</p> <p>我们将事件监听绑定在<code>document</code>对象上，并在点击弹窗和按钮的时候阻止事件冒泡。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            showBox<span class="token operator">:</span> props<span class="token punctuation">.</span>showBox
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClickBody<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClickBody<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function-variable function">handleClickBody</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'visible'</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click body'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            showBox<span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token function-variable function">handleClickButton</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// React中专属的阻止事件冒泡方法</span>
        e<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>showBox<span class="token punctuation">)</span> <span class="token keyword">return</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click button'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            showBox<span class="token operator">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">clickModal</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click modal'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> showBox <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state 
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClickButton<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点我显示弹窗</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span>showBox <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
                    <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clickModal<span class="token punctuation">}</span></span>
                <span class="token punctuation">/&gt;</span></span>
                <span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> 
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-06-04 12:10:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/react/portal.html" class="prev">
        Portal
      </a></span> <span class="next"><a href="/docs/react/optimization.html">
        性能优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.8bb7f38c.js" defer></script><script src="/docs/assets/js/2.346c741e.js" defer></script><script src="/docs/assets/js/162.d2a9c87b.js" defer></script>
  </body>
</html>
