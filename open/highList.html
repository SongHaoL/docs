<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何设计高性能的渲染列表 | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.6d5013a8.css" as="style"><link rel="preload" href="/docs/assets/js/app.6a02870d.js" as="script"><link rel="preload" href="/docs/assets/js/2.346c741e.js" as="script"><link rel="preload" href="/docs/assets/js/118.ad5de6e0.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.448efd45.js"><link rel="prefetch" href="/docs/assets/js/100.c327c202.js"><link rel="prefetch" href="/docs/assets/js/101.635e9668.js"><link rel="prefetch" href="/docs/assets/js/102.9e530f3f.js"><link rel="prefetch" href="/docs/assets/js/103.06a7f189.js"><link rel="prefetch" href="/docs/assets/js/104.30e30edf.js"><link rel="prefetch" href="/docs/assets/js/105.a238b9e0.js"><link rel="prefetch" href="/docs/assets/js/106.3d97010e.js"><link rel="prefetch" href="/docs/assets/js/107.82cab5ff.js"><link rel="prefetch" href="/docs/assets/js/108.7ef2033d.js"><link rel="prefetch" href="/docs/assets/js/109.927f1bce.js"><link rel="prefetch" href="/docs/assets/js/11.6b84f53c.js"><link rel="prefetch" href="/docs/assets/js/110.f0f3dc4b.js"><link rel="prefetch" href="/docs/assets/js/111.6a7698db.js"><link rel="prefetch" href="/docs/assets/js/112.ecfe781e.js"><link rel="prefetch" href="/docs/assets/js/113.f1ddb344.js"><link rel="prefetch" href="/docs/assets/js/114.716156f0.js"><link rel="prefetch" href="/docs/assets/js/115.d22d553d.js"><link rel="prefetch" href="/docs/assets/js/116.75ce401a.js"><link rel="prefetch" href="/docs/assets/js/117.27564d78.js"><link rel="prefetch" href="/docs/assets/js/119.322d71e1.js"><link rel="prefetch" href="/docs/assets/js/12.8bcafd6e.js"><link rel="prefetch" href="/docs/assets/js/120.db18bccc.js"><link rel="prefetch" href="/docs/assets/js/121.c36cd28e.js"><link rel="prefetch" href="/docs/assets/js/122.51a819cb.js"><link rel="prefetch" href="/docs/assets/js/123.b1612630.js"><link rel="prefetch" href="/docs/assets/js/124.b601a5c5.js"><link rel="prefetch" href="/docs/assets/js/125.50b53816.js"><link rel="prefetch" href="/docs/assets/js/126.7071ab69.js"><link rel="prefetch" href="/docs/assets/js/127.36b03b4d.js"><link rel="prefetch" href="/docs/assets/js/128.10b7e22a.js"><link rel="prefetch" href="/docs/assets/js/129.8eab4700.js"><link rel="prefetch" href="/docs/assets/js/13.4455f4e8.js"><link rel="prefetch" href="/docs/assets/js/130.6f42ca2d.js"><link rel="prefetch" href="/docs/assets/js/131.89fa4b7c.js"><link rel="prefetch" href="/docs/assets/js/132.46290b38.js"><link rel="prefetch" href="/docs/assets/js/133.802194c2.js"><link rel="prefetch" href="/docs/assets/js/134.1148dc34.js"><link rel="prefetch" href="/docs/assets/js/135.b6908b67.js"><link rel="prefetch" href="/docs/assets/js/136.aa0508ad.js"><link rel="prefetch" href="/docs/assets/js/137.3f0cea0a.js"><link rel="prefetch" href="/docs/assets/js/138.260c6449.js"><link rel="prefetch" href="/docs/assets/js/139.6ae4419d.js"><link rel="prefetch" href="/docs/assets/js/14.3b0be226.js"><link rel="prefetch" href="/docs/assets/js/140.c447665e.js"><link rel="prefetch" href="/docs/assets/js/141.fafc1da3.js"><link rel="prefetch" href="/docs/assets/js/142.79ee0952.js"><link rel="prefetch" href="/docs/assets/js/143.0877dab0.js"><link rel="prefetch" href="/docs/assets/js/144.137d2df8.js"><link rel="prefetch" href="/docs/assets/js/145.5c37112d.js"><link rel="prefetch" href="/docs/assets/js/146.d4f46cbc.js"><link rel="prefetch" href="/docs/assets/js/147.717eda6d.js"><link rel="prefetch" href="/docs/assets/js/148.e33293ed.js"><link rel="prefetch" href="/docs/assets/js/149.391693b3.js"><link rel="prefetch" href="/docs/assets/js/15.4b5d7343.js"><link rel="prefetch" href="/docs/assets/js/150.304f2063.js"><link rel="prefetch" href="/docs/assets/js/151.77cf7241.js"><link rel="prefetch" href="/docs/assets/js/152.dd31252d.js"><link rel="prefetch" href="/docs/assets/js/153.06280f03.js"><link rel="prefetch" href="/docs/assets/js/154.a28f7712.js"><link rel="prefetch" href="/docs/assets/js/155.378a9acf.js"><link rel="prefetch" href="/docs/assets/js/156.b3135cd0.js"><link rel="prefetch" href="/docs/assets/js/157.218db71c.js"><link rel="prefetch" href="/docs/assets/js/158.abf94421.js"><link rel="prefetch" href="/docs/assets/js/159.ccb43e64.js"><link rel="prefetch" href="/docs/assets/js/16.9d0963b3.js"><link rel="prefetch" href="/docs/assets/js/160.f50954de.js"><link rel="prefetch" href="/docs/assets/js/161.cb6960e8.js"><link rel="prefetch" href="/docs/assets/js/162.cffd1e16.js"><link rel="prefetch" href="/docs/assets/js/163.f13317e7.js"><link rel="prefetch" href="/docs/assets/js/164.e284bfa0.js"><link rel="prefetch" href="/docs/assets/js/165.25e184ee.js"><link rel="prefetch" href="/docs/assets/js/166.14d02d53.js"><link rel="prefetch" href="/docs/assets/js/167.462a8aa7.js"><link rel="prefetch" href="/docs/assets/js/168.06efb817.js"><link rel="prefetch" href="/docs/assets/js/169.b8926f94.js"><link rel="prefetch" href="/docs/assets/js/17.95b7e490.js"><link rel="prefetch" href="/docs/assets/js/170.bc7b715c.js"><link rel="prefetch" href="/docs/assets/js/171.4c00bdf5.js"><link rel="prefetch" href="/docs/assets/js/172.c5545cd4.js"><link rel="prefetch" href="/docs/assets/js/173.7fd02026.js"><link rel="prefetch" href="/docs/assets/js/174.691e161c.js"><link rel="prefetch" href="/docs/assets/js/175.87a39684.js"><link rel="prefetch" href="/docs/assets/js/176.5e220b26.js"><link rel="prefetch" href="/docs/assets/js/177.1ddf75a1.js"><link rel="prefetch" href="/docs/assets/js/178.9530f2e0.js"><link rel="prefetch" href="/docs/assets/js/179.0f54ee7c.js"><link rel="prefetch" href="/docs/assets/js/18.ca0afb77.js"><link rel="prefetch" href="/docs/assets/js/180.e43653a8.js"><link rel="prefetch" href="/docs/assets/js/181.becf2f96.js"><link rel="prefetch" href="/docs/assets/js/182.52647d96.js"><link rel="prefetch" href="/docs/assets/js/183.1cca3b08.js"><link rel="prefetch" href="/docs/assets/js/184.afaf2a8b.js"><link rel="prefetch" href="/docs/assets/js/185.c63fb14d.js"><link rel="prefetch" href="/docs/assets/js/186.902a8f71.js"><link rel="prefetch" href="/docs/assets/js/187.8a345ec1.js"><link rel="prefetch" href="/docs/assets/js/188.32ba31c0.js"><link rel="prefetch" href="/docs/assets/js/19.981481df.js"><link rel="prefetch" href="/docs/assets/js/20.6e80cd2d.js"><link rel="prefetch" href="/docs/assets/js/21.c0ec8375.js"><link rel="prefetch" href="/docs/assets/js/22.648850d3.js"><link rel="prefetch" href="/docs/assets/js/23.73ed5316.js"><link rel="prefetch" href="/docs/assets/js/24.768a95fb.js"><link rel="prefetch" href="/docs/assets/js/25.b460e9a9.js"><link rel="prefetch" href="/docs/assets/js/26.61c56597.js"><link rel="prefetch" href="/docs/assets/js/27.2bbfe116.js"><link rel="prefetch" href="/docs/assets/js/28.efc0814f.js"><link rel="prefetch" href="/docs/assets/js/29.8bebb742.js"><link rel="prefetch" href="/docs/assets/js/3.f0b9dcd8.js"><link rel="prefetch" href="/docs/assets/js/30.e6180f81.js"><link rel="prefetch" href="/docs/assets/js/31.791f6adb.js"><link rel="prefetch" href="/docs/assets/js/32.59f79bfb.js"><link rel="prefetch" href="/docs/assets/js/33.24072082.js"><link rel="prefetch" href="/docs/assets/js/34.9cc3face.js"><link rel="prefetch" href="/docs/assets/js/35.f5942d3c.js"><link rel="prefetch" href="/docs/assets/js/36.e95f5559.js"><link rel="prefetch" href="/docs/assets/js/37.12a8e708.js"><link rel="prefetch" href="/docs/assets/js/38.26144ebc.js"><link rel="prefetch" href="/docs/assets/js/39.354046d3.js"><link rel="prefetch" href="/docs/assets/js/4.0f806da2.js"><link rel="prefetch" href="/docs/assets/js/40.494e0bb7.js"><link rel="prefetch" href="/docs/assets/js/41.e2242735.js"><link rel="prefetch" href="/docs/assets/js/42.6990a813.js"><link rel="prefetch" href="/docs/assets/js/43.2d37f795.js"><link rel="prefetch" href="/docs/assets/js/44.30737457.js"><link rel="prefetch" href="/docs/assets/js/45.d89f2104.js"><link rel="prefetch" href="/docs/assets/js/46.ed073089.js"><link rel="prefetch" href="/docs/assets/js/47.2f75a0c5.js"><link rel="prefetch" href="/docs/assets/js/48.b1d6cb0c.js"><link rel="prefetch" href="/docs/assets/js/49.638e37b2.js"><link rel="prefetch" href="/docs/assets/js/5.7088cd54.js"><link rel="prefetch" href="/docs/assets/js/50.96a031bf.js"><link rel="prefetch" href="/docs/assets/js/51.1bd1f14a.js"><link rel="prefetch" href="/docs/assets/js/52.6d7e5d0f.js"><link rel="prefetch" href="/docs/assets/js/53.9caf58d4.js"><link rel="prefetch" href="/docs/assets/js/54.1db88b75.js"><link rel="prefetch" href="/docs/assets/js/55.546fcfab.js"><link rel="prefetch" href="/docs/assets/js/56.a421d945.js"><link rel="prefetch" href="/docs/assets/js/57.2cea9a50.js"><link rel="prefetch" href="/docs/assets/js/58.af062900.js"><link rel="prefetch" href="/docs/assets/js/59.6a65cfc9.js"><link rel="prefetch" href="/docs/assets/js/6.aa27b4b3.js"><link rel="prefetch" href="/docs/assets/js/60.c7ffc079.js"><link rel="prefetch" href="/docs/assets/js/61.3a1b902e.js"><link rel="prefetch" href="/docs/assets/js/62.0725f412.js"><link rel="prefetch" href="/docs/assets/js/63.b0b4fd8f.js"><link rel="prefetch" href="/docs/assets/js/64.5dcc02ba.js"><link rel="prefetch" href="/docs/assets/js/65.af4f86c4.js"><link rel="prefetch" href="/docs/assets/js/66.9c4962fa.js"><link rel="prefetch" href="/docs/assets/js/67.6312f2bc.js"><link rel="prefetch" href="/docs/assets/js/68.5ec30089.js"><link rel="prefetch" href="/docs/assets/js/69.fcbf7974.js"><link rel="prefetch" href="/docs/assets/js/7.6653ed24.js"><link rel="prefetch" href="/docs/assets/js/70.f83a2398.js"><link rel="prefetch" href="/docs/assets/js/71.14e9da8f.js"><link rel="prefetch" href="/docs/assets/js/72.757c563a.js"><link rel="prefetch" href="/docs/assets/js/73.d71681af.js"><link rel="prefetch" href="/docs/assets/js/74.a466d83c.js"><link rel="prefetch" href="/docs/assets/js/75.9c4faeee.js"><link rel="prefetch" href="/docs/assets/js/76.3b872cd2.js"><link rel="prefetch" href="/docs/assets/js/77.bd8626c1.js"><link rel="prefetch" href="/docs/assets/js/78.efef06b9.js"><link rel="prefetch" href="/docs/assets/js/79.15dc9107.js"><link rel="prefetch" href="/docs/assets/js/8.a8d55efb.js"><link rel="prefetch" href="/docs/assets/js/80.7745ff28.js"><link rel="prefetch" href="/docs/assets/js/81.603d5cae.js"><link rel="prefetch" href="/docs/assets/js/82.50ce1ebc.js"><link rel="prefetch" href="/docs/assets/js/83.9870def4.js"><link rel="prefetch" href="/docs/assets/js/84.4f058987.js"><link rel="prefetch" href="/docs/assets/js/85.9b68d2d1.js"><link rel="prefetch" href="/docs/assets/js/86.942247b2.js"><link rel="prefetch" href="/docs/assets/js/87.07f95823.js"><link rel="prefetch" href="/docs/assets/js/88.b5a3bb3a.js"><link rel="prefetch" href="/docs/assets/js/89.5e875e31.js"><link rel="prefetch" href="/docs/assets/js/9.7d808dd7.js"><link rel="prefetch" href="/docs/assets/js/90.c6ebb437.js"><link rel="prefetch" href="/docs/assets/js/91.c41a5d47.js"><link rel="prefetch" href="/docs/assets/js/92.72bc4b0a.js"><link rel="prefetch" href="/docs/assets/js/93.e74e2471.js"><link rel="prefetch" href="/docs/assets/js/94.32a13afc.js"><link rel="prefetch" href="/docs/assets/js/95.2de422d3.js"><link rel="prefetch" href="/docs/assets/js/96.ec06d22a.js"><link rel="prefetch" href="/docs/assets/js/97.d7aeca2c.js"><link rel="prefetch" href="/docs/assets/js/98.8e5739fa.js"><link rel="prefetch" href="/docs/assets/js/99.b521eaf9.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.6d5013a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/open/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/open/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/open/.html" class="nav-link">
  css tricks
</a></div><div class="nav-item"><a href="/docs/open/.html" class="nav-link">
  js tricks
</a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><a href="/docs/git/" class="sidebar-link">git相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>开放性问题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/open/font.html" class="sidebar-link">如何使用10号以下的字体大小？</a></li><li><a href="/docs/open/px.html" class="sidebar-link">如何绘制一条0.5px的线?</a></li><li><a href="/docs/open/module.html" class="sidebar-link">谈谈你对前端工程化的理解？</a></li><li><a href="/docs/open/rtv.html" class="sidebar-link">从React切换到Vue</a></li><li><a href="/docs/open/highList.html" class="active sidebar-link">如何设计高性能的渲染列表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/open/highList.html#为什么需要使用虚拟列表？" class="sidebar-link">为什么需要使用虚拟列表？</a></li><li class="sidebar-sub-header"><a href="/docs/open/highList.html#什么是虚拟列表？" class="sidebar-link">什么是虚拟列表？</a></li><li class="sidebar-sub-header"><a href="/docs/open/highList.html#实现虚拟列表" class="sidebar-link">实现虚拟列表</a></li></ul></li><li><a href="/docs/open/system.html" class="sidebar-link">进程、线程与协程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器插件扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何设计高性能的渲染列表">如何设计高性能的渲染列表</h1> <ul><li>2020.05.21</li></ul> <h2 id="为什么需要使用虚拟列表？">为什么需要使用虚拟列表？</h2> <p>假设我们的列表有10000条记录，我们同时将10000条记录渲染到页面中，先来看看需要花费多长时间：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useRef
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">const</span> <span class="token function-variable function">btnClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 记录任务开始时间</span>
        <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 插入一万条数据</span>
        <span class="token keyword">const</span> totalSize <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取容器</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> listRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
        <span class="token comment">// 将数据放入容器中</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalSize<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            li<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">我是列表项</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JS运行时间'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 24</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'总运行时间'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 327</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;page-container&quot;</span> <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>btnClick<span class="token punctuation">}</span><span class="token operator">&gt;</span> button <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ul ref<span class="token operator">=</span><span class="token punctuation">{</span>listRef<span class="token punctuation">}</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Example<span class="token punctuation">;</span>
</code></pre></div><p>当我们点击按钮的时候,会像<code>ul</code>追加<code>10000</code>个<code>li</code>元素,打开<code>Google</code>浏览器<code>performance</code>可以看到.</p> <p><img src="https://img-blog.csdnimg.cn/2020052118013627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="Performance"></p> <p>从上图可以看出代码总共执行了321ms,其中的主要时间消耗如下:</p> <ul><li><p><code>Event(click)</code> : 25.96ms</p></li> <li><p><code>Recalculate Style</code> : 49.19ms</p></li> <li><p><code>Layout</code> : 251.81ms</p></li> <li><p><code>Update Layer Tree</code> : 17.03ms</p></li> <li><p><code>Paint</code> : 2ms</p></li></ul> <p>从这里我们可以看出，我们的代码的执行过程中，消耗时间最多的两个阶段是 <code>RecalculateStyle</code>和 <code>Layout</code>。</p> <ul><li><p><code>RecalculateStyle</code>：样式计算，浏览器根据css选择器计算哪些元素应该应用哪些规则，确定每个元素具体的样式。</p></li> <li><p><code>Layout</code>：布局，知道元素应用哪些规则之后，浏览器开始计算它要占据的空间大小及其在屏幕的位置。</p></li></ul> <p>在实际的工作中，列表项必然不会像例子中仅仅只由一个li标签组成，必然是由复杂DOM节点组成的。</p> <p>那么可以想象的是，当列表项数过多并且列表项结构复杂的时候，同时渲染时，会在<code>RecalculateStyle</code>和 <code>Layout</code>阶段消耗大量的时间。</p> <p>而 <code>虚拟列表</code> 就是解决这一问题的一种实现。</p> <h2 id="什么是虚拟列表？">什么是虚拟列表？</h2> <blockquote><p><code>虚拟列表</code>其实是按需显示的一种实现，即只对<code>可见区域</code>进行渲染，对<code>非可见区域</code>中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。</p></blockquote> <p>假设有1万条记录需要同时渲染，我们屏幕的 可见区域的高度为 <code>400px</code>,而列表项的高度为 <code>50px</code>，则此时我们在屏幕中最多只能看到8个列表项，那么在首次渲染的时候，我们只需加载8条即可。</p> <p><img src="https://img-blog.csdnimg.cn/20200521190925940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="示例"></p> <p>说完首次加载，再分析一下当滚动发生时，我们可以通过计算当前滚动值得知此时在屏幕 可见区域应该显示的列表项。</p> <p>假设滚动发生，滚动条距顶部的位置为 <code>150px</code>,则我们可得知在 可见区域内的列表项为 第4项至`第11项。</p> <p><img src="https://img-blog.csdnimg.cn/20200521191426491.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="滚动示例"></p> <h2 id="实现虚拟列表">实现虚拟列表</h2> <blockquote><p>虚拟列表的实现，实际上就是在首屏加载的时候，只加载 可视区域内需要的列表项，当滚动发生时，动态通过计算获得 可视区域内的列表项，并将 非可视区域内存在的列表项删除。</p></blockquote> <ul><li>计算当前 可视区域起始数据索引( startIndex)</li> <li>计算当前 可视区域结束数据索引( endIndex)</li> <li>计算当前 可视区域的数据，并渲染到页面中</li> <li>计算 startIndex对应的数据在整个列表中的偏移位置 startOffset并设置到列表上</li></ul> <p>由于只是对 可视区域内的列表项进行渲染，所以为了保持列表容器的高度并可正常的触发滚动，将Html结构设计成如下结构：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>page-container<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list-phantom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- item-1 --&gt;</span>
            <span class="token comment">&lt;!-- item-2 --&gt;</span>
            <span class="token comment">&lt;!-- ... --&gt;</span>
            <span class="token comment">&lt;!-- item-n --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p><code>infinite-list-container</code> 为可视区域的容器</p></li> <li><p><code>infinite-list-phantom</code> 为容器内的占位，高度为总列表高度，用于形成滚动条</p></li> <li><p><code>infinite-list</code> 为列表项的渲染区域</p></li></ul> <p>接着，监听 <code>infinite-list-container</code>的 <code>scroll</code>事件，获取滚动位置 <code>scrollTop</code>。</p> <ul><li><p>假定 可视区域高度固定，称之为 <code>screenHeight</code></p></li> <li><p>假定 列表每项高度固定，称之为 <code>itemSize</code></p></li> <li><p>假定 列表数据称之为 <code>listData</code></p></li> <li><p>假定 当前滚动位置称之为 <code>scrollTop</code></p></li></ul> <p>则可推算出：</p> <ul><li><p>列表总高度 <code>listHeight = listData.length * itemSize</code></p></li> <li><p>可显示的列表项数 <code>visibleCount = Math.ceil(screenHeight / itemSize)</code></p></li> <li><p>数据的起始索引 <code>startIndex = Math.floor(scrollTop / itemSize)</code></p></li> <li><p>数据的结束索引 <code>endIndex = startIndex + visibleCount</code></p></li> <li><p>列表显示数据为 <code>visibleData = listData.slice(startIndex,endIndex)</code></p></li></ul> <p>当滚动后，由于 渲染区域相对于 可视区域已经发生了偏移，此时我需要获取一个偏移量 <code>startOffset</code>，通过样式控制将渲染区域偏移至可视区域中。</p> <blockquote><p>偏移量 <code>startOffset = scrollTop - (scrollTop % itemSize);</code></p></blockquote> <p>基于以上理论和考虑到实际情况列表高度不固定的情况下我们实现了一下的列表组件。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useLayoutEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">throttle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> timehold <span class="token operator">=</span> <span class="token number">450</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentTime <span class="token operator">-</span> startTime <span class="token operator">&gt;=</span> timehold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            startTime <span class="token operator">=</span> currentTime<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">VirtualList</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> listRefs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> listContainer <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> defaultHeight<span class="token punctuation">,</span> setDefaultHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> positions<span class="token punctuation">,</span> setPositions <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> listHeight<span class="token punctuation">,</span> setListheight <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// const [ visibleHeight, setVisibleHeight] = useState(0);</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> visibleNumber<span class="token punctuation">,</span> setVisibleNumber<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> transferOffset<span class="token punctuation">,</span> setTransferOffset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> visibleList<span class="token punctuation">,</span> setVisibleList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> startIndex<span class="token punctuation">,</span> setStartIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> endIndex<span class="token punctuation">,</span> setEndIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化参数</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token function-variable function">initPositions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> options <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
                index<span class="token punctuation">,</span>
                height<span class="token operator">:</span> defaultHeight<span class="token punctuation">,</span>
                top<span class="token operator">:</span> index <span class="token operator">*</span> defaultHeight<span class="token punctuation">,</span>
                bottom<span class="token operator">:</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> defaultHeight
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setPositions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">initPositions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">initPositions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>list<span class="token punctuation">,</span> defaultHeight<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 获取列表起始索引</span>
    <span class="token keyword">const</span> getStartIndex <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">top <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>positions<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>positions<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 二分法查找</span>
    <span class="token keyword">const</span> <span class="token function-variable function">binarySearch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> end <span class="token operator">=</span> list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> tempIndex <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;=</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> midIndex <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> midValue <span class="token operator">=</span> list<span class="token punctuation">[</span>midIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>midValue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> midIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>midValue <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            start <span class="token operator">=</span> midIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>midValue <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tempIndex <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> tempIndex <span class="token operator">&gt;</span> midIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              tempIndex <span class="token operator">=</span> midIndex<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            end <span class="token operator">=</span> end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> tempIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//获取列表项的当前尺寸</span>
    <span class="token keyword">const</span> updateItemsSize <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> nodes <span class="token operator">=</span> listRefs<span class="token punctuation">;</span>
        nodes <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> rect<span class="token punctuation">;</span>
          <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">+</span>node<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
          <span class="token keyword">let</span> oldHeight <span class="token operator">=</span> positions<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
          <span class="token keyword">let</span> dValue <span class="token operator">=</span> oldHeight <span class="token operator">-</span> height<span class="token punctuation">;</span>
          <span class="token comment">//存在差值</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>dValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            positions<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">=</span> positions<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">-</span> dValue<span class="token punctuation">;</span>
            positions<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> positions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                positions<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>top <span class="token operator">=</span> positions<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
                positions<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">=</span> positions<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">-</span> dValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">setPositions</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setDefaultHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>listRefs<span class="token punctuation">,</span> positions<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新偏移量</span>
    <span class="token keyword">const</span> setStartOffset <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> startOffset <span class="token operator">=</span> startIndex <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">?</span> positions<span class="token punctuation">[</span>startIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">setTransferOffset</span><span class="token punctuation">(</span>startOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>positions<span class="token punctuation">,</span> startIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 滚动监听</span>
    <span class="token keyword">const</span> listScroll <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> $ref <span class="token operator">=</span> listContainer<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
        <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> $ref<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
        <span class="token comment">// 此时开始的索引值</span>
        <span class="token function">setStartIndex</span><span class="token punctuation">(</span><span class="token function">getStartIndex</span><span class="token punctuation">(</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 此时结束的索引值</span>
        <span class="token function">setEndIndex</span><span class="token punctuation">(</span>startIndex <span class="token operator">+</span> visibleNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 列表偏移量</span>
        <span class="token function">setStartOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> $ref <span class="token operator">=</span> listContainer<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
        <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> $ref<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
        <span class="token keyword">const</span> clientHeight <span class="token operator">=</span> $ref<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token comment">// 正常的总列表高度</span>
        <span class="token keyword">const</span> height <span class="token operator">=</span> list<span class="token punctuation">.</span>length <span class="token operator">*</span> defaultHeight <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
        <span class="token comment">// setVisibleHeight(clientHeight);</span>
        <span class="token function">setListheight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可显示的列表数</span>
        <span class="token function">setVisibleNumber</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>clientHeight <span class="token operator">/</span> defaultHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 列表偏移量</span>
        <span class="token function">setTransferOffset</span><span class="token punctuation">(</span>scrollTop <span class="token operator">-</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">%</span> defaultHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 此时开始的索引值</span>
        <span class="token function">setStartIndex</span><span class="token punctuation">(</span><span class="token function">getStartIndex</span><span class="token punctuation">(</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 此时结束的索引值</span>
        <span class="token function">setEndIndex</span><span class="token punctuation">(</span>startIndex <span class="token operator">+</span> visibleNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可见的列表数据</span>
        <span class="token function">setVisibleList</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startIndex<span class="token punctuation">,</span> endIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>endIndex<span class="token punctuation">,</span> getStartIndex<span class="token punctuation">,</span> list<span class="token punctuation">,</span> startIndex<span class="token punctuation">,</span> visibleNumber<span class="token punctuation">,</span> defaultHeight<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待列表DOM更新</span>
    <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>listRefs <span class="token operator">||</span> listRefs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取真实元素大小，修改对应的尺寸缓存</span>
        <span class="token function">updateItemsSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// 更新列表总高度</span>
       <span class="token keyword">let</span> height <span class="token operator">=</span> positions<span class="token punctuation">[</span>positions<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
       <span class="token function">setListheight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// 更新真实偏移量</span>
       <span class="token function">setStartOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>listRefs<span class="token punctuation">,</span> positions<span class="token punctuation">,</span> setStartOffset<span class="token punctuation">,</span> updateItemsSize<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>listContainer<span class="token punctuation">}</span></span> <span class="token attr-name">onScroll</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>listScroll<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span><span class="token comment">/* 容器内的占位，高度为总列表高度，用于形成滚动条 */</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list-phantom<span class="token punctuation">&quot;</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> height<span class="token operator">:</span> listHeight<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> transform<span class="token operator">:</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transferOffset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span>
                visibleList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">n</span><span class="token operator">=&gt;</span>listRefs<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> n<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>infinite-list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是列表项</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>VirtualList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>CSS样式如下:</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.infinite-list-container</span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token property">-webkit-overflow-scrolling</span><span class="token punctuation">:</span> touch<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 60vh<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.infinite-list-phantom </span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.infinite-list </span><span class="token punctuation">{</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.infinite-list-item</span><span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token comment">// height: 50px;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #FFF<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
    <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #EEE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>内部Item组件的实现可以采用外部传入的方法,这里不做展开。</p> <p>Vue 版本的可以参考<a href="https://codesandbox.io/s/virtuallist2-1bqk6" target="_blank" rel="noopener noreferrer">原作者的地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-06-30 12:05:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/open/rtv.html" class="prev">
        从React切换到Vue
      </a></span> <span class="next"><a href="/docs/open/system.html">
        进程、线程与协程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.6a02870d.js" defer></script><script src="/docs/assets/js/2.346c741e.js" defer></script><script src="/docs/assets/js/118.ad5de6e0.js" defer></script>
  </body>
</html>
