(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{793:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"爬虫利器-puppeteer-实战"}},[t._v("爬虫利器 Puppeteer 实战")]),t._v(" "),a("ul",[a("li",[t._v("2020.06.28")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("Puppeteer")]),t._v("是一个"),a("code",[t._v("Node.js库")]),t._v(",用于操控浏览器的爬虫神器，支持调用Chrome的API来操纵Web，相比较"),a("code",[t._v("Selenium")]),t._v("或是"),a("code",[t._v("PhantomJs")]),t._v(",它最大的特点就是它的操作Dom可以完全在内存中进行模拟既在V8引擎中处理而不打开浏览器"),a("a",{attrs:{href:"https://github.com/puppeteer/puppeteer",target:"_blank",rel:"noopener noreferrer"}},[t._v("github地址"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"使用场景"}},[t._v("使用场景")]),t._v(" "),a("ul",[a("li",[t._v("对网页截屏生成PDF、图片等")]),t._v(" "),a("li",[t._v("爬取SPA应用，并生成预渲染内容（即“SSR” 服务端渲染）")]),t._v(" "),a("li",[t._v("可以从网站抓取内容")]),t._v(" "),a("li",[t._v("自动化表单提交、UI测试、键盘输入等")]),t._v(" "),a("li",[t._v("帮你创建一个最新的自动化测试环境（chrome），可以直接在此运行测试用例")]),t._v(" "),a("li",[t._v("捕获站点的时间线，以便追踪你的网站，帮助分析网站性能问题")]),t._v(" "),a("li",[t._v("测试Chrome的扩展程序")])]),t._v(" "),a("h2",{attrs:{id:"安装"}},[t._v("安装")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("npm i puppeteer\n# yarn add puppeteer\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("由于封网，直接下载 "),a("code",[t._v("Chromium")]),t._v(" 可能会失败，可以先阻止下载 "),a("code",[t._v("Chromium")]),t._v(" 然后再手动下载它.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("# 安装命令\nnpm i puppeteer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save\n\n# 错误信息\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ERROR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Failed to download Chromium r515411"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Set "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PUPPETEER_SKIP_CHROMIUM_DOWNLOAD"')]),t._v(" env variable to skip download"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n# 设置环境变量跳过下载 Chromium\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUPPETEER_SKIP_CHROMIUM_DOWNLOAD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n\n# 或者可以这样干，只下载模块而不build\nnpm i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save puppeteer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("ignore"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scripts\n\n# 成功安装模块\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" puppeteer@"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.2")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\nadded "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.77")]),t._v("s\n")])])])]),t._v(" "),a("p",[t._v("手动下载 "),a("code",[t._v("Chromium")]),t._v("，下载完后将压缩包解压，会有个 "),a("code",[t._v("Chromium.app")]),t._v("，将其放在自定义路径下，正常安装包后 "),a("code",[t._v("Chromium.app")]),t._v(" 会在 "),a("code",[t._v(".local-chromium中")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"使用-puppeteer进行屏幕截图"}},[t._v("使用 "),a("code",[t._v("Puppeteer")]),t._v("进行屏幕截图")]),t._v(" "),a("p",[t._v("相关知识点:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("puppeteer.launch")]),t._v(" 启动浏览器实例")]),t._v(" "),a("li",[a("code",[t._v("browser.newPage()")]),t._v(" 创建一个新页面")]),t._v(" "),a("li",[a("code",[t._v("page.goto")]),t._v(" 进入指定网页")]),t._v(" "),a("li",[a("code",[t._v("page.screenshot")]),t._v(" 进行截图")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" puppeteer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'puppeteer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" browser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("puppeteer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("launch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 若是手动下载的chromium需要指定chromium地址, 默认引用地址为 /项目目录/node_modules/puppeteer/.local-chromium/")]),t._v("\n    executablePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/Users/...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置超时时间")]),t._v("\n    timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果是访问https页面 此属性会忽略https错误")]),t._v("\n    ignoreHTTPSErrors"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开开发者工具, 当此值为true时, headless总为false")]),t._v("\n    devtools"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭headless模式, 不会打开浏览器")]),t._v("\n    headless"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" page "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("newPage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" page"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("goto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://www.baidu.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" page"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("screenshot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'baidu.png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// quality: 100, 只对jpg有效")]),t._v("\n    fullPage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定区域截图，clip和fullPage两者只能设置一个")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// clip: {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   x: 0,")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   y: 0,")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   width: 1000,")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   height: 40")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);