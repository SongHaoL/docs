<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从零开始开发一个Chrome插件 | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.1bcb2e49.css" as="style"><link rel="preload" href="/docs/assets/js/app.f71b4d6a.js" as="script"><link rel="preload" href="/docs/assets/js/2.01d5cf40.js" as="script"><link rel="preload" href="/docs/assets/js/47.22721c18.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.589bbc9e.js"><link rel="prefetch" href="/docs/assets/js/100.d3579e42.js"><link rel="prefetch" href="/docs/assets/js/101.0a1ff8f5.js"><link rel="prefetch" href="/docs/assets/js/102.712f45d8.js"><link rel="prefetch" href="/docs/assets/js/103.daa5f923.js"><link rel="prefetch" href="/docs/assets/js/104.0ccc8e6f.js"><link rel="prefetch" href="/docs/assets/js/105.cd78f98f.js"><link rel="prefetch" href="/docs/assets/js/106.65c19bc1.js"><link rel="prefetch" href="/docs/assets/js/107.61c1df98.js"><link rel="prefetch" href="/docs/assets/js/108.3c75b501.js"><link rel="prefetch" href="/docs/assets/js/109.568be989.js"><link rel="prefetch" href="/docs/assets/js/11.937238e2.js"><link rel="prefetch" href="/docs/assets/js/110.0a27206f.js"><link rel="prefetch" href="/docs/assets/js/111.0975dcaa.js"><link rel="prefetch" href="/docs/assets/js/112.b163519e.js"><link rel="prefetch" href="/docs/assets/js/113.1368f680.js"><link rel="prefetch" href="/docs/assets/js/114.218ef5bd.js"><link rel="prefetch" href="/docs/assets/js/115.c1fcc195.js"><link rel="prefetch" href="/docs/assets/js/116.4469098f.js"><link rel="prefetch" href="/docs/assets/js/117.ab3ea1b4.js"><link rel="prefetch" href="/docs/assets/js/118.81cde5a0.js"><link rel="prefetch" href="/docs/assets/js/119.a307119b.js"><link rel="prefetch" href="/docs/assets/js/12.93c20f16.js"><link rel="prefetch" href="/docs/assets/js/120.4a998e5b.js"><link rel="prefetch" href="/docs/assets/js/121.589f06bb.js"><link rel="prefetch" href="/docs/assets/js/122.4d7239ef.js"><link rel="prefetch" href="/docs/assets/js/123.50217a2a.js"><link rel="prefetch" href="/docs/assets/js/124.dbc14887.js"><link rel="prefetch" href="/docs/assets/js/125.b408f9ea.js"><link rel="prefetch" href="/docs/assets/js/126.a5a769d9.js"><link rel="prefetch" href="/docs/assets/js/127.f55723ab.js"><link rel="prefetch" href="/docs/assets/js/128.f0ef0b52.js"><link rel="prefetch" href="/docs/assets/js/129.79e2b71c.js"><link rel="prefetch" href="/docs/assets/js/13.42abf24d.js"><link rel="prefetch" href="/docs/assets/js/130.641ad7d9.js"><link rel="prefetch" href="/docs/assets/js/131.98ada8a2.js"><link rel="prefetch" href="/docs/assets/js/132.9c8d7033.js"><link rel="prefetch" href="/docs/assets/js/133.e563afb5.js"><link rel="prefetch" href="/docs/assets/js/134.02fa45ee.js"><link rel="prefetch" href="/docs/assets/js/135.303563ee.js"><link rel="prefetch" href="/docs/assets/js/136.e1b13c76.js"><link rel="prefetch" href="/docs/assets/js/137.4f6afe2e.js"><link rel="prefetch" href="/docs/assets/js/138.d4f4c9a7.js"><link rel="prefetch" href="/docs/assets/js/139.f81c45e7.js"><link rel="prefetch" href="/docs/assets/js/14.3ca01e7c.js"><link rel="prefetch" href="/docs/assets/js/140.f3fba051.js"><link rel="prefetch" href="/docs/assets/js/141.2dde3e3f.js"><link rel="prefetch" href="/docs/assets/js/142.4eb9fec8.js"><link rel="prefetch" href="/docs/assets/js/143.55dc373e.js"><link rel="prefetch" href="/docs/assets/js/144.37509786.js"><link rel="prefetch" href="/docs/assets/js/145.6fed30c5.js"><link rel="prefetch" href="/docs/assets/js/146.3a1f66d4.js"><link rel="prefetch" href="/docs/assets/js/147.2bb6b76a.js"><link rel="prefetch" href="/docs/assets/js/148.880299f3.js"><link rel="prefetch" href="/docs/assets/js/149.d42098b5.js"><link rel="prefetch" href="/docs/assets/js/15.7df95322.js"><link rel="prefetch" href="/docs/assets/js/150.3b3c4f73.js"><link rel="prefetch" href="/docs/assets/js/151.75f185d9.js"><link rel="prefetch" href="/docs/assets/js/152.428cc388.js"><link rel="prefetch" href="/docs/assets/js/153.a93bd298.js"><link rel="prefetch" href="/docs/assets/js/154.dda52fbd.js"><link rel="prefetch" href="/docs/assets/js/155.f4c7fff3.js"><link rel="prefetch" href="/docs/assets/js/156.0f6c04c6.js"><link rel="prefetch" href="/docs/assets/js/157.f0641399.js"><link rel="prefetch" href="/docs/assets/js/158.772874da.js"><link rel="prefetch" href="/docs/assets/js/159.e47e917c.js"><link rel="prefetch" href="/docs/assets/js/16.035cd679.js"><link rel="prefetch" href="/docs/assets/js/160.06b5798d.js"><link rel="prefetch" href="/docs/assets/js/161.9181007d.js"><link rel="prefetch" href="/docs/assets/js/162.cec7fa0b.js"><link rel="prefetch" href="/docs/assets/js/163.4ac4dad7.js"><link rel="prefetch" href="/docs/assets/js/164.c8641865.js"><link rel="prefetch" href="/docs/assets/js/165.4f697283.js"><link rel="prefetch" href="/docs/assets/js/166.61a94ddc.js"><link rel="prefetch" href="/docs/assets/js/167.35baaf69.js"><link rel="prefetch" href="/docs/assets/js/168.3aab3e68.js"><link rel="prefetch" href="/docs/assets/js/169.f5b7500b.js"><link rel="prefetch" href="/docs/assets/js/17.4de747af.js"><link rel="prefetch" href="/docs/assets/js/170.2224a5c9.js"><link rel="prefetch" href="/docs/assets/js/171.708e4919.js"><link rel="prefetch" href="/docs/assets/js/172.a21ba2d2.js"><link rel="prefetch" href="/docs/assets/js/173.824e70cc.js"><link rel="prefetch" href="/docs/assets/js/174.abbec6aa.js"><link rel="prefetch" href="/docs/assets/js/175.adedaf39.js"><link rel="prefetch" href="/docs/assets/js/176.372e3d64.js"><link rel="prefetch" href="/docs/assets/js/177.747a2ebe.js"><link rel="prefetch" href="/docs/assets/js/178.5322780e.js"><link rel="prefetch" href="/docs/assets/js/179.20bb0e8c.js"><link rel="prefetch" href="/docs/assets/js/18.98626982.js"><link rel="prefetch" href="/docs/assets/js/180.cbd8c7ea.js"><link rel="prefetch" href="/docs/assets/js/181.cd91bf71.js"><link rel="prefetch" href="/docs/assets/js/182.13c80338.js"><link rel="prefetch" href="/docs/assets/js/183.11c1cd14.js"><link rel="prefetch" href="/docs/assets/js/184.46047aba.js"><link rel="prefetch" href="/docs/assets/js/185.1f977941.js"><link rel="prefetch" href="/docs/assets/js/186.4fafcbbe.js"><link rel="prefetch" href="/docs/assets/js/187.7ee67971.js"><link rel="prefetch" href="/docs/assets/js/188.33ae9e8a.js"><link rel="prefetch" href="/docs/assets/js/189.98a0b9af.js"><link rel="prefetch" href="/docs/assets/js/19.9d610c8e.js"><link rel="prefetch" href="/docs/assets/js/190.856aae71.js"><link rel="prefetch" href="/docs/assets/js/191.a68fa6cc.js"><link rel="prefetch" href="/docs/assets/js/192.0a20b17c.js"><link rel="prefetch" href="/docs/assets/js/193.5c63f468.js"><link rel="prefetch" href="/docs/assets/js/194.6b8a9669.js"><link rel="prefetch" href="/docs/assets/js/195.861d0914.js"><link rel="prefetch" href="/docs/assets/js/196.dafadffc.js"><link rel="prefetch" href="/docs/assets/js/197.9a860594.js"><link rel="prefetch" href="/docs/assets/js/198.fda6f886.js"><link rel="prefetch" href="/docs/assets/js/199.a05e1878.js"><link rel="prefetch" href="/docs/assets/js/20.1ee37f28.js"><link rel="prefetch" href="/docs/assets/js/200.3668a53d.js"><link rel="prefetch" href="/docs/assets/js/201.95ca3ce7.js"><link rel="prefetch" href="/docs/assets/js/202.5c2cddd1.js"><link rel="prefetch" href="/docs/assets/js/203.0b3d4b57.js"><link rel="prefetch" href="/docs/assets/js/204.bab556ea.js"><link rel="prefetch" href="/docs/assets/js/205.721ea125.js"><link rel="prefetch" href="/docs/assets/js/206.d05853be.js"><link rel="prefetch" href="/docs/assets/js/207.81c5b159.js"><link rel="prefetch" href="/docs/assets/js/208.b98520c2.js"><link rel="prefetch" href="/docs/assets/js/209.a9af146a.js"><link rel="prefetch" href="/docs/assets/js/21.f56a40f3.js"><link rel="prefetch" href="/docs/assets/js/210.e6a84bb4.js"><link rel="prefetch" href="/docs/assets/js/211.f73b43b7.js"><link rel="prefetch" href="/docs/assets/js/212.537954d1.js"><link rel="prefetch" href="/docs/assets/js/22.5494cfd1.js"><link rel="prefetch" href="/docs/assets/js/23.2798be18.js"><link rel="prefetch" href="/docs/assets/js/24.6958bf72.js"><link rel="prefetch" href="/docs/assets/js/25.9de5b22f.js"><link rel="prefetch" href="/docs/assets/js/26.dd71183d.js"><link rel="prefetch" href="/docs/assets/js/27.04f6dad3.js"><link rel="prefetch" href="/docs/assets/js/28.01736cd9.js"><link rel="prefetch" href="/docs/assets/js/29.ca4ec983.js"><link rel="prefetch" href="/docs/assets/js/3.b109a1dc.js"><link rel="prefetch" href="/docs/assets/js/30.a2307dd0.js"><link rel="prefetch" href="/docs/assets/js/31.27fd7395.js"><link rel="prefetch" href="/docs/assets/js/32.ead80593.js"><link rel="prefetch" href="/docs/assets/js/33.c91d56c8.js"><link rel="prefetch" href="/docs/assets/js/34.9894ccaa.js"><link rel="prefetch" href="/docs/assets/js/35.f77e30d5.js"><link rel="prefetch" href="/docs/assets/js/36.90f0f710.js"><link rel="prefetch" href="/docs/assets/js/37.ec756b69.js"><link rel="prefetch" href="/docs/assets/js/38.80052982.js"><link rel="prefetch" href="/docs/assets/js/39.bc3654c9.js"><link rel="prefetch" href="/docs/assets/js/4.1b648871.js"><link rel="prefetch" href="/docs/assets/js/40.8459c406.js"><link rel="prefetch" href="/docs/assets/js/41.90b7f66b.js"><link rel="prefetch" href="/docs/assets/js/42.a6a1273d.js"><link rel="prefetch" href="/docs/assets/js/43.d35660fe.js"><link rel="prefetch" href="/docs/assets/js/44.0a184009.js"><link rel="prefetch" href="/docs/assets/js/45.78961d05.js"><link rel="prefetch" href="/docs/assets/js/46.cb1a4655.js"><link rel="prefetch" href="/docs/assets/js/48.6b4d6a1a.js"><link rel="prefetch" href="/docs/assets/js/49.e89bb03d.js"><link rel="prefetch" href="/docs/assets/js/5.6a7e0113.js"><link rel="prefetch" href="/docs/assets/js/50.21b17a0e.js"><link rel="prefetch" href="/docs/assets/js/51.5c6cd28a.js"><link rel="prefetch" href="/docs/assets/js/52.4be20dda.js"><link rel="prefetch" href="/docs/assets/js/53.518bb8f4.js"><link rel="prefetch" href="/docs/assets/js/54.e27cf7d1.js"><link rel="prefetch" href="/docs/assets/js/55.86378938.js"><link rel="prefetch" href="/docs/assets/js/56.eb12689c.js"><link rel="prefetch" href="/docs/assets/js/57.f754e440.js"><link rel="prefetch" href="/docs/assets/js/58.e459d99d.js"><link rel="prefetch" href="/docs/assets/js/59.f6232e6e.js"><link rel="prefetch" href="/docs/assets/js/6.c2e2ba0d.js"><link rel="prefetch" href="/docs/assets/js/60.27e94571.js"><link rel="prefetch" href="/docs/assets/js/61.b12d0e57.js"><link rel="prefetch" href="/docs/assets/js/62.14a320a4.js"><link rel="prefetch" href="/docs/assets/js/63.c587724b.js"><link rel="prefetch" href="/docs/assets/js/64.b321370e.js"><link rel="prefetch" href="/docs/assets/js/65.9f4159f3.js"><link rel="prefetch" href="/docs/assets/js/66.79354d2d.js"><link rel="prefetch" href="/docs/assets/js/67.4e84271e.js"><link rel="prefetch" href="/docs/assets/js/68.312df481.js"><link rel="prefetch" href="/docs/assets/js/69.a1012ffe.js"><link rel="prefetch" href="/docs/assets/js/7.93284524.js"><link rel="prefetch" href="/docs/assets/js/70.26c8fad8.js"><link rel="prefetch" href="/docs/assets/js/71.c106abff.js"><link rel="prefetch" href="/docs/assets/js/72.63864943.js"><link rel="prefetch" href="/docs/assets/js/73.32a43e98.js"><link rel="prefetch" href="/docs/assets/js/74.6803d9e6.js"><link rel="prefetch" href="/docs/assets/js/75.699dff66.js"><link rel="prefetch" href="/docs/assets/js/76.7a24edb4.js"><link rel="prefetch" href="/docs/assets/js/77.33c45b83.js"><link rel="prefetch" href="/docs/assets/js/78.8dc26383.js"><link rel="prefetch" href="/docs/assets/js/79.060f50f8.js"><link rel="prefetch" href="/docs/assets/js/8.3f5d3b92.js"><link rel="prefetch" href="/docs/assets/js/80.aee1c57a.js"><link rel="prefetch" href="/docs/assets/js/81.083d93c6.js"><link rel="prefetch" href="/docs/assets/js/82.2f428e23.js"><link rel="prefetch" href="/docs/assets/js/83.4d822908.js"><link rel="prefetch" href="/docs/assets/js/84.d7dfddad.js"><link rel="prefetch" href="/docs/assets/js/85.b2a7b7b1.js"><link rel="prefetch" href="/docs/assets/js/86.3d6d2174.js"><link rel="prefetch" href="/docs/assets/js/87.4b839c9e.js"><link rel="prefetch" href="/docs/assets/js/88.b3a9a875.js"><link rel="prefetch" href="/docs/assets/js/89.08fa64a6.js"><link rel="prefetch" href="/docs/assets/js/9.e84efa80.js"><link rel="prefetch" href="/docs/assets/js/90.63cd1050.js"><link rel="prefetch" href="/docs/assets/js/91.b9f6d600.js"><link rel="prefetch" href="/docs/assets/js/92.fbdf86a2.js"><link rel="prefetch" href="/docs/assets/js/93.1c95e421.js"><link rel="prefetch" href="/docs/assets/js/94.26e4fdc2.js"><link rel="prefetch" href="/docs/assets/js/95.76e9550e.js"><link rel="prefetch" href="/docs/assets/js/96.ea71eccb.js"><link rel="prefetch" href="/docs/assets/js/97.e91ab86c.js"><link rel="prefetch" href="/docs/assets/js/98.8d311128.js"><link rel="prefetch" href="/docs/assets/js/99.33973657.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.1bcb2e49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://xjl271314.github.io/css_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  css tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://xjl271314.github.io/js_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  js tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://xjl271314.github.io/css_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  css tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://xjl271314.github.io/js_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  js tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器相关知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/browser/extension.html" class="active sidebar-link">从零开始开发一个Chrome插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#什么是chrome插件" class="sidebar-link">什么是Chrome插件</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#为什么需要去开发插件" class="sidebar-link">为什么需要去开发插件</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#开发与调试" class="sidebar-link">开发与调试</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#核心概念" class="sidebar-link">核心概念</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#chrome插件的8种展示形式" class="sidebar-link">Chrome插件的8种展示形式</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#_5种类型的js对比" class="sidebar-link">5种类型的JS对比</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#消息通信" class="sidebar-link">消息通信</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#长连接和短连接" class="sidebar-link">长连接和短连接</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#动态注入或执行js" class="sidebar-link">动态注入或执行JS</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#动态注入css" class="sidebar-link">动态注入CSS</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#获取当前窗口id" class="sidebar-link">获取当前窗口ID</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#获取当前标签页id" class="sidebar-link">获取当前标签页ID</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#本地存储" class="sidebar-link">本地存储</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#国际化" class="sidebar-link">国际化</a></li><li class="sidebar-sub-header"><a href="/docs/browser/extension.html#打包与发布" class="sidebar-link">打包与发布</a></li></ul></li><li><a href="/docs/browser/knowledge.html" class="sidebar-link">浏览器工作原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>即时通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信开发相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件推荐</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从零开始开发一个chrome插件">从零开始开发一个Chrome插件</h1> <ul><li>2020-04-02</li></ul> <h2 id="什么是chrome插件">什么是Chrome插件</h2> <blockquote><p>Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件，它其实就是一个由HTML、CSS、JS、图片等资源组成的一个.crx后缀的压缩包.</p></blockquote> <p>严格来讲，我们正在说的东西应该叫<code>Chrome扩展(Chrome Extension)</code>，真正意义上的<code>Chrome插件</code>是更底层的浏览器功能扩展，可能需要对浏览器源码有一定掌握才有能力去开发。</p> <h2 id="为什么需要去开发插件">为什么需要去开发插件</h2> <p>虽然chrome本身已经给我们提供了很多实用的API,但是特定场景下我们可能还需要一些自己常用的定制化浏览器功能，如果能够掌握开发插件的能力，那是再好不过了。</p> <h2 id="开发与调试">开发与调试</h2> <p><code>Chrome插件</code>没有严格的项目结构要求，只要保证本目录有一个<code>manifest.json</code>即可。</p> <h3 id="访问">访问:</h3> <p>从右上角菜单-&gt;更多工具-&gt;扩展程序可以进入 插件管理页面，也可以直接在地址栏输入 <code>chrome://extensions</code> 访问。</p> <p><img src="https://img-blog.csdnimg.cn/20200403133700704.png" alt="开发者模式"></p> <p>勾选开发者模式即可以文件夹的形式直接加载插件，否则只能安装<code>.crx</code>格式的文件。<code>Chrome</code>要求插件必须从它的<code>Chrome应用商店</code>安装，其它任何网站下载的都无法直接安装，所以，其实我们可以把<code>crx</code>文件解压，然后通过<code>开发者模式</code>直接加载。</p> <h2 id="核心概念">核心概念</h2> <h3 id="manifest-json">manifest.json</h3> <blockquote><p>这是一个Chrome插件最重要也是必不可少的文件，用来配置所有和插件相关的配置，必须放在根目录。</p></blockquote> <p>其中，<code>manifest_version</code>、<code>name</code>、<code>version</code>3个是必不可少的，<code>description</code>和<code>icons</code>是推荐的。完整的地址可以查看<a href="https://developer.chrome.com/extensions/manifest" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">/* ----必须要有的参数(开始)-----*/</span>
	<span class="token comment">// 清单文件的版本，这个必须写，而且必须是2</span>
	<span class="token string">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
	<span class="token comment">// 插件的名称</span>
	<span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;extensionName&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 插件的版本</span>
    <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">/* ----可选的参数(开始)-----*/</span>
	<span class="token comment">// 插件描述</span>
	<span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;extension description&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span>
	<span class="token string">&quot;icons&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 会一直常驻的后台JS或后台页面</span>
	<span class="token string">&quot;background&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span>
		<span class="token string">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.html&quot;</span>
		<span class="token comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span>
	<span class="token string">&quot;browser_action&quot;</span><span class="token operator">:</span> 
	<span class="token punctuation">{</span>
		<span class="token string">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
		<span class="token comment">// 图标悬停时的标题，可选</span>
		<span class="token string">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这是一个示例Chrome插件&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 当某些特定页面打开才显示的图标</span>
	<span class="token string">&quot;page_action&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;我是pageAction&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 需要直接注入页面的JS</span>
	<span class="token string">&quot;content_scripts&quot;</span><span class="token operator">:</span> 
	<span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span>
			<span class="token comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span>
			<span class="token string">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token comment">// 多个JS按顺序注入</span>
			<span class="token string">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/jquery-1.8.3.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;js/content-script.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span>
			<span class="token string">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;css/custom.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span>
			<span class="token string">&quot;run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;document_start&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// 这里仅仅是为了演示content-script可以配置多个规则</span>
		<span class="token punctuation">{</span>
			<span class="token string">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*://*/*.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*://*/*.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*://*/*.gif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*://*/*.bmp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token string">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/show-image-content-size.js&quot;</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token comment">// 权限申请</span>
	<span class="token string">&quot;permissions&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">[</span>
		<span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 右键菜单</span>
		<span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 标签</span>
		<span class="token string">&quot;notifications&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 通知</span>
		<span class="token string">&quot;webRequest&quot;</span><span class="token punctuation">,</span> <span class="token comment">// web请求</span>
		<span class="token string">&quot;webRequestBlocking&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 插件本地存储</span>
		<span class="token string">&quot;http://*/*&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可以通过executeScript或者insertCSS访问的网站</span>
		<span class="token string">&quot;https://*/*&quot;</span> <span class="token comment">// 可以通过executeScript或者insertCSS访问的网站</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span>
	<span class="token string">&quot;web_accessible_resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/inject.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span>
	<span class="token string">&quot;homepage_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://www.baidu.com&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 覆盖浏览器默认页面</span>
	<span class="token string">&quot;chrome_url_overrides&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token comment">// 覆盖浏览器默认的新标签页</span>
		<span class="token string">&quot;newtab&quot;</span><span class="token operator">:</span> <span class="token string">&quot;newtab.html&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// Chrome40以前的插件配置页写法</span>
	<span class="token string">&quot;options_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span>
	<span class="token string">&quot;options_ui&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span>
		<span class="token comment">// 添加一些默认的样式，推荐使用</span>
		<span class="token string">&quot;chrome_style&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span>
	<span class="token string">&quot;omnibox&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;keyword&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;go&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 默认语言</span>
	<span class="token string">&quot;default_locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh_CN&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span>
	<span class="token string">&quot;devtools_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;devtools.html&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="content-scripts">content-scripts</h3> <blockquote><p><code>content-scripts</code>，其实就是<code>Chrome插件</code>中向页面注入脚本的一种形式（虽然名为<code>script</code>，其实还可以包括<code>css</code>的），借助<code>content-scripts</code>我们可以实现通过配置的方式轻松向指定页面注入<code>JS</code>和<code>CSS</code>（如果需要动态注入，可以参考下文），最常见的比如：广告屏蔽、页面CSS定制，等等。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token comment">// 需要直接注入页面的JS</span>
	<span class="token string">&quot;content_scripts&quot;</span><span class="token operator">:</span> 
	<span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span>
			<span class="token comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span>
			<span class="token string">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token comment">// 多个JS按顺序注入</span>
			<span class="token string">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/jquery-1.8.3.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;js/content-script.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span>
			<span class="token string">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;css/custom.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span>
			<span class="token string">&quot;run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;document_start&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>特别注意，如果没有主动指定<code>run_at</code>为<code>document_start</code>（默认为<code>document_idle</code>），下面这种代码是不会生效的：</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我被执行了！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <p><code>content-scripts</code>和原始页面共享<code>DOM</code>，但是不共享<code>JS</code>，如要访问页面<code>JS</code>（例如某个JS变量），只能通过<code>injected js</code>来实现。</p> <p><strong><code>content-scripts</code>不能访问绝大部分<code>chrome.xxx.api</code>，除了下面这4种：</strong></p> <ol><li><p>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</p></li> <li><p>chrome.i18n</p></li> <li><p>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</p></li> <li><p>chrome.storage</p></li></ol> <p>其实看到这里不要悲观，这些API绝大部分时候都够用了，非要调用其它API的话，你还可以通过通信来实现让<code>background</code>来帮你调用。</p> <h3 id="background">background</h3> <blockquote><p>一个隐藏的后台控制中心,它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在<code>background</code>里面。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>background</code>的权限非常高，几乎可以调用所有的<code>Chrome扩展API</code>（除了devtools），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置CORS。</p> <p>经过测试，其实不止是<code>background</code>，所有的直接通过<code>chrome-extension://id/xx.html</code>这种方式打开的网页都可以无限制跨域。</p></div> <p>配置中，<code>background</code>可以通过<code>page</code>指定一张网页，也可以通过<code>scripts</code>直接指定一个<code>JS</code>，<code>Chrome</code>会自动为这个<code>JS</code>生成一个默认的网页：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token comment">// 会一直常驻的后台JS或后台页面</span>
	<span class="token string">&quot;background&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span>
		<span class="token string">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.html&quot;</span>
		<span class="token comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>虽然你可以通过<code>chrome-extension://xxx/background.html</code>直接打开后台页，但是你打开的后台页和真正一直在后台运行的那个页面不是同一个，换句话说，你可以打开无数个<code>background.html</code>，但是真正在后台常驻的只有一个，而且这个你永远看不到它的界面，只能调试它的代码。</p></div> <h3 id="event-pages">event-pages</h3> <blockquote><p><code>event-pages</code>是一个什么东西呢？鉴于<code>background</code>生命周期太长，长时间挂载后台可能会影响性能，所以<code>Google</code>又弄一个<code>event-pages</code>，在配置文件上，它与<code>background</code>的唯一区别就是多了一个<code>persistent</code>参数：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token string">&quot;background&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;event-page.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token string">&quot;persistent&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有<code>content-script</code>向它发送消息，等等。</p> <p>除了配置文件的变化，代码上也有一些细微变化，个人这个简单了解一下就行了，一般情况下<code>background</code>也不会很消耗性能的。</p> <h3 id="popup">popup</h3> <blockquote><p><code>popup</code>是点击<code>browser_action</code>或者<code>page_action</code>图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p></blockquote> <p><code>popup</code>可以包含任意你想要的HTML内容，并且会自适应大小。可以通<code>default_popup</code>字段来指定<code>popup</code>页面，也可以调用<code>setPopup()</code>方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token string">&quot;browser_action&quot;</span><span class="token operator">:</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
		<span class="token comment">// 图标悬停时的标题，可选</span>
		<span class="token string">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这是一个示例Chrome插件&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>需要特别注意的是，由于单击图标打开<code>popup</code>，焦点离开又立即关闭，所以popup页面的生命周期一般很短，需要长时间运行的代码千万不要写在popup里面。</p> <p>在权限上，它和<code>background</code>非常类似，它们之间最大的不同是生命周期的不同，<code>popup</code>中可以直接通过<code>chrome.extension.getBackgroundPage()</code>获取<code>background</code>的window对象。</p></div> <h3 id="injected-script">injected-script</h3> <blockquote><p>使用<code>content-script</code>有一个很大的“缺陷”，也就是无法访问页面中的JS，虽然它可以操作<code>DOM</code>，但是<code>DOM</code>却不能调用它，也就是无法在<code>DOM</code>中通过绑定事件的方式调用<code>content-script</code>中的代码（包括直接写<code>onclick</code>和<code>addEventListener</code>2种方式都不行），但是，“在页面上添加一个按钮并调用插件的扩展API”是一个很常见的需求，那该怎么办呢？其实这就是本小节要讲的。</p></blockquote> <p>在<code>content-script</code>中通过<code>DOM</code>方式向页面注入<code>inject-script</code>代码示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 向页面注入JS</span>
<span class="token keyword">function</span> <span class="token function">injectCustomJs</span><span class="token punctuation">(</span><span class="token parameter">jsPath</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	jsPath <span class="token operator">=</span> jsPath <span class="token operator">||</span> <span class="token string">'js/inject.js'</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> temp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	temp<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'text/javascript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span>
	temp<span class="token punctuation">.</span>src <span class="token operator">=</span> chrome<span class="token punctuation">.</span>extension<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
	temp<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 放在页面不好看，执行完后移除掉</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你以为这样就行了？执行一下你会看到如下报错：</p> <div class="language-js extra-class"><pre class="language-js"><code>Denying load <span class="token keyword">of</span> chrome<span class="token operator">-</span>extension<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>efbllncjkjiijkppagepehoekjojdclc<span class="token operator">/</span>js<span class="token operator">/</span>inject<span class="token punctuation">.</span>js<span class="token punctuation">.</span> Resources must be listed <span class="token keyword">in</span> the web_accessible_resources manifest key <span class="token keyword">in</span> order to be loaded by pages outside the extension<span class="token punctuation">.</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>

意思就是你想要在web中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下：

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>`js
<span class="token punctuation">{</span>
	<span class="token comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span>
	<span class="token string">&quot;web_accessible_resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js/inject.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="homepage-url">homepage_url</h3> <blockquote><p>开发者或者插件主页设置</p></blockquote> <h2 id="chrome插件的8种展示形式">Chrome插件的8种展示形式</h2> <h3 id="browseraction-浏览器右上角">browserAction(浏览器右上角)</h3> <p>通过配置<code>browser_action</code>可以在浏览器的右上角增加一个图标，一个<code>browser_action</code>可以拥有一个图标，一个<code>tooltip</code>，一个<code>badge</code>和一个<code>popup</code>。</p> <p>示例配置如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;browser_action&quot;</span><span class="token operator">:</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这是一个示例Chrome插件&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>图标</li></ul> <p><code>browser_action</code>图标推荐使用宽高都为<code>19</code>像素的图片，更大的图标会被缩小，格式随意，一般推荐<code>png</code>，可以通过<code>manifest</code>中<code>default_icon</code>字段配置，也可以调用<code>setIcon()</code>方法。</p> <ul><li>tooltip</li></ul> <p>修改<code>browser_action</code>的<code>manifest中default_title</code>字段，或者调用<code>setTitle()</code>方法。</p> <ul><li>badge</li></ul> <p>所谓<code>badge</code>就是在图标上显示一些文本，可以用来更新一些小的扩展状态提示信息。因为badge空间有限，所以只支持4个以下的字符（英文4个，中文2个）。</p> <p><code>badge</code>无法通过配置文件来指定，必须通过代码实现，设置<code>badge</code>文字和颜色可以分别使用<code>setBadgeText()</code>和<code>setBadgeBackgroundColor()</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>chrome<span class="token punctuation">.</span>browserAction<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token operator">:</span> <span class="token string">'new'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>browserAction<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span><span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pageaction-地址栏右侧">pageAction(地址栏右侧)</h3> <p>所谓<code>pageAction</code>，指的是只有当某些特定页面打开才显示的图标，它和<code>browserAction</code>最大的区别是一个始终都显示，一个只在特定情况才显示。</p> <p>新版的Chrome，<code>pageAction</code>和普通的<code>browserAction</code>一样也是放在浏览器右上角，只不过没有点亮时是灰色的，点亮了才是彩色的，灰色时无论左键还是右键单击都是弹出选项,调整之后的<code>pageAction</code>我们可以简单地把它看成是可以置灰的<code>browserAction</code>。</p> <p><img src="https://img-blog.csdnimg.cn/20200403153516224.png" alt="pageAction"></p> <div class="language-js extra-class"><pre class="language-js"><code>chrome<span class="token punctuation">.</span>pageAction<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>tabId<span class="token punctuation">)</span> 显示图标；
chrome<span class="token punctuation">.</span>pageAction<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>tabId<span class="token punctuation">)</span> 隐藏图标；
</code></pre></div><h3 id="右键菜单">右键菜单</h3> <p>通过开发<code>Chrome</code>插件可以自定义浏览器的右键菜单，主要是通过<code>chrome.contextMenusAPI</code>实现，右键菜单可以出现在不同的上下文，比如普通页面、选中的文字、图片、链接，等等，如果有同一个插件里面定义了多个菜单，Chrome会自动组合放到以插件名字命名的二级菜单里</p> <p>最简单的右键菜单示例:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// manifest.json</span>
<span class="token punctuation">{</span><span class="token string">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>contextMenus<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	title<span class="token operator">:</span> <span class="token string">&quot;测试右键菜单&quot;</span><span class="token punctuation">,</span>
	<span class="token function-variable function">onclick</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您点击了右键菜单！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="override-覆盖特定页面">override(覆盖特定页面)</h3> <blockquote><p>使用<code>override</code>页可以将<code>Chrome</code>默认的一些特定页面替换掉，改为使用扩展提供的页面。</p></blockquote> <p>扩展可以替代如下页面：</p> <p>历史记录：从工具菜单上点击历史记录时访问的页面，或者从地址栏直接输入 chrome://history
新标签页：当创建新标签的时候访问的页面，或者从地址栏直接输入 chrome://newtab
书签：浏览器的书签，或者直接输入 chrome://bookmarks</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>一个扩展只能替代一个页面；</p> <p>不能替代隐身窗口的新标签页；</p> <p>网页必须设置title，否则用户可能会看到网页的URL，造成困扰；</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;chrome_url_overrides&quot;</span><span class="token operator">:</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;newtab&quot;</span><span class="token operator">:</span> <span class="token string">&quot;newtab.html&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;history&quot;</span><span class="token operator">:</span> <span class="token string">&quot;history.html&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;bookmarks&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bookmarks.html&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="桌面通知">桌面通知</h3> <p>hrome提供了一个chrome.notificationsAPI以便插件推送桌面通知，暂未找到chrome.notifications和HTML5自带的Notification的显著区别及优势。</p> <p>在后台JS中，无论是使用chrome.notifications还是Notification都不需要申请权限（HTML5方式需要申请权限），直接使用即可。</p> <div class="language-js extra-class"><pre class="language-js"><code>chrome<span class="token punctuation">.</span>notifications<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">'basic'</span><span class="token punctuation">,</span>
	iconUrl<span class="token operator">:</span> <span class="token string">'img/icon.png'</span><span class="token punctuation">,</span>
	title<span class="token operator">:</span> <span class="token string">'这是标题'</span><span class="token punctuation">,</span>
	message<span class="token operator">:</span> <span class="token string">'您刚才点击了自定义右键菜单！'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5种类型的js对比">5种类型的JS对比</h2> <p>Chrome插件的JS主要可以分为这5类：<code>injected script</code>、<code>content-script</code>、<code>popup js</code>、<code>background js</code>和<code>devtools js</code>。</p> <p><strong>权限对照表:</strong></p> <table><thead><tr><th style="text-align:left;">JS类型</th> <th style="text-align:left;">可访问的API</th> <th style="text-align:left;">DOM访问情况</th> <th style="text-align:left;">是否支持JS访问</th> <th style="text-align:left;">是否支持跨域</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>injected script</code></td> <td style="text-align:left;">和普通JS无任何差别，不能访问任何扩展API</td> <td style="text-align:left;">直接访问</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;"><code>content script</code></td> <td style="text-align:left;">只能访问 extension、runtime等部分API</td> <td style="text-align:left;">直接访问</td> <td style="text-align:left;">否</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;"><code>popup js</code></td> <td style="text-align:left;">可访问绝大部分API，除了devtools系列</td> <td style="text-align:left;">不可直接访问</td> <td style="text-align:left;">否</td> <td style="text-align:left;">是</td></tr> <tr><td style="text-align:left;"><code>background js</code></td> <td style="text-align:left;">可访问绝大部分API，除了devtools系列</td> <td style="text-align:left;">不可直接访问</td> <td style="text-align:left;">否</td> <td style="text-align:left;">是</td></tr> <tr><td style="text-align:left;"><code>devtools js</code></td> <td style="text-align:left;">只能访问 devtools、extension、runtime等部分API</td> <td style="text-align:left;">直接访问</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr></tbody></table> <h2 id="消息通信">消息通信</h2> <p><a href="https://developer.chrome.com/extensions/messaging" target="_blank" rel="noopener noreferrer">完整文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>互相通信概览表:</strong></p> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">injected-script</th> <th style="text-align:left;">content-script</th> <th style="text-align:left;">popup-js</th> <th style="text-align:left;">background-js</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>injected script</code></td> <td style="text-align:left;">\</td> <td style="text-align:left;">window.postMessage</td> <td style="text-align:left;">\</td> <td style="text-align:left;">\</td></tr> <tr><td style="text-align:left;"><code>content script</code></td> <td style="text-align:left;">window.postMessage</td> <td style="text-align:left;">\</td> <td style="text-align:left;">chrome.runtime.sendMessage chrome.runtime.connect</td> <td style="text-align:left;">chrome.runtime.sendMessage chrome.runtime.connect</td></tr> <tr><td style="text-align:left;"><code>popup js</code></td> <td style="text-align:left;">\</td> <td style="text-align:left;">chrome.tabs.sendMessage chrome.tabs.connect</td> <td style="text-align:left;">\</td> <td style="text-align:left;">chrome.extension. getBackgroundPage()</td></tr> <tr><td style="text-align:left;"><code>background js</code></td> <td style="text-align:left;">\</td> <td style="text-align:left;">chrome.tabs.sendMessage chrome.tabs.connect</td> <td style="text-align:left;">chrome.extension.getViews</td> <td style="text-align:left;">\</td></tr> <tr><td style="text-align:left;"><code>devtools js</code></td> <td style="text-align:left;">chrome.devtools. inspectedWindow.eval</td> <td style="text-align:left;">\</td> <td style="text-align:left;">chrome.runtime.sendMessage</td> <td style="text-align:left;">chrome.runtime.sendMessage</td></tr></tbody></table> <h2 id="长连接和短连接">长连接和短连接</h2> <blockquote><p>Chrome插件中有2种通信方式，一个是<code>短连接（chrome.tabs.sendMessage和chrome.runtime.sendMessage）</code>，一个是<code>长连接（chrome.tabs.connect和chrome.runtime.connect）</code>。</p></blockquote> <p>短连接的话就是挤牙膏一样，我发送一下，你收到了再回复一下，如果对方不回复，你只能重新发，而长连接类似<code>WebSocket</code>会一直建立连接，双方可以随时互发消息。</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// popup.js</span>
<span class="token function">getCurrentTabId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tabId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> port <span class="token operator">=</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'test-connect'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>question<span class="token operator">:</span> <span class="token string">'你是谁啊？'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	port<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'收到消息：'</span><span class="token operator">+</span>msg<span class="token punctuation">.</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>answer <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span>answer<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'我是'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>question<span class="token operator">:</span> <span class="token string">'哦，原来是你啊！'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// content-script.js</span>
<span class="token comment">// 监听长连接</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onConnect<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>port<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'test-connect'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		port<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到长连接消息：'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>question <span class="token operator">==</span> <span class="token string">'你是谁啊？'</span><span class="token punctuation">)</span> port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>answer<span class="token operator">:</span> <span class="token string">'我是你爸！'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="动态注入或执行js">动态注入或执行JS</h2> <p>虽然在<code>background</code>和<code>popup</code>中无法直接访问页面DOM，但是可以通过chrome.tabs.executeScript来执行脚本，从而实现访问web页面的DOM（注意，这种方式也不能直接访问页面JS）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// manifest.json</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;动态JS注入演示&quot;</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
	<span class="token string">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://*/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://*/*&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 动态执行JS代码</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>code<span class="token operator">:</span> <span class="token string">'document.body.style.backgroundColor=&quot;red&quot;'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 动态执行JS文件</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>file<span class="token operator">:</span> <span class="token string">'some-script.js'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="动态注入css">动态注入CSS</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// manifest.json</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;动态CSS注入演示&quot;</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
	<span class="token string">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://*/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://*/*&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 动态执行CSS代码，TODO</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">insertCSS</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>code<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 动态执行CSS文件</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">insertCSS</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>file<span class="token operator">:</span> <span class="token string">'some-style.css'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取当前窗口id">获取当前窗口ID</h2> <div class="language-js extra-class"><pre class="language-js"><code>chrome<span class="token punctuation">.</span>windows<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">currentWindow</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前窗口ID：'</span> <span class="token operator">+</span> currentWindow<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取当前标签页id">获取当前标签页ID</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 方式一</span>
<span class="token keyword">function</span> <span class="token function">getCurrentTabId</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> currentWindow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tabs</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>tabs<span class="token punctuation">.</span>length <span class="token operator">?</span> tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方式二</span>
<span class="token keyword">function</span> <span class="token function">getCurrentTabId2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	chrome<span class="token punctuation">.</span>windows<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">currentWindow</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> windowId<span class="token operator">:</span> currentWindow<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tabs</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>tabs<span class="token punctuation">.</span>length <span class="token operator">?</span> tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="本地存储">本地存储</h2> <p>本地存储建议用<code>chrome.storage</code>而不是普通的<code>localStorage</code>，区别有好几点，个人认为最重要的2点区别是：</p> <ol><li><p><code>chrome.storage</code>是针对插件全局的，即使你在<code>background</code>中保存的数据，在<code>content-script</code>也能获取到；</p></li> <li><p><code>chrome.storage.sync</code>可以跟随当前登录用户自动同步，这台电脑修改的设置会自动同步到其它电脑，很方便，如果没有登录或者未联网则先保存到本地，等登录了再同步至网络；</p></li></ol> <p>需要声明<code>storage</code>权限，有<code>chrome.storage.sync</code>和<code>chrome.storage.local</code>2种方式可供选择，使用示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 读取数据，第一个参数是指定要读取的key以及设置默认值</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span>color<span class="token punctuation">,</span> items<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 保存数据</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'保存成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="国际化">国际化</h2> <p>插件根目录新建一个名为<code>_locales</code>的文件夹，再在下面新建一些语言的文件夹，如<code>en</code>、<code>zh_CN</code>、<code>zh_TW</code>，然后再在每个文件夹放入一个<code>messages.json</code>，同时必须在清单文件中设置<code>default_locale</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// en</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;pluginDesc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A simple chrome extension demo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string">&quot;helloWorld&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// zh_CN</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;pluginDesc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;一个简单的Chrome插件demo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string">&quot;helloWorld&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你好啊，世界！&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在manifest.json和CSS文件中通过__MSG_messagename__引入，如：</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__MSG_pluginDesc__&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 默认语言</span>
	<span class="token string">&quot;default_locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh_CN&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="打包与发布">打包与发布</h2> <p>打包的话直接在插件管理页有一个打包按钮：</p> <p><img src="https://img-blog.csdnimg.cn/20200403172207484.png" alt="打包示例"></p> <p>然后会生成一个<code>.crx</code>文件，要发布到<code>Google应用商店</code>的话需要先登录你的<code>Google账号</code>，然后花<code>5$</code>注册为开发者，本人太穷，就懒得亲自验证了，有发布需求的自己去整吧。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-11-26 13:26:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/http/" class="prev">
        HTTP相关知识
      </a></span> <span class="next"><a href="/docs/browser/knowledge.html">
        浏览器工作原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.f71b4d6a.js" defer></script><script src="/docs/assets/js/2.01d5cf40.js" defer></script><script src="/docs/assets/js/47.22721c18.js" defer></script>
  </body>
</html>
