<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>腾讯云即时通讯IM(H5端) | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/docs/images/favicon.png">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bmob/hydrogen-js-sdk/dist/Bmob-2.2.4.min.js"></script>
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta name="theme-color" content="#00adb5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#00adb5">
    <meta itemprop="name" content="前端工程师成长路线">
    <meta itemprop="image" content="/my-blogs/images/favicon.png">
    <link rel="preload" href="/docs/assets/css/0.styles.46ff6e94.css" as="style"><link rel="preload" href="/docs/assets/js/app.091d26e2.js" as="script"><link rel="preload" href="/docs/assets/js/2.01d5cf40.js" as="script"><link rel="preload" href="/docs/assets/js/66.79354d2d.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.589bbc9e.js"><link rel="prefetch" href="/docs/assets/js/100.f97802ae.js"><link rel="prefetch" href="/docs/assets/js/101.0a1ff8f5.js"><link rel="prefetch" href="/docs/assets/js/102.712f45d8.js"><link rel="prefetch" href="/docs/assets/js/103.daa5f923.js"><link rel="prefetch" href="/docs/assets/js/104.0ccc8e6f.js"><link rel="prefetch" href="/docs/assets/js/105.cd78f98f.js"><link rel="prefetch" href="/docs/assets/js/106.65c19bc1.js"><link rel="prefetch" href="/docs/assets/js/107.61c1df98.js"><link rel="prefetch" href="/docs/assets/js/108.3c75b501.js"><link rel="prefetch" href="/docs/assets/js/109.568be989.js"><link rel="prefetch" href="/docs/assets/js/11.937238e2.js"><link rel="prefetch" href="/docs/assets/js/110.0a27206f.js"><link rel="prefetch" href="/docs/assets/js/111.0975dcaa.js"><link rel="prefetch" href="/docs/assets/js/112.b163519e.js"><link rel="prefetch" href="/docs/assets/js/113.1368f680.js"><link rel="prefetch" href="/docs/assets/js/114.218ef5bd.js"><link rel="prefetch" href="/docs/assets/js/115.c1fcc195.js"><link rel="prefetch" href="/docs/assets/js/116.4469098f.js"><link rel="prefetch" href="/docs/assets/js/117.ab3ea1b4.js"><link rel="prefetch" href="/docs/assets/js/118.81cde5a0.js"><link rel="prefetch" href="/docs/assets/js/119.a307119b.js"><link rel="prefetch" href="/docs/assets/js/12.93c20f16.js"><link rel="prefetch" href="/docs/assets/js/120.4a998e5b.js"><link rel="prefetch" href="/docs/assets/js/121.58b8a353.js"><link rel="prefetch" href="/docs/assets/js/122.c432f7ab.js"><link rel="prefetch" href="/docs/assets/js/123.50217a2a.js"><link rel="prefetch" href="/docs/assets/js/124.dbc14887.js"><link rel="prefetch" href="/docs/assets/js/125.b408f9ea.js"><link rel="prefetch" href="/docs/assets/js/126.a5a769d9.js"><link rel="prefetch" href="/docs/assets/js/127.e5edcb3f.js"><link rel="prefetch" href="/docs/assets/js/128.a74093b2.js"><link rel="prefetch" href="/docs/assets/js/129.1c0366e5.js"><link rel="prefetch" href="/docs/assets/js/13.42abf24d.js"><link rel="prefetch" href="/docs/assets/js/130.6740c93a.js"><link rel="prefetch" href="/docs/assets/js/131.1df5a16f.js"><link rel="prefetch" href="/docs/assets/js/132.bb082366.js"><link rel="prefetch" href="/docs/assets/js/133.625776b5.js"><link rel="prefetch" href="/docs/assets/js/134.23ad83a4.js"><link rel="prefetch" href="/docs/assets/js/135.374be682.js"><link rel="prefetch" href="/docs/assets/js/136.09ced831.js"><link rel="prefetch" href="/docs/assets/js/137.4f6afe2e.js"><link rel="prefetch" href="/docs/assets/js/138.09d2aefd.js"><link rel="prefetch" href="/docs/assets/js/139.9c07682f.js"><link rel="prefetch" href="/docs/assets/js/14.3ca01e7c.js"><link rel="prefetch" href="/docs/assets/js/140.606026d4.js"><link rel="prefetch" href="/docs/assets/js/141.813e8344.js"><link rel="prefetch" href="/docs/assets/js/142.d5b3eeaf.js"><link rel="prefetch" href="/docs/assets/js/143.e6328f52.js"><link rel="prefetch" href="/docs/assets/js/144.c09c7694.js"><link rel="prefetch" href="/docs/assets/js/145.9b026608.js"><link rel="prefetch" href="/docs/assets/js/146.4ab77074.js"><link rel="prefetch" href="/docs/assets/js/147.171bb952.js"><link rel="prefetch" href="/docs/assets/js/148.023e9874.js"><link rel="prefetch" href="/docs/assets/js/149.d42098b5.js"><link rel="prefetch" href="/docs/assets/js/15.7df95322.js"><link rel="prefetch" href="/docs/assets/js/150.0a1a251b.js"><link rel="prefetch" href="/docs/assets/js/151.f40299ef.js"><link rel="prefetch" href="/docs/assets/js/152.02047f77.js"><link rel="prefetch" href="/docs/assets/js/153.e1049082.js"><link rel="prefetch" href="/docs/assets/js/154.85028e1a.js"><link rel="prefetch" href="/docs/assets/js/155.c83c5602.js"><link rel="prefetch" href="/docs/assets/js/156.ec9739f4.js"><link rel="prefetch" href="/docs/assets/js/157.4de99df1.js"><link rel="prefetch" href="/docs/assets/js/158.11c0d9a2.js"><link rel="prefetch" href="/docs/assets/js/159.173c4051.js"><link rel="prefetch" href="/docs/assets/js/16.035cd679.js"><link rel="prefetch" href="/docs/assets/js/160.cd0293dc.js"><link rel="prefetch" href="/docs/assets/js/161.f5436b81.js"><link rel="prefetch" href="/docs/assets/js/162.81f29245.js"><link rel="prefetch" href="/docs/assets/js/163.aeb9e357.js"><link rel="prefetch" href="/docs/assets/js/164.ea495700.js"><link rel="prefetch" href="/docs/assets/js/165.6799f62f.js"><link rel="prefetch" href="/docs/assets/js/166.95f4d3e0.js"><link rel="prefetch" href="/docs/assets/js/167.0ce601db.js"><link rel="prefetch" href="/docs/assets/js/168.279b386e.js"><link rel="prefetch" href="/docs/assets/js/169.182b4057.js"><link rel="prefetch" href="/docs/assets/js/17.4de747af.js"><link rel="prefetch" href="/docs/assets/js/170.62bc83c1.js"><link rel="prefetch" href="/docs/assets/js/171.2a0ad556.js"><link rel="prefetch" href="/docs/assets/js/172.2ed4803c.js"><link rel="prefetch" href="/docs/assets/js/173.d07e1036.js"><link rel="prefetch" href="/docs/assets/js/174.a408d211.js"><link rel="prefetch" href="/docs/assets/js/175.85380a49.js"><link rel="prefetch" href="/docs/assets/js/176.0e43f4ac.js"><link rel="prefetch" href="/docs/assets/js/177.aad90271.js"><link rel="prefetch" href="/docs/assets/js/178.37823ab4.js"><link rel="prefetch" href="/docs/assets/js/179.20bb0e8c.js"><link rel="prefetch" href="/docs/assets/js/18.98626982.js"><link rel="prefetch" href="/docs/assets/js/180.7a7778cf.js"><link rel="prefetch" href="/docs/assets/js/181.5352e448.js"><link rel="prefetch" href="/docs/assets/js/182.512dda87.js"><link rel="prefetch" href="/docs/assets/js/183.86985341.js"><link rel="prefetch" href="/docs/assets/js/184.5532f74a.js"><link rel="prefetch" href="/docs/assets/js/185.c198e787.js"><link rel="prefetch" href="/docs/assets/js/186.72b0b02d.js"><link rel="prefetch" href="/docs/assets/js/187.b8616afb.js"><link rel="prefetch" href="/docs/assets/js/188.b10ac3a7.js"><link rel="prefetch" href="/docs/assets/js/189.aea24ca3.js"><link rel="prefetch" href="/docs/assets/js/19.9d610c8e.js"><link rel="prefetch" href="/docs/assets/js/190.a2c327d9.js"><link rel="prefetch" href="/docs/assets/js/191.a3a3bb1b.js"><link rel="prefetch" href="/docs/assets/js/192.4559eefd.js"><link rel="prefetch" href="/docs/assets/js/193.5f4b1f39.js"><link rel="prefetch" href="/docs/assets/js/194.f6f4062e.js"><link rel="prefetch" href="/docs/assets/js/195.1a3419cb.js"><link rel="prefetch" href="/docs/assets/js/196.3916310a.js"><link rel="prefetch" href="/docs/assets/js/197.d78d79d8.js"><link rel="prefetch" href="/docs/assets/js/198.e48e8aff.js"><link rel="prefetch" href="/docs/assets/js/199.42c30240.js"><link rel="prefetch" href="/docs/assets/js/20.1ee37f28.js"><link rel="prefetch" href="/docs/assets/js/200.04d977e0.js"><link rel="prefetch" href="/docs/assets/js/201.b3e1c79d.js"><link rel="prefetch" href="/docs/assets/js/202.3afdf258.js"><link rel="prefetch" href="/docs/assets/js/203.86c65e6f.js"><link rel="prefetch" href="/docs/assets/js/204.ad455408.js"><link rel="prefetch" href="/docs/assets/js/205.39fb474e.js"><link rel="prefetch" href="/docs/assets/js/206.cef74200.js"><link rel="prefetch" href="/docs/assets/js/207.55064cfe.js"><link rel="prefetch" href="/docs/assets/js/208.1d83b734.js"><link rel="prefetch" href="/docs/assets/js/209.d02d99fc.js"><link rel="prefetch" href="/docs/assets/js/21.f56a40f3.js"><link rel="prefetch" href="/docs/assets/js/210.cd0e31b4.js"><link rel="prefetch" href="/docs/assets/js/211.f73b43b7.js"><link rel="prefetch" href="/docs/assets/js/212.faa7c064.js"><link rel="prefetch" href="/docs/assets/js/22.5494cfd1.js"><link rel="prefetch" href="/docs/assets/js/23.2798be18.js"><link rel="prefetch" href="/docs/assets/js/24.6958bf72.js"><link rel="prefetch" href="/docs/assets/js/25.9de5b22f.js"><link rel="prefetch" href="/docs/assets/js/26.dd71183d.js"><link rel="prefetch" href="/docs/assets/js/27.04f6dad3.js"><link rel="prefetch" href="/docs/assets/js/28.01736cd9.js"><link rel="prefetch" href="/docs/assets/js/29.ca4ec983.js"><link rel="prefetch" href="/docs/assets/js/3.b109a1dc.js"><link rel="prefetch" href="/docs/assets/js/30.a2307dd0.js"><link rel="prefetch" href="/docs/assets/js/31.27fd7395.js"><link rel="prefetch" href="/docs/assets/js/32.ead80593.js"><link rel="prefetch" href="/docs/assets/js/33.c91d56c8.js"><link rel="prefetch" href="/docs/assets/js/34.9894ccaa.js"><link rel="prefetch" href="/docs/assets/js/35.f77e30d5.js"><link rel="prefetch" href="/docs/assets/js/36.90f0f710.js"><link rel="prefetch" href="/docs/assets/js/37.ec756b69.js"><link rel="prefetch" href="/docs/assets/js/38.80052982.js"><link rel="prefetch" href="/docs/assets/js/39.bc3654c9.js"><link rel="prefetch" href="/docs/assets/js/4.1b648871.js"><link rel="prefetch" href="/docs/assets/js/40.8459c406.js"><link rel="prefetch" href="/docs/assets/js/41.90b7f66b.js"><link rel="prefetch" href="/docs/assets/js/42.a6a1273d.js"><link rel="prefetch" href="/docs/assets/js/43.ab12be17.js"><link rel="prefetch" href="/docs/assets/js/44.51fa7baa.js"><link rel="prefetch" href="/docs/assets/js/45.78961d05.js"><link rel="prefetch" href="/docs/assets/js/46.cb1a4655.js"><link rel="prefetch" href="/docs/assets/js/47.22721c18.js"><link rel="prefetch" href="/docs/assets/js/48.feeca303.js"><link rel="prefetch" href="/docs/assets/js/49.289c11bc.js"><link rel="prefetch" href="/docs/assets/js/5.6a7e0113.js"><link rel="prefetch" href="/docs/assets/js/50.21b17a0e.js"><link rel="prefetch" href="/docs/assets/js/51.5c6cd28a.js"><link rel="prefetch" href="/docs/assets/js/52.4be20dda.js"><link rel="prefetch" href="/docs/assets/js/53.518bb8f4.js"><link rel="prefetch" href="/docs/assets/js/54.e27cf7d1.js"><link rel="prefetch" href="/docs/assets/js/55.86378938.js"><link rel="prefetch" href="/docs/assets/js/56.eb12689c.js"><link rel="prefetch" href="/docs/assets/js/57.f754e440.js"><link rel="prefetch" href="/docs/assets/js/58.e459d99d.js"><link rel="prefetch" href="/docs/assets/js/59.b5ebd8e3.js"><link rel="prefetch" href="/docs/assets/js/6.c2e2ba0d.js"><link rel="prefetch" href="/docs/assets/js/60.27e94571.js"><link rel="prefetch" href="/docs/assets/js/61.b12d0e57.js"><link rel="prefetch" href="/docs/assets/js/62.828f6a1b.js"><link rel="prefetch" href="/docs/assets/js/63.c587724b.js"><link rel="prefetch" href="/docs/assets/js/64.b321370e.js"><link rel="prefetch" href="/docs/assets/js/65.9f4159f3.js"><link rel="prefetch" href="/docs/assets/js/67.4e84271e.js"><link rel="prefetch" href="/docs/assets/js/68.312df481.js"><link rel="prefetch" href="/docs/assets/js/69.a1012ffe.js"><link rel="prefetch" href="/docs/assets/js/7.93284524.js"><link rel="prefetch" href="/docs/assets/js/70.26c8fad8.js"><link rel="prefetch" href="/docs/assets/js/71.c106abff.js"><link rel="prefetch" href="/docs/assets/js/72.63864943.js"><link rel="prefetch" href="/docs/assets/js/73.32a43e98.js"><link rel="prefetch" href="/docs/assets/js/74.6803d9e6.js"><link rel="prefetch" href="/docs/assets/js/75.699dff66.js"><link rel="prefetch" href="/docs/assets/js/76.7a24edb4.js"><link rel="prefetch" href="/docs/assets/js/77.33c45b83.js"><link rel="prefetch" href="/docs/assets/js/78.8dc26383.js"><link rel="prefetch" href="/docs/assets/js/79.060f50f8.js"><link rel="prefetch" href="/docs/assets/js/8.3f5d3b92.js"><link rel="prefetch" href="/docs/assets/js/80.aee1c57a.js"><link rel="prefetch" href="/docs/assets/js/81.083d93c6.js"><link rel="prefetch" href="/docs/assets/js/82.2f428e23.js"><link rel="prefetch" href="/docs/assets/js/83.32307d37.js"><link rel="prefetch" href="/docs/assets/js/84.d7dfddad.js"><link rel="prefetch" href="/docs/assets/js/85.b2a7b7b1.js"><link rel="prefetch" href="/docs/assets/js/86.3d6d2174.js"><link rel="prefetch" href="/docs/assets/js/87.b8480f5e.js"><link rel="prefetch" href="/docs/assets/js/88.7abc0d26.js"><link rel="prefetch" href="/docs/assets/js/89.08fa64a6.js"><link rel="prefetch" href="/docs/assets/js/9.e84efa80.js"><link rel="prefetch" href="/docs/assets/js/90.63cd1050.js"><link rel="prefetch" href="/docs/assets/js/91.b9edba17.js"><link rel="prefetch" href="/docs/assets/js/92.defae9cf.js"><link rel="prefetch" href="/docs/assets/js/93.1c95e421.js"><link rel="prefetch" href="/docs/assets/js/94.b08376df.js"><link rel="prefetch" href="/docs/assets/js/95.6c424eaf.js"><link rel="prefetch" href="/docs/assets/js/96.4d7f1d43.js"><link rel="prefetch" href="/docs/assets/js/97.973a22ea.js"><link rel="prefetch" href="/docs/assets/js/98.20dd9a19.js"><link rel="prefetch" href="/docs/assets/js/99.79e6ba83.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.46ff6e94.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://xjl271314.github.io/css_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  css tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://xjl271314.github.io/js_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  js tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://xjl271314.github.io/css_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  css tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://xjl271314.github.io/js_tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  js tricks
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/xjl271314/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/dom/" class="sidebar-link">文档对象模型DOM</a></li><li><a href="/docs/bom/" class="sidebar-link">浏览器对象 BOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript高级技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/es/" class="sidebar-link">ES6到ES11特性总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Svg相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/http/" class="sidebar-link">HTTP相关知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS相关知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/safe/" class="sidebar-link">Web安全问题</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/bff/" class="sidebar-link">BFF</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开放性问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>即时通讯</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/im/tcent.html" class="active sidebar-link">腾讯云即时通讯IM(H5端)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#开始" class="sidebar-link">开始</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#登录鉴权流程" class="sidebar-link">登录鉴权流程</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送文本消息" class="sidebar-link">发送文本消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送图片消息" class="sidebar-link">发送图片消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送音频消息" class="sidebar-link">发送音频消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送文件消息" class="sidebar-link">发送文件消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送自定义消息" class="sidebar-link">发送自定义消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送视频消息" class="sidebar-link">发送视频消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#发送表情消息" class="sidebar-link">发送表情消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#撤回消息" class="sidebar-link">撤回消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#重发消息" class="sidebar-link">重发消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#接收消息" class="sidebar-link">接收消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#解析文本消息" class="sidebar-link">解析文本消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#解析系统消息" class="sidebar-link">解析系统消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#解析群提示消息" class="sidebar-link">解析群提示消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#获取某会话的消息列表" class="sidebar-link">获取某会话的消息列表</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#将会话设置为已读" class="sidebar-link">将会话设置为已读</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#获取会话的列表" class="sidebar-link">获取会话的列表</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#获取会话资料" class="sidebar-link">获取会话资料</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#删除会话" class="sidebar-link">删除会话</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#未读计数" class="sidebar-link">未读计数</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#网络状态相关" class="sidebar-link">网络状态相关</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#创建群聊" class="sidebar-link">创建群聊</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#解散群组" class="sidebar-link">解散群组</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#更新群组资料" class="sidebar-link">更新群组资料</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#加入群聊" class="sidebar-link">加入群聊</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#退出群聊" class="sidebar-link">退出群聊</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#根据群-id-搜索群组" class="sidebar-link">根据群 ID 搜索群组</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#转让群组" class="sidebar-link">转让群组</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#处理加群申请" class="sidebar-link">处理加群申请</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#设置群消息提示类型" class="sidebar-link">设置群消息提示类型</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#获取群成员列表" class="sidebar-link">获取群成员列表</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#获取群成员资料" class="sidebar-link">获取群成员资料</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#添加群成员" class="sidebar-link">添加群成员</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#删除群成员" class="sidebar-link">删除群成员</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#禁言或取消禁言" class="sidebar-link">禁言或取消禁言</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#设为管理员或撤销管理员" class="sidebar-link">设为管理员或撤销管理员</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#修改群名片" class="sidebar-link">修改群名片</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#修改自定义字段" class="sidebar-link">修改自定义字段</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#群提示消息" class="sidebar-link">群提示消息</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#群系统通知" class="sidebar-link">群系统通知</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#登出" class="sidebar-link">登出</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#集成新版完整的流程" class="sidebar-link">集成新版完整的流程</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#常用错误状态码" class="sidebar-link">常用错误状态码</a></li><li class="sidebar-sub-header"><a href="/docs/im/tcent.html#常见问题" class="sidebar-link">常见问题</a></li></ul></li><li><a href="/docs/im/base.html" class="sidebar-link">/im/base.html</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信开发相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件推荐</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="腾讯云即时通讯im-h5端">腾讯云即时通讯IM(H5端)</h1> <ul><li>2020.04.16</li></ul> <p>最近项目中有使用到即时通讯类sdk，目前的方案是腾讯云IM这块，在此做一个快速踩坑-腾讯云IM即时通信总结。</p> <h2 id="前言">前言</h2> <p>腾讯云的IM是(Web和小程序)公用一套的,官方的<a href="https://cloud.tencent.com/document/product/269/36887" target="_blank" rel="noopener noreferrer">SDK下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>目前这里描述的是<code>1.7.3</code>版本，官方目前最新为<code>2.6.2</code>版本。</p></div> <h2 id="开始">开始</h2> <p>推荐使用H5项目Demo,<a href="https://cloud.tencent.com/document/product/269/36838#.E6.AD.A5.E9.AA.A41.EF.BC.9A.E5.88.9B.E5.BB.BA.E5.BA.94.E7.94.A8" target="_blank" rel="noopener noreferrer">一分钟跑通Demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="初始化">初始化</h2> <p>可以自己手动下载引入到项目中或者通过<code>npm</code>包安装。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// IM Web SDK</span>
npm install tim<span class="token operator">-</span>js<span class="token operator">-</span>sdk <span class="token operator">--</span>save
<span class="token comment">// 发送图片、文件等消息需要的 COS SDK</span>
npm install cos<span class="token operator">-</span>js<span class="token operator">-</span>sdk<span class="token operator">-</span>v5 <span class="token operator">--</span>save
</code></pre></div><p>在项目脚本里引入模块。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token constant">TIM</span> <span class="token keyword">from</span> <span class="token string">'tim-js-sdk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">COS</span> <span class="token keyword">from</span> <span class="token string">&quot;cos-js-sdk-v5&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  SDKAppID<span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 接入时需要将0替换为您的即时通信 IM 应用的 SDKAppID</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 SDK 实例，`TIM.create()`方法对于同一个 `SDKAppID` 只会返回同一份实例</span>
<span class="token keyword">let</span> tim <span class="token operator">=</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SDK 实例通常用 tim 表示</span>

<span class="token comment">/**
 * 设置 SDK 日志输出级别，详细分级
 * 0 普通级别，日志量较多，接入时建议使用
 * 1 release级别，SDK 输出关键信息，生产环境时建议使用
 * 2 告警级别，SDK 只输出告警和错误级别的日志
 * 3 错误级别，SDK 只输出错误级别的日志s
 * 4 无日志级别，SDK 将不打印任何日志
 */</span>
tim<span class="token punctuation">.</span><span class="token function">setLogLevel</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册 COS SDK 插件</span>
tim<span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'cos-wx-sdk'</span><span class="token operator">:</span> <span class="token constant">COS</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="登录鉴权流程">登录鉴权流程</h2> <p>用户登录 <code>IM SDK</code> 才能正常收发消息，登录需要用户提供 <code>UserID</code>、<code>UserSig</code> 等信息，具体含义请参见下方的流程图，通过<code>sdkAppID</code>请求后端接口获取对应的 <code>userSig</code>。</p> <p>登录成功后，需要先等 <code>SDK</code> 处于 <code>ready</code> 状态才能调用 <code>sendMessage</code> 等需要鉴权的接口，您可以通过监听事件 <code>TIM.EVENT.SDK_READY</code> 获取 <code>SDK</code> 状态。</p> <p><img src="https://img-blog.csdnimg.cn/20200416150532155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="登录鉴权流程"></p> <h3 id="服务端计算usersig">服务端计算userSig</h3> <p>采用服务端计算 <code>UserSig</code>，可以最大限度地保障计算 <code>UserSig</code> 所用的密钥信息不被泄露。您只需将计算代码部署在您的服务器上，并提供面向 <code>App</code> 的服务端接口，在需要 <code>UserSig</code> 时由您的 <code>App</code> 向业务服务器发起请求获取动态 <code>UserSig</code>。完整的代码可以参考<a href="https://cloud.tencent.com/document/product/269/32688" target="_blank" rel="noopener noreferrer">腾讯的文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,下面的示例是<code>Node.js</code>版本。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">/**
 * @param sdkappid 应用 SDKAppID，可在即时通信 IM 控制台 的应用卡片中获取。
 * @param userId 用户 ID,可以选择自己服务内对应的唯一id。
 * @param expire UserSig 的有效期，单位为秒。
 * @param userbuf 即时通信 IM 中均默认使用不带 UserBuf 的接口，即该参数默认填写为null。。
 * @param key 密钥信息，可在即时通信 IM 控制台 的应用详情页面中获取。
 * 
 */</span>
<span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> base64url <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">newBuffer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fill<span class="token punctuation">,</span> encoding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Buffer<span class="token punctuation">.</span>from <span class="token operator">?</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fill<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>fill<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

base64url<span class="token punctuation">.</span><span class="token function-variable function">unescape</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">unescape</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> str<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/_/g</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\-/g</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\*/g</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

base64url<span class="token punctuation">.</span><span class="token function-variable function">escape</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\+/g</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\//g</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/=/g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

base64url<span class="token punctuation">.</span><span class="token function-variable function">encode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">encode</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span><span class="token function">newBuffer</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

base64url<span class="token punctuation">.</span><span class="token function-variable function">decode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">decode</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">newBuffer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unescape</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">base64encode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">newBuffer</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">base64decode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">newBuffer</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">Api</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sdkappid<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sdkappid  <span class="token operator">=</span> sdkappid<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 通过传入参数生成 base64 的 hmac 值
 * @param identifier
 * @param currTime
 * @param expire
 * @returns {string}
 * @private
 */</span>
<span class="token class-name">Api</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_hmacsha256</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">identifier<span class="token punctuation">,</span> currTime<span class="token punctuation">,</span> expire<span class="token punctuation">,</span> base64UserBuf</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> contentToBeSigned <span class="token operator">=</span> <span class="token string">&quot;TLS.identifier:&quot;</span> <span class="token operator">+</span> identifier <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    contentToBeSigned <span class="token operator">+=</span> <span class="token string">&quot;TLS.sdkappid:&quot;</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sdkappid <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    contentToBeSigned <span class="token operator">+=</span> <span class="token string">&quot;TLS.time:&quot;</span> <span class="token operator">+</span> currTime <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    contentToBeSigned <span class="token operator">+=</span> <span class="token string">&quot;TLS.expire:&quot;</span> <span class="token operator">+</span> expire <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> base64UserBuf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        contentToBeSigned <span class="token operator">+=</span> <span class="token string">&quot;TLS.userbuf:&quot;</span> <span class="token operator">+</span> base64UserBuf <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> hmac <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHmac</span><span class="token punctuation">(</span><span class="token string">&quot;sha256&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> hmac<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>contentToBeSigned<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 生成 usersig
 * @param string $identifier 用户名
 * @return string 生成的失败时为false
 */</span>
<span class="token comment">/**
 * 生成 usersig
 * @param identifier 用户账号
 * @param expire 有效期，单位秒
 * @returns {string} 返回的 sig 值
 */</span>
<span class="token class-name">Api</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">genSig</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">identifier<span class="token punctuation">,</span> expire</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">genSigWithUserbuf</span><span class="token punctuation">(</span>identifier<span class="token punctuation">,</span> expire<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 生成带 userbuf 的 usersig
 * @param identifier  用户账号
 * @param expire 有效期，单位秒
 * @param userBuf 用户数据
 * @returns {string} 返回的 sig 值
 */</span>
<span class="token class-name">Api</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">genSigWithUserbuf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">identifier<span class="token punctuation">,</span> expire<span class="token punctuation">,</span> userBuf</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">var</span> currTime <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> sigDoc <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'TLS.ver'</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
        <span class="token string">'TLS.identifier'</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token operator">+</span>identifier<span class="token punctuation">,</span>
        <span class="token string">'TLS.sdkappid'</span><span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sdkappid<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'TLS.time'</span><span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>currTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'TLS.expire'</span><span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>expire<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> sig <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> userBuf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> base64UserBuf <span class="token operator">=</span> <span class="token function">base64encode</span><span class="token punctuation">(</span>userBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sigDoc<span class="token punctuation">[</span><span class="token string">'TLS.userbuf'</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64UserBuf<span class="token punctuation">;</span>
        sig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_hmacsha256</span><span class="token punctuation">(</span>identifier<span class="token punctuation">,</span> currTime<span class="token punctuation">,</span> expire<span class="token punctuation">,</span> base64UserBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        sig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_hmacsha256</span><span class="token punctuation">(</span>identifier<span class="token punctuation">,</span> currTime<span class="token punctuation">,</span> expire<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    sigDoc<span class="token punctuation">[</span><span class="token string">'TLS.sig'</span><span class="token punctuation">]</span> <span class="token operator">=</span> sig<span class="token punctuation">;</span>

    <span class="token keyword">var</span> compressed <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">deflateSync</span><span class="token punctuation">(</span><span class="token function">newBuffer</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>sigDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> base64url<span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span>compressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>Api <span class="token operator">=</span> Api<span class="token punctuation">;</span>
</code></pre></div><p>userSig的值可以参考上面的生成。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'后台提供的生成用户userSig的接口地址'</span><span class="token punctuation">;</span>
<span class="token comment">// 登录的用户信息</span>
<span class="token keyword">const</span> loginUserInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    sdkAppID<span class="token punctuation">,</span> <span class="token comment">// 用户所属应用id,必填</span>
    appIDAt3rd<span class="token operator">:</span> sdkAppID<span class="token punctuation">,</span> <span class="token comment">// 用户所属应用id，必填</span>
    accountType<span class="token punctuation">,</span> <span class="token comment">// 用户所属应用帐号类型，必填</span>
    identifier<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前用户ID,必须是否字符串类型，选填</span>
    identifierNick<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 当前用户昵称，选填</span>
    userSig<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前用户身份凭证，必须是字符串类型，选填</span>
    headurl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 当前用户默认头像，选填</span>
<span class="token punctuation">}</span>
<span class="token comment">// 后端返回的userSig</span>
<span class="token keyword">const</span> userSig <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> userId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loginInfo<span class="token punctuation">.</span>userSig <span class="token operator">=</span> data<span class="token punctuation">.</span>userSig<span class="token punctuation">;</span>

<span class="token comment">// 进行用户的登录操作</span>
webim<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>
    loginInfo<span class="token punctuation">,</span>
    listeners<span class="token punctuation">,</span><span class="token comment">// 选填 其他监听事件</span>
    options<span class="token punctuation">,</span> <span class="token comment">// 选填 其他选项</span>
    <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// identifierNick为登录用户昵称(没有设置时，为帐号)，无登录态时为空</span>
        loginInfo<span class="token punctuation">.</span>identifierNick <span class="token operator">=</span> res<span class="token punctuation">.</span>identifierNick<span class="token punctuation">;</span> <span class="token comment">// 设置当前用户昵称</span>
        loginInfo<span class="token punctuation">.</span>headurl <span class="token operator">=</span> res<span class="token punctuation">.</span>headurl<span class="token punctuation">;</span> <span class="token comment">// 设置当前用户头像</span>
        webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'webim登录成功'</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>identifierNick<span class="token punctuation">)</span><span class="token punctuation">;</span>
        retryConnect <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// 选填 登录成功的回调</span>
        cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>ErrorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可以尝试重新登录</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>默认情况下，不支持多实例登录，即如果此帐号已在其他页面登录，若继续在当前页面登录成功，有可能会将其他页面踢下线。用户被踢下线时会触发事件<code>TIM.EVENT.KICKED_OUT</code>，用户可在监听到事件后做相应处理。多端登录监听示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">onKickedOut</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mutipleAccount(同一设备，同一帐号，多页面登录被踢)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">KICKED_OUT</span><span class="token punctuation">,</span> onKickedOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如需支持多实例登录（允许在多个网页中同时登录同一帐号），请登录 <a href="https://cloud.tencent.com/login?s_url=https%3A%2F%2Fconsole.cloud.tencent.com%2Fim" target="_blank" rel="noopener noreferrer">即时通信 IM 控制台<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，找到相应 <code>SDKAppID</code>，选择【应用配置】&gt;【功能配置】&gt;【登录与消息】&gt;【Web端实例同时在线】配置实例个数。配置将在50分钟内生效。</p></div> <h2 id="发送文本消息">发送文本消息</h2> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>text</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息文本内容</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.7.3</span>
<span class="token keyword">function</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> customObj<span class="token punctuation">,</span> successCallBack<span class="token punctuation">,</span> errorCallBack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 未登录</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'未登录'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 去登陆</span>
        <span class="token keyword">return</span> <span class="token function">sdkLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 当前选中聊天id（当聊天类型为私聊时，该值为好友帐号，否则为群号）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selToID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'您还没有进入房间，暂不能聊天'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token operator">?.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发送的消息不能为空!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 当前聊天会话</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selSess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        selSess <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Session</span><span class="token punctuation">(</span>
            selType<span class="token punctuation">,</span>
            selToID<span class="token punctuation">,</span>
            selToID<span class="token punctuation">,</span>
            selSessHeadUrl<span class="token punctuation">,</span>
            Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> isSend <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 是否为自己发送</span>
    <span class="token keyword">const</span> seq <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 消息序列，-1表示sdk自动生成，用于去重</span>
    <span class="token keyword">const</span> random <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4294967296</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 消息随机数，用于去重</span>
    <span class="token keyword">const</span> msgTime <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 消息时间戳</span>
    <span class="token keyword">let</span> subType<span class="token punctuation">;</span> <span class="token comment">// 消息子类型</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selType <span class="token operator">==</span> webim<span class="token punctuation">.</span><span class="token constant">SESSION_TYPE</span><span class="token punctuation">.</span><span class="token constant">GROUP</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 群消息子类型如下：</span>
        <span class="token comment">// webim.GROUP_MSG_SUB_TYPE.COMMON-普通消息,</span>
        <span class="token comment">// webim.GROUP_MSG_SUB_TYPE.LOVEMSG-点赞消息，优先级最低</span>
        <span class="token comment">// webim.GROUP_MSG_SUB_TYPE.TIP-提示消息(不支持发送，用于区分群消息子类型)，</span>
        <span class="token comment">// webim.GROUP_MSG_SUB_TYPE.REDPACKET-红包消息，优先级最高</span>
        subType <span class="token operator">=</span> webim<span class="token punctuation">.</span><span class="token constant">GROUP_MSG_SUB_TYPE</span><span class="token punctuation">.</span><span class="token constant">COMMON</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// C2C消息子类型如下：</span>
        <span class="token comment">// webim.C2C_MSG_SUB_TYPE.COMMON-普通消息,</span>
        subType <span class="token operator">=</span> webim<span class="token punctuation">.</span><span class="token constant">C2C_MSG_SUB_TYPE</span><span class="token punctuation">.</span><span class="token constant">COMMON</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg</span><span class="token punctuation">(</span>
        selSess<span class="token punctuation">,</span>
        isSend<span class="token punctuation">,</span>
        seq<span class="token punctuation">,</span>
        random<span class="token punctuation">,</span>
        msgTime<span class="token punctuation">,</span>
        loginInfo<span class="token punctuation">.</span>identifier<span class="token punctuation">,</span>
        subType<span class="token punctuation">,</span>
        loginInfo<span class="token punctuation">.</span>identifierNick
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 解析文本和表情</span>
    <span class="token keyword">const</span> expr <span class="token operator">=</span> <span class="token regex">/\[[^[\]]{1,3}\]/gm</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> emotions <span class="token operator">=</span> msgtosend<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> text_obj<span class="token punctuation">;</span>
    <span class="token keyword">let</span> face_obj<span class="token punctuation">;</span>
    <span class="token keyword">let</span> tmsg<span class="token punctuation">;</span>
    <span class="token keyword">let</span> emotionIndex<span class="token punctuation">;</span>
    <span class="token keyword">let</span> emotion<span class="token punctuation">;</span>
    <span class="token keyword">let</span> restMsgIndex<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>emotions <span class="token operator">||</span> emotions<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        text_obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>Elem<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span>msgtosend<span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">addText</span><span class="token punctuation">(</span>text_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有表情</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> emotions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tmsg <span class="token operator">=</span> msgtosend<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> msgtosend<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>emotions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                text_obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>Elem<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span>tmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                msg<span class="token punctuation">.</span><span class="token function">addText</span><span class="token punctuation">(</span>text_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            emotionIndex <span class="token operator">=</span> webim<span class="token punctuation">.</span>EmotionDataIndexs<span class="token punctuation">[</span>emotions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            emotion <span class="token operator">=</span> webim<span class="token punctuation">.</span>Emotions<span class="token punctuation">[</span>emotionIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>emotion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                face_obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>Elem<span class="token punctuation">.</span>Face</span><span class="token punctuation">(</span>emotionIndex<span class="token punctuation">,</span> emotions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                msg<span class="token punctuation">.</span><span class="token function">addFace</span><span class="token punctuation">(</span>face_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                text_obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>Elem<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span>emotions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                msg<span class="token punctuation">.</span><span class="token function">addText</span><span class="token punctuation">(</span>text_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            restMsgIndex <span class="token operator">=</span> msgtosend<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>emotions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> emotions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            msgtosend <span class="token operator">=</span> msgtosend<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>restMsgIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msgtosend<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            text_obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>Elem<span class="token punctuation">.</span>Text</span><span class="token punctuation">(</span>msgtosend<span class="token punctuation">)</span><span class="token punctuation">;</span>
            msg<span class="token punctuation">.</span><span class="token function">addText</span><span class="token punctuation">(</span>text_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>customObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> customElem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webim<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>Elem<span class="token punctuation">.</span>Custom</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>customObj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">addCustom</span><span class="token punctuation">(</span>customElem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    webim<span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span>
        msg<span class="token punctuation">,</span>
        <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>selType <span class="token operator">==</span> webim<span class="token punctuation">.</span><span class="token constant">SESSION_TYPE</span><span class="token punctuation">.</span><span class="token constant">C2C</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 私聊时，在聊天窗口手动添加一条发的消息，群聊时，长轮询接口会返回自己发的消息</span>
                <span class="token function">showMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'发消息成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            successCallBack <span class="token operator">&amp;&amp;</span> <span class="token function">successCallBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">发消息失败:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>ErrorInfo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 其他自定义的失败处理</span>
            errorCallBack <span class="token operator">&amp;&amp;</span> <span class="token function">errorCallBack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2.6.2</span>

<span class="token comment">// 1. 创建消息实例</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> webim<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> webim<span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'Hello world!'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="发送图片消息">发送图片消息</h2> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createImageMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr> <tr><td style="text-align:left;"><code>onProgress</code></td> <td style="text-align:left;">function</td> <td style="text-align:left;">获取上传进度的回调函数</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>file</code></td> <td style="text-align:left;">HTMLInputElement 或 Object</td> <td style="text-align:left;">用于选择图片的 DOM 节点（Web）或者 File 对象（Web）或者微信小程序 wx.chooseImage 接口的 success 回调参数。SDK 会读取其中的数据并上传图片</td></tr></tbody></table> <p><strong>Web 端发送图片消息示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createImageMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考 消息优先级与频率控制</span>
  <span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
  <span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_NORMAL,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'imagePicker'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Web 端发送图片消息示例2- 传入 File 对象:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 先在页面上添加一个 ID 为 &quot;testPasteInput&quot; 的消息输入框，例如 &lt;input type=&quot;text&quot; id=&quot;testPasteInput&quot; placeholder=&quot;截图后粘贴到输入框中&quot; size=&quot;30&quot; /&gt;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'testPasteInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'paste'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> clipboardData <span class="token operator">=</span> e<span class="token punctuation">.</span>clipboardData<span class="token punctuation">;</span>
  <span class="token keyword">let</span> file<span class="token punctuation">;</span>
  <span class="token keyword">let</span> fileCopy<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>clipboardData <span class="token operator">&amp;&amp;</span> clipboardData<span class="token punctuation">.</span>files <span class="token operator">&amp;&amp;</span> clipboardData<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> clipboardData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 图片消息发送成功后，file 指向的内容可能被浏览器清空，如果接入侧有额外的渲染需求，可以提前复制一份数据</span>
    fileCopy <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> file <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'file 是 undefined，请检查代码或浏览器兼容性！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createImageMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
    conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      file<span class="token operator">:</span> file
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. 发送消息</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送成功</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送失败</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="发送音频消息">发送音频消息</h2> <blockquote><p>创建音频消息实例的接口，此接口返回一个消息实例，可以在需要发送音频消息时调用 发送消息 接口发送消息。 目前 <code>createAudioMessage</code> 只支持在<code>微信小程序环境</code>使用。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createAudioMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>file</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">录音后得到的文件信息</td></tr></tbody></table> <p><strong>小程序示例：使用微信官方的 RecorderManager 进行录音，参考 RecorderManager.start(Object object):</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 获取全局唯一的录音管理器 RecorderManager</span>
<span class="token keyword">const</span> recorderManager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getRecorderManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 录音部分参数</span>
<span class="token keyword">const</span> recordOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  duration<span class="token operator">:</span> <span class="token number">60000</span><span class="token punctuation">,</span> <span class="token comment">// 录音的时长，单位 ms，最大值 600000（10 分钟）</span>
  sampleRate<span class="token operator">:</span> <span class="token number">44100</span><span class="token punctuation">,</span> <span class="token comment">// 采样率</span>
  numberOfChannels<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 录音通道数</span>
  encodeBitRate<span class="token operator">:</span> <span class="token number">192000</span><span class="token punctuation">,</span> <span class="token comment">// 编码码率</span>
  format<span class="token operator">:</span> <span class="token string">'aac'</span> <span class="token comment">// 音频格式，选择此格式创建的音频消息，可以在即时通信 IM 全平台（Android、iOS、微信小程序和 Web）互通</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2.1 监听录音错误事件</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">errMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'recorder error:'</span><span class="token punctuation">,</span> errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2.2 监听录音结束事件，录音结束后，调用 createAudioMessage 创建音频消息实例</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'recorder stop'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. 创建消息实例，接口返回的实例可以上屏</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createAudioMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
    conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      file<span class="token operator">:</span> res
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 5. 发送消息</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送成功</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送失败</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 开始录音</span>
recorderManager<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>recordOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="发送文件消息">发送文件消息</h2> <blockquote><p>创建文件消息的接口，此接口返回一个消息实例，可以在需要发送文件消息时调用 发送消息 接口发送消息实例。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>! v2.3.1版本开始支持传入 File 对象，使用前需要将 SDK 升级至v2.3.1或以上。
! v2.4.0版本起，上传文件大小最大值调整为100MB。
! 微信小程序目前不支持选择文件的功能，故该接口暂不支持微信小程序端。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createFileMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr> <tr><td style="text-align:left;"><code>onProgress</code></td> <td style="text-align:left;">function</td> <td style="text-align:left;">获取上传进度的回调函数</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>file</code></td> <td style="text-align:left;">HTMLInputElement</td> <td style="text-align:left;">用于选择文件的 DOM 节点（Web）或者 File 对象（Web），SDK 会读取其中的数据并上传文件</td></tr></tbody></table> <p><strong>Web 端发送文件消息示例1- 传入 DOM 节点:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Web 端发送文件消息示例1 - 传入 DOM 节点</span>
<span class="token comment">// 1. 创建文件消息实例，接口返回的实例可以上屏</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token function">createFileMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考 消息优先级与频率控制</span>
  <span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
  <span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_NORMAL,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'filePicker'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Web 端发送文件消息示例2- 传入 File 对象:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 先在页面上添加一个 ID 为 &quot;testPasteInput&quot; 的消息输入框，如 &lt;input type=&quot;text&quot; id=&quot;testPasteInput&quot; placeholder=&quot;截图后粘贴到输入框中&quot; size=&quot;30&quot; /&gt;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'testPasteInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'paste'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> clipboardData <span class="token operator">=</span> e<span class="token punctuation">.</span>clipboardData<span class="token punctuation">;</span>
  <span class="token keyword">let</span> file<span class="token punctuation">;</span>
  <span class="token keyword">let</span> fileCopy<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>clipboardData <span class="token operator">&amp;&amp;</span> clipboardData<span class="token punctuation">.</span>files <span class="token operator">&amp;&amp;</span> clipboardData<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> clipboardData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 图片消息发送成功后，file 指向的内容可能被浏览器清空，如果接入侧有额外的渲染需求，可以提前复制一份数据</span>
    fileCopy <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> file <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'file 是 undefined，请检查代码或浏览器兼容性！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createFileMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
    conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      file<span class="token operator">:</span> file
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2. 发送消息</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送成功</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送失败</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="发送自定义消息">发送自定义消息</h2> <blockquote><p>创建自定义消息实例的接口，此接口返回一个消息实例，可以在需要发送自定义消息时调用 发送消息 接口发送消息实例。当 SDK 提供的能力不能满足您的需求时，可以使用自定义消息进行个性化定制，例如投骰子功能。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createCustomMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>data</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">自定义消息的数据字段</td></tr> <tr><td style="text-align:left;"><code>description</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">自定义消息的说明字段</td></tr> <tr><td style="text-align:left;"><code>extension</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">自定义消息的扩展字段</td></tr></tbody></table> <p><strong>利用自定义消息实现投骰子功能示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 定义随机函数</span>
<span class="token keyword">function</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2. 创建消息实例，接口返回的实例可以上屏</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createCustomMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考 消息优先级与频率控制</span>
  <span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
  <span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_HIGH,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token string">'dice'</span><span class="token punctuation">,</span> <span class="token comment">// 用于标识该消息是骰子类型消息</span>
    description<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 获取骰子点数</span>
    extension<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="发送视频消息">发送视频消息</h2> <blockquote><p>创建视频消息实例的接口，此接口返回一个消息实例，可以在需要发送视频消息时调用 发送消息 接口发送消息。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li><p>使用该接口前，需要将SDK版本升级至v2.2.0或以上。</p></li> <li><p><code>createVideoMessage</code> 支持在微信小程序环境使用，从v2.6.0起，支持在 Web 环境使用。</p></li> <li><p>微信小程序录制视频，或者从相册选择视频文件，没有返回视频缩略图信息。为了更好的体验，SDK 在创建视频消息时会设置默认的缩略图信息。如果接入侧不想展示默认的缩略图，可在渲染的时候忽略缩图相关信息，自主处理。</p></li> <li><p>全平台互通视频消息，移动端请升级使用 最新的 TUIKit 或 SDK。</p></li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createVideoMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>file</code></td> <td style="text-align:left;">HTMLInputElement、File 或 Object</td> <td style="text-align:left;">用于选择视频文件的 DOM 节点（Web）或者 File 对象（Web），或微信小程序录制或者从相册选择的视频文件。SDK 会读取其中的数据并上传。</td></tr></tbody></table> <p><strong>小程序端发送视频消息示例 <code>wx.chooseVideo</code>:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 调用小程序接口选择视频，接口详情请查阅 </span>
wx<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  sourceType<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">,</span> <span class="token string">'camera'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 来源相册或者拍摄</span>
  maxDuration<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 设置最长时间60s</span>
  camera<span class="token operator">:</span> <span class="token string">'back'</span><span class="token punctuation">,</span> <span class="token comment">// 后置摄像头</span>
  <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2. 创建消息实例，接口返回的实例可以上屏</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createVideoMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
      conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        file<span class="token operator">:</span> res
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'video uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 3. 发送消息</span>
    <span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 发送成功</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 发送失败</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>web 端发送视频消息示例（v2.6.0起支持）：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 获取视频：传入 DOM 节点</span>
<span class="token comment">// 2. 创建消息实例</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createVideoMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'videoPicker'</span><span class="token punctuation">)</span> <span class="token comment">// 或者用event.target</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="发送表情消息">发送表情消息</h2> <blockquote><p>创建表情消息实例的接口，此接口返回一个消息实例，可以在需要发送表情消息时调用 发送消息 接口发送消息。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>使用该接口前，需要将 SDK 版本升级至<code>v2.3.1</code>或以上。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createFaceMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>to</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">消息的接收方</td></tr> <tr><td style="text-align:left;"><code>conversationType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话类型，取值TIM.TYPES.CONV_C2C(端到端)或TIM.TYPES.CONV_GROUP(群发消息)</td></tr> <tr><td style="text-align:left;"><code>payload</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>index</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">表情索引，用户自定义</td></tr> <tr><td style="text-align:left;"><code>data</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">额外数据</td></tr></tbody></table> <p><strong>发送表情消息示例，Web 端与小程序端相同</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createFaceMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考 消息优先级与频率控制</span>
  <span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
  <span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_NORMAL,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// Number 表情索引，用户自定义</span>
    data<span class="token operator">:</span> <span class="token string">'tt00'</span> <span class="token comment">// String 额外数据</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="撤回消息">撤回消息</h2> <blockquote><p>撤回单聊消息或者群聊消息。撤回成功后，消息对象的 <code>isRevoked</code> 属性值为 <code>true</code>。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li><p>使用该接口前，需要将 SDK 版本升级至v2.4.0或以上。</p></li> <li><p>消息可撤回时间默认为2分钟。可通过 控制台 调整消息可撤回时间。</p></li> <li><p>被撤回的消息，可以调用 <code>getMessageList</code> 接口从单聊或者群聊消息漫游中拉取到。接入侧需根据消息对象的 <code>isRevoked</code> 属性妥善处理被撤回消息的展示。例如，单聊会话内可展示为 &quot;对方撤回了一条消息&quot;，群聊会话内可展示为 &quot;张三撤回了一条消息&quot;。</p></li> <li><p>可使用 <code>REST API</code> 撤回单聊消息 或 撤回群聊消息。</p></li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">revokeMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>message</code></td> <td style="text-align:left;">Message</td> <td style="text-align:left;">消息实例</td></tr></tbody></table> <p><strong>主动撤回消息示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">revokeMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 消息撤回成功</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 消息撤回失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'revokeMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>收到消息被撤回的通知：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_REVOKED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用前需要将 SDK 版本升级至v2.4.0或以上。</span>
  <span class="token comment">// event.name - TIM.EVENT.MESSAGE_REVOKED</span>
  <span class="token comment">// event.data - 存储 Message 对象的数组 - [Message] - 每个 Message 对象的 isRevoked 属性值为 true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>获取会话的消息列表时遇到被撤回的消息:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conversationID<span class="token operator">:</span> <span class="token string">'C2Ctest'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageList <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>messageList<span class="token punctuation">;</span> <span class="token comment">// 消息列表</span>
  messageList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>isRevoked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理被撤回的消息</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理普通消息</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="重发消息">重发消息</h2> <blockquote><p>重发消息的接口，当消息发送失败时，调用该接口进行重发。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">resendMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>message</code></td> <td style="text-align:left;">Message</td> <td style="text-align:left;">消息实例</td></tr></tbody></table> <p><strong>重发消息示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">resendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入需要重发的消息实例</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重发成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重发失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'resendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="接收消息">接收消息</h2> <blockquote><p>接受消息的接口，接收消息需要通过事件监听实现：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.7.3</span>
<span class="token keyword">function</span> <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 不是同一个房间，不接收</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> avChatRoomId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> isSelfSend<span class="token punctuation">;</span>
    <span class="token keyword">let</span> sessType<span class="token punctuation">;</span>
    <span class="token keyword">let</span> subType<span class="token punctuation">;</span>
    <span class="token keyword">let</span> fromAccount <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getFromAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fromAccountNick <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getFromAccountNick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'未知用户'</span><span class="token punctuation">;</span>

    <span class="token comment">// 解析消息</span>
    <span class="token comment">// 获取会话类型，目前只支持群聊</span>
    <span class="token comment">// webim.SESSION_TYPE.GROUP-群聊，</span>
    <span class="token comment">// webim.SESSION_TYPE.C2C-私聊，</span>
    sessType <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取消息子类型</span>
    <span class="token comment">// 会话类型为群聊时，子类型为：webim.GROUP_MSG_SUB_TYPE</span>
    <span class="token comment">// 会话类型为私聊时，子类型为：webim.C2C_MSG_SUB_TYPE</span>
    subType <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getSubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    isSelfSend <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getIsSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 消息是否为自己发的</span>
    <span class="token keyword">const</span> elems <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getElems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取消息包含的元素数组</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>el0<span class="token punctuation">,</span> el1<span class="token punctuation">]</span> <span class="token operator">=</span> elems<span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>el0 <span class="token operator">&amp;&amp;</span> el0<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> webim<span class="token punctuation">.</span><span class="token constant">MSG_ELEMENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> content <span class="token operator">=</span> el0<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取元素对象</span>
            <span class="token keyword">let</span> buyerLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> user_img <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> streamType <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> userRoleType <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>el1 <span class="token operator">&amp;&amp;</span> el1<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> webim<span class="token punctuation">.</span><span class="token constant">MSG_ELEMENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> contentCustom <span class="token operator">=</span> el1<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取元素对象</span>
                <span class="token keyword">const</span> contentData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>contentCustom<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                buyerLevel <span class="token operator">=</span> contentData<span class="token punctuation">.</span>buyerLevel<span class="token punctuation">;</span>
                user_img <span class="token operator">=</span> contentData<span class="token punctuation">.</span>user_img<span class="token punctuation">;</span>
                streamType <span class="token operator">=</span> contentData<span class="token punctuation">.</span>streamType<span class="token punctuation">;</span>
                userRoleType <span class="token operator">=</span> contentData<span class="token punctuation">.</span>userRoleType<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 文本类型，默认为聊天消息</span>
            acceptCallBack <span class="token operator">&amp;&amp;</span>
                <span class="token function">acceptCallBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    type<span class="token operator">:</span> MsgType<span class="token punctuation">.</span>chatText<span class="token punctuation">,</span>
                    message_string<span class="token operator">:</span> content<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    user_img<span class="token punctuation">,</span>
                    user_nickname<span class="token operator">:</span> fromAccountNick<span class="token punctuation">,</span>
                    user_uri<span class="token operator">:</span> fromAccount<span class="token punctuation">,</span>
                    buyerLevel<span class="token punctuation">,</span>
                    streamType<span class="token punctuation">,</span>
                    userRoleType<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el0 <span class="token operator">&amp;&amp;</span> el0<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> webim<span class="token punctuation">.</span><span class="token constant">MSG_ELEMENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> content <span class="token operator">=</span> el0<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取元素对象</span>
            <span class="token keyword">const</span> contentData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> show<span class="token punctuation">,</span> userinfoUri <span class="token punctuation">}</span> <span class="token operator">=</span> contentData<span class="token punctuation">;</span>

            <span class="token comment">// 只接受指定的自定义类型</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                contentData<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    acceptCallBack <span class="token operator">&amp;&amp;</span>
                        <span class="token function">acceptCallBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            type<span class="token punctuation">,</span>
                            data<span class="token punctuation">,</span>
                            show<span class="token punctuation">,</span>
                            userinfoUri<span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2.7.0</span>
<span class="token keyword">let</span> <span class="token function-variable function">onMessageReceived</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// event.data - 存储 Message 对象的数组 - [Message]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_RECEIVED</span><span class="token punctuation">,</span> onMessageReceived<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="解析文本消息">解析文本消息</h2> <blockquote><p>如果文本消息仅是文字的话，直接渲染 'xxxx'文字即可，如果文本中带有类似emoji的表情，则需要解析表情</p></blockquote> <p><strong>解析emoji的示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> emojiMap <span class="token operator">=</span> <span class="token punctuation">{</span>         <span class="token comment">// 根据[呲牙]可匹配的路径地址</span>
  <span class="token string">'[微笑]'</span><span class="token operator">:</span> <span class="token string">'emoji_0.png'</span><span class="token punctuation">,</span>
  <span class="token string">'[呲牙]'</span><span class="token operator">:</span> <span class="token string">'emoji_1.png'</span><span class="token punctuation">,</span>
  <span class="token string">'[下雨]'</span><span class="token operator">:</span> <span class="token string">'emoji_2.png'</span>
<span class="token punctuation">}</span>

<span class="token comment">// &lt;img src=&quot;https://main.qcloudimg.com/raw/6be88c30a4552b5eb93d8eec243b6593.png&quot; style=&quot;margin:0;&quot;&gt;图片的地址</span>
<span class="token keyword">const</span> emojiUrl <span class="token operator">=</span> <span class="token string">'http://xxxxxxxx/emoji/'</span>   

<span class="token keyword">function</span> <span class="token function">parseText</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> renderDom <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 文本消息</span>
    <span class="token keyword">let</span> temp <span class="token operator">=</span> payload<span class="token punctuation">.</span>text
    <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">let</span> right <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>temp <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      left <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'['</span><span class="token punctuation">)</span>
      right <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">']'</span><span class="token punctuation">)</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            renderDom<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
              text<span class="token operator">:</span> temp
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            temp <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> _emoji <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>emojiMap<span class="token punctuation">[</span>_emoji<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果您需要渲染表情包，需要进行匹配您对应[呲牙]的表情包地址</span>
              renderDom<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">'img'</span><span class="token punctuation">,</span>
                src<span class="token operator">:</span> emojiUrl <span class="token operator">+</span> emojiMap<span class="token punctuation">[</span>_emoji<span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
              temp <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              renderDom<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                text<span class="token operator">:</span> <span class="token string">'['</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
              temp <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span>
          renderDom<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> temp
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          temp <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token keyword">break</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          renderDom<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> temp<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          temp <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span>
          <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">return</span> renderDom
<span class="token punctuation">}</span>

<span class="token comment">// 最后的 renderDom 结构为[{name: 'text', text: 'XXX'}, {name: 'img', src: 'http://xxx'}......]</span>
<span class="token comment">// 渲染当前数组即可得到想要的 UI 结果，如：XXX&lt;img src=&quot;https://main.qcloudimg.com/raw/6be88c30a4552b5eb93d8eec243b6593.png&quot;  style=&quot;margin:0;&quot;&gt;XXX&lt;img src=&quot;https://main.qcloudimg.com/raw/6be88c30a4552b5eb93d8eec243b6593.png&quot;  style=&quot;margin:0;&quot;&gt;XXX[呲牙XXX]</span>
</code></pre></div><h2 id="解析系统消息">解析系统消息</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">parseGroupSystemNotice</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> groupName <span class="token operator">=</span>
      payload<span class="token punctuation">.</span>groupProfile<span class="token punctuation">.</span>groupName <span class="token operator">||</span> payload<span class="token punctuation">.</span>groupProfile<span class="token punctuation">.</span>groupID
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>operationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 申请加入群组：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">成功加入群组：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">申请加入群组：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">被拒绝</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">被管理员</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">踢出群组：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 已被</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">解散</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">创建群：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">邀请你加群：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你退出群组：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你被</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">设置为群：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的管理员</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你被</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">撤销群：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的管理员身份</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token number">255</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">'自定义群系统通知'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="解析群提示消息">解析群提示消息</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">parseGroupTipContent</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>operationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_TIP_MBR_JOIN</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群成员：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>userIDList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，加入群组</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_TIP_MBR_QUIT</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群成员：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>userIDList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，退出群组</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_TIP_MBR_KICKED_OUT</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群成员：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>userIDList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，被</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>operatorID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">踢出群组</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_TIP_MBR_SET_ADMIN</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群成员：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>userIDList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，成为管理员</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">case</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_TIP_MBR_CANCELED_ADMIN</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群成员：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>payload<span class="token punctuation">.</span>userIDList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，被撤销管理员</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">'[群提示消息]'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="获取某会话的消息列表">获取某会话的消息列表</h2> <blockquote><p>分页拉取指定会话的消息列表的接口，当用户进入会话首次渲染消息列表或者用户“下拉查看更多消息”时，需调用该接口。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>conversationID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">会话 ID。会话 ID 组成方式：C2C+userID（单聊）GROUP+groupID（群聊）@TIM#SYSTEM（系统通知会话）</td></tr> <tr><td style="text-align:left;"><code>nextReqMessageID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">用于分页续拉的消息 ID。第一次拉取时该字段可不填，每次调用该接口会返回该字段，续拉时将返回字段填入即可</td></tr> <tr><td style="text-align:left;"><code>count</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">需要拉取的消息数量，默认值和最大值为15，即一次拉取至多返回15条消息</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 打开某个会话时，第一次拉取消息列表</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conversationID<span class="token operator">:</span> <span class="token string">'C2Ctest'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageList <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>messageList<span class="token punctuation">;</span> <span class="token comment">// 消息列表。</span>
  <span class="token keyword">const</span> nextReqMessageID <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nextReqMessageID<span class="token punctuation">;</span> <span class="token comment">// 用于续拉，分页续拉时需传入该字段。</span>
  <span class="token keyword">const</span> isCompleted <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>isCompleted<span class="token punctuation">;</span> <span class="token comment">// 表示是否已经拉完所有消息。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下拉查看更多消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conversationID<span class="token operator">:</span> <span class="token string">'C2Ctest'</span><span class="token punctuation">,</span> nextReqMessageID<span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageList <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>messageList<span class="token punctuation">;</span> <span class="token comment">// 消息列表。</span>
  <span class="token keyword">const</span> nextReqMessageID <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nextReqMessageID<span class="token punctuation">;</span> <span class="token comment">// 用于续拉，分页续拉时需传入该字段。</span>
  <span class="token keyword">const</span> isCompleted <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>isCompleted<span class="token punctuation">;</span> <span class="token comment">// 表示是否已经拉完所有消息。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="将会话设置为已读">将会话设置为已读</h2> <blockquote><p>将某会话下的未读消息状态设置为已读，置为已读的消息不会计入到未读统计，当打开会话或切换会话时调用该接口。如果在打开/切换会话时，不调用该接口，则对应的消息会一直是未读的状态。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setMessageRead</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>options</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">消息内容的容器</td></tr></tbody></table> <p>其中 paylaod的描述如下表所示:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>conversationID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话 ID。会话 ID 组成方式：C2C+userID（单聊）GROUP+groupID（群聊）@TIM#SYSTEM（系统通知会话）</td></tr></tbody></table> <p><strong>将某会话下所有未读消息已读上报示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setMessageRead</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conversationID<span class="token operator">:</span> <span class="token string">'C2Cexample'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取会话的列表">获取会话的列表</h2> <blockquote><p>获取会话列表的接口，该接口拉取最近的100条会话，当需要刷新会话列表时调用该接口。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li><p>该接口获取的会话列表中的资料是不完整的（仅包括头像、昵称等，能够满足会话列表的渲染需求），若要查询详细会话资料，请参考 <a href="https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html?_ga=1.40889829.652217193.1589250417#getConversationProfile" target="_blank" rel="noopener noreferrer">getConversationProfile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></li> <li><p>会话保存时长跟会话最后一条消息保存时间一致，消息默认保存7天，即会话默认保存7天。</p></li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">getConversationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>拉取会话列表示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getConversationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> conversationList <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>conversationList<span class="token punctuation">;</span> <span class="token comment">// 会话列表，用该列表覆盖原有的会话列表</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'getConversationList error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取会话列表失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取会话资料">获取会话资料</h2> <blockquote><p>获取会话资料的接口，当单击会话列表中的某个会话时，调用该接口获取会话的详细信息。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">getConversationProfile</span><span class="token punctuation">(</span>conversationID<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>conversationID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话 ID。会话 ID 组成方式：C2C+userID（单聊）GROUP+groupID（群聊）@TIM#SYSTEM（系统通知会话）</td></tr></tbody></table> <p><strong>获取会话资料示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getConversationProfile</span><span class="token punctuation">(</span>conversationID<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>conversation<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会话资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'getConversationProfile error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取会话资料失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="删除会话">删除会话</h2> <blockquote><p>根据会话 ID 删除会话的接口，该接口只删除会话，不删除消息。例如，删除与用户 A 的会话，下次再与用户 A 发起会话时，之前的聊天信息仍在。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">deleteConversation</span><span class="token punctuation">(</span>conversationID<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>conversationID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话 ID。会话 ID 组成方式：C2C+userID（单聊）GROUP+groupID（群聊）@TIM#SYSTEM（系统通知会话）</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">deleteConversation</span><span class="token punctuation">(</span><span class="token string">'C2CExample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//删除成功。</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> conversationID <span class="token punctuation">}</span> <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">;</span><span class="token comment">// 被删除的会话 ID。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'deleteConversation error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除会话失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="未读计数">未读计数</h2> <blockquote><p>这里的未读消息是指用户没有进行已读上报的消息，而非对方是否已经阅读。如需显示正确的未读计数，需要开发者显式调用已读上报，告诉 IM SDK 某个会话的消息是否已读，例如，当用户进入聊天界面，可以设置整个会话的消息已读。</p></blockquote> <h3 id="获取当前未读消息数量">获取当前未读消息数量</h3> <p>每次使用 <code>getConversationList()</code> 时，会获得<code>[Conversation，Conversation，......]</code>数组，每个<code>Conversation</code>都有当前会话的未读数目，用<code>unreadCount</code>表示。</p> <p>所有会话的未读计数，由所有会话的<code>unreadCount</code>相加所得。</p> <h3 id="已读上报">已读上报</h3> <p>当用户阅读某个会话的消息后，需要进行会话消息的已读上报，IM SDK 根据会话中最后一条阅读的消息，设置会话中之前所有消息为已读。建议在单击进行切换会话时进行消息的已读上报。</p> <p>:::tips
已读上报只会改变会话的未读计数，不会向消息发送者推送回执状态。
:::</p> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setMessageRead</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>conversationID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">会话 ID。</td></tr></tbody></table> <p><strong>将某会话下所有未读消息已读上报示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">setMessageRead</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conversationID<span class="token operator">:</span> <span class="token string">'C2Cexample'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 已读上报成功</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 已读上报失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'setMessageRead error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="网络状态相关">网络状态相关</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">onConnNotify</span> <span class="token operator">=</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>ErrorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> webim<span class="token punctuation">.</span><span class="token constant">CONNECTION_STATUS</span><span class="token punctuation">.</span><span class="token constant">ON</span><span class="token operator">:</span>
            <span class="token comment">// webim.Log.warn('连接状态正常...');</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> webim<span class="token punctuation">.</span><span class="token constant">CONNECTION_STATUS</span><span class="token punctuation">.</span><span class="token constant">OFF</span><span class="token operator">:</span>
            webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'连接已断开，无法收到新消息，请检查下你的网络是否正常'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token constant">WPT</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">tips</span><span class="token punctuation">(</span><span class="token string">'网络不稳定，无法收到新消息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">未知连接状态,status=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>ErrorCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="创建群聊">创建群聊</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>该接口创建 <code>TIM.TYPES.GRP_AVCHATROOM（音视频聊天室）</code> 后，需调用 <code>joinGroup</code> 接口加入群组后，才能进行消息收发流程。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">默认值</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>name</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>type</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">TIM.TYPES.GRP_PRIVATE</td></tr> <tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>introduction</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>notification</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>avatar</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>maxMemberNum</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>joinOption</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">TIM.TYPES.JOIN_OPTIONS_FREE_ACCESS</td></tr> <tr><td style="text-align:left;"><code>memberList</code></td> <td style="text-align:left;"><code>Array&lt;Object&gt;</code></td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>groupCustomField</code></td> <td style="text-align:left;"><code>Array&lt;Object&gt;</code></td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr></tbody></table> <p>其中 <code>memberList</code>参数说明:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>userID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">必填，群成员的 UserID</td></tr> <tr><td style="text-align:left;"><code>role</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">成员身份，可选值只有 <code>Admin</code>，表示添加该成员并设置为管理员</td></tr> <tr><td style="text-align:left;"><code>memberCustomField</code></td> <td style="text-align:left;"><code>Array&lt;Object&gt;</code></td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">群成员维度的自定义字段，默认没有自定义字段，如需开通请参见 <a href="https://cloud.tencent.com/document/product/269/1502#.E8.87.AA.E5.AE.9A.E4.B9.89.E5.AD.97.E6.AE.B5" target="_blank" rel="noopener noreferrer">自定义字段<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table> <p><strong>创建私有群示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_PRIVATE</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'WebSDK'</span><span class="token punctuation">,</span>
  memberList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>userID<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>userID<span class="token operator">:</span> <span class="token string">'user2'</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 如果填写了 memberList，则必须填写 userID</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 创建成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建的群的资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'createGroup error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建群组失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="解散群组">解散群组</h2> <blockquote><p>群主可调用该接口解散群组。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>群主不能解散私有群。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// groupID	String	群组 ID</span>
tim<span class="token punctuation">.</span><span class="token function">dismissGroup</span><span class="token punctuation">(</span>groupID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>解散群组示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">dismissGroup</span><span class="token punctuation">(</span><span class="token string">'group1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 解散成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>groupID<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 被解散的群组 ID</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'dismissGroup error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解散群组失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="更新群组资料">更新群组资料</h2> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">updateGroupProfile</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">默认值</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>name</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>avatar</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>introduction</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>notification</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>maxMemberNum</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>joinOption</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">TIM.TYPES.JOIN_OPTIONS_FREE_ACCESS</td></tr> <tr><td style="text-align:left;"><code>groupCustomField</code></td> <td style="text-align:left;"><code>Array&lt;Object&gt;</code></td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">-</td></tr></tbody></table> <p>其中 <code>groupCustomField</code> 参数说明:</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>key</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">自定义字段的 Key</td></tr> <tr><td style="text-align:left;"><code>value</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">自定义字段的 Value</td></tr></tbody></table> <p><strong>更新群组资料示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">updateGroupProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'new name'</span><span class="token punctuation">,</span> <span class="token comment">// 修改群名称</span>
  introduction<span class="token operator">:</span> <span class="token string">'this is introduction.'</span><span class="token punctuation">,</span> <span class="token comment">// 修改群公告</span>
  <span class="token comment">// v2.6.0 起，群成员能收到群自定义字段变更的群提示消息，且能获取到相关的内容，详见 Message.payload.newGroupProfile.groupCustomField</span>
  groupCustomField<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'group_level'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'high'</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 修改群组维度自定义字段</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span> <span class="token comment">// 修改成功后的群组详细资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'updateGroupProfile error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改群组资料失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="加入群聊">加入群聊</h2> <blockquote><p>私有群不能申请加入，只能由群成员邀请加入。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">joinGroup</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;"><code>applyMessage</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">附言</td></tr> <tr><td style="text-align:left;"><code>type</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">待加入的群组的类型，加入音视频聊天室时该字段必填。</td></tr></tbody></table> <p>其中 <code>type</code>可选值如下:</p> <ul><li><code>TIM.TYPES.GRP_PUBLIC</code>：公开群</li> <li><code>TIM.TYPES.GRP_CHATROOM</code>：聊天室</li> <li><code>TIM.TYPES.GRP_AVCHATROOM</code>：音视频聊天室</li></ul> <p><strong>加入群聊示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.7.3</span>
<span class="token keyword">function</span> <span class="token function">applyJoinBigGroup</span><span class="token punctuation">(</span><span class="token parameter">groupId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _options <span class="token operator">=</span> <span class="token punctuation">{</span>
        GroupId<span class="token operator">:</span> groupId<span class="token punctuation">,</span> <span class="token comment">// 群id</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 先进行退群操作</span>
    <span class="token function">quitBigGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 比如此处2.6.2版本的方法变为了 webim.joinGroup</span>
    webim<span class="token punctuation">.</span><span class="token function">applyJoinBigGroup</span><span class="token punctuation">(</span>
        _options<span class="token punctuation">,</span>
        <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// JoinedSuccess:加入成功; WaitAdminApproval:等待管理员审批</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resp<span class="token operator">?.</span>JoinedStatus <span class="token operator">===</span> <span class="token string">'JoinedSuccess'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'进群成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 其他进群成功的操作</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进群失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 可以尝试重新进群</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>ErrorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 可以尝试重新进群</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2.7.0</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">joinGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> 
    type<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_AVCHATROOM</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">JOIN_STATUS_WAIT_APPROVAL</span><span class="token operator">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 等待管理员同意</span>
    <span class="token keyword">case</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">JOIN_STATUS_SUCCESS</span><span class="token operator">:</span> <span class="token comment">// 加群成功</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加入的群组资料</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'joinGroup error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 申请加群失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="退出群聊">退出群聊</h2> <blockquote><p>群主只能退出私有群，退出后该私有群无群主。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// groupID	String	群组 ID</span>
tim<span class="token punctuation">.</span><span class="token function">quitGroup</span><span class="token punctuation">(</span>groupID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>退出群聊的示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.7.3</span>
<span class="token keyword">function</span> <span class="token function">quitBigGroup</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> failed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>avChatRoomId<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> _options <span class="token operator">=</span> <span class="token punctuation">{</span>
        GroupId<span class="token operator">:</span> avChatRoomId<span class="token punctuation">,</span> <span class="token comment">// 群id</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    webim<span class="token punctuation">.</span><span class="token function">quitBigGroup</span><span class="token punctuation">(</span>
        _options<span class="token punctuation">,</span>
        <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'退群成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            failed <span class="token operator">&amp;&amp;</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>ErrorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2.7.0</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">quitGroup</span><span class="token punctuation">(</span><span class="token string">'group1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>groupID<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 退出成功的群 ID</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'quitGroup error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 退出群组失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="根据群-id-搜索群组">根据群 ID 搜索群组</h2> <blockquote><p>私有群不能被搜索。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// groupID	String	群组 ID</span>
tim<span class="token punctuation">.</span><span class="token function">searchGroupByID</span><span class="token punctuation">(</span>groupID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>根据群 ID 搜索群组示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">searchGroupByID</span><span class="token punctuation">(</span><span class="token string">'group1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> group <span class="token operator">=</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">;</span> <span class="token comment">// 群组信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'searchGroupByID error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 搜素群组失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="转让群组">转让群组</h2> <blockquote><p>只有群主拥有转让的权限，音视频聊天室不能转让。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">changeGroupOwner</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">待转让的群组 ID</td></tr> <tr><td style="text-align:left;"><code>newOwnerID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">新群主的 ID</td></tr></tbody></table> <p><strong>转让群组示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">changeGroupOwner</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span>
  newOwnerID<span class="token operator">:</span> <span class="token string">'user2'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 转让成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 群组资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 转让失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'changeGroupOwner error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转让群组失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="处理加群申请">处理加群申请</h2> <blockquote><p>当用户申请加入一个需要管理员同意的群组时，管理员/群主会收到申请加群的【群系统通知消息】，详情请参见 Message。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">handleGroupApplication</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>handleAction</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">处理结果 Agree（同意） / Reject（拒绝）</td></tr> <tr><td style="text-align:left;"><code>handleMessage</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">附言</td></tr> <tr><td style="text-align:left;"><code>message</code></td> <td style="text-align:left;">Message</td> <td style="text-align:left;">-</td> <td style="text-align:left;">申请加群的【群系统通知消息】的消息实例。</td></tr></tbody></table> <p>Message实例可通过以下方式获取：</p> <ul><li><p>收到新的群系统通知事件 的回调参数中获取</p></li> <li><p>系统类型会话的消息列表中获取</p></li></ul> <p><strong>处理加群申请的示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">handleGroupApplication</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  handleAction<span class="token operator">:</span> <span class="token string">'Agree'</span><span class="token punctuation">,</span>
  handleMessage<span class="token operator">:</span> <span class="token string">'欢迎欢迎'</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> message <span class="token comment">// 申请加群群系统通知的消息实例</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 群组资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'handleGroupApplication error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="设置群消息提示类型">设置群消息提示类型</h2> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setMessageRemindType</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组 ID</td></tr> <tr><td style="text-align:left;"><code>messageRemindType</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群消息提示类型。</td></tr></tbody></table> <p><code>messageRemindType</code>类型如下:</p> <ul><li><p><code>TIM.TYPES.MSG_REMIND_ACPT_AND_NOTE</code>：SDK 接收消息并抛出 收到消息事件 通知接入侧，接入侧做提示</p></li> <li><p><code>TIM.TYPES.MSG_REMIND_ACPT_NOT_NOTE</code>：SDK 接收消息并抛出 收到消息事件 通知接入侧，接入侧不做提示</p></li> <li><p><code>TIM.TYPES.MSG_REMIND_DISCARD</code>：SDK 拒收消息，不会抛出 收到新消息事件</p></li></ul> <p><strong>群消息提示类型示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">setMessageRemindType</span><span class="token punctuation">(</span><span class="token punctuation">{</span> groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> messageRemindType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">MSG_REMIND_DISCARD</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拒收消息</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置后的群资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'setMessageRemindType error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取群成员列表">获取群成员列表</h2> <p>:::tips</p> <ul><li><p>从<code>v2.6.2</code>版本开始，该接口支持拉取群成员禁言截止时间戳（muteUntil），接入侧可根据此值判断群成员是否被禁言，以及禁言的剩余时间。</p></li> <li><p>低于<code>v2.6.2</code>版本时，该接口获取的群成员列表中的资料仅包括头像、昵称等，能够满足群成员列表的渲染需求。如需查询群成员禁言截止时间戳（muteUntil）等详细资料，请使用 getGroupMemberProfile。</p></li> <li><p>该接口是分页拉取群成员，不能直接用于获取群的总人数。获取群的总人数（memberNum）请使用 getGroupProfile 。
:::</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">getGroupMemberList</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>count</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">15</td> <td style="text-align:left;">需要拉取的数量。最大值为100，避免回包过大导致请求失败。若传入超过100，则只拉取前100个</td></tr> <tr><td style="text-align:left;"><code>offset</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">0</td> <td style="text-align:left;">偏移量，默认从0开始拉取</td></tr></tbody></table> <p><strong>获取群成员列表示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getGroupMemberList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> 
  count<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> 
  offset<span class="token operator">:</span><span class="token number">0</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从0开始拉取30个群成员</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>memberList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 群成员列表</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'getGroupMemberList error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 从v2.6.2 起，该接口支持拉取群成员禁言截止时间戳。</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">getGroupMemberList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> offset<span class="token operator">:</span><span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从0开始拉取30个群成员</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>memberList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 群成员列表</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> groupMember <span class="token keyword">of</span> imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>memberList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>groupMember<span class="token punctuation">.</span>muteUntil <span class="token operator">*</span> <span class="token number">1000</span>  <span class="token operator">&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupMember<span class="token punctuation">.</span>userID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 禁言中</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>groupMember<span class="token punctuation">.</span>userID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 未被禁言</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'getGroupMemberProfile error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取群成员资料">获取群成员资料</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li><p>使用该接口前，需要将 SDK 版本升级至v2.2.0或以上。</p></li> <li><p>每次查询的用户数上限为50。如果传入的数组长度大于50，则只取前50个用户进行查询，其余丢弃。</p></li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">getGroupMemberProfile</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userIDList</code></td> <td style="text-align:left;"><code>Array.&lt;String&gt;</code></td> <td style="text-align:left;">-</td> <td style="text-align:left;">要查询的群成员用户 ID 列表</td></tr> <tr><td style="text-align:left;"><code>memberCustomFieldFilter</code></td> <td style="text-align:left;"><code>Array.&lt;String&gt;</code></td> <td style="text-align:left;"><code>&lt;optional&gt;</code></td> <td style="text-align:left;">群成员自定义字段筛选。可选，若不填，则默认查询所有群成员自定义字段</td></tr></tbody></table> <h2 id="添加群成员">添加群成员</h2> <p>添加群成员需要遵循以下的规则：</p> <ul><li><p><code>TIM.TYPES.GRP_PRIVATE 私有群</code>：任何群成员都可邀请他人加群，且无需被邀请人同意，直接将其拉入群组中。</p></li> <li><p><code>TIM.TYPES.GRP_PUBLIC 公开群/ TIM.TYPES.GRP_CHATROOM 聊天室</code>：只有 App 管理员可以邀请他人入群，且无需被邀请人同意，直接将其拉入群组中。</p></li> <li><p><code>TIM.TYPES.GRP_AVCHATROOM 音视频聊天室</code>：不允许任何人邀请他人入群（包括 App 管理员）。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">addGroupMember</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userIDList</code></td> <td style="text-align:left;"><code>Array.&lt;String&gt;</code></td> <td style="text-align:left;">待添加的群成员 ID 数组。单次最多添加500个成员</td></tr></tbody></table> <p>其中then的回调函数参数为 <code>IMResponse</code>，<code>IMResponse.data</code>属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>successUserIDList</code></td> <td style="text-align:left;"><code>Array&lt;String&gt;</code></td> <td style="text-align:left;">添加成功的 userID 列表</td></tr> <tr><td style="text-align:left;"><code>failureUserIDList</code></td> <td style="text-align:left;"><code>Array&lt;String&gt;</code></td> <td style="text-align:left;">添加失败的 userID 列表</td></tr> <tr><td style="text-align:left;"><code>existedUserIDList</code></td> <td style="text-align:left;"><code>Array&lt;String&gt;</code></td> <td style="text-align:left;">已在群中的 userID 列表</td></tr> <tr><td style="text-align:left;"><code>group</code></td> <td style="text-align:left;"><code>Group</code></td> <td style="text-align:left;">接口调用后的群组资料</td></tr></tbody></table> <p><strong>添加群成员的示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">addGroupMember</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span>
  userIDList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'user1'</span><span class="token punctuation">,</span><span class="token string">'user2'</span><span class="token punctuation">,</span><span class="token string">'user3'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>successUserIDList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加成功的群成员 userIDList</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>failureUserIDList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加失败的群成员 userIDList</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>existedUserIDList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 已在群中的群成员 userIDList</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加后的群组信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'addGroupMember error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="删除群成员">删除群成员</h2> <blockquote><p>删除群成员。群主可移除群成员。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">deleteGroupMember</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userIDList</code></td> <td style="text-align:left;"><code>Array.&lt;String&gt;</code></td> <td style="text-align:left;">待删除的群成员的 ID 列表</td></tr> <tr><td style="text-align:left;"><code>reason</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">踢人的原因，可选参数</td></tr></tbody></table> <p><strong>删除群成员示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">deleteGroupMember</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> 
  userIDList<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'user1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
  reason<span class="token operator">:</span> <span class="token string">'你违规了，我要踢你！'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除后的群组信息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>userIDList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 被删除的群成员的 userID 列表</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'deleteGroupMember error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="禁言或取消禁言">禁言或取消禁言</h2> <blockquote><p>设置群成员的禁言时间，可以禁言群成员，也可取消禁言。<code>TIM.TYPES.GRP_PRIVATE</code> 类型的群组（即私有群）不能禁言。</p></blockquote> <p>:::tips
只有群主和管理员拥有该操作权限：</p> <ul><li><p>群主可以禁言/取消禁言管理员和普通群成员。</p></li> <li><p>管理员可以禁言/取消禁言普通群成员。
:::</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setGroupMemberMuteTime</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群成员 ID</td></tr> <tr><td style="text-align:left;"><code>muteTime</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">禁言时长，单位秒 例如，设置该值为1000，则表示即刻起禁言该用户1000秒，设置为0，则表示取消禁言</td></tr></tbody></table> <p><strong>禁言或取消禁言示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">setGroupMemberMuteTime</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span>
  userID<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  muteTime<span class="token operator">:</span> <span class="token number">600</span> <span class="token comment">// 禁言10分钟；设为0，则表示取消禁言</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改后的群资料</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改后的群成员资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'setGroupMemberMuteTime error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 禁言失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="设为管理员或撤销管理员">设为管理员或撤销管理员</h2> <blockquote><p>修改群成员角色，只有群主拥有操作权限。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setGroupMemberRole</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群成员 ID</td></tr> <tr><td style="text-align:left;"><code>role</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">权限</td></tr></tbody></table> <p>其中 role的类型如下:</p> <ul><li><p>TIM.TYPES.GRP_MBR_ROLE_ADMIN（群管理员</p></li> <li><p>TIM.TYPES.GRP_MBR_ROLE_MEMBER（群普通成员）</p></li></ul> <p><strong>设置管理员权限示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">setGroupMemberRole</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span>
  userID<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  role<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">GRP_MBR_ROLE_ADMIN</span> <span class="token comment">// 将群 ID: group1 中的用户：user1 设为管理员</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改后的群资料</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改后的群成员资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'setGroupMemberRole error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="修改群名片">修改群名片</h2> <blockquote><p>设置群成员名片。</p></blockquote> <ul><li><p>群主：可设置所有群成员的名片。</p></li> <li><p>管理员：可设置自身和其他普通群成员的群名片。</p></li> <li><p>普通群成员：只能设置自身群名片。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setGroupMemberNameCard</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userID</code></td> <td style="text-align:left;"><code>String&lt;optional&gt;</code></td> <td style="text-align:left;">可选，默认修改自身的群名片</td></tr> <tr><td style="text-align:left;"><code>nameCard</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">-</td></tr></tbody></table> <p><strong>修改群名片示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">setGroupMemberNameCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> 
  userID<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span> 
  nameCard<span class="token operator">:</span> <span class="token string">'用户名片'</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置后的群资料</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改后的群成员资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'setGroupMemberNameCard error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置群成员名片失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="修改自定义字段">修改自定义字段</h2> <blockquote><p>设置群成员自定义字段。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>普通群成员只能设置自己的自定义字段。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>tim<span class="token punctuation">.</span><span class="token function">setGroupMemberCustomField</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>参数<code>options</code>为<code>Object</code>类型，包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>groupID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">群组的 ID</td></tr> <tr><td style="text-align:left;"><code>userID</code></td> <td style="text-align:left;"><code>String&lt;optional&gt;</code></td> <td style="text-align:left;">可选，不填则修改自己的群成员自定义字段</td></tr> <tr><td style="text-align:left;"><code>memberCustomField</code></td> <td style="text-align:left;"><code>Array&lt;Object&gt;</code></td> <td style="text-align:left;">群成员自定义字段</td></tr></tbody></table> <p>其中<code>memberCustomField</code>包含的属性值如下表所示：</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>key</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">自定义字段的 Key</td></tr> <tr><td style="text-align:left;"><code>value</code></td> <td style="text-align:left;"><code>String&lt;optional&gt;</code></td> <td style="text-align:left;">自定义字段的 Value</td></tr></tbody></table> <p><strong>修改自定义字段示例:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">setGroupMemberCustomField</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  groupID<span class="token operator">:</span> <span class="token string">'group1'</span><span class="token punctuation">,</span> 
  memberCustomField<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    key<span class="token operator">:</span> <span class="token string">'group_member_test'</span><span class="token punctuation">,</span> 
    value<span class="token operator">:</span> <span class="token string">'test'</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置后的群资料</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改后的群成员资料</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'setGroupMemberCustomField error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置群成员自定义字段失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="群提示消息">群提示消息</h2> <blockquote><p>当有用户被邀请加入群组或有用户被移出群组等事件发生时，群内会产生提示消息，接入侧可以根据需要展示给群组用户，或者忽略。</p></blockquote> <p>群提示消息有多种类型，详细描述请参见 <a href="https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/Message.html?_ga=1.172719974.453947682.1548379635#.GroupTipPayload" target="_blank" rel="noopener noreferrer"><code>Message.GroupTipPayload</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>operatorID</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">执行该操作的用户 ID</td></tr> <tr><td style="text-align:left;"><code>operationType</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">操作类型</td></tr> <tr><td style="text-align:left;"><code>userIDList</code></td> <td style="text-align:left;"><code>Array&lt;String&gt;</code></td> <td style="text-align:left;">相关的 userID 列表</td></tr> <tr><td style="text-align:left;"><code>newGroupProfile</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">若是群资料变更，该字段存放变更的群资料</td></tr></tbody></table> <p>其中<code>operationType</code>属性如下:</p> <table><thead><tr><th style="text-align:left;">操作类型</th> <th style="text-align:left;">值</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_MBR_JOIN</code></td> <td style="text-align:left;">1</td> <td style="text-align:left;">有成员加群</td></tr> <tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_MBR_QUIT</code></td> <td style="text-align:left;">2</td> <td style="text-align:left;">有群成员退群</td></tr> <tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_MBR_KICKED_OUT</code></td> <td style="text-align:left;">3</td> <td style="text-align:left;">有群成员被踢出群</td></tr> <tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_MBR_SET_ADMIN</code></td> <td style="text-align:left;">4</td> <td style="text-align:left;">有群成员被设为管理员</td></tr> <tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_MBR_CANCELED_ADMIN</code></td> <td style="text-align:left;">5</td> <td style="text-align:left;">有群成员被撤销管理员</td></tr> <tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_GRP_PROFILE_UPDATED</code></td> <td style="text-align:left;">6</td> <td style="text-align:left;">群组资料变更</td></tr> <tr><td style="text-align:left;"><code>TIM.TYPES.GRP_TIP_MBR_PROFILE_UPDATED</code></td> <td style="text-align:left;">7</td> <td style="text-align:left;">群成员资料变更，例如：群成员被禁言</td></tr></tbody></table> <p>群提示消息的 <code>content</code> 结构。系统会在恰当的时机，向全体群成员发出群提示消息。例如：有群成员退群/进群，系统会给所有群成员发对应的群提示消息。</p> <h2 id="群系统通知">群系统通知</h2> <p>当有用户申请加群等事件发生时，管理员会收到申请加群等系统消息。管理员同意或拒绝加群申请，IM SDK 会将相应的消息通过群系统通知消息发送给接入侧，由接入侧展示给用户。</p> <p>群系统通知消息有多种类型，详细描述请参见 <a href="https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/Message.html?_ga=1.65789419.453947682.1548379635#.GroupSystemNoticePayload" target="_blank" rel="noopener noreferrer">群系统通知类型常量及含义<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">onGroupSystemNoticeReceived</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> type <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">;</span> <span class="token comment">// 群系统通知的类型，详情请参见 Message.GroupSystemNoticePayload </span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">;</span> <span class="token comment">// 群系统通知的消息实例，详情请参见 Message</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 消息内容. 群系统通知 payload 结构描述</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">GROUP_SYSTEM_NOTICE_RECEIVED</span><span class="token punctuation">,</span> onGroupSystemNoticeReceived<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">操作类型</th> <th style="text-align:left;">值</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">operatorID</td> <td style="text-align:left;">String</td> <td style="text-align:left;">执行该操作的用户 ID</td></tr> <tr><td style="text-align:left;">operationType</td> <td style="text-align:left;">Number</td> <td style="text-align:left;">操作类型</td></tr> <tr><td style="text-align:left;">groupProfile</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">相关的群组资料</td></tr> <tr><td style="text-align:left;">handleMessage</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">处理的附言,例如，user1 申请加入进群需要验证的 group1 时，若 <code>user1</code> 填写了申请加群的附言，则 <code>group1</code> 的管理员会在相应群系统通知中看到该字段</td></tr></tbody></table> <p><strong><code>operationType</code>属性群系统通知类型常量及含义详细如下:</strong></p> <table><thead><tr><th style="text-align:left;">操作类型</th> <th style="text-align:left;">值</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">有用户申请加群</td> <td style="text-align:left;">群管理员/群主接收</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">申请加群被同意</td> <td style="text-align:left;">申请加群的用户接收</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">申请加群被拒绝</td> <td style="text-align:left;">申请加群的用户接收</td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">被踢出群组</td> <td style="text-align:left;">被踢出的用户接收</td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">群组被解散</td> <td style="text-align:left;">全体群成员接收</td></tr> <tr><td style="text-align:left;">6</td> <td style="text-align:left;">创建群组</td> <td style="text-align:left;">创建者接收</td></tr> <tr><td style="text-align:left;">7</td> <td style="text-align:left;">邀请加群</td> <td style="text-align:left;">被邀请者接收</td></tr> <tr><td style="text-align:left;">8</td> <td style="text-align:left;">退群</td> <td style="text-align:left;">退群者接收</td></tr> <tr><td style="text-align:left;">9</td> <td style="text-align:left;">设置管理员</td> <td style="text-align:left;">被设置方接收</td></tr> <tr><td style="text-align:left;">10</td> <td style="text-align:left;">取消管理员</td> <td style="text-align:left;">被取消方接收</td></tr> <tr><td style="text-align:left;">255</td> <td style="text-align:left;">用户自定义通知</td> <td style="text-align:left;">默认全员接收</td></tr></tbody></table> <p>群系统通知的 content 结构。系统会在恰当的时机，向特定用户发出群系统通知。例如，user1 被踢出群组，系统会给 user1 发送对应的群系统消息。</p> <h2 id="登出">登出</h2> <p>登出即时通信 IM，通常在切换帐号的时候调用，清除登录态以及内存中的所有数据。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><p>调用此接口的实例会发布 <code>SDK_NOT_READY</code> 事件，此时该实例下线，无法收、发消息。</p></li> <li><p>如果您在即时通信 IM 控制台配置的“Web端实例同时在线个数”大于 1，且同一账号登录了<code>a1</code>和<code>a2</code>两个实例（含小程序端），当执行<code>a1.logout()</code>后，<code>a1</code>会下线，无法收、发消息。而<code>a2</code>实例不会受影响。</p></li> <li><p>多实例被踢：基于第 2 点，如果“Web端实例同时在线个数”配置为 2，且您的某一账号已经登录了 <code>a1</code>，<code>a2</code>两个实例，当使用此账号成功登录第三个实例<code>a3</code>时，<code>a1</code>或<code>a2</code>中的一个实例会被踢下线（通常是最先处在登录态的实例会触发），这种情况称之为<code>多实例被踢</code>。假设<code>a1</code>实例被踢下线，<code>a1</code>实例内部会执行登出流程，然后抛出<code>KICKED_OUT</code>事件，接入侧可以监听此事件，并在触发时跳转到登录页。此时<code>a1</code>实例下线，而<code>a2</code>、<code>a3</code>实例可以正常运行。</p></li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webim<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        webim<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'登出成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="集成新版完整的流程">集成新版完整的流程</h2> <ul><li>2020.06.17</li></ul> <p>这里使用的版本为<code>2.7.0</code>,如未安装参考上方的安装命令。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token constant">TIM</span> <span class="token keyword">from</span> <span class="token string">'tim-js-sdk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">COS</span> <span class="token keyword">from</span> <span class="token string">&quot;cos-js-sdk-v5&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 接入时需要替换为您的即时通信 IM 应用的 SDKAppID</span>
    SDKAppID<span class="token operator">:</span> xxxxxxx<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 SDK 实例，`TIM.create()`方法对于同一个 `SDKAppID` 只会返回同一份实例</span>
<span class="token keyword">let</span> tim <span class="token operator">=</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SDK 实例通常用 tim 表示</span>

<span class="token comment">/**
 * 设置 SDK 日志输出级别，详细分级
 * 0 普通级别，日志量较多，接入时建议使用
 * 1 release级别，SDK 输出关键信息，生产环境时建议使用
 * 2 告警级别，SDK 只输出告警和错误级别的日志
 * 3 错误级别，SDK 只输出错误级别的日志s
 * 4 无日志级别，SDK 将不打印任何日志
 */</span>
tim<span class="token punctuation">.</span><span class="token function">setLogLevel</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册 COS SDK 插件</span>
tim<span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'cos-wx-sdk'</span><span class="token operator">:</span> <span class="token constant">COS</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
 * 收到离线消息和会话列表同步完毕通知，
 * event.name - TIM.EVENT.SDK_READY
 * 接入侧可以调用 sendMessage 等需要鉴权的接口
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">SDK_READY</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到推送的单聊、群聊、群提示、群系统通知的新消息
 * event.name - TIM.EVENT.MESSAGE_RECEIVED
 * event.data - 存储 Message 对象的数组 - [Message]
 * 可通过遍历 event.data 获取消息列表数据并渲染到页面
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_RECEIVED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到消息被撤回的通知
 * event.name - TIM.EVENT.MESSAGE_REVOKED
 * event.data - 存储 Message 对象的数组 - [Message]
 * 每个 Message 对象的 isRevoked 属性值为 true
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_REVOKED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到会话列表更新通知
 * event.name - TIM.EVENT.CONVERSATION_LIST_UPDATED
 * event.data - 存储 Conversation 对象的数组 - [Conversation]
 * 可通过遍历 event.data 获取会话列表数据并渲染到页面
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">CONVERSATION_LIST_UPDATED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到群组列表更新通知
 * event.name - TIM.EVENT.GROUP_LIST_UPDATED
 * event.data - 存储 Group 对象的数组 - [Group]
 * 可通过遍历 event.data 获取群组列表数据并渲染到页面
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">GROUP_LIST_UPDATED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到新的群系统通知
 * event.name - TIM.EVENT.GROUP_SYSTEM_NOTICE_RECEIVED
 * event.data.type - 群系统通知的类型，详情请参见 GroupSystemNoticePayload 的 operationType 枚举值说明
 * event.data.message - Message 对象，
 * 可将 event.data.message.content 渲染到到页面
 * --------------------------------------------
 * GroupSystemNoticePayload 属性详解
 * @param operatorID {string} 执行该操作的用户 ID
 * @param operationType	{number} 操作类型，具体如下：
 * 值          描述                 接收对象
 * 1       有用户申请加群         群管理员/群主接收
 * 2	   申请加群被同意	      申请加群的用户接收
 * 3	   申请加群被拒绝	      申请加群的用户接收
 * 4	     被踢出群组	          被踢出的用户接收
 * 5	     群组被解散	          全体群成员接收
 * 6	     创建群组	          创建者接收
 * 7	     邀请加群	          被邀请者接收
 * 8	       退群	              退群者接收
 * 9	     设置管理员	           被设置方接收
 * 10	     取消管理员	           被取消方接收
 * 255	     用户自定义通知	        默认全员接收
 * @param groupProfile {object}	相关的群组资料
 * @param userDefinedField	{string} 用户自定义字段。
 * @param handleMessage	{object} 处理的附言。
 * --------------------------------------------
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">GROUP_SYSTEM_NOTICE_RECEIVED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到自己或好友的资料变更通知
 * event.name - TIM.EVENT.PROFILE_UPDATED
 * event.data - 存储 Profile 对象的数组 - [Profile]
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">PROFILE_UPDATED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到黑名单列表更新通知
 * event.name - TIM.EVENT.BLACKLIST_UPDATED
 * event.data - 存储 userID 的数组 - [userID]
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">BLACKLIST_UPDATED</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到 SDK 发生错误通知，可以获取错误码和错误信息
 * event.name - TIM.EVENT.ERROR
 * event.data.code - 错误码
 * event.data.message - 错误信息
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到 SDK 进入 not ready 状态通知，此时 SDK 无法正常工作
 * event.name - TIM.EVENT.SDK_NOT_READY
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">SDK_NOT_READY</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ....</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 收到被踢下线通知
 * event.name - TIM.EVENT.KICKED_OUT
 * event.data.type - 被踢下线的原因，例如:
 * - TIM.TYPES.KICKED_OUT_MULT_ACCOUNT 多实例登录被踢
 * - TIM.TYPES.KICKED_OUT_MULT_DEVICE 多终端登录被踢
 * - TIM.TYPES.KICKED_OUT_USERSIG_EXPIRED 签名过期被踢 （v2.4.0起支持）。
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">KICKED_OUT</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 网络状态发生改变（v2.5.0 起支持）
 * event.name - TIM.EVENT.NET_STATE_CHANGE
 * event.data.state 当前网络状态，枚举值及说明如下：
 * - TIM.TYPES.NET_STATE_CONNECTED - 已接入网络
 * - TIM.TYPES.NET_STATE_CONNECTING - 连接中。很可能遇到网络抖动，SDK 在重试。接入侧可根据此状态提示“当前网络不稳定”或“连接中”
 * - TIM.TYPES.NET_STATE_DISCONNECTED - 未接入网络。接入侧可根据此状态提示“当前网络不可用”。SDK 仍会继续重试，若用户网络恢复，SDK 会自动同步消息 。
 */</span>
tim<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">NET_STATE_CHANGE</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * 登录IM
 * @param userID {string} 用户的ID
 * @param userSig {string} 用户登录即时通信 IM 的密码，其本质是对 UserID 等信息加密后得到的密文,参见上方登录流程。
 */</span>
tim<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userID<span class="token operator">:</span> <span class="token string">'your userID'</span><span class="token punctuation">,</span> userSig<span class="token operator">:</span> <span class="token string">'your userSig'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 登录成功</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'login error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 登录失败的相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登出IM
 * @return Promise
 */</span>
tim<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 登出成功</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'logout error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/****************消息收发********************/</span>

<span class="token comment">/**
 * 创建文本消息
 * 创建文本消息的接口，此接口返回一个消息实例，可以在需要发送文本消息时调用 发送消息 接口发送消息实例。
 * @param options {object} 
 * - to {string} 消息接收方的 userID 或 groupID
 * - conversationType {string} 会话类型，取值TIM.TYPES.CONV_C2C（端到端会话） 或 TIM.TYPES.CONV_GROUP（群组会话）
 * - payload {object} 消息内容的容器
 * -- text {string} 消息文本内容
 */</span>
tim<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*--------- 发送文本消息示例---------*/</span>

<span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考：https://cloud.tencent.com/document/product/269/3663#.E6.B6.88.E6.81.AF.E4.BC.98.E5.85.88.E7.BA.A7.E4.B8.8E.E9.A2.91.E7.8E.87.E6.8E.A7.E5.88.B6)</span>
  <span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
  <span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_NORMAL,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'Hello world!'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 发送图片消息
 * 创建图片消息的接口，此接口返回一个消息实例，可以在需要发送图片消息时调用 发送消息 接口发送消息实例。
 * @param options {object} 
 * - to {string} 消息接收方的 userID 或 groupID
 * - conversationType {string} 会话类型，取值TIM.TYPES.CONV_C2C（端到端会话） 或 TIM.TYPES.CONV_GROUP（群组会话）
 * - payload {object} 消息内容的容器
 * -- file { HTMLInputElement 或 Object } 用于选择图片的 DOM 节点（Web）或者 File 对象（Web）或者微信小程序 wx.chooseImage 接口的 success 回调参数。SDK 会读取其中的数据并上传图片。
 * - onProgress {function} 获取上传进度的回调函数
 */</span>

tim<span class="token punctuation">.</span><span class="token function">createImageMessage</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>

<span class="token comment">/*--------- 发送图片消息示例---------*/</span>

<span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createImageMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
  conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息优先级，用于群聊（v2.4.2起支持）。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息，详细请参考 消息优先级与频率控制</span>
  <span class="token comment">// 支持的枚举值：TIM.TYPES.MSG_PRIORITY_HIGH, TIM.TYPES.MSG_PRIORITY_NORMAL（默认）, TIM.TYPES.MSG_PRIORITY_LOW, TIM.TYPES.MSG_PRIORITY_LOWEST</span>
  <span class="token comment">// priority: TIM.TYPES.MSG_PRIORITY_NORMAL,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'imagePicker'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 发送消息</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送成功</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送失败</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Web 端发送图片消息示例2- 传入 File 对象</span>
<span class="token comment">// 先在页面上添加一个 ID 为 &quot;testPasteInput&quot; 的消息输入框，例如 &lt;input type=&quot;text&quot; id=&quot;testPasteInput&quot; placeholder=&quot;截图后粘贴到输入框中&quot; size=&quot;30&quot; /&gt;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'testPasteInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'paste'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> clipboardData <span class="token operator">=</span> e<span class="token punctuation">.</span>clipboardData<span class="token punctuation">;</span>
  <span class="token keyword">let</span> file<span class="token punctuation">;</span>
  <span class="token keyword">let</span> fileCopy<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>clipboardData <span class="token operator">&amp;&amp;</span> clipboardData<span class="token punctuation">.</span>files <span class="token operator">&amp;&amp;</span> clipboardData<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> clipboardData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 图片消息发送成功后，file 指向的内容可能被浏览器清空，如果接入侧有额外的渲染需求，可以提前复制一份数据</span>
    fileCopy <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> file <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'file 是 undefined，请检查代码或浏览器兼容性！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">createImageMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    to<span class="token operator">:</span> <span class="token string">'user1'</span><span class="token punctuation">,</span>
    conversationType<span class="token operator">:</span> <span class="token constant">TIM</span><span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
      file<span class="token operator">:</span> file
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file uploading:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. 发送消息</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> tim<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送成功</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>imResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送失败</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'sendMessage error:'</span><span class="token punctuation">,</span> imError<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="常用错误状态码">常用错误状态码</h2> <table><thead><tr><th style="text-align:left;">错误码</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">6013</td> <td style="text-align:left;"><code>IM SDK</code> 未初始化，初始化成功回调之后重试。</td></tr> <tr><td style="text-align:left;">6014</td> <td style="text-align:left;"><code>IM SDK</code> 未登录，请先登录，成功回调之后重试，或者已被踢下线，可使用 <code>TIMManager getLoginUser</code> 检查当前是否在线。</td></tr> <tr><td style="text-align:left;">6206</td> <td style="text-align:left;"><code>UserSig</code> 过期，请重新获取有效的 <code>UserSig</code> 后再重新登录。</td></tr> <tr><td style="text-align:left;">6208</td> <td style="text-align:left;">其他终端登录同一个帐号，引起已登录的帐号被踢，需重新登录。</td></tr> <tr><td style="text-align:left;">6004</td> <td style="text-align:left;">会话无效，<code>getConversation</code> 时检查是否已经登录，如未登录获取会话，会有此错误码返回。</td></tr> <tr><td style="text-align:left;">6010</td> <td style="text-align:left;"><code>HTTP</code> 请求失败，请检查 <code>URL</code> 地址是否合法，可在网页浏览器尝试访问该 <code>URL</code> 地址。</td></tr> <tr><td style="text-align:left;">60016</td> <td style="text-align:left;">SDKAppID 被禁用。</td></tr> <tr><td style="text-align:left;">10016</td> <td style="text-align:left;">App 后台通过第三方回调拒绝本次操作。(可以通过这个状态码自定义处理禁言等操作)</td></tr> <tr><td style="text-align:left;">10017</td> <td style="text-align:left;">因被禁言而不能发送消息，请检查发送者是否被设置禁言。</td></tr> <tr><td style="text-align:left;">10031</td> <td style="text-align:left;">消息撤回超过了时间限制（默认2分钟）。</td></tr> <tr><td style="text-align:left;">10032</td> <td style="text-align:left;">请求撤回的消息不支持撤回操作。</td></tr> <tr><td style="text-align:left;">10033</td> <td style="text-align:left;">群组类型不支持消息撤回操作。</td></tr> <tr><td style="text-align:left;">10034</td> <td style="text-align:left;">该消息类型不支持删除操作。</td></tr></tbody></table> <h2 id="常见问题">常见问题</h2> <p><strong>1. 小程序如果需要上线或者部署正式环境怎么办？</strong></p> <p>请在【微信公众平台】&gt;【开发】&gt;【开发设置】&gt;【服务器域名】中进行域名配置：</p> <p>将以下域名添加到 <code>request</code> 合法域名：</p> <table><thead><tr><th style="text-align:left;">域名</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">是否必须</th></tr></thead> <tbody><tr><td style="text-align:left;">https://webim.tim.qq.com</td> <td style="text-align:left;">Web IM 业务域名</td> <td style="text-align:left;">必须</td></tr> <tr><td style="text-align:left;">https://yun.tim.qq.com</td> <td style="text-align:left;">Web IM 业务域名</td> <td style="text-align:left;">必须</td></tr> <tr><td style="text-align:left;">https://events.tim.qq.com</td> <td style="text-align:left;">Web IM 业务域名</td> <td style="text-align:left;">必须</td></tr> <tr><td style="text-align:left;">https://grouptalk.c2c.qq.com</td> <td style="text-align:left;">Web IM 业务域名</td> <td style="text-align:left;">必须</td></tr> <tr><td style="text-align:left;">https://pingtas.qq.com</td> <td style="text-align:left;">Web IM 统计域名</td> <td style="text-align:left;">必须</td></tr></tbody></table> <p>将以下域名添加到 <code>uploadFile</code> 合法域名：</p> <table><thead><tr><th style="text-align:left;">域名</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">是否必须</th></tr></thead> <tbody><tr><td style="text-align:left;">https://cos.ap-shanghai.myqcloud.com</td> <td style="text-align:left;">文件上传域名</td> <td style="text-align:left;">必须</td></tr></tbody></table> <p>将以下域名添加到 <code>downloadFile</code> 合法域名：</p> <table><thead><tr><th style="text-align:left;">域名</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">是否必须</th></tr></thead> <tbody><tr><td style="text-align:left;">https://cos.ap-shanghai.myqcloud.com</td> <td style="text-align:left;">文件下载域名</td> <td style="text-align:left;">必须</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2020-06-30 09:46:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/open/performance.html" class="prev">
        前端性能优化对业务产生的影响
      </a></span> <span class="next"><a href="/docs/im/base.html">
        /im/base.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="gitalk-container"><div id="gitalk-container"></div></div><div></div><!----></div></div>
    <script src="/docs/assets/js/app.091d26e2.js" defer></script><script src="/docs/assets/js/2.01d5cf40.js" defer></script><script src="/docs/assets/js/66.79354d2d.js" defer></script>
  </body>
</html>
